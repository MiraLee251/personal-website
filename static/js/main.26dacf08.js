/*! For license information please see main.26dacf08.js.LICENSE.txt */
(()=>{"use strict";var e={4:(e,t,n)=>{var i=n(853),r=n(43),a=n(950);function o(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function c(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function l(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(c(e)!==e)throw Error(o(188))}function d(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=d(e)))return t;e=e.sibling}return null}var h=Object.assign,p=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),k=Symbol.for("react.consumer"),T=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope");var O=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var x=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var I=Symbol.iterator;function _(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=I&&e[I]||e["@@iterator"])?e:null}var N=Symbol.for("react.client.reference");function D(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===N?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case g:return"Fragment";case b:return"Profiler";case v:return"StrictMode";case w:return"Suspense";case E:return"SuspenseList";case O:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case m:return"Portal";case T:return(e.displayName||"Context")+".Provider";case k:return(e._context.displayName||"Context")+".Consumer";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case P:return null!==(t=e.displayName||null)?t:D(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return D(e(t))}catch(n){}}return null}var M=Array.isArray,A=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,U={pending:!1,data:null,method:null,action:null},j=[],F=-1;function B(e){return{current:e}}function z(e){0>F||(e.current=j[F],j[F]=null,F--)}function V(e,t){F++,j[F]=e.current,e.current=t}var q=B(null),H=B(null),W=B(null),G=B(null);function K(e,t){switch(V(W,t),V(H,e),V(q,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?ad(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=od(t=ad(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}z(q),V(q,e)}function Q(){z(q),z(H),z(W)}function J(e){null!==e.memoizedState&&V(G,e);var t=q.current,n=od(t,e.type);t!==n&&(V(H,e),V(q,n))}function $(e){H.current===e&&(z(q),z(H)),G.current===e&&(z(G),Jd._currentValue=U)}var Y=Object.prototype.hasOwnProperty,X=i.unstable_scheduleCallback,Z=i.unstable_cancelCallback,ee=i.unstable_shouldYield,te=i.unstable_requestPaint,ne=i.unstable_now,ie=i.unstable_getCurrentPriorityLevel,re=i.unstable_ImmediatePriority,ae=i.unstable_UserBlockingPriority,oe=i.unstable_NormalPriority,se=i.unstable_LowPriority,ce=i.unstable_IdlePriority,le=i.log,ue=i.unstable_setDisableYieldValue,de=null,he=null;function pe(e){if("function"===typeof le&&ue(e),he&&"function"===typeof he.setStrictMode)try{he.setStrictMode(de,e)}catch(t){}}var fe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(me(e)/ge|0)|0},me=Math.log,ge=Math.LN2;var ve=256,be=4194304;function ye(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ke(e,t,n){var i=e.pendingLanes;if(0===i)return 0;var r=0,a=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var s=134217727&i;return 0!==s?0!==(i=s&~a)?r=ye(i):0!==(o&=s)?r=ye(o):n||0!==(n=s&~e)&&(r=ye(n)):0!==(s=i&~a)?r=ye(s):0!==o?r=ye(o):n||0!==(n=i&~e)&&(r=ye(n)),0===r?0:0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(n=t&-t)||32===a&&0!==(4194048&n))?t:r}function Se(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Te(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Ce(){var e=ve;return 0===(4194048&(ve<<=1))&&(ve=256),e}function we(){var e=be;return 0===(62914560&(be<<=1))&&(be=4194304),e}function Ee(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Pe(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Re(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var i=31-fe(t);e.entangledLanes|=t,e.entanglements[i]=1073741824|e.entanglements[i]|4194090&n}function Oe(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-fe(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}function xe(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ie(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function _e(){var e=L.p;return 0!==e?e:void 0===(e=window.event)?32:uh(e.type)}var Ne=Math.random().toString(36).slice(2),De="__reactFiber$"+Ne,Me="__reactProps$"+Ne,Ae="__reactContainer$"+Ne,Le="__reactEvents$"+Ne,Ue="__reactListeners$"+Ne,je="__reactHandles$"+Ne,Fe="__reactResources$"+Ne,Be="__reactMarker$"+Ne;function ze(e){delete e[De],delete e[Me],delete e[Le],delete e[Ue],delete e[je]}function Ve(e){var t=e[De];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ae]||n[De]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=kd(e);null!==e;){if(n=e[De])return n;e=kd(e)}return t}n=(e=n).parentNode}return null}function qe(e){if(e=e[De]||e[Ae]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function He(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(o(33))}function We(e){var t=e[Fe];return t||(t=e[Fe]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Ge(e){e[Be]=!0}var Ke=new Set,Qe={};function Je(e,t){$e(e,t),$e(e+"Capture",t)}function $e(e,t){for(Qe[e]=t,e=0;e<t.length;e++)Ke.add(t[e])}var Ye,Xe,Ze=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),et={},tt={};function nt(e,t,n){if(r=t,Y.call(tt,r)||!Y.call(et,r)&&(Ze.test(r)?tt[r]=!0:(et[r]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var i=t.toLowerCase().slice(0,5);if("data-"!==i&&"aria-"!==i)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var r}function it(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function rt(e,t,n,i){if(null===i)e.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+i)}}function at(e){if(void 0===Ye)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ye=t&&t[1]||"",Xe=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Ye+e+Xe}var ot=!1;function st(e,t){if(!e||ot)return"";ot=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(r){var i=r}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){i=a}e.call(n.prototype)}}else{try{throw Error()}catch(o){i=o}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(s){if(s&&i&&"string"===typeof s.stack)return[s.stack,i.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=i.DetermineComponentFrameRoot(),o=a[0],s=a[1];if(o&&s){var c=o.split("\n"),l=s.split("\n");for(r=i=0;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;for(;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;if(i===c.length||r===l.length)for(i=c.length-1,r=l.length-1;1<=i&&0<=r&&c[i]!==l[r];)r--;for(;1<=i&&0<=r;i--,r--)if(c[i]!==l[r]){if(1!==i||1!==r)do{if(i--,0>--r||c[i]!==l[r]){var u="\n"+c[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=i&&0<=r);break}}}finally{ot=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?at(n):""}function ct(e){switch(e.tag){case 26:case 27:case 5:return at(e.type);case 16:return at("Lazy");case 13:return at("Suspense");case 19:return at("SuspenseList");case 0:case 15:return st(e.type,!1);case 11:return st(e.type.render,!1);case 1:return st(e.type,!0);case 31:return at("Activity");default:return""}}function lt(e){try{var t="";do{t+=ct(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function ut(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ht(e){e._valueTracker||(e._valueTracker=function(e){var t=dt(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function pt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=dt(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function ft(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(S){return e.body}}var mt=/[\n"\\]/g;function gt(e){return e.replace(mt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function vt(e,t,n,i,r,a,o,s){e.name="",null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o?e.type=o:e.removeAttribute("type"),null!=t?"number"===o?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ut(t)):e.value!==""+ut(t)&&(e.value=""+ut(t)):"submit"!==o&&"reset"!==o||e.removeAttribute("value"),null!=t?yt(e,o,ut(t)):null!=n?yt(e,o,ut(n)):null!=i&&e.removeAttribute("value"),null==r&&null!=a&&(e.defaultChecked=!!a),null!=r&&(e.checked=r&&"function"!==typeof r&&"symbol"!==typeof r),null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.name=""+ut(s):e.removeAttribute("name")}function bt(e,t,n,i,r,a,o,s){if(null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.type=a),null!=t||null!=n){if(!("submit"!==a&&"reset"!==a||void 0!==t&&null!==t))return;n=null!=n?""+ut(n):"",t=null!=t?""+ut(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}i="function"!==typeof(i=null!=i?i:r)&&"symbol"!==typeof i&&!!i,e.checked=s?e.checked:!!i,e.defaultChecked=!!i,null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(e.name=o)}function yt(e,t,n){"number"===t&&ft(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function kt(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+ut(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function St(e,t,n){null==t||((t=""+ut(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ut(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function Tt(e,t,n,i){if(null==t){if(null!=i){if(null!=n)throw Error(o(92));if(M(i)){if(1<i.length)throw Error(o(93));i=i[0]}n=i}null==n&&(n=""),t=n}n=ut(t),e.defaultValue=n,(i=e.textContent)===n&&""!==i&&null!==i&&(e.value=i)}function Ct(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var wt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Et(e,t,n){var i=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?i?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":i?e.setProperty(t,n):"number"!==typeof n||0===n||wt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Pt(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(o(62));if(e=e.style,null!=n){for(var i in n)!n.hasOwnProperty(i)||null!=t&&t.hasOwnProperty(i)||(0===i.indexOf("--")?e.setProperty(i,""):"float"===i?e.cssFloat="":e[i]="");for(var r in t)i=t[r],t.hasOwnProperty(r)&&n[r]!==i&&Et(e,r,i)}else for(var a in t)t.hasOwnProperty(a)&&Et(e,a,t[a])}function Rt(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ot=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function It(e){return xt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var _t=null;function Nt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Dt=null,Mt=null;function At(e){var t=qe(e);if(t&&(e=t.stateNode)){var n=e[Me]||null;e:switch(e=t.stateNode,t.type){case"input":if(vt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+gt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=i[Me]||null;if(!r)throw Error(o(90));vt(i,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<n.length;t++)(i=n[t]).form===e.form&&pt(i)}break e;case"textarea":St(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&kt(e,!!n.multiple,t,!1)}}}var Lt=!1;function Ut(e,t,n){if(Lt)return e(t,n);Lt=!0;try{return e(t)}finally{if(Lt=!1,(null!==Dt||null!==Mt)&&(Vl(),Dt&&(t=Dt,e=Mt,Mt=Dt=null,At(t),e)))for(t=0;t<e.length;t++)At(e[t])}}function jt(e,t){var n=e.stateNode;if(null===n)return null;var i=n[Me]||null;if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Ft=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Bt=!1;if(Ft)try{var zt={};Object.defineProperty(zt,"passive",{get:function(){Bt=!0}}),window.addEventListener("test",zt,zt),window.removeEventListener("test",zt,zt)}catch(S){Bt=!1}var Vt=null,qt=null,Ht=null;function Wt(){if(Ht)return Ht;var e,t,n=qt,i=n.length,r="value"in Vt?Vt.value:Vt.textContent,a=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[a-t];t++);return Ht=r.slice(e,1<t?1-t:void 0)}function Gt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Kt(){return!0}function Qt(){return!1}function Jt(e){function t(t,n,i,r,a){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?Kt:Qt,this.isPropagationStopped=Qt,this}return h(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Kt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Kt)},persist:function(){},isPersistent:Kt}),t}var $t,Yt,Xt,Zt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},en=Jt(Zt),tn=h({},Zt,{view:0,detail:0}),nn=Jt(tn),rn=h({},tn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Xt&&(Xt&&"mousemove"===e.type?($t=e.screenX-Xt.screenX,Yt=e.screenY-Xt.screenY):Yt=$t=0,Xt=e),$t)},movementY:function(e){return"movementY"in e?e.movementY:Yt}}),an=Jt(rn),on=Jt(h({},rn,{dataTransfer:0})),sn=Jt(h({},tn,{relatedTarget:0})),cn=Jt(h({},Zt,{animationName:0,elapsedTime:0,pseudoElement:0})),ln=Jt(h({},Zt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),un=Jt(h({},Zt,{data:0})),dn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=pn[e])&&!!t[e]}function mn(){return fn}var gn=Jt(h({},tn,{key:function(e){if(e.key){var t=dn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Gt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mn,charCode:function(e){return"keypress"===e.type?Gt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Gt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),vn=Jt(h({},rn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),bn=Jt(h({},tn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mn})),yn=Jt(h({},Zt,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=Jt(h({},rn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Sn=Jt(h({},Zt,{newState:0,oldState:0})),Tn=[9,13,27,32],Cn=Ft&&"CompositionEvent"in window,wn=null;Ft&&"documentMode"in document&&(wn=document.documentMode);var En=Ft&&"TextEvent"in window&&!wn,Pn=Ft&&(!Cn||wn&&8<wn&&11>=wn),Rn=String.fromCharCode(32),On=!1;function xn(e,t){switch(e){case"keyup":return-1!==Tn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function In(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var _n=!1;var Nn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Nn[e.type]:"textarea"===t}function Mn(e,t,n,i){Dt?Mt?Mt.push(i):Mt=[i]:Dt=i,0<(t=Wu(t,"onChange")).length&&(n=new en("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var An=null,Ln=null;function Un(e){Uu(e,0)}function jn(e){if(pt(He(e)))return e}function Fn(e,t){if("change"===e)return t}var Bn=!1;if(Ft){var zn;if(Ft){var Vn="oninput"in document;if(!Vn){var qn=document.createElement("div");qn.setAttribute("oninput","return;"),Vn="function"===typeof qn.oninput}zn=Vn}else zn=!1;Bn=zn&&(!document.documentMode||9<document.documentMode)}function Hn(){An&&(An.detachEvent("onpropertychange",Wn),Ln=An=null)}function Wn(e){if("value"===e.propertyName&&jn(Ln)){var t=[];Mn(t,Ln,e,Nt(e)),Ut(Un,t)}}function Gn(e,t,n){"focusin"===e?(Hn(),Ln=n,(An=t).attachEvent("onpropertychange",Wn)):"focusout"===e&&Hn()}function Kn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return jn(Ln)}function Qn(e,t){if("click"===e)return jn(t)}function Jn(e,t){if("input"===e||"change"===e)return jn(t)}var $n="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Yn(e,t){if($n(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Y.call(t,r)||!$n(e[r],t[r]))return!1}return!0}function Xn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Zn(e,t){var n,i=Xn(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Xn(i)}}function ei(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ei(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ti(e){for(var t=ft((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=ft((e=t.contentWindow).document)}return t}function ni(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ii=Ft&&"documentMode"in document&&11>=document.documentMode,ri=null,ai=null,oi=null,si=!1;function ci(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;si||null==ri||ri!==ft(i)||("selectionStart"in(i=ri)&&ni(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},oi&&Yn(oi,i)||(oi=i,0<(i=Wu(ai,"onSelect")).length&&(t=new en("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=ri)))}function li(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ui={animationend:li("Animation","AnimationEnd"),animationiteration:li("Animation","AnimationIteration"),animationstart:li("Animation","AnimationStart"),transitionrun:li("Transition","TransitionRun"),transitionstart:li("Transition","TransitionStart"),transitioncancel:li("Transition","TransitionCancel"),transitionend:li("Transition","TransitionEnd")},di={},hi={};function pi(e){if(di[e])return di[e];if(!ui[e])return e;var t,n=ui[e];for(t in n)if(n.hasOwnProperty(t)&&t in hi)return di[e]=n[t];return e}Ft&&(hi=document.createElement("div").style,"AnimationEvent"in window||(delete ui.animationend.animation,delete ui.animationiteration.animation,delete ui.animationstart.animation),"TransitionEvent"in window||delete ui.transitionend.transition);var fi=pi("animationend"),mi=pi("animationiteration"),gi=pi("animationstart"),vi=pi("transitionrun"),bi=pi("transitionstart"),yi=pi("transitioncancel"),ki=pi("transitionend"),Si=new Map,Ti="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ci(e,t){Si.set(e,t),Je(t,[e])}Ti.push("scrollEnd");var wi=new WeakMap;function Ei(e,t){if("object"===typeof e&&null!==e){var n=wi.get(e);return void 0!==n?n:(t={value:e,source:t,stack:lt(t)},wi.set(e,t),t)}return{value:e,source:t,stack:lt(t)}}var Pi=[],Ri=0,Oi=0;function xi(){for(var e=Ri,t=Oi=Ri=0;t<e;){var n=Pi[t];Pi[t++]=null;var i=Pi[t];Pi[t++]=null;var r=Pi[t];Pi[t++]=null;var a=Pi[t];if(Pi[t++]=null,null!==i&&null!==r){var o=i.pending;null===o?r.next=r:(r.next=o.next,o.next=r),i.pending=r}0!==a&&Di(n,r,a)}}function Ii(e,t,n,i){Pi[Ri++]=e,Pi[Ri++]=t,Pi[Ri++]=n,Pi[Ri++]=i,Oi|=i,e.lanes|=i,null!==(e=e.alternate)&&(e.lanes|=i)}function _i(e,t,n,i){return Ii(e,t,n,i),Mi(e)}function Ni(e,t){return Ii(e,null,null,t),Mi(e)}function Di(e,t,n){e.lanes|=n;var i=e.alternate;null!==i&&(i.lanes|=n);for(var r=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(i=a.alternate)&&(i.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(r=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,r&&null!==t&&(r=31-fe(n),null===(i=(e=a.hiddenUpdates)[r])?e[r]=[t]:i.push(t),t.lane=536870912|n),a):null}function Mi(e){if(50<Dl)throw Dl=0,Ml=null,Error(o(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Ai={};function Li(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ui(e,t,n,i){return new Li(e,t,n,i)}function ji(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Fi(e,t){var n=e.alternate;return null===n?((n=Ui(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Bi(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function zi(e,t,n,i,r,a){var s=0;if(i=e,"function"===typeof e)ji(e)&&(s=1);else if("string"===typeof e)s=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,q.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case O:return(e=Ui(31,n,t,r)).elementType=O,e.lanes=a,e;case g:return Vi(n.children,r,a,t);case v:s=8,r|=24;break;case b:return(e=Ui(12,n,t,2|r)).elementType=b,e.lanes=a,e;case w:return(e=Ui(13,n,t,r)).elementType=w,e.lanes=a,e;case E:return(e=Ui(19,n,t,r)).elementType=E,e.lanes=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case y:case T:s=10;break e;case k:s=9;break e;case C:s=11;break e;case P:s=14;break e;case R:s=16,i=null;break e}s=29,n=Error(o(130,null===e?"null":typeof e,"")),i=null}return(t=Ui(s,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function Vi(e,t,n,i){return(e=Ui(7,e,i,t)).lanes=n,e}function qi(e,t,n){return(e=Ui(6,e,null,t)).lanes=n,e}function Hi(e,t,n){return(t=Ui(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Wi=[],Gi=0,Ki=null,Qi=0,Ji=[],$i=0,Yi=null,Xi=1,Zi="";function er(e,t){Wi[Gi++]=Qi,Wi[Gi++]=Ki,Ki=e,Qi=t}function tr(e,t,n){Ji[$i++]=Xi,Ji[$i++]=Zi,Ji[$i++]=Yi,Yi=e;var i=Xi;e=Zi;var r=32-fe(i)-1;i&=~(1<<r),n+=1;var a=32-fe(t)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Xi=1<<32-fe(t)+r|n<<r|i,Zi=a+e}else Xi=1<<a|n<<r|i,Zi=e}function nr(e){null!==e.return&&(er(e,1),tr(e,1,0))}function ir(e){for(;e===Ki;)Ki=Wi[--Gi],Wi[Gi]=null,Qi=Wi[--Gi],Wi[Gi]=null;for(;e===Yi;)Yi=Ji[--$i],Ji[$i]=null,Zi=Ji[--$i],Ji[$i]=null,Xi=Ji[--$i],Ji[$i]=null}var rr=null,ar=null,or=!1,sr=null,cr=!1,lr=Error(o(519));function ur(e){throw gr(Ei(Error(o(418,"")),e)),lr}function dr(e){var t=e.stateNode,n=e.type,i=e.memoizedProps;switch(t[De]=e,t[Me]=i,n){case"dialog":ju("cancel",t),ju("close",t);break;case"iframe":case"object":case"embed":ju("load",t);break;case"video":case"audio":for(n=0;n<Au.length;n++)ju(Au[n],t);break;case"source":ju("error",t);break;case"img":case"image":case"link":ju("error",t),ju("load",t);break;case"details":ju("toggle",t);break;case"input":ju("invalid",t),bt(t,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0),ht(t);break;case"select":ju("invalid",t);break;case"textarea":ju("invalid",t),Tt(t,i.value,i.defaultValue,i.children),ht(t)}"string"!==typeof(n=i.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===i.suppressHydrationWarning||Yu(t.textContent,n)?(null!=i.popover&&(ju("beforetoggle",t),ju("toggle",t)),null!=i.onScroll&&ju("scroll",t),null!=i.onScrollEnd&&ju("scrollend",t),null!=i.onClick&&(t.onclick=Xu),t=!0):t=!1,t||ur(e)}function hr(e){for(rr=e.return;rr;)switch(rr.tag){case 5:case 13:return void(cr=!1);case 27:case 3:return void(cr=!0);default:rr=rr.return}}function pr(e){if(e!==rr)return!1;if(!or)return hr(e),or=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||sd(e.type,e.memoizedProps)),t=!t),t&&ar&&ur(e),hr(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){ar=bd(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}ar=null}}else 27===n?(n=ar,fd(e.type)?(e=yd,yd=null,ar=e):ar=n):ar=rr?bd(e.stateNode.nextSibling):null;return!0}function fr(){ar=rr=null,or=!1}function mr(){var e=sr;return null!==e&&(null===kl?kl=e:kl.push.apply(kl,e),sr=null),e}function gr(e){null===sr?sr=[e]:sr.push(e)}var vr=B(null),br=null,yr=null;function kr(e,t,n){V(vr,t._currentValue),t._currentValue=n}function Sr(e){e._currentValue=vr.current,z(vr)}function Tr(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Cr(e,t,n,i){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var a=r.dependencies;if(null!==a){var s=r.child;a=a.firstContext;e:for(;null!==a;){var c=a;a=r;for(var l=0;l<t.length;l++)if(c.context===t[l]){a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Tr(a.return,n,e),i||(s=null);break e}a=c.next}}else if(18===r.tag){if(null===(s=r.return))throw Error(o(341));s.lanes|=n,null!==(a=s.alternate)&&(a.lanes|=n),Tr(s,n,e),s=null}else s=r.child;if(null!==s)s.return=r;else for(s=r;null!==s;){if(s===e){s=null;break}if(null!==(r=s.sibling)){r.return=s.return,s=r;break}s=s.return}r=s}}function wr(e,t,n,i){e=null;for(var r=t,a=!1;null!==r;){if(!a)if(0!==(524288&r.flags))a=!0;else if(0!==(262144&r.flags))break;if(10===r.tag){var s=r.alternate;if(null===s)throw Error(o(387));if(null!==(s=s.memoizedProps)){var c=r.type;$n(r.pendingProps.value,s.value)||(null!==e?e.push(c):e=[c])}}else if(r===G.current){if(null===(s=r.alternate))throw Error(o(387));s.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(Jd):e=[Jd])}r=r.return}null!==e&&Cr(t,e,n,i),t.flags|=262144}function Er(e){for(e=e.firstContext;null!==e;){if(!$n(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Pr(e){br=e,yr=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Rr(e){return xr(br,e)}function Or(e,t){return null===br&&Pr(e),xr(e,t)}function xr(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===yr){if(null===e)throw Error(o(308));yr=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else yr=yr.next=t;return n}var Ir="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},_r=i.unstable_scheduleCallback,Nr=i.unstable_NormalPriority,Dr={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Mr(){return{controller:new Ir,data:new Map,refCount:0}}function Ar(e){e.refCount--,0===e.refCount&&_r(Nr,function(){e.controller.abort()})}var Lr=null,Ur=0,jr=0,Fr=null;function Br(){if(0===--Ur&&null!==Lr){null!==Fr&&(Fr.status="fulfilled");var e=Lr;Lr=null,jr=0,Fr=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var zr=A.S;A.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Lr){var n=Lr=[];Ur=0,jr=Iu(),Fr={status:"pending",value:void 0,then:function(e){n.push(e)}}}Ur++,t.then(Br,Br)}(0,t),null!==zr&&zr(e,t)};var Vr=B(null);function qr(){var e=Vr.current;return null!==e?e:rl.pooledCache}function Hr(e,t){V(Vr,null===t?Vr.current:t.pool)}function Wr(){var e=qr();return null===e?null:{parent:Dr._currentValue,pool:e}}var Gr=Error(o(460)),Kr=Error(o(474)),Qr=Error(o(542)),Jr={then:function(){}};function $r(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Yr(){}function Xr(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Yr,Yr),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw ta(e=t.reason),e;default:if("string"===typeof t.status)t.then(Yr,Yr);else{if(null!==(e=rl)&&100<e.shellSuspendCounter)throw Error(o(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw ta(e=t.reason),e}throw Zr=t,Gr}}var Zr=null;function ea(){if(null===Zr)throw Error(o(459));var e=Zr;return Zr=null,e}function ta(e){if(e===Gr||e===Qr)throw Error(o(483))}var na=!1;function ia(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ra(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function aa(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function oa(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&il)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,t=Mi(e),Di(e,null,n),t}return Ii(e,i,t,n),Mi(e)}function sa(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Oe(e,n)}}function ca(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,callbacks:i.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var la=!1;function ua(){if(la){if(null!==Fr)throw Fr}}function da(e,t,n,i){la=!1;var r=e.updateQueue;na=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var c=s,l=c.next;c.next=null,null===o?a=l:o.next=l,o=c;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(null!==a){var d=r.baseState;for(o=0,u=l=c=null,s=a;;){var p=-536870913&s.lane,f=p!==s.lane;if(f?(ol&p)===p:(i&p)===p){0!==p&&p===jr&&(la=!0),null!==u&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var m=e,g=s;p=t;var v=n;switch(g.tag){case 1:if("function"===typeof(m=g.payload)){d=m.call(v,d,p);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(p="function"===typeof(m=g.payload)?m.call(v,d,p):m)||void 0===p)break e;d=h({},d,p);break e;case 2:na=!0}}null!==(p=s.callback)&&(e.flags|=64,f&&(e.flags|=8192),null===(f=r.callbacks)?r.callbacks=[p]:f.push(p))}else f={lane:p,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(l=u=f,c=d):u=u.next=f,o|=p;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(f=s).next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}null===u&&(c=d),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,null===a&&(r.shared.lanes=0),fl|=o,e.lanes=o,e.memoizedState=d}}function ha(e,t){if("function"!==typeof e)throw Error(o(191,e));e.call(t)}function pa(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ha(n[e],t)}var fa=B(null),ma=B(0);function ga(e,t){V(ma,e=hl),V(fa,t),hl=e|t.baseLanes}function va(){V(ma,hl),V(fa,fa.current)}function ba(){hl=ma.current,z(fa),z(ma)}var ya=0,ka=null,Sa=null,Ta=null,Ca=!1,wa=!1,Ea=!1,Pa=0,Ra=0,Oa=null,xa=0;function Ia(){throw Error(o(321))}function _a(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!$n(e[n],t[n]))return!1;return!0}function Na(e,t,n,i,r,a){return ya=a,ka=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,A.H=null===e||null===e.memoizedState?Ko:Qo,Ea=!1,a=n(i,r),Ea=!1,wa&&(a=Ma(t,n,i,r)),Da(e),a}function Da(e){A.H=Go;var t=null!==Sa&&null!==Sa.next;if(ya=0,Ta=Sa=ka=null,Ca=!1,Ra=0,Oa=null,t)throw Error(o(300));null===e||Os||null!==(e=e.dependencies)&&Er(e)&&(Os=!0)}function Ma(e,t,n,i){ka=e;var r=0;do{if(wa&&(Oa=null),Ra=0,wa=!1,25<=r)throw Error(o(301));if(r+=1,Ta=Sa=null,null!=e.updateQueue){var a=e.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,null!=a.memoCache&&(a.memoCache.index=0)}A.H=Jo,a=t(n,i)}while(wa);return a}function Aa(){var e=A.H,t=e.useState()[0];return t="function"===typeof t.then?za(t):t,e=e.useState()[0],(null!==Sa?Sa.memoizedState:null)!==e&&(ka.flags|=1024),t}function La(){var e=0!==Pa;return Pa=0,e}function Ua(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function ja(e){if(Ca){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Ca=!1}ya=0,Ta=Sa=ka=null,wa=!1,Ra=Pa=0,Oa=null}function Fa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ta?ka.memoizedState=Ta=e:Ta=Ta.next=e,Ta}function Ba(){if(null===Sa){var e=ka.alternate;e=null!==e?e.memoizedState:null}else e=Sa.next;var t=null===Ta?ka.memoizedState:Ta.next;if(null!==t)Ta=t,Sa=e;else{if(null===e){if(null===ka.alternate)throw Error(o(467));throw Error(o(310))}e={memoizedState:(Sa=e).memoizedState,baseState:Sa.baseState,baseQueue:Sa.baseQueue,queue:Sa.queue,next:null},null===Ta?ka.memoizedState=Ta=e:Ta=Ta.next=e}return Ta}function za(e){var t=Ra;return Ra+=1,null===Oa&&(Oa=[]),e=Xr(Oa,e,t),t=ka,null===(null===Ta?t.memoizedState:Ta.next)&&(t=t.alternate,A.H=null===t||null===t.memoizedState?Ko:Qo),e}function Va(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return za(e);if(e.$$typeof===T)return Rr(e)}throw Error(o(438,String(e)))}function qa(e){var t=null,n=ka.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var i=ka.alternate;null!==i&&(null!==(i=i.updateQueue)&&(null!=(i=i.memoCache)&&(t={data:i.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},ka.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),i=0;i<e;i++)n[i]=x;return t.index++,n}function Ha(e,t){return"function"===typeof t?t(e):t}function Wa(e){return Ga(Ba(),Sa,e)}function Ga(e,t,n){var i=e.queue;if(null===i)throw Error(o(311));i.lastRenderedReducer=n;var r=e.baseQueue,a=i.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}t.baseQueue=r=a,i.pending=null}if(a=e.baseState,null===r)e.memoizedState=a;else{var c=s=null,l=null,u=t=r.next,d=!1;do{var h=-536870913&u.lane;if(h!==u.lane?(ol&h)===h:(ya&h)===h){var p=u.revertLane;if(0===p)null!==l&&(l=l.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===jr&&(d=!0);else{if((ya&p)===p){u=u.next,p===jr&&(d=!0);continue}h={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===l?(c=l=h,s=a):l=l.next=h,ka.lanes|=p,fl|=p}h=u.action,Ea&&n(a,h),a=u.hasEagerState?u.eagerState:n(a,h)}else p={lane:h,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===l?(c=l=p,s=a):l=l.next=p,ka.lanes|=h,fl|=h;u=u.next}while(null!==u&&u!==t);if(null===l?s=a:l.next=c,!$n(a,e.memoizedState)&&(Os=!0,d&&null!==(n=Fr)))throw n;e.memoizedState=a,e.baseState=s,e.baseQueue=l,i.lastRenderedState=a}return null===r&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Ka(e){var t=Ba(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=e(a,s.action),s=s.next}while(s!==r);$n(a,t.memoizedState)||(Os=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Qa(e,t,n){var i=ka,r=Ba(),a=or;if(a){if(void 0===n)throw Error(o(407));n=n()}else n=t();var s=!$n((Sa||r).memoizedState,n);if(s&&(r.memoizedState=n,Os=!0),r=r.queue,bo(2048,8,Ya.bind(null,i,r,e),[e]),r.getSnapshot!==t||s||null!==Ta&&1&Ta.memoizedState.tag){if(i.flags|=2048,mo(9,{destroy:void 0,resource:void 0},$a.bind(null,i,r,n,t),null),null===rl)throw Error(o(349));a||0!==(124&ya)||Ja(i,t,n)}return n}function Ja(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ka.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},ka.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function $a(e,t,n,i){t.value=n,t.getSnapshot=i,Xa(t)&&Za(e)}function Ya(e,t,n){return n(function(){Xa(t)&&Za(e)})}function Xa(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!$n(e,n)}catch(i){return!0}}function Za(e){var t=Ni(e,2);null!==t&&Ul(t,e,2)}function eo(e){var t=Fa();if("function"===typeof e){var n=e;if(e=n(),Ea){pe(!0);try{n()}finally{pe(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ha,lastRenderedState:e},t}function to(e,t,n,i){return e.baseState=n,Ga(e,Sa,"function"===typeof i?i:Ha)}function no(e,t,n,i,r){if(qo(e))throw Error(o(485));if(null!==(e=t.action)){var a={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){a.listeners.push(e)}};null!==A.T?n(!0):a.isTransition=!1,i(a),null===(n=t.pending)?(a.next=t.pending=a,io(t,a)):(a.next=n.next,t.pending=n.next=a)}}function io(e,t){var n=t.action,i=t.payload,r=e.state;if(t.isTransition){var a=A.T,o={};A.T=o;try{var s=n(r,i),c=A.S;null!==c&&c(o,s),ro(e,t,s)}catch(l){oo(e,t,l)}finally{A.T=a}}else try{ro(e,t,a=n(r,i))}catch(u){oo(e,t,u)}}function ro(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){ao(e,t,n)},function(n){return oo(e,t,n)}):ao(e,t,n)}function ao(e,t,n){t.status="fulfilled",t.value=n,so(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,io(e,n)))}function oo(e,t,n){var i=e.pending;if(e.pending=null,null!==i){i=i.next;do{t.status="rejected",t.reason=n,so(t),t=t.next}while(t!==i)}e.action=null}function so(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function co(e,t){return t}function lo(e,t){if(or){var n=rl.formState;if(null!==n){e:{var i=ka;if(or){if(ar){t:{for(var r=ar,a=cr;8!==r.nodeType;){if(!a){r=null;break t}if(null===(r=bd(r.nextSibling))){r=null;break t}}r="F!"===(a=r.data)||"F"===a?r:null}if(r){ar=bd(r.nextSibling),i="F!"===r.data;break e}}ur(i)}i=!1}i&&(t=n[0])}}return(n=Fa()).memoizedState=n.baseState=t,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:co,lastRenderedState:t},n.queue=i,n=Bo.bind(null,ka,i),i.dispatch=n,i=eo(!1),a=Vo.bind(null,ka,!1,i.queue),r={state:t,dispatch:null,action:e,pending:null},(i=Fa()).queue=r,n=no.bind(null,ka,r,a,n),r.dispatch=n,i.memoizedState=e,[t,n,!1]}function uo(e){return ho(Ba(),Sa,e)}function ho(e,t,n){if(t=Ga(e,t,co)[0],e=Wa(Ha)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var i=za(t)}catch(o){if(o===Gr)throw Qr;throw o}else i=t;var r=(t=Ba()).queue,a=r.dispatch;return n!==t.memoizedState&&(ka.flags|=2048,mo(9,{destroy:void 0,resource:void 0},po.bind(null,r,n),null)),[i,a,e]}function po(e,t){e.action=t}function fo(e){var t=Ba(),n=Sa;if(null!==n)return ho(t,n,e);Ba(),t=t.memoizedState;var i=(n=Ba()).queue.dispatch;return n.memoizedState=e,[t,i,!1]}function mo(e,t,n,i){return e={tag:e,create:n,deps:i,inst:t,next:null},null===(t=ka.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},ka.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function go(){return Ba().memoizedState}function vo(e,t,n,i){var r=Fa();i=void 0===i?null:i,ka.flags|=e,r.memoizedState=mo(1|t,{destroy:void 0,resource:void 0},n,i)}function bo(e,t,n,i){var r=Ba();i=void 0===i?null:i;var a=r.memoizedState.inst;null!==Sa&&null!==i&&_a(i,Sa.memoizedState.deps)?r.memoizedState=mo(t,a,n,i):(ka.flags|=e,r.memoizedState=mo(1|t,a,n,i))}function yo(e,t){vo(8390656,8,e,t)}function ko(e,t){bo(2048,8,e,t)}function So(e,t){return bo(4,2,e,t)}function To(e,t){return bo(4,4,e,t)}function Co(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function wo(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,bo(4,4,Co.bind(null,t,e),n)}function Eo(){}function Po(e,t){var n=Ba();t=void 0===t?null:t;var i=n.memoizedState;return null!==t&&_a(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ro(e,t){var n=Ba();t=void 0===t?null:t;var i=n.memoizedState;if(null!==t&&_a(t,i[1]))return i[0];if(i=e(),Ea){pe(!0);try{e()}finally{pe(!1)}}return n.memoizedState=[i,t],i}function Oo(e,t,n){return void 0===n||0!==(1073741824&ya)?e.memoizedState=t:(e.memoizedState=n,e=Ll(),ka.lanes|=e,fl|=e,n)}function xo(e,t,n,i){return $n(n,t)?n:null!==fa.current?(e=Oo(e,n,i),$n(e,t)||(Os=!0),e):0===(42&ya)?(Os=!0,e.memoizedState=n):(e=Ll(),ka.lanes|=e,fl|=e,t)}function Io(e,t,n,i,r){var a=L.p;L.p=0!==a&&8>a?a:8;var o=A.T,s={};A.T=s,Vo(e,!1,t,n);try{var c=r(),l=A.S;if(null!==l&&l(s,c),null!==c&&"object"===typeof c&&"function"===typeof c.then)zo(e,t,function(e,t){var n=[],i={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){i.status="fulfilled",i.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(i.status="rejected",i.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),i}(c,i),Al());else zo(e,t,i,Al())}catch(u){zo(e,t,{then:function(){},status:"rejected",reason:u},Al())}finally{L.p=a,A.T=o}}function _o(){}function No(e,t,n,i){if(5!==e.tag)throw Error(o(476));var r=Do(e).queue;Io(e,r,t,U,null===n?_o:function(){return Mo(e),n(i)})}function Do(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:U,baseState:U,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ha,lastRenderedState:U},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ha,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Mo(e){zo(e,Do(e).next.queue,{},Al())}function Ao(){return Rr(Jd)}function Lo(){return Ba().memoizedState}function Uo(){return Ba().memoizedState}function jo(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Al(),i=oa(t,e=aa(n),n);return null!==i&&(Ul(i,t,n),sa(i,t,n)),t={cache:Mr()},void(e.payload=t)}t=t.return}}function Fo(e,t,n){var i=Al();n={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},qo(e)?Ho(t,n):null!==(n=_i(e,t,n,i))&&(Ul(n,e,i),Wo(n,t,i))}function Bo(e,t,n){zo(e,t,n,Al())}function zo(e,t,n,i){var r={lane:i,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(qo(e))Ho(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,$n(s,o))return Ii(e,t,r,0),null===rl&&xi(),!1}catch(c){}if(null!==(n=_i(e,t,r,i)))return Ul(n,e,i),Wo(n,t,i),!0}return!1}function Vo(e,t,n,i){if(i={lane:2,revertLane:Iu(),action:i,hasEagerState:!1,eagerState:null,next:null},qo(e)){if(t)throw Error(o(479))}else null!==(t=_i(e,n,i,2))&&Ul(t,e,2)}function qo(e){var t=e.alternate;return e===ka||null!==t&&t===ka}function Ho(e,t){wa=Ca=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Wo(e,t,n){if(0!==(4194048&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Oe(e,n)}}var Go={readContext:Rr,use:Va,useCallback:Ia,useContext:Ia,useEffect:Ia,useImperativeHandle:Ia,useLayoutEffect:Ia,useInsertionEffect:Ia,useMemo:Ia,useReducer:Ia,useRef:Ia,useState:Ia,useDebugValue:Ia,useDeferredValue:Ia,useTransition:Ia,useSyncExternalStore:Ia,useId:Ia,useHostTransitionStatus:Ia,useFormState:Ia,useActionState:Ia,useOptimistic:Ia,useMemoCache:Ia,useCacheRefresh:Ia},Ko={readContext:Rr,use:Va,useCallback:function(e,t){return Fa().memoizedState=[e,void 0===t?null:t],e},useContext:Rr,useEffect:yo,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,vo(4194308,4,Co.bind(null,t,e),n)},useLayoutEffect:function(e,t){return vo(4194308,4,e,t)},useInsertionEffect:function(e,t){vo(4,2,e,t)},useMemo:function(e,t){var n=Fa();t=void 0===t?null:t;var i=e();if(Ea){pe(!0);try{e()}finally{pe(!1)}}return n.memoizedState=[i,t],i},useReducer:function(e,t,n){var i=Fa();if(void 0!==n){var r=n(t);if(Ea){pe(!0);try{n(t)}finally{pe(!1)}}}else r=t;return i.memoizedState=i.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},i.queue=e,e=e.dispatch=Fo.bind(null,ka,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Fa().memoizedState=e},useState:function(e){var t=(e=eo(e)).queue,n=Bo.bind(null,ka,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Eo,useDeferredValue:function(e,t){return Oo(Fa(),e,t)},useTransition:function(){var e=eo(!1);return e=Io.bind(null,ka,e.queue,!0,!1),Fa().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=ka,r=Fa();if(or){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===rl)throw Error(o(349));0!==(124&ol)||Ja(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,yo(Ya.bind(null,i,a,e),[e]),i.flags|=2048,mo(9,{destroy:void 0,resource:void 0},$a.bind(null,i,a,n,t),null),n},useId:function(){var e=Fa(),t=rl.identifierPrefix;if(or){var n=Zi;t="\xab"+t+"R"+(n=(Xi&~(1<<32-fe(Xi)-1)).toString(32)+n),0<(n=Pa++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=xa++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Ao,useFormState:lo,useActionState:lo,useOptimistic:function(e){var t=Fa();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Vo.bind(null,ka,!0,n),n.dispatch=t,[e,t]},useMemoCache:qa,useCacheRefresh:function(){return Fa().memoizedState=jo.bind(null,ka)}},Qo={readContext:Rr,use:Va,useCallback:Po,useContext:Rr,useEffect:ko,useImperativeHandle:wo,useInsertionEffect:So,useLayoutEffect:To,useMemo:Ro,useReducer:Wa,useRef:go,useState:function(){return Wa(Ha)},useDebugValue:Eo,useDeferredValue:function(e,t){return xo(Ba(),Sa.memoizedState,e,t)},useTransition:function(){var e=Wa(Ha)[0],t=Ba().memoizedState;return["boolean"===typeof e?e:za(e),t]},useSyncExternalStore:Qa,useId:Lo,useHostTransitionStatus:Ao,useFormState:uo,useActionState:uo,useOptimistic:function(e,t){return to(Ba(),0,e,t)},useMemoCache:qa,useCacheRefresh:Uo},Jo={readContext:Rr,use:Va,useCallback:Po,useContext:Rr,useEffect:ko,useImperativeHandle:wo,useInsertionEffect:So,useLayoutEffect:To,useMemo:Ro,useReducer:Ka,useRef:go,useState:function(){return Ka(Ha)},useDebugValue:Eo,useDeferredValue:function(e,t){var n=Ba();return null===Sa?Oo(n,e,t):xo(n,Sa.memoizedState,e,t)},useTransition:function(){var e=Ka(Ha)[0],t=Ba().memoizedState;return["boolean"===typeof e?e:za(e),t]},useSyncExternalStore:Qa,useId:Lo,useHostTransitionStatus:Ao,useFormState:fo,useActionState:fo,useOptimistic:function(e,t){var n=Ba();return null!==Sa?to(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:qa,useCacheRefresh:Uo},$o=null,Yo=0;function Xo(e){var t=Yo;return Yo+=1,null===$o&&($o=[]),Xr($o,e,t)}function Zo(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function es(e,t){if(t.$$typeof===p)throw Error(o(525));throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ts(e){return(0,e._init)(e._payload)}function ns(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=Fi(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=67108866,n):i:(t.flags|=67108866,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=qi(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){var a=n.type;return a===g?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===R&&ts(a)===t.type)?(Zo(t=r(t,n.props),n),t.return=e,t):(Zo(t=zi(n.type,n.key,n.props,null,e.mode,i),n),t.return=e,t)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Hi(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,a){return null===t||7!==t.tag?((t=Vi(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=qi(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case f:return Zo(n=zi(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case m:return(t=Hi(t,e.mode,n)).return=e,t;case R:return h(e,t=(0,t._init)(t._payload),n)}if(M(t)||_(t))return(t=Vi(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return h(e,Xo(t),n);if(t.$$typeof===T)return h(e,Or(e,t),n);es(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==r?null:c(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case f:return n.key===r?l(e,t,n,i):null;case m:return n.key===r?u(e,t,n,i):null;case R:return p(e,t,n=(r=n._init)(n._payload),i)}if(M(n)||_(n))return null!==r?null:d(e,t,n,i,null);if("function"===typeof n.then)return p(e,t,Xo(n),i);if(n.$$typeof===T)return p(e,t,Or(e,n),i);es(e,n)}return null}function v(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i||"bigint"===typeof i)return c(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case f:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case m:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case R:return v(e,t,n,i=(0,i._init)(i._payload),r)}if(M(i)||_(i))return d(t,e=e.get(n)||null,i,r,null);if("function"===typeof i.then)return v(e,t,n,Xo(i),r);if(i.$$typeof===T)return v(e,t,n,Or(t,i),r);es(t,i)}return null}function b(c,l,u,d){if("object"===typeof u&&null!==u&&u.type===g&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case f:e:{for(var y=u.key;null!==l;){if(l.key===y){if((y=u.type)===g){if(7===l.tag){n(c,l.sibling),(d=r(l,u.props.children)).return=c,c=d;break e}}else if(l.elementType===y||"object"===typeof y&&null!==y&&y.$$typeof===R&&ts(y)===l.type){n(c,l.sibling),Zo(d=r(l,u.props),u),d.return=c,c=d;break e}n(c,l);break}t(c,l),l=l.sibling}u.type===g?((d=Vi(u.props.children,c.mode,d,u.key)).return=c,c=d):(Zo(d=zi(u.type,u.key,u.props,null,c.mode,d),u),d.return=c,c=d)}return s(c);case m:e:{for(y=u.key;null!==l;){if(l.key===y){if(4===l.tag&&l.stateNode.containerInfo===u.containerInfo&&l.stateNode.implementation===u.implementation){n(c,l.sibling),(d=r(l,u.children||[])).return=c,c=d;break e}n(c,l);break}t(c,l),l=l.sibling}(d=Hi(u,c.mode,d)).return=c,c=d}return s(c);case R:return b(c,l,u=(y=u._init)(u._payload),d)}if(M(u))return function(r,o,s,c){for(var l=null,u=null,d=o,f=o=0,m=null;null!==d&&f<s.length;f++){d.index>f?(m=d,d=null):m=d.sibling;var g=p(r,d,s[f],c);if(null===g){null===d&&(d=m);break}e&&d&&null===g.alternate&&t(r,d),o=a(g,o,f),null===u?l=g:u.sibling=g,u=g,d=m}if(f===s.length)return n(r,d),or&&er(r,f),l;if(null===d){for(;f<s.length;f++)null!==(d=h(r,s[f],c))&&(o=a(d,o,f),null===u?l=d:u.sibling=d,u=d);return or&&er(r,f),l}for(d=i(d);f<s.length;f++)null!==(m=v(d,r,f,s[f],c))&&(e&&null!==m.alternate&&d.delete(null===m.key?f:m.key),o=a(m,o,f),null===u?l=m:u.sibling=m,u=m);return e&&d.forEach(function(e){return t(r,e)}),or&&er(r,f),l}(c,l,u,d);if(_(u)){if("function"!==typeof(y=_(u)))throw Error(o(150));return function(r,s,c,l){if(null==c)throw Error(o(151));for(var u=null,d=null,f=s,m=s=0,g=null,b=c.next();null!==f&&!b.done;m++,b=c.next()){f.index>m?(g=f,f=null):g=f.sibling;var y=p(r,f,b.value,l);if(null===y){null===f&&(f=g);break}e&&f&&null===y.alternate&&t(r,f),s=a(y,s,m),null===d?u=y:d.sibling=y,d=y,f=g}if(b.done)return n(r,f),or&&er(r,m),u;if(null===f){for(;!b.done;m++,b=c.next())null!==(b=h(r,b.value,l))&&(s=a(b,s,m),null===d?u=b:d.sibling=b,d=b);return or&&er(r,m),u}for(f=i(f);!b.done;m++,b=c.next())null!==(b=v(f,r,m,b.value,l))&&(e&&null!==b.alternate&&f.delete(null===b.key?m:b.key),s=a(b,s,m),null===d?u=b:d.sibling=b,d=b);return e&&f.forEach(function(e){return t(r,e)}),or&&er(r,m),u}(c,l,u=y.call(u),d)}if("function"===typeof u.then)return b(c,l,Xo(u),d);if(u.$$typeof===T)return b(c,l,Or(c,u),d);es(c,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==l&&6===l.tag?(n(c,l.sibling),(d=r(l,u)).return=c,c=d):(n(c,l),(d=qi(u,c.mode,d)).return=c,c=d),s(c)):n(c,l)}return function(e,t,n,i){try{Yo=0;var r=b(e,t,n,i);return $o=null,r}catch(o){if(o===Gr||o===Qr)throw o;var a=Ui(29,o,null,e.mode);return a.lanes=i,a.return=e,a}}}var is=ns(!0),rs=ns(!1),as=B(null),os=null;function ss(e){var t=e.alternate;V(ds,1&ds.current),V(as,e),null===os&&(null===t||null!==fa.current||null!==t.memoizedState)&&(os=e)}function cs(e){if(22===e.tag){if(V(ds,ds.current),V(as,e),null===os){var t=e.alternate;null!==t&&null!==t.memoizedState&&(os=e)}}else ls()}function ls(){V(ds,ds.current),V(as,as.current)}function us(e){z(as),os===e&&(os=null),z(ds)}var ds=B(0);function hs(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||vd(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ps(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:h({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var fs={enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Al(),r=aa(i);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=oa(e,r,i))&&(Ul(t,e,i),sa(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Al(),r=aa(i);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=oa(e,r,i))&&(Ul(t,e,i),sa(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Al(),i=aa(n);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=oa(e,i,n))&&(Ul(t,e,n),sa(t,e,n))}};function ms(e,t,n,i,r,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!Yn(n,i)||!Yn(r,a))}function gs(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&fs.enqueueReplaceState(t,t.state,null)}function vs(e,t){var n=t;if("ref"in t)for(var i in n={},t)"ref"!==i&&(n[i]=t[i]);if(e=e.defaultProps)for(var r in n===t&&(n=h({},n)),e)void 0===n[r]&&(n[r]=e[r]);return n}var bs="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function ys(e){bs(e)}function ks(e){console.error(e)}function Ss(e){bs(e)}function Ts(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Cs(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function ws(e,t,n){return(n=aa(n)).tag=3,n.payload={element:null},n.callback=function(){Ts(e,t)},n}function Es(e){return(e=aa(e)).tag=3,e}function Ps(e,t,n,i){var r=n.type.getDerivedStateFromError;if("function"===typeof r){var a=i.value;e.payload=function(){return r(a)},e.callback=function(){Cs(t,n,i)}}var o=n.stateNode;null!==o&&"function"===typeof o.componentDidCatch&&(e.callback=function(){Cs(t,n,i),"function"!==typeof r&&(null===El?El=new Set([this]):El.add(this));var e=i.stack;this.componentDidCatch(i.value,{componentStack:null!==e?e:""})})}var Rs=Error(o(461)),Os=!1;function xs(e,t,n,i){t.child=null===e?rs(t,null,n,i):is(t,e.child,n,i)}function Is(e,t,n,i,r){n=n.render;var a=t.ref;if("ref"in i){var o={};for(var s in i)"ref"!==s&&(o[s]=i[s])}else o=i;return Pr(t),i=Na(e,t,n,o,a,r),s=La(),null===e||Os?(or&&s&&nr(t),t.flags|=1,xs(e,t,i,r),t.child):(Ua(e,t,r),$s(e,t,r))}function _s(e,t,n,i,r){if(null===e){var a=n.type;return"function"!==typeof a||ji(a)||void 0!==a.defaultProps||null!==n.compare?((e=zi(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ns(e,t,a,i,r))}if(a=e.child,!Ys(e,r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:Yn)(o,i)&&e.ref===t.ref)return $s(e,t,r)}return t.flags|=1,(e=Fi(a,i)).ref=t.ref,e.return=t,t.child=e}function Ns(e,t,n,i,r){if(null!==e){var a=e.memoizedProps;if(Yn(a,i)&&e.ref===t.ref){if(Os=!1,t.pendingProps=i=a,!Ys(e,r))return t.lanes=e.lanes,$s(e,t,r);0!==(131072&e.flags)&&(Os=!0)}}return Ls(e,t,n,i,r)}function Ds(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode){if(0!==(128&t.flags)){if(i=null!==a?a.baseLanes|n:n,null!==e){for(r=t.child=e.child,a=0;null!==r;)a=a|r.lanes|r.childLanes,r=r.sibling;t.childLanes=a&~i}else t.childLanes=0,t.child=null;return Ms(e,t,i,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Ms(e,t,null!==a?a.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Hr(0,null!==a?a.cachePool:null),null!==a?ga(t,a):va(),cs(t)}else null!==a?(Hr(0,a.cachePool),ga(t,a),ls(),t.memoizedState=null):(null!==e&&Hr(0,null),va(),ls());return xs(e,t,r,n),t.child}function Ms(e,t,n,i){var r=qr();return r=null===r?null:{parent:Dr._currentValue,pool:r},t.memoizedState={baseLanes:n,cachePool:r},null!==e&&Hr(0,null),va(),cs(t),null!==e&&wr(e,t,i,!0),null}function As(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(o(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Ls(e,t,n,i,r){return Pr(t),n=Na(e,t,n,i,void 0,r),i=La(),null===e||Os?(or&&i&&nr(t),t.flags|=1,xs(e,t,n,r),t.child):(Ua(e,t,r),$s(e,t,r))}function Us(e,t,n,i,r,a){return Pr(t),t.updateQueue=null,n=Ma(t,i,n,r),Da(e),i=La(),null===e||Os?(or&&i&&nr(t),t.flags|=1,xs(e,t,n,a),t.child):(Ua(e,t,a),$s(e,t,a))}function js(e,t,n,i,r){if(Pr(t),null===t.stateNode){var a=Ai,o=n.contextType;"object"===typeof o&&null!==o&&(a=Rr(o)),a=new n(i,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=fs,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=i,a.state=t.memoizedState,a.refs={},ia(t),o=n.contextType,a.context="object"===typeof o&&null!==o?Rr(o):Ai,a.state=t.memoizedState,"function"===typeof(o=n.getDerivedStateFromProps)&&(ps(t,n,o,i),a.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(o=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),o!==a.state&&fs.enqueueReplaceState(a,a.state,null),da(t,i,a,r),ua(),a.state=t.memoizedState),"function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!0}else if(null===e){a=t.stateNode;var s=t.memoizedProps,c=vs(n,s);a.props=c;var l=a.context,u=n.contextType;o=Ai,"object"===typeof u&&null!==u&&(o=Rr(u));var d=n.getDerivedStateFromProps;u="function"===typeof d||"function"===typeof a.getSnapshotBeforeUpdate,s=t.pendingProps!==s,u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s||l!==o)&&gs(t,a,i,o),na=!1;var h=t.memoizedState;a.state=h,da(t,i,a,r),ua(),l=t.memoizedState,s||h!==l||na?("function"===typeof d&&(ps(t,n,d,i),l=t.memoizedState),(c=na||ms(t,n,c,i,h,l,o))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=o,i=c):("function"===typeof a.componentDidMount&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,ra(e,t),u=vs(n,o=t.memoizedProps),a.props=u,d=t.pendingProps,h=a.context,l=n.contextType,c=Ai,"object"===typeof l&&null!==l&&(c=Rr(l)),(l="function"===typeof(s=n.getDerivedStateFromProps)||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==d||h!==c)&&gs(t,a,i,c),na=!1,h=t.memoizedState,a.state=h,da(t,i,a,r),ua();var p=t.memoizedState;o!==d||h!==p||na||null!==e&&null!==e.dependencies&&Er(e.dependencies)?("function"===typeof s&&(ps(t,n,s,i),p=t.memoizedState),(u=na||ms(t,n,u,i,h,p,c)||null!==e&&null!==e.dependencies&&Er(e.dependencies))?(l||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,p,c),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,p,c)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),a.props=i,a.state=p,a.context=c,i=u):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return a=i,As(e,t),i=0!==(128&t.flags),a||i?(a=t.stateNode,n=i&&"function"!==typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&i?(t.child=is(t,e.child,null,r),t.child=is(t,null,n,r)):xs(e,t,n,r),t.memoizedState=a.state,e=t.child):e=$s(e,t,r),e}function Fs(e,t,n,i){return fr(),t.flags|=256,xs(e,t,n,i),t.child}var Bs={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function zs(e){return{baseLanes:e,cachePool:Wr()}}function Vs(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=vl),e}function qs(e,t,n){var i,r=t.pendingProps,a=!1,s=0!==(128&t.flags);if((i=s)||(i=(null===e||null!==e.memoizedState)&&0!==(2&ds.current)),i&&(a=!0,t.flags&=-129),i=0!==(32&t.flags),t.flags&=-33,null===e){if(or){if(a?ss(t):ls(),or){var c,l=ar;if(c=l){e:{for(c=l,l=cr;8!==c.nodeType;){if(!l){l=null;break e}if(null===(c=bd(c.nextSibling))){l=null;break e}}l=c}null!==l?(t.memoizedState={dehydrated:l,treeContext:null!==Yi?{id:Xi,overflow:Zi}:null,retryLane:536870912,hydrationErrors:null},(c=Ui(18,null,null,0)).stateNode=l,c.return=t,t.child=c,rr=t,ar=null,c=!0):c=!1}c||ur(t)}if(null!==(l=t.memoizedState)&&null!==(l=l.dehydrated))return vd(l)?t.lanes=32:t.lanes=536870912,null;us(t)}return l=r.children,r=r.fallback,a?(ls(),l=Ws({mode:"hidden",children:l},a=t.mode),r=Vi(r,a,n,null),l.return=t,r.return=t,l.sibling=r,t.child=l,(a=t.child).memoizedState=zs(n),a.childLanes=Vs(e,i,n),t.memoizedState=Bs,r):(ss(t),Hs(t,l))}if(null!==(c=e.memoizedState)&&null!==(l=c.dehydrated)){if(s)256&t.flags?(ss(t),t.flags&=-257,t=Gs(e,t,n)):null!==t.memoizedState?(ls(),t.child=e.child,t.flags|=128,t=null):(ls(),a=r.fallback,l=t.mode,r=Ws({mode:"visible",children:r.children},l),(a=Vi(a,l,n,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,is(t,e.child,null,n),(r=t.child).memoizedState=zs(n),r.childLanes=Vs(e,i,n),t.memoizedState=Bs,t=a);else if(ss(t),vd(l)){if(i=l.nextSibling&&l.nextSibling.dataset)var u=i.dgst;i=u,(r=Error(o(419))).stack="",r.digest=i,gr({value:r,source:null,stack:null}),t=Gs(e,t,n)}else if(Os||wr(e,t,n,!1),i=0!==(n&e.childLanes),Os||i){if(null!==(i=rl)&&(0!==(r=0!==((r=0!==(42&(r=n&-n))?1:xe(r))&(i.suspendedLanes|n))?0:r)&&r!==c.retryLane))throw c.retryLane=r,Ni(e,r),Ul(i,e,r),Rs;"$?"===l.data||Ql(),t=Gs(e,t,n)}else"$?"===l.data?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,ar=bd(l.nextSibling),rr=t,or=!0,sr=null,cr=!1,null!==e&&(Ji[$i++]=Xi,Ji[$i++]=Zi,Ji[$i++]=Yi,Xi=e.id,Zi=e.overflow,Yi=t),(t=Hs(t,r.children)).flags|=4096);return t}return a?(ls(),a=r.fallback,l=t.mode,u=(c=e.child).sibling,(r=Fi(c,{mode:"hidden",children:r.children})).subtreeFlags=65011712&c.subtreeFlags,null!==u?a=Fi(u,a):(a=Vi(a,l,n,null)).flags|=2,a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,null===(l=e.child.memoizedState)?l=zs(n):(null!==(c=l.cachePool)?(u=Dr._currentValue,c=c.parent!==u?{parent:u,pool:u}:c):c=Wr(),l={baseLanes:l.baseLanes|n,cachePool:c}),a.memoizedState=l,a.childLanes=Vs(e,i,n),t.memoizedState=Bs,r):(ss(t),e=(n=e.child).sibling,(n=Fi(n,{mode:"visible",children:r.children})).return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n)}function Hs(e,t){return(t=Ws({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Ws(e,t){return(e=Ui(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Gs(e,t,n){return is(t,e.child,null,n),(e=Hs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ks(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Tr(e.return,t,n)}function Qs(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function Js(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(xs(e,t,i.children,n),0!==(2&(i=ds.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ks(e,n,t);else if(19===e.tag)Ks(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}switch(V(ds,i),r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===hs(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Qs(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===hs(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Qs(t,!0,n,null,a);break;case"together":Qs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function $s(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),fl|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(wr(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Fi(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Fi(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ys(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Er(e))}function Xs(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Os=!0;else{if(!Ys(e,n)&&0===(128&t.flags))return Os=!1,function(e,t,n){switch(t.tag){case 3:K(t,t.stateNode.containerInfo),kr(0,Dr,e.memoizedState.cache),fr();break;case 27:case 5:J(t);break;case 4:K(t,t.stateNode.containerInfo);break;case 10:kr(0,t.type,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(ss(t),t.flags|=128,null):0!==(n&t.child.childLanes)?qs(e,t,n):(ss(t),null!==(e=$s(e,t,n))?e.sibling:null);ss(t);break;case 19:var r=0!==(128&e.flags);if((i=0!==(n&t.childLanes))||(wr(e,t,n,!1),i=0!==(n&t.childLanes)),r){if(i)return Js(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),V(ds,ds.current),i)break;return null;case 22:case 23:return t.lanes=0,Ds(e,t,n);case 24:kr(0,Dr,e.memoizedState.cache)}return $s(e,t,n)}(e,t,n);Os=0!==(131072&e.flags)}else Os=!1,or&&0!==(1048576&t.flags)&&tr(t,Qi,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var i=t.elementType,r=i._init;if(i=r(i._payload),t.type=i,"function"!==typeof i){if(void 0!==i&&null!==i){if((r=i.$$typeof)===C){t.tag=11,t=Is(null,t,i,e,n);break e}if(r===P){t.tag=14,t=_s(null,t,i,e,n);break e}}throw t=D(i)||i,Error(o(306,t,""))}ji(i)?(e=vs(i,e),t.tag=1,t=js(null,t,i,e,n)):(t.tag=0,t=Ls(null,t,i,e,n))}return t;case 0:return Ls(e,t,t.type,t.pendingProps,n);case 1:return js(e,t,i=t.type,r=vs(i,t.pendingProps),n);case 3:e:{if(K(t,t.stateNode.containerInfo),null===e)throw Error(o(387));i=t.pendingProps;var a=t.memoizedState;r=a.element,ra(e,t),da(t,i,null,n);var s=t.memoizedState;if(i=s.cache,kr(0,Dr,i),i!==a.cache&&Cr(t,[Dr],n,!0),ua(),i=s.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Fs(e,t,i,n);break e}if(i!==r){gr(r=Ei(Error(o(424)),t)),t=Fs(e,t,i,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ar=bd(e.firstChild),rr=t,or=!0,sr=null,cr=!0,n=rs(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fr(),i===r){t=$s(e,t,n);break e}xs(e,t,i,n)}t=t.child}return t;case 26:return As(e,t),null===e?(n=xd(t.type,null,t.pendingProps,null))?t.memoizedState=n:or||(n=t.type,e=t.pendingProps,(i=rd(W.current).createElement(n))[De]=t,i[Me]=e,td(i,n,e),Ge(i),t.stateNode=i):t.memoizedState=xd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return J(t),null===e&&or&&(i=t.stateNode=Sd(t.type,t.pendingProps,W.current),rr=t,cr=!0,r=ar,fd(t.type)?(yd=r,ar=bd(i.firstChild)):ar=r),xs(e,t,t.pendingProps.children,n),As(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&or&&((r=i=ar)&&(null!==(i=function(e,t,n,i){for(;1===e.nodeType;){var r=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!i&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(i){if(!e[Be])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(a=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(a!==r.rel||e.getAttribute("href")!==(null==r.href||""===r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((a=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&a&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var a=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===a)return e}if(null===(e=bd(e.nextSibling)))break}return null}(i,t.type,t.pendingProps,cr))?(t.stateNode=i,rr=t,ar=bd(i.firstChild),cr=!1,r=!0):r=!1),r||ur(t)),J(t),r=t.type,a=t.pendingProps,s=null!==e?e.memoizedProps:null,i=a.children,sd(r,a)?i=null:null!==s&&sd(r,s)&&(t.flags|=32),null!==t.memoizedState&&(r=Na(e,t,Aa,null,null,n),Jd._currentValue=r),As(e,t),xs(e,t,i,n),t.child;case 6:return null===e&&or&&((e=n=ar)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=bd(e.nextSibling)))return null}return e}(n,t.pendingProps,cr))?(t.stateNode=n,rr=t,ar=null,e=!0):e=!1),e||ur(t)),null;case 13:return qs(e,t,n);case 4:return K(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=is(t,null,i,n):xs(e,t,i,n),t.child;case 11:return Is(e,t,t.type,t.pendingProps,n);case 7:return xs(e,t,t.pendingProps,n),t.child;case 8:case 12:return xs(e,t,t.pendingProps.children,n),t.child;case 10:return i=t.pendingProps,kr(0,t.type,i.value),xs(e,t,i.children,n),t.child;case 9:return r=t.type._context,i=t.pendingProps.children,Pr(t),i=i(r=Rr(r)),t.flags|=1,xs(e,t,i,n),t.child;case 14:return _s(e,t,t.type,t.pendingProps,n);case 15:return Ns(e,t,t.type,t.pendingProps,n);case 19:return Js(e,t,n);case 31:return i=t.pendingProps,n=t.mode,i={mode:i.mode,children:i.children},null===e?((n=Ws(i,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Fi(e.child,i)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Ds(e,t,n);case 24:return Pr(t),i=Rr(Dr),null===e?(null===(r=qr())&&(r=rl,a=Mr(),r.pooledCache=a,a.refCount++,null!==a&&(r.pooledCacheLanes|=n),r=a),t.memoizedState={parent:i,cache:r},ia(t),kr(0,Dr,r)):(0!==(e.lanes&n)&&(ra(e,t),da(t,null,null,n),ua()),r=e.memoizedState,a=t.memoizedState,r.parent!==i?(r={parent:i,cache:i},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),kr(0,Dr,i)):(i=a.cache,kr(0,Dr,i),i!==r.cache&&Cr(t,[Dr],n,!0))),xs(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(o(156,t.tag))}function Zs(e){e.flags|=4}function ec(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Vd(t)){if(null!==(t=as.current)&&((4194048&ol)===ol?null!==os:(62914560&ol)!==ol&&0===(536870912&ol)||t!==os))throw Zr=Jr,Kr;e.flags|=8192}}function tc(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?we():536870912,e.lanes|=t,bl|=t)}function nc(e,t){if(!or)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function ic(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=65011712&r.subtreeFlags,i|=65011712&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function rc(e,t,n){var i=t.pendingProps;switch(ir(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return ic(t),null;case 3:return n=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),Sr(Dr),Q(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(pr(t)?Zs(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,mr())),ic(t),null;case 26:return n=t.memoizedState,null===e?(Zs(t),null!==n?(ic(t),ec(t,n)):(ic(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Zs(t),ic(t),ec(t,n)):(ic(t),t.flags&=-16777217):(e.memoizedProps!==i&&Zs(t),ic(t),t.flags&=-16777217),null;case 27:$(t),n=W.current;var r=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Zs(t);else{if(!i){if(null===t.stateNode)throw Error(o(166));return ic(t),null}e=q.current,pr(t)?dr(t):(e=Sd(r,i,n),t.stateNode=e,Zs(t))}return ic(t),null;case 5:if($(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==i&&Zs(t);else{if(!i){if(null===t.stateNode)throw Error(o(166));return ic(t),null}if(e=q.current,pr(t))dr(t);else{switch(r=rd(W.current),e){case 1:e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=r.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=r.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=r.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof i.is?r.createElement("select",{is:i.is}):r.createElement("select"),i.multiple?e.multiple=!0:i.size&&(e.size=i.size);break;default:e="string"===typeof i.is?r.createElement(n,{is:i.is}):r.createElement(n)}}e[De]=t,e[Me]=i;e:for(r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;null===r.sibling;){if(null===r.return||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=e;e:switch(td(e,n,i),n){case"button":case"input":case"select":case"textarea":e=!!i.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Zs(t)}}return ic(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==i&&Zs(t);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));if(e=W.current,pr(t)){if(e=t.stateNode,n=t.memoizedProps,i=null,null!==(r=rr))switch(r.tag){case 27:case 5:i=r.memoizedProps}e[De]=t,(e=!!(e.nodeValue===n||null!==i&&!0===i.suppressHydrationWarning||Yu(e.nodeValue,n)))||ur(t)}else(e=rd(e).createTextNode(i))[De]=t,t.stateNode=e}return ic(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=pr(t),null!==i&&null!==i.dehydrated){if(null===e){if(!r)throw Error(o(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(o(317));r[De]=t}else fr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;ic(t),r=!1}else r=mr(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return 256&t.flags?(us(t),t):(us(t),null)}if(us(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==i,e=null!==e&&null!==e.memoizedState,n){r=null,null!==(i=t.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(r=i.alternate.memoizedState.cachePool.pool);var a=null;null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(a=i.memoizedState.cachePool.pool),a!==r&&(i.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),tc(t,t.updateQueue),ic(t),null;case 4:return Q(),null===e&&zu(t.stateNode.containerInfo),ic(t),null;case 10:return Sr(t.type),ic(t),null;case 19:if(z(ds),null===(r=t.memoizedState))return ic(t),null;if(i=0!==(128&t.flags),null===(a=r.rendering))if(i)nc(r,!1);else{if(0!==pl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=hs(e))){for(t.flags|=128,nc(r,!1),e=a.updateQueue,t.updateQueue=e,tc(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Bi(n,e),n=n.sibling;return V(ds,1&ds.current|2),t.child}e=e.sibling}null!==r.tail&&ne()>Cl&&(t.flags|=128,i=!0,nc(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=hs(a))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,tc(t,e),nc(r,!0),null===r.tail&&"hidden"===r.tailMode&&!a.alternate&&!or)return ic(t),null}else 2*ne()-r.renderingStartTime>Cl&&536870912!==n&&(t.flags|=128,i=!0,nc(r,!1),t.lanes=4194304);r.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=r.last)?e.sibling=a:t.child=a,r.last=a)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=ne(),t.sibling=null,e=ds.current,V(ds,i?1&e|2:1&e),t):(ic(t),null);case 22:case 23:return us(t),ba(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?0!==(536870912&n)&&0===(128&t.flags)&&(ic(t),6&t.subtreeFlags&&(t.flags|=8192)):ic(t),null!==(n=t.updateQueue)&&tc(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),null!==e&&z(Vr),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Sr(Dr),ic(t),null;case 25:case 30:return null}throw Error(o(156,t.tag))}function ac(e,t){switch(ir(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Sr(Dr),Q(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return $(t),null;case 13:if(us(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return z(ds),null;case 4:return Q(),null;case 10:return Sr(t.type),null;case 22:case 23:return us(t),ba(),null!==e&&z(Vr),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Sr(Dr),null;default:return null}}function oc(e,t){switch(ir(t),t.tag){case 3:Sr(Dr),Q();break;case 26:case 27:case 5:$(t);break;case 4:Q();break;case 13:us(t);break;case 19:z(ds);break;case 10:Sr(t.type);break;case 22:case 23:us(t),ba(),null!==e&&z(Vr);break;case 24:Sr(Dr)}}function sc(e,t){try{var n=t.updateQueue,i=null!==n?n.lastEffect:null;if(null!==i){var r=i.next;n=r;do{if((n.tag&e)===e){i=void 0;var a=n.create,o=n.inst;i=a(),o.destroy=i}n=n.next}while(n!==r)}}catch(s){du(t,t.return,s)}}function cc(e,t,n){try{var i=t.updateQueue,r=null!==i?i.lastEffect:null;if(null!==r){var a=r.next;i=a;do{if((i.tag&e)===e){var o=i.inst,s=o.destroy;if(void 0!==s){o.destroy=void 0,r=t;var c=n,l=s;try{l()}catch(u){du(r,c,u)}}}i=i.next}while(i!==a)}}catch(u){du(t,t.return,u)}}function lc(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{pa(t,n)}catch(i){du(e,e.return,i)}}}function uc(e,t,n){n.props=vs(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(i){du(e,t,i)}}function dc(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var i=e.stateNode;break;default:i=e.stateNode}"function"===typeof n?e.refCleanup=n(i):n.current=i}}catch(r){du(e,t,r)}}function hc(e,t){var n=e.ref,i=e.refCleanup;if(null!==n)if("function"===typeof i)try{i()}catch(r){du(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(a){du(e,t,a)}else n.current=null}function pc(e){var t=e.type,n=e.memoizedProps,i=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(r){du(e,e.return,r)}}function fc(e,t,n){try{var i=e.stateNode;!function(e,t,n,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,a=null,s=null,c=null,l=null,u=null,d=null;for(f in n){var h=n[f];if(n.hasOwnProperty(f)&&null!=h)switch(f){case"checked":case"value":break;case"defaultValue":l=h;default:i.hasOwnProperty(f)||Zu(e,t,f,null,i,h)}}for(var p in i){var f=i[p];if(h=n[p],i.hasOwnProperty(p)&&(null!=f||null!=h))switch(p){case"type":a=f;break;case"name":r=f;break;case"checked":u=f;break;case"defaultChecked":d=f;break;case"value":s=f;break;case"defaultValue":c=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(o(137,t));break;default:f!==h&&Zu(e,t,p,f,i,h)}}return void vt(e,s,c,l,u,d,a,r);case"select":for(a in f=s=c=p=null,n)if(l=n[a],n.hasOwnProperty(a)&&null!=l)switch(a){case"value":break;case"multiple":f=l;default:i.hasOwnProperty(a)||Zu(e,t,a,null,i,l)}for(r in i)if(a=i[r],l=n[r],i.hasOwnProperty(r)&&(null!=a||null!=l))switch(r){case"value":p=a;break;case"defaultValue":c=a;break;case"multiple":s=a;default:a!==l&&Zu(e,t,r,a,i,l)}return t=c,n=s,i=f,void(null!=p?kt(e,!!n,p,!1):!!i!==!!n&&(null!=t?kt(e,!!n,t,!0):kt(e,!!n,n?[]:"",!1)));case"textarea":for(c in f=p=null,n)if(r=n[c],n.hasOwnProperty(c)&&null!=r&&!i.hasOwnProperty(c))switch(c){case"value":case"children":break;default:Zu(e,t,c,null,i,r)}for(s in i)if(r=i[s],a=n[s],i.hasOwnProperty(s)&&(null!=r||null!=a))switch(s){case"value":p=r;break;case"defaultValue":f=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(o(91));break;default:r!==a&&Zu(e,t,s,r,i,a)}return void St(e,p,f);case"option":for(var m in n)if(p=n[m],n.hasOwnProperty(m)&&null!=p&&!i.hasOwnProperty(m))if("selected"===m)e.selected=!1;else Zu(e,t,m,null,i,p);for(l in i)if(p=i[l],f=n[l],i.hasOwnProperty(l)&&p!==f&&(null!=p||null!=f))if("selected"===l)e.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else Zu(e,t,l,p,i,f);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)p=n[g],n.hasOwnProperty(g)&&null!=p&&!i.hasOwnProperty(g)&&Zu(e,t,g,null,i,p);for(u in i)if(p=i[u],f=n[u],i.hasOwnProperty(u)&&p!==f&&(null!=p||null!=f))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(o(137,t));break;default:Zu(e,t,u,p,i,f)}return;default:if(Rt(t)){for(var v in n)p=n[v],n.hasOwnProperty(v)&&void 0!==p&&!i.hasOwnProperty(v)&&ed(e,t,v,void 0,i,p);for(d in i)p=i[d],f=n[d],!i.hasOwnProperty(d)||p===f||void 0===p&&void 0===f||ed(e,t,d,p,i,f);return}}for(var b in n)p=n[b],n.hasOwnProperty(b)&&null!=p&&!i.hasOwnProperty(b)&&Zu(e,t,b,null,i,p);for(h in i)p=i[h],f=n[h],!i.hasOwnProperty(h)||p===f||null==p&&null==f||Zu(e,t,h,p,i,f)}(i,e.type,n,t),i[Me]=t}catch(r){du(e,e.return,r)}}function mc(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&fd(e.type)||4===e.tag}function gc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||mc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&fd(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function vc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Xu));else if(4!==i&&(27===i&&fd(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(vc(e,t,n),e=e.sibling;null!==e;)vc(e,t,n),e=e.sibling}function bc(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&(27===i&&fd(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(bc(e,t,n),e=e.sibling;null!==e;)bc(e,t,n),e=e.sibling}function yc(e){var t=e.stateNode,n=e.memoizedProps;try{for(var i=e.type,r=t.attributes;r.length;)t.removeAttributeNode(r[0]);td(t,i,n),t[De]=e,t[Me]=n}catch(a){du(e,e.return,a)}}var kc=!1,Sc=!1,Tc=!1,Cc="function"===typeof WeakSet?WeakSet:Set,wc=null;function Ec(e,t,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:jc(e,n),4&i&&sc(5,n);break;case 1:if(jc(e,n),4&i)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(o){du(n,n.return,o)}else{var r=vs(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(s){du(n,n.return,s)}}64&i&&lc(n),512&i&&dc(n,n.return);break;case 3:if(jc(e,n),64&i&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{pa(e,t)}catch(o){du(n,n.return,o)}}break;case 27:null===t&&4&i&&yc(n);case 26:case 5:jc(e,n),null===t&&4&i&&pc(n),512&i&&dc(n,n.return);break;case 12:jc(e,n);break;case 13:jc(e,n),4&i&&_c(e,n),64&i&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var i=function(){t(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),e._reactRetry=i}}(e,n=mu.bind(null,n))));break;case 22:if(!(i=null!==n.memoizedState||kc)){t=null!==t&&null!==t.memoizedState||Sc,r=kc;var a=Sc;kc=i,(Sc=t)&&!a?Bc(e,n,0!==(8772&n.subtreeFlags)):jc(e,n),kc=r,Sc=a}break;case 30:break;default:jc(e,n)}}function Pc(e){var t=e.alternate;null!==t&&(e.alternate=null,Pc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ze(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Rc=null,Oc=!1;function xc(e,t,n){for(n=n.child;null!==n;)Ic(e,t,n),n=n.sibling}function Ic(e,t,n){if(he&&"function"===typeof he.onCommitFiberUnmount)try{he.onCommitFiberUnmount(de,n)}catch(a){}switch(n.tag){case 26:Sc||hc(n,t),xc(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Sc||hc(n,t);var i=Rc,r=Oc;fd(n.type)&&(Rc=n.stateNode,Oc=!1),xc(e,t,n),Td(n.stateNode),Rc=i,Oc=r;break;case 5:Sc||hc(n,t);case 6:if(i=Rc,r=Oc,Rc=null,xc(e,t,n),Oc=r,null!==(Rc=i))if(Oc)try{(9===Rc.nodeType?Rc.body:"HTML"===Rc.nodeName?Rc.ownerDocument.body:Rc).removeChild(n.stateNode)}catch(o){du(n,t,o)}else try{Rc.removeChild(n.stateNode)}catch(o){du(n,t,o)}break;case 18:null!==Rc&&(Oc?(md(9===(e=Rc).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Oh(e)):md(Rc,n.stateNode));break;case 4:i=Rc,r=Oc,Rc=n.stateNode.containerInfo,Oc=!0,xc(e,t,n),Rc=i,Oc=r;break;case 0:case 11:case 14:case 15:Sc||cc(2,n,t),Sc||cc(4,n,t),xc(e,t,n);break;case 1:Sc||(hc(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount&&uc(n,t,i)),xc(e,t,n);break;case 21:xc(e,t,n);break;case 22:Sc=(i=Sc)||null!==n.memoizedState,xc(e,t,n),Sc=i;break;default:xc(e,t,n)}}function _c(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Oh(e)}catch(n){du(t,t.return,n)}}function Nc(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Cc),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Cc),t;default:throw Error(o(435,e.tag))}}(e);t.forEach(function(t){var i=gu.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}function Dc(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i],a=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 27:if(fd(c.type)){Rc=c.stateNode,Oc=!1;break e}break;case 5:Rc=c.stateNode,Oc=!1;break e;case 3:case 4:Rc=c.stateNode.containerInfo,Oc=!0;break e}c=c.return}if(null===Rc)throw Error(o(160));Ic(a,s,r),Rc=null,Oc=!1,null!==(a=r.alternate)&&(a.return=null),r.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Ac(t,e),t=t.sibling}var Mc=null;function Ac(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Dc(t,e),Lc(e),4&i&&(cc(3,e,e.return),sc(3,e),cc(5,e,e.return));break;case 1:Dc(t,e),Lc(e),512&i&&(Sc||null===n||hc(n,n.return)),64&i&&kc&&(null!==(e=e.updateQueue)&&(null!==(i=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?i:n.concat(i))));break;case 26:var r=Mc;if(Dc(t,e),Lc(e),512&i&&(Sc||null===n||hc(n,n.return)),4&i){var a=null!==n?n.memoizedState:null;if(i=e.memoizedState,null===n)if(null===i)if(null===e.stateNode){e:{i=e.type,n=e.memoizedProps,r=r.ownerDocument||r;t:switch(i){case"title":(!(a=r.getElementsByTagName("title")[0])||a[Be]||a[De]||"http://www.w3.org/2000/svg"===a.namespaceURI||a.hasAttribute("itemprop"))&&(a=r.createElement(i),r.head.insertBefore(a,r.querySelector("head > title"))),td(a,i,n),a[De]=e,Ge(a),i=a;break e;case"link":var s=Bd("link","href",r).get(i+(n.href||""));if(s)for(var c=0;c<s.length;c++)if((a=s[c]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&a.getAttribute("rel")===(null==n.rel?null:n.rel)&&a.getAttribute("title")===(null==n.title?null:n.title)&&a.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(c,1);break t}td(a=r.createElement(i),i,n),r.head.appendChild(a);break;case"meta":if(s=Bd("meta","content",r).get(i+(n.content||"")))for(c=0;c<s.length;c++)if((a=s[c]).getAttribute("content")===(null==n.content?null:""+n.content)&&a.getAttribute("name")===(null==n.name?null:n.name)&&a.getAttribute("property")===(null==n.property?null:n.property)&&a.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&a.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(c,1);break t}td(a=r.createElement(i),i,n),r.head.appendChild(a);break;default:throw Error(o(468,i))}a[De]=e,Ge(a),i=a}e.stateNode=i}else zd(r,e.type,e.stateNode);else e.stateNode=Ad(r,i,e.memoizedProps);else a!==i?(null===a?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):a.count--,null===i?zd(r,e.type,e.stateNode):Ad(r,i,e.memoizedProps)):null===i&&null!==e.stateNode&&fc(e,e.memoizedProps,n.memoizedProps)}break;case 27:Dc(t,e),Lc(e),512&i&&(Sc||null===n||hc(n,n.return)),null!==n&&4&i&&fc(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Dc(t,e),Lc(e),512&i&&(Sc||null===n||hc(n,n.return)),32&e.flags){r=e.stateNode;try{Ct(r,"")}catch(f){du(e,e.return,f)}}4&i&&null!=e.stateNode&&fc(e,r=e.memoizedProps,null!==n?n.memoizedProps:r),1024&i&&(Tc=!0);break;case 6:if(Dc(t,e),Lc(e),4&i){if(null===e.stateNode)throw Error(o(162));i=e.memoizedProps,n=e.stateNode;try{n.nodeValue=i}catch(f){du(e,e.return,f)}}break;case 3:if(Fd=null,r=Mc,Mc=Ed(t.containerInfo),Dc(t,e),Mc=r,Lc(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Oh(t.containerInfo)}catch(f){du(e,e.return,f)}Tc&&(Tc=!1,Uc(e));break;case 4:i=Mc,Mc=Ed(e.stateNode.containerInfo),Dc(t,e),Lc(e),Mc=i;break;case 12:default:Dc(t,e),Lc(e);break;case 13:Dc(t,e),Lc(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(Tl=ne()),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,Nc(e,i)));break;case 22:r=null!==e.memoizedState;var l=null!==n&&null!==n.memoizedState,u=kc,d=Sc;if(kc=u||r,Sc=d||l,Dc(t,e),Sc=d,kc=u,Lc(e),8192&i)e:for(t=e.stateNode,t._visibility=r?-2&t._visibility:1|t._visibility,r&&(null===n||l||kc||Sc||Fc(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){l=n=t;try{if(a=l.stateNode,r)"function"===typeof(s=a.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{c=l.stateNode;var h=l.memoizedProps.style,p=void 0!==h&&null!==h&&h.hasOwnProperty("display")?h.display:null;c.style.display=null==p||"boolean"===typeof p?"":(""+p).trim()}}catch(f){du(l,l.return,f)}}}else if(6===t.tag){if(null===n){l=t;try{l.stateNode.nodeValue=r?"":l.memoizedProps}catch(f){du(l,l.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&i&&(null!==(i=e.updateQueue)&&(null!==(n=i.retryQueue)&&(i.retryQueue=null,Nc(e,n))));break;case 19:Dc(t,e),Lc(e),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,Nc(e,i)));case 30:case 21:}}function Lc(e){var t=e.flags;if(2&t){try{for(var n,i=e.return;null!==i;){if(mc(i)){n=i;break}i=i.return}if(null==n)throw Error(o(160));switch(n.tag){case 27:var r=n.stateNode;bc(e,gc(e),r);break;case 5:var a=n.stateNode;32&n.flags&&(Ct(a,""),n.flags&=-33),bc(e,gc(e),a);break;case 3:case 4:var s=n.stateNode.containerInfo;vc(e,gc(e),s);break;default:throw Error(o(161))}}catch(c){du(e,e.return,c)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Uc(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Uc(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function jc(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Ec(e,t.alternate,t),t=t.sibling}function Fc(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:cc(4,t,t.return),Fc(t);break;case 1:hc(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&uc(t,t.return,n),Fc(t);break;case 27:Td(t.stateNode);case 26:case 5:hc(t,t.return),Fc(t);break;case 22:null===t.memoizedState&&Fc(t);break;default:Fc(t)}e=e.sibling}}function Bc(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var i=t.alternate,r=e,a=t,o=a.flags;switch(a.tag){case 0:case 11:case 15:Bc(r,a,n),sc(4,a);break;case 1:if(Bc(r,a,n),"function"===typeof(r=(i=a).stateNode).componentDidMount)try{r.componentDidMount()}catch(l){du(i,i.return,l)}if(null!==(r=(i=a).updateQueue)){var s=i.stateNode;try{var c=r.shared.hiddenCallbacks;if(null!==c)for(r.shared.hiddenCallbacks=null,r=0;r<c.length;r++)ha(c[r],s)}catch(l){du(i,i.return,l)}}n&&64&o&&lc(a),dc(a,a.return);break;case 27:yc(a);case 26:case 5:Bc(r,a,n),n&&null===i&&4&o&&pc(a),dc(a,a.return);break;case 12:Bc(r,a,n);break;case 13:Bc(r,a,n),n&&4&o&&_c(r,a);break;case 22:null===a.memoizedState&&Bc(r,a,n),dc(a,a.return);break;case 30:break;default:Bc(r,a,n)}t=t.sibling}}function zc(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Ar(n))}function Vc(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ar(e))}function qc(e,t,n,i){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Hc(e,t,n,i),t=t.sibling}function Hc(e,t,n,i){var r=t.flags;switch(t.tag){case 0:case 11:case 15:qc(e,t,n,i),2048&r&&sc(9,t);break;case 1:case 13:default:qc(e,t,n,i);break;case 3:qc(e,t,n,i),2048&r&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Ar(e)));break;case 12:if(2048&r){qc(e,t,n,i),e=t.stateNode;try{var a=t.memoizedProps,o=a.id,s=a.onPostCommit;"function"===typeof s&&s(o,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(c){du(t,t.return,c)}}else qc(e,t,n,i);break;case 23:break;case 22:a=t.stateNode,o=t.alternate,null!==t.memoizedState?2&a._visibility?qc(e,t,n,i):Gc(e,t):2&a._visibility?qc(e,t,n,i):(a._visibility|=2,Wc(e,t,n,i,0!==(10256&t.subtreeFlags))),2048&r&&zc(o,t);break;case 24:qc(e,t,n,i),2048&r&&Vc(t.alternate,t)}}function Wc(e,t,n,i,r){for(r=r&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var a=e,o=t,s=n,c=i,l=o.flags;switch(o.tag){case 0:case 11:case 15:Wc(a,o,s,c,r),sc(8,o);break;case 23:break;case 22:var u=o.stateNode;null!==o.memoizedState?2&u._visibility?Wc(a,o,s,c,r):Gc(a,o):(u._visibility|=2,Wc(a,o,s,c,r)),r&&2048&l&&zc(o.alternate,o);break;case 24:Wc(a,o,s,c,r),r&&2048&l&&Vc(o.alternate,o);break;default:Wc(a,o,s,c,r)}t=t.sibling}}function Gc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,i=t,r=i.flags;switch(i.tag){case 22:Gc(n,i),2048&r&&zc(i.alternate,i);break;case 24:Gc(n,i),2048&r&&Vc(i.alternate,i);break;default:Gc(n,i)}t=t.sibling}}var Kc=8192;function Qc(e){if(e.subtreeFlags&Kc)for(e=e.child;null!==e;)Jc(e),e=e.sibling}function Jc(e){switch(e.tag){case 26:Qc(e),e.flags&Kc&&null!==e.memoizedState&&function(e,t,n){if(null===qd)throw Error(o(475));var i=qd;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var r=Id(n.href),a=e.querySelector(_d(r));if(a)return null!==(e=a._p)&&"object"===typeof e&&"function"===typeof e.then&&(i.count++,i=Wd.bind(i),e.then(i,i)),t.state.loading|=4,t.instance=a,void Ge(a);a=e.ownerDocument||e,n=Nd(n),(r=Cd.get(r))&&Ud(n,r),Ge(a=a.createElement("link"));var s=a;s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),td(a,"link",n),t.instance=a}null===i.stylesheets&&(i.stylesheets=new Map),i.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(i.count++,t=Wd.bind(i),e.addEventListener("load",t),e.addEventListener("error",t))}}(Mc,e.memoizedState,e.memoizedProps);break;case 5:default:Qc(e);break;case 3:case 4:var t=Mc;Mc=Ed(e.stateNode.containerInfo),Qc(e),Mc=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Kc,Kc=16777216,Qc(e),Kc=t):Qc(e))}}function $c(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Yc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];wc=i,el(i,e)}$c(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Xc(e),e=e.sibling}function Xc(e){switch(e.tag){case 0:case 11:case 15:Yc(e),2048&e.flags&&cc(9,e,e.return);break;case 3:case 12:default:Yc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Zc(e)):Yc(e)}}function Zc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var i=t[n];wc=i,el(i,e)}$c(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:cc(8,t,t.return),Zc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Zc(t));break;default:Zc(t)}e=e.sibling}}function el(e,t){for(;null!==wc;){var n=wc;switch(n.tag){case 0:case 11:case 15:cc(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var i=n.memoizedState.cachePool.pool;null!=i&&i.refCount++}break;case 24:Ar(n.memoizedState.cache)}if(null!==(i=n.child))i.return=n,wc=i;else e:for(n=e;null!==wc;){var r=(i=wc).sibling,a=i.return;if(Pc(i),i===n){wc=null;break e}if(null!==r){r.return=a,wc=r;break e}wc=a}}}var tl={getCacheForType:function(e){var t=Rr(Dr),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},nl="function"===typeof WeakMap?WeakMap:Map,il=0,rl=null,al=null,ol=0,sl=0,cl=null,ll=!1,ul=!1,dl=!1,hl=0,pl=0,fl=0,ml=0,gl=0,vl=0,bl=0,yl=null,kl=null,Sl=!1,Tl=0,Cl=1/0,wl=null,El=null,Pl=0,Rl=null,Ol=null,xl=0,Il=0,_l=null,Nl=null,Dl=0,Ml=null;function Al(){if(0!==(2&il)&&0!==ol)return ol&-ol;if(null!==A.T){return 0!==jr?jr:Iu()}return _e()}function Ll(){0===vl&&(vl=0===(536870912&ol)||or?Ce():536870912);var e=as.current;return null!==e&&(e.flags|=32),vl}function Ul(e,t,n){(e!==rl||2!==sl&&9!==sl)&&null===e.cancelPendingCommit||(Hl(e,0),zl(e,ol,vl,!1)),Pe(e,n),0!==(2&il)&&e===rl||(e===rl&&(0===(2&il)&&(ml|=n),4===pl&&zl(e,ol,vl,!1)),Cu(e))}function jl(e,t,n){if(0!==(6&il))throw Error(o(327));for(var i=!n&&0===(124&t)&&0===(t&e.expiredLanes)||Se(e,t),r=i?function(e,t){var n=il;il|=2;var i=Gl(),r=Kl();rl!==e||ol!==t?(wl=null,Cl=ne()+500,Hl(e,t)):ul=Se(e,t);e:for(;;)try{if(0!==sl&&null!==al){t=al;var a=cl;t:switch(sl){case 1:sl=0,cl=null,eu(e,t,a,1);break;case 2:case 9:if($r(a)){sl=0,cl=null,Zl(t);break}t=function(){2!==sl&&9!==sl||rl!==e||(sl=7),Cu(e)},a.then(t,t);break e;case 3:sl=7;break e;case 4:sl=5;break e;case 7:$r(a)?(sl=0,cl=null,Zl(t)):(sl=0,cl=null,eu(e,t,a,7));break;case 5:var s=null;switch(al.tag){case 26:s=al.memoizedState;case 5:case 27:var c=al;if(!s||Vd(s)){sl=0,cl=null;var l=c.sibling;if(null!==l)al=l;else{var u=c.return;null!==u?(al=u,tu(u)):al=null}break t}}sl=0,cl=null,eu(e,t,a,5);break;case 6:sl=0,cl=null,eu(e,t,a,6);break;case 8:ql(),pl=6;break e;default:throw Error(o(462))}}Yl();break}catch(d){Wl(e,d)}return yr=br=null,A.H=i,A.A=r,il=n,null!==al?0:(rl=null,ol=0,xi(),pl)}(e,t):Jl(e,t,!0),a=i;;){if(0===r){ul&&!i&&zl(e,t,0,!1);break}if(n=e.current.alternate,!a||Bl(n)){if(2===r){if(a=t,e.errorRecoveryDisabledLanes&a)var s=0;else s=0!==(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var c=e;r=yl;var l=c.current.memoizedState.isDehydrated;if(l&&(Hl(c,s).flags|=256),2!==(s=Jl(c,s,!1))){if(dl&&!l){c.errorRecoveryDisabledLanes|=a,ml|=a,r=4;break e}a=kl,kl=r,null!==a&&(null===kl?kl=a:kl.push.apply(kl,a))}r=s}if(a=!1,2!==r)continue}}if(1===r){Hl(e,0),zl(e,t,0,!0);break}e:{switch(i=e,a=r){case 0:case 1:throw Error(o(345));case 4:if((4194048&t)!==t)break;case 6:zl(i,t,vl,!ll);break e;case 2:kl=null;break;case 3:case 5:break;default:throw Error(o(329))}if((62914560&t)===t&&10<(r=Tl+300-ne())){if(zl(i,t,vl,!ll),0!==ke(i,0,!0))break e;i.timeoutHandle=ld(Fl.bind(null,i,n,kl,wl,Sl,t,vl,ml,bl,ll,a,2,-0,0),r)}else Fl(i,n,kl,wl,Sl,t,vl,ml,bl,ll,a,0,-0,0)}break}r=Jl(e,t,!1),a=!1}Cu(e)}function Fl(e,t,n,i,r,a,s,c,l,u,d,h,p,f){if(e.timeoutHandle=-1,(8192&(h=t.subtreeFlags)||16785408===(16785408&h))&&(qd={stylesheets:null,count:0,unsuspend:Hd},Jc(t),null!==(h=function(){if(null===qd)throw Error(o(475));var e=qd;return e.stylesheets&&0===e.count&&Kd(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Kd(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=h(iu.bind(null,e,t,a,n,i,r,s,c,l,d,1,p,f)),void zl(e,a,s,!u);iu(e,t,a,n,i,r,s,c,l)}function Bl(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!$n(a(),r))return!1}catch(o){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function zl(e,t,n,i){t&=~gl,t&=~ml,e.suspendedLanes|=t,e.pingedLanes&=~t,i&&(e.warmLanes|=t),i=e.expirationTimes;for(var r=t;0<r;){var a=31-fe(r),o=1<<a;i[a]=-1,r&=~o}0!==n&&Re(e,n,t)}function Vl(){return 0!==(6&il)||(wu(0,!1),!1)}function ql(){if(null!==al){if(0===sl)var e=al.return;else yr=br=null,ja(e=al),$o=null,Yo=0,e=al;for(;null!==e;)oc(e.alternate,e),e=e.return;al=null}}function Hl(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,ud(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),ql(),rl=e,al=n=Fi(e.current,null),ol=t,sl=0,cl=null,ll=!1,ul=Se(e,t),dl=!1,bl=vl=gl=ml=fl=pl=0,kl=yl=null,Sl=!1,0!==(8&t)&&(t|=32&t);var i=e.entangledLanes;if(0!==i)for(e=e.entanglements,i&=t;0<i;){var r=31-fe(i),a=1<<r;t|=e[r],i&=~a}return hl=t,xi(),n}function Wl(e,t){ka=null,A.H=Go,t===Gr||t===Qr?(t=ea(),sl=3):t===Kr?(t=ea(),sl=4):sl=t===Rs?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,cl=t,null===al&&(pl=1,Ts(e,Ei(t,e.current)))}function Gl(){var e=A.H;return A.H=Go,null===e?Go:e}function Kl(){var e=A.A;return A.A=tl,e}function Ql(){pl=4,ll||(4194048&ol)!==ol&&null!==as.current||(ul=!0),0===(134217727&fl)&&0===(134217727&ml)||null===rl||zl(rl,ol,vl,!1)}function Jl(e,t,n){var i=il;il|=2;var r=Gl(),a=Kl();rl===e&&ol===t||(wl=null,Hl(e,t)),t=!1;var o=pl;e:for(;;)try{if(0!==sl&&null!==al){var s=al,c=cl;switch(sl){case 8:ql(),o=6;break e;case 3:case 2:case 9:case 6:null===as.current&&(t=!0);var l=sl;if(sl=0,cl=null,eu(e,s,c,l),n&&ul){o=0;break e}break;default:l=sl,sl=0,cl=null,eu(e,s,c,l)}}$l(),o=pl;break}catch(u){Wl(e,u)}return t&&e.shellSuspendCounter++,yr=br=null,il=i,A.H=r,A.A=a,null===al&&(rl=null,ol=0,xi()),o}function $l(){for(;null!==al;)Xl(al)}function Yl(){for(;null!==al&&!ee();)Xl(al)}function Xl(e){var t=Xs(e.alternate,e,hl);e.memoizedProps=e.pendingProps,null===t?tu(e):al=t}function Zl(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Us(n,t,t.pendingProps,t.type,void 0,ol);break;case 11:t=Us(n,t,t.pendingProps,t.type.render,t.ref,ol);break;case 5:ja(t);default:oc(n,t),t=Xs(n,t=al=Bi(t,hl),hl)}e.memoizedProps=e.pendingProps,null===t?tu(e):al=t}function eu(e,t,n,i){yr=br=null,ja(t),$o=null,Yo=0;var r=t.return;try{if(function(e,t,n,i,r){if(n.flags|=32768,null!==i&&"object"===typeof i&&"function"===typeof i.then){if(null!==(t=n.alternate)&&wr(t,n,r,!0),null!==(n=as.current)){switch(n.tag){case 13:return null===os?Ql():null===n.alternate&&0===pl&&(pl=3),n.flags&=-257,n.flags|=65536,n.lanes=r,i===Jr?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([i]):t.add(i),hu(e,i,r)),!1;case 22:return n.flags|=65536,i===Jr?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([i]):n.add(i),hu(e,i,r)),!1}throw Error(o(435,n.tag))}return hu(e,i,r),Ql(),!1}if(or)return null!==(t=as.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,i!==lr&&gr(Ei(e=Error(o(422),{cause:i}),n))):(i!==lr&&gr(Ei(t=Error(o(423),{cause:i}),n)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,i=Ei(i,n),ca(e,r=ws(e.stateNode,i,r)),4!==pl&&(pl=2)),!1;var a=Error(o(520),{cause:i});if(a=Ei(a,n),null===yl?yl=[a]:yl.push(a),4!==pl&&(pl=2),null===t)return!0;i=Ei(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=r&-r,n.lanes|=e,ca(n,e=ws(n.stateNode,i,e)),!1;case 1:if(t=n.type,a=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==a&&"function"===typeof a.componentDidCatch&&(null===El||!El.has(a))))return n.flags|=65536,r&=-r,n.lanes|=r,Ps(r=Es(r),e,n,i),ca(n,r),!1}n=n.return}while(null!==n);return!1}(e,r,t,n,ol))return pl=1,Ts(e,Ei(n,e.current)),void(al=null)}catch(a){if(null!==r)throw al=r,a;return pl=1,Ts(e,Ei(n,e.current)),void(al=null)}32768&t.flags?(or||1===i?e=!0:ul||0!==(536870912&ol)?e=!1:(ll=e=!0,(2===i||9===i||3===i||6===i)&&(null!==(i=as.current)&&13===i.tag&&(i.flags|=16384))),nu(t,e)):tu(t)}function tu(e){var t=e;do{if(0!==(32768&t.flags))return void nu(t,ll);e=t.return;var n=rc(t.alternate,t,hl);if(null!==n)return void(al=n);if(null!==(t=t.sibling))return void(al=t);al=t=e}while(null!==t);0===pl&&(pl=5)}function nu(e,t){do{var n=ac(e.alternate,e);if(null!==n)return n.flags&=32767,void(al=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(al=e);al=e=n}while(null!==e);pl=6,al=null}function iu(e,t,n,i,r,a,s,c,l){e.cancelPendingCommit=null;do{cu()}while(0!==Pl);if(0!==(6&il))throw Error(o(327));if(null!==t){if(t===e.current)throw Error(o(177));if(a=t.lanes|t.childLanes,function(e,t,n,i,r,a){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,c=e.expirationTimes,l=e.hiddenUpdates;for(n=o&~n;0<n;){var u=31-fe(n),d=1<<u;s[u]=0,c[u]=-1;var h=l[u];if(null!==h)for(l[u]=null,u=0;u<h.length;u++){var p=h[u];null!==p&&(p.lane&=-536870913)}n&=~d}0!==i&&Re(e,i,0),0!==a&&0===r&&0!==e.tag&&(e.suspendedLanes|=a&~(o&~t))}(e,n,a|=Oi,s,c,l),e===rl&&(al=rl=null,ol=0),Ol=t,Rl=e,xl=n,Il=a,_l=r,Nl=i,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,X(oe,function(){return lu(),null})):(e.callbackNode=null,e.callbackPriority=0),i=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||i){i=A.T,A.T=null,r=L.p,L.p=2,s=il,il|=4;try{!function(e,t){if(e=e.containerInfo,nd=ih,ni(e=ti(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(g){n=null;break e}var s=0,c=-1,l=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==r&&3!==h.nodeType||(c=s+r),h!==a||0!==i&&3!==h.nodeType||(l=s+i),3===h.nodeType&&(s+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++u===r&&(c=s),p===a&&++d===i&&(l=s),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(id={focusedElem:e,selectionRange:n},ih=!1,wc=t;null!==wc;)if(e=(t=wc).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,wc=e;else for(;null!==wc;){switch(a=(t=wc).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==a){e=void 0,n=t,r=a.memoizedProps,a=a.memoizedState,i=n.stateNode;try{var m=vs(n.type,r,(n.elementType,n.type));e=i.getSnapshotBeforeUpdate(m,a),i.__reactInternalSnapshotBeforeUpdate=e}catch(v){du(n,n.return,v)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))gd(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":gd(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(o(163))}if(null!==(e=t.sibling)){e.return=t.return,wc=e;break}wc=t.return}}(e,t)}finally{il=s,L.p=r,A.T=i}}Pl=1,ru(),au(),ou()}}function ru(){if(1===Pl){Pl=0;var e=Rl,t=Ol,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=A.T,A.T=null;var i=L.p;L.p=2;var r=il;il|=4;try{Ac(t,e);var a=id,o=ti(e.containerInfo),s=a.focusedElem,c=a.selectionRange;if(o!==s&&s&&s.ownerDocument&&ei(s.ownerDocument.documentElement,s)){if(null!==c&&ni(s)){var l=c.start,u=c.end;if(void 0===u&&(u=l),"selectionStart"in s)s.selectionStart=l,s.selectionEnd=Math.min(u,s.value.length);else{var d=s.ownerDocument||document,h=d&&d.defaultView||window;if(h.getSelection){var p=h.getSelection(),f=s.textContent.length,m=Math.min(c.start,f),g=void 0===c.end?m:Math.min(c.end,f);!p.extend&&m>g&&(o=g,g=m,m=o);var v=Zn(s,m),b=Zn(s,g);if(v&&b&&(1!==p.rangeCount||p.anchorNode!==v.node||p.anchorOffset!==v.offset||p.focusNode!==b.node||p.focusOffset!==b.offset)){var y=d.createRange();y.setStart(v.node,v.offset),p.removeAllRanges(),m>g?(p.addRange(y),p.extend(b.node,b.offset)):(y.setEnd(b.node,b.offset),p.addRange(y))}}}}for(d=[],p=s;p=p.parentNode;)1===p.nodeType&&d.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"===typeof s.focus&&s.focus(),s=0;s<d.length;s++){var k=d[s];k.element.scrollLeft=k.left,k.element.scrollTop=k.top}}ih=!!nd,id=nd=null}finally{il=r,L.p=i,A.T=n}}e.current=t,Pl=2}}function au(){if(2===Pl){Pl=0;var e=Rl,t=Ol,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=A.T,A.T=null;var i=L.p;L.p=2;var r=il;il|=4;try{Ec(e,t.alternate,t)}finally{il=r,L.p=i,A.T=n}}Pl=3}}function ou(){if(4===Pl||3===Pl){Pl=0,te();var e=Rl,t=Ol,n=xl,i=Nl;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Pl=5:(Pl=0,Ol=Rl=null,su(e,e.pendingLanes));var r=e.pendingLanes;if(0===r&&(El=null),Ie(n),t=t.stateNode,he&&"function"===typeof he.onCommitFiberRoot)try{he.onCommitFiberRoot(de,t,void 0,128===(128&t.current.flags))}catch(c){}if(null!==i){t=A.T,r=L.p,L.p=2,A.T=null;try{for(var a=e.onRecoverableError,o=0;o<i.length;o++){var s=i[o];a(s.value,{componentStack:s.stack})}}finally{A.T=t,L.p=r}}0!==(3&xl)&&cu(),Cu(e),r=e.pendingLanes,0!==(4194090&n)&&0!==(42&r)?e===Ml?Dl++:(Dl=0,Ml=e):Dl=0,wu(0,!1)}}function su(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Ar(t)))}function cu(e){return ru(),au(),ou(),lu()}function lu(){if(5!==Pl)return!1;var e=Rl,t=Il;Il=0;var n=Ie(xl),i=A.T,r=L.p;try{L.p=32>n?32:n,A.T=null,n=_l,_l=null;var a=Rl,s=xl;if(Pl=0,Ol=Rl=null,xl=0,0!==(6&il))throw Error(o(331));var c=il;if(il|=4,Xc(a.current),Hc(a,a.current,s,n),il=c,wu(0,!1),he&&"function"===typeof he.onPostCommitFiberRoot)try{he.onPostCommitFiberRoot(de,a)}catch(l){}return!0}finally{L.p=r,A.T=i,su(e,t)}}function uu(e,t,n){t=Ei(n,t),null!==(e=oa(e,t=ws(e.stateNode,t,2),2))&&(Pe(e,2),Cu(e))}function du(e,t,n){if(3===e.tag)uu(e,e,n);else for(;null!==t;){if(3===t.tag){uu(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===El||!El.has(i))){e=Ei(n,e),null!==(i=oa(t,n=Es(2),2))&&(Ps(n,i,t,e),Pe(i,2),Cu(i));break}}t=t.return}}function hu(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new nl;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(dl=!0,r.add(n),e=pu.bind(null,e,t,n),t.then(e,e))}function pu(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,rl===e&&(ol&n)===n&&(4===pl||3===pl&&(62914560&ol)===ol&&300>ne()-Tl?0===(2&il)&&Hl(e,0):gl|=n,bl===ol&&(bl=0)),Cu(e)}function fu(e,t){0===t&&(t=we()),null!==(e=Ni(e,t))&&(Pe(e,t),Cu(e))}function mu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),fu(e,n)}function gu(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(o(314))}null!==i&&i.delete(t),fu(e,n)}var vu=null,bu=null,yu=!1,ku=!1,Su=!1,Tu=0;function Cu(e){e!==bu&&null===e.next&&(null===bu?vu=bu=e:bu=bu.next=e),ku=!0,yu||(yu=!0,hd(function(){0!==(6&il)?X(re,Eu):Pu()}))}function wu(e,t){if(!Su&&ku){Su=!0;do{for(var n=!1,i=vu;null!==i;){if(!t)if(0!==e){var r=i.pendingLanes;if(0===r)var a=0;else{var o=i.suspendedLanes,s=i.pingedLanes;a=(1<<31-fe(42|e)+1)-1,a=201326741&(a&=r&~(o&~s))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,xu(i,a))}else a=ol,0===(3&(a=ke(i,i===rl?a:0,null!==i.cancelPendingCommit||-1!==i.timeoutHandle)))||Se(i,a)||(n=!0,xu(i,a));i=i.next}}while(n);Su=!1}}function Eu(){Pu()}function Pu(){ku=yu=!1;var e=0;0!==Tu&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==cd&&(cd=e,!0);return cd=null,!1}()&&(e=Tu),Tu=0);for(var t=ne(),n=null,i=vu;null!==i;){var r=i.next,a=Ru(i,t);0===a?(i.next=null,null===n?vu=r:n.next=r,null===r&&(bu=n)):(n=i,(0!==e||0!==(3&a))&&(ku=!0)),i=r}wu(e,!1)}function Ru(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var o=31-fe(a),s=1<<o,c=r[o];-1===c?0!==(s&n)&&0===(s&i)||(r[o]=Te(s,t)):c<=t&&(e.expiredLanes|=s),a&=~s}if(n=ol,n=ke(e,e===(t=rl)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),i=e.callbackNode,0===n||e===t&&(2===sl||9===sl)||null!==e.cancelPendingCommit)return null!==i&&null!==i&&Z(i),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||Se(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==i&&Z(i),Ie(n)){case 2:case 8:n=ae;break;case 32:default:n=oe;break;case 268435456:n=ce}return i=Ou.bind(null,e),n=X(n,i),e.callbackPriority=t,e.callbackNode=n,t}return null!==i&&null!==i&&Z(i),e.callbackPriority=2,e.callbackNode=null,2}function Ou(e,t){if(0!==Pl&&5!==Pl)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(cu()&&e.callbackNode!==n)return null;var i=ol;return 0===(i=ke(e,e===rl?i:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(jl(e,i,t),Ru(e,ne()),null!=e.callbackNode&&e.callbackNode===n?Ou.bind(null,e):null)}function xu(e,t){if(cu())return null;jl(e,t,!0)}function Iu(){return 0===Tu&&(Tu=Ce()),Tu}function _u(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:It(""+e)}function Nu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Du=0;Du<Ti.length;Du++){var Mu=Ti[Du];Ci(Mu.toLowerCase(),"on"+(Mu[0].toUpperCase()+Mu.slice(1)))}Ci(fi,"onAnimationEnd"),Ci(mi,"onAnimationIteration"),Ci(gi,"onAnimationStart"),Ci("dblclick","onDoubleClick"),Ci("focusin","onFocus"),Ci("focusout","onBlur"),Ci(vi,"onTransitionRun"),Ci(bi,"onTransitionStart"),Ci(yi,"onTransitionCancel"),Ci(ki,"onTransitionEnd"),$e("onMouseEnter",["mouseout","mouseover"]),$e("onMouseLeave",["mouseout","mouseover"]),$e("onPointerEnter",["pointerout","pointerover"]),$e("onPointerLeave",["pointerout","pointerover"]),Je("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Je("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Je("onBeforeInput",["compositionend","keypress","textInput","paste"]),Je("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Je("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Je("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Au="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Au));function Uu(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var a=void 0;if(t)for(var o=i.length-1;0<=o;o--){var s=i[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&r.isPropagationStopped())break e;a=s,r.currentTarget=l;try{a(r)}catch(u){bs(u)}r.currentTarget=null,a=c}else for(o=0;o<i.length;o++){if(c=(s=i[o]).instance,l=s.currentTarget,s=s.listener,c!==a&&r.isPropagationStopped())break e;a=s,r.currentTarget=l;try{a(r)}catch(u){bs(u)}r.currentTarget=null,a=c}}}}function ju(e,t){var n=t[Le];void 0===n&&(n=t[Le]=new Set);var i=e+"__bubble";n.has(i)||(Vu(t,e,2,!1),n.add(i))}function Fu(e,t,n){var i=0;t&&(i|=4),Vu(n,e,i,t)}var Bu="_reactListening"+Math.random().toString(36).slice(2);function zu(e){if(!e[Bu]){e[Bu]=!0,Ke.forEach(function(t){"selectionchange"!==t&&(Lu.has(t)||Fu(t,!1,e),Fu(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Bu]||(t[Bu]=!0,Fu("selectionchange",!1,t))}}function Vu(e,t,n,i){switch(uh(t)){case 2:var r=rh;break;case 8:r=ah;break;default:r=oh}n=r.bind(null,t,n,e),r=void 0,!Bt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function qu(e,t,n,i,r){var a=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&o.stateNode.containerInfo===r)return;o=o.return}for(;null!==s;){if(null===(o=Ve(s)))return;if(5===(l=o.tag)||6===l||26===l||27===l){i=a=o;continue e}s=s.parentNode}}i=i.return}Ut(function(){var i=a,r=Nt(n),o=[];e:{var s=Si.get(e);if(void 0!==s){var l=en,u=e;switch(e){case"keypress":if(0===Gt(n))break e;case"keydown":case"keyup":l=gn;break;case"focusin":u="focus",l=sn;break;case"focusout":u="blur",l=sn;break;case"beforeblur":case"afterblur":l=sn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=an;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=bn;break;case fi:case mi:case gi:l=cn;break;case ki:l=yn;break;case"scroll":case"scrollend":l=nn;break;case"wheel":l=kn;break;case"copy":case"cut":case"paste":l=ln;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=vn;break;case"toggle":case"beforetoggle":l=Sn}var d=0!==(4&t),h=!d&&("scroll"===e||"scrollend"===e),p=d?null!==s?s+"Capture":null:s;d=[];for(var f,m=i;null!==m;){var g=m;if(f=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===f||null===p||null!=(g=jt(m,p))&&d.push(Hu(m,g,f)),h)break;m=m.return}0<d.length&&(s=new l(s,u,null,n,r),o.push({event:s,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===_t||!(u=n.relatedTarget||n.fromElement)||!Ve(u)&&!u[Ae])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(u=(u=n.relatedTarget||n.toElement)?Ve(u):null)&&(h=c(u),d=u.tag,u!==h||5!==d&&27!==d&&6!==d)&&(u=null)):(l=null,u=i),l!==u)){if(d=an,g="onMouseLeave",p="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=vn,g="onPointerLeave",p="onPointerEnter",m="pointer"),h=null==l?s:He(l),f=null==u?s:He(u),(s=new d(g,m+"leave",l,n,r)).target=h,s.relatedTarget=f,g=null,Ve(r)===i&&((d=new d(p,m+"enter",u,n,r)).target=f,d.relatedTarget=h,g=d),h=g,l&&u)e:{for(p=u,m=0,f=d=l;f;f=Gu(f))m++;for(f=0,g=p;g;g=Gu(g))f++;for(;0<m-f;)d=Gu(d),m--;for(;0<f-m;)p=Gu(p),f--;for(;m--;){if(d===p||null!==p&&d===p.alternate)break e;d=Gu(d),p=Gu(p)}d=null}else d=null;null!==l&&Ku(o,s,l,d,!1),null!==u&&null!==h&&Ku(o,h,u,d,!0)}if("select"===(l=(s=i?He(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var v=Fn;else if(Dn(s))if(Bn)v=Jn;else{v=Kn;var b=Gn}else!(l=s.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?i&&Rt(i.elementType)&&(v=Fn):v=Qn;switch(v&&(v=v(e,i))?Mn(o,v,n,r):(b&&b(e,s,i),"focusout"===e&&i&&"number"===s.type&&null!=i.memoizedProps.value&&yt(s,"number",s.value)),b=i?He(i):window,e){case"focusin":(Dn(b)||"true"===b.contentEditable)&&(ri=b,ai=i,oi=null);break;case"focusout":oi=ai=ri=null;break;case"mousedown":si=!0;break;case"contextmenu":case"mouseup":case"dragend":si=!1,ci(o,n,r);break;case"selectionchange":if(ii)break;case"keydown":case"keyup":ci(o,n,r)}var y;if(Cn)e:{switch(e){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else _n?xn(e,n)&&(k="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(k="onCompositionStart");k&&(Pn&&"ko"!==n.locale&&(_n||"onCompositionStart"!==k?"onCompositionEnd"===k&&_n&&(y=Wt()):(qt="value"in(Vt=r)?Vt.value:Vt.textContent,_n=!0)),0<(b=Wu(i,k)).length&&(k=new un(k,e,null,n,r),o.push({event:k,listeners:b}),y?k.data=y:null!==(y=In(n))&&(k.data=y))),(y=En?function(e,t){switch(e){case"compositionend":return In(t);case"keypress":return 32!==t.which?null:(On=!0,Rn);case"textInput":return(e=t.data)===Rn&&On?null:e;default:return null}}(e,n):function(e,t){if(_n)return"compositionend"===e||!Cn&&xn(e,t)?(e=Wt(),Ht=qt=Vt=null,_n=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Pn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(k=Wu(i,"onBeforeInput")).length&&(b=new un("onBeforeInput","beforeinput",null,n,r),o.push({event:b,listeners:k}),b.data=y)),function(e,t,n,i,r){if("submit"===t&&n&&n.stateNode===r){var a=_u((r[Me]||null).action),o=i.submitter;o&&null!==(t=(t=o[Me]||null)?_u(t.formAction):o.getAttribute("formAction"))&&(a=t,o=null);var s=new en("action","action",null,i,r);e.push({event:s,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(0!==Tu){var e=o?Nu(r,o):new FormData(r);No(n,{pending:!0,data:e,method:r.method,action:a},null,e)}}else"function"===typeof a&&(s.preventDefault(),e=o?Nu(r,o):new FormData(r),No(n,{pending:!0,data:e,method:r.method,action:a},a,e))},currentTarget:r}]})}}(o,e,i,n,r)}Uu(o,t)})}function Hu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wu(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;if(5!==(r=r.tag)&&26!==r&&27!==r||null===a||(null!=(r=jt(e,n))&&i.unshift(Hu(e,r,a)),null!=(r=jt(e,t))&&i.push(Hu(e,r,a))),3===e.tag)return i;e=e.return}return[]}function Gu(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Ku(e,t,n,i,r){for(var a=t._reactName,o=[];null!==n&&n!==i;){var s=n,c=s.alternate,l=s.stateNode;if(s=s.tag,null!==c&&c===i)break;5!==s&&26!==s&&27!==s||null===l||(c=l,r?null!=(l=jt(n,a))&&o.unshift(Hu(n,l,c)):r||null!=(l=jt(n,a))&&o.push(Hu(n,l,c))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Qu=/\r\n?/g,Ju=/\u0000|\uFFFD/g;function $u(e){return("string"===typeof e?e:""+e).replace(Qu,"\n").replace(Ju,"")}function Yu(e,t){return t=$u(t),$u(e)===t}function Xu(){}function Zu(e,t,n,i,r,a){switch(n){case"children":"string"===typeof i?"body"===t||"textarea"===t&&""===i||Ct(e,i):("number"===typeof i||"bigint"===typeof i)&&"body"!==t&&Ct(e,""+i);break;case"className":it(e,"class",i);break;case"tabIndex":it(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":it(e,n,i);break;case"style":Pt(e,i,a);break;case"data":if("object"!==t){it(e,"data",i);break}case"src":case"href":if(""===i&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==i||"function"===typeof i||"symbol"===typeof i||"boolean"===typeof i){e.removeAttribute(n);break}i=It(""+i),e.setAttribute(n,i);break;case"action":case"formAction":if("function"===typeof i){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof a&&("formAction"===n?("input"!==t&&Zu(e,t,"name",r.name,r,null),Zu(e,t,"formEncType",r.formEncType,r,null),Zu(e,t,"formMethod",r.formMethod,r,null),Zu(e,t,"formTarget",r.formTarget,r,null)):(Zu(e,t,"encType",r.encType,r,null),Zu(e,t,"method",r.method,r,null),Zu(e,t,"target",r.target,r,null))),null==i||"symbol"===typeof i||"boolean"===typeof i){e.removeAttribute(n);break}i=It(""+i),e.setAttribute(n,i);break;case"onClick":null!=i&&(e.onclick=Xu);break;case"onScroll":null!=i&&ju("scroll",e);break;case"onScrollEnd":null!=i&&ju("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(o(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(o(60));e.innerHTML=n}}break;case"multiple":e.multiple=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"muted":e.muted=i&&"function"!==typeof i&&"symbol"!==typeof i;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==i||"function"===typeof i||"boolean"===typeof i||"symbol"===typeof i){e.removeAttribute("xlink:href");break}n=It(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,""+i):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===i?e.setAttribute(n,""):!1!==i&&null!=i&&"function"!==typeof i&&"symbol"!==typeof i?e.setAttribute(n,i):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&!isNaN(i)&&1<=i?e.setAttribute(n,i):e.removeAttribute(n);break;case"rowSpan":case"start":null==i||"function"===typeof i||"symbol"===typeof i||isNaN(i)?e.removeAttribute(n):e.setAttribute(n,i);break;case"popover":ju("beforetoggle",e),ju("toggle",e),nt(e,"popover",i);break;case"xlinkActuate":rt(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":rt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":rt(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":rt(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":rt(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":rt(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":rt(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":rt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":rt(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":nt(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&nt(e,n=Ot.get(n)||n,i)}}function ed(e,t,n,i,r,a){switch(n){case"style":Pt(e,i,a);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!==typeof i||!("__html"in i))throw Error(o(61));if(null!=(n=i.__html)){if(null!=r.children)throw Error(o(60));e.innerHTML=n}}break;case"children":"string"===typeof i?Ct(e,i):("number"===typeof i||"bigint"===typeof i)&&Ct(e,""+i);break;case"onScroll":null!=i&&ju("scroll",e);break;case"onScrollEnd":null!=i&&ju("scrollend",e);break;case"onClick":null!=i&&(e.onclick=Xu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Qe.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(r=n.endsWith("Capture"),t=n.slice(2,r?n.length-7:void 0),"function"===typeof(a=null!=(a=e[Me]||null)?a[n]:null)&&e.removeEventListener(t,a,r),"function"!==typeof i)?n in e?e[n]=i:!0===i?e.setAttribute(n,""):nt(e,n,i):("function"!==typeof a&&null!==a&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,i,r)))}}function td(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ju("error",e),ju("load",e);var i,r=!1,a=!1;for(i in n)if(n.hasOwnProperty(i)){var s=n[i];if(null!=s)switch(i){case"src":r=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:Zu(e,t,i,s,n,null)}}return a&&Zu(e,t,"srcSet",n.srcSet,n,null),void(r&&Zu(e,t,"src",n.src,n,null));case"input":ju("invalid",e);var c=i=s=a=null,l=null,u=null;for(r in n)if(n.hasOwnProperty(r)){var d=n[r];if(null!=d)switch(r){case"name":a=d;break;case"type":s=d;break;case"checked":l=d;break;case"defaultChecked":u=d;break;case"value":i=d;break;case"defaultValue":c=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(o(137,t));break;default:Zu(e,t,r,d,n,null)}}return bt(e,i,c,l,u,s,a,!1),void ht(e);case"select":for(a in ju("invalid",e),r=s=i=null,n)if(n.hasOwnProperty(a)&&null!=(c=n[a]))switch(a){case"value":i=c;break;case"defaultValue":s=c;break;case"multiple":r=c;default:Zu(e,t,a,c,n,null)}return t=i,n=s,e.multiple=!!r,void(null!=t?kt(e,!!r,t,!1):null!=n&&kt(e,!!r,n,!0));case"textarea":for(s in ju("invalid",e),i=a=r=null,n)if(n.hasOwnProperty(s)&&null!=(c=n[s]))switch(s){case"value":r=c;break;case"defaultValue":a=c;break;case"children":i=c;break;case"dangerouslySetInnerHTML":if(null!=c)throw Error(o(91));break;default:Zu(e,t,s,c,n,null)}return Tt(e,r,a,i),void ht(e);case"option":for(l in n)if(n.hasOwnProperty(l)&&null!=(r=n[l]))if("selected"===l)e.selected=r&&"function"!==typeof r&&"symbol"!==typeof r;else Zu(e,t,l,r,n,null);return;case"dialog":ju("beforetoggle",e),ju("toggle",e),ju("cancel",e),ju("close",e);break;case"iframe":case"object":ju("load",e);break;case"video":case"audio":for(r=0;r<Au.length;r++)ju(Au[r],e);break;case"image":ju("error",e),ju("load",e);break;case"details":ju("toggle",e);break;case"embed":case"source":case"link":ju("error",e),ju("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(r=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:Zu(e,t,u,r,n,null)}return;default:if(Rt(t)){for(d in n)n.hasOwnProperty(d)&&(void 0!==(r=n[d])&&ed(e,t,d,r,n,void 0));return}}for(c in n)n.hasOwnProperty(c)&&(null!=(r=n[c])&&Zu(e,t,c,r,n,null))}var nd=null,id=null;function rd(e){return 9===e.nodeType?e:e.ownerDocument}function ad(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function od(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function sd(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var cd=null;var ld="function"===typeof setTimeout?setTimeout:void 0,ud="function"===typeof clearTimeout?clearTimeout:void 0,dd="function"===typeof Promise?Promise:void 0,hd="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof dd?function(e){return dd.resolve(null).then(e).catch(pd)}:ld;function pd(e){setTimeout(function(){throw e})}function fd(e){return"head"===e}function md(e,t){var n=t,i=0,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0<i&&8>i){n=i;var o=e.ownerDocument;if(1&n&&Td(o.documentElement),2&n&&Td(o.body),4&n)for(Td(n=o.head),o=n.firstChild;o;){var s=o.nextSibling,c=o.nodeName;o[Be]||"SCRIPT"===c||"STYLE"===c||"LINK"===c&&"stylesheet"===o.rel.toLowerCase()||n.removeChild(o),o=s}}if(0===r)return e.removeChild(a),void Oh(t);r--}else"$"===n||"$?"===n||"$!"===n?r++:i=n.charCodeAt(0)-48;else i=0;n=a}while(n);Oh(t)}function gd(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":gd(n),ze(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function vd(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function bd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var yd=null;function kd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function Sd(e,t,n){switch(t=rd(n),e){case"html":if(!(e=t.documentElement))throw Error(o(452));return e;case"head":if(!(e=t.head))throw Error(o(453));return e;case"body":if(!(e=t.body))throw Error(o(454));return e;default:throw Error(o(451))}}function Td(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);ze(e)}var Cd=new Map,wd=new Set;function Ed(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Pd=L.d;L.d={f:function(){var e=Pd.f(),t=Vl();return e||t},r:function(e){var t=qe(e);null!==t&&5===t.tag&&"form"===t.type?Mo(t):Pd.r(e)},D:function(e){Pd.D(e),Od("dns-prefetch",e,null)},C:function(e,t){Pd.C(e,t),Od("preconnect",e,t)},L:function(e,t,n){Pd.L(e,t,n);var i=Rd;if(i&&e&&t){var r='link[rel="preload"][as="'+gt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(r+='[imagesrcset="'+gt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(r+='[imagesizes="'+gt(n.imageSizes)+'"]')):r+='[href="'+gt(e)+'"]';var a=r;switch(t){case"style":a=Id(e);break;case"script":a=Dd(e)}Cd.has(a)||(e=h({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Cd.set(a,e),null!==i.querySelector(r)||"style"===t&&i.querySelector(_d(a))||"script"===t&&i.querySelector(Md(a))||(td(t=i.createElement("link"),"link",e),Ge(t),i.head.appendChild(t)))}},m:function(e,t){Pd.m(e,t);var n=Rd;if(n&&e){var i=t&&"string"===typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+gt(i)+'"][href="'+gt(e)+'"]',a=r;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=Dd(e)}if(!Cd.has(a)&&(e=h({rel:"modulepreload",href:e},t),Cd.set(a,e),null===n.querySelector(r))){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Md(a)))return}td(i=n.createElement("link"),"link",e),Ge(i),n.head.appendChild(i)}}},X:function(e,t){Pd.X(e,t);var n=Rd;if(n&&e){var i=We(n).hoistableScripts,r=Dd(e),a=i.get(r);a||((a=n.querySelector(Md(r)))||(e=h({src:e,async:!0},t),(t=Cd.get(r))&&jd(e,t),Ge(a=n.createElement("script")),td(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},i.set(r,a))}},S:function(e,t,n){Pd.S(e,t,n);var i=Rd;if(i&&e){var r=We(i).hoistableStyles,a=Id(e);t=t||"default";var o=r.get(a);if(!o){var s={loading:0,preload:null};if(o=i.querySelector(_d(a)))s.loading=5;else{e=h({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Cd.get(a))&&Ud(e,n);var c=o=i.createElement("link");Ge(c),td(c,"link",e),c._p=new Promise(function(e,t){c.onload=e,c.onerror=t}),c.addEventListener("load",function(){s.loading|=1}),c.addEventListener("error",function(){s.loading|=2}),s.loading|=4,Ld(o,t,i)}o={type:"stylesheet",instance:o,count:1,state:s},r.set(a,o)}}},M:function(e,t){Pd.M(e,t);var n=Rd;if(n&&e){var i=We(n).hoistableScripts,r=Dd(e),a=i.get(r);a||((a=n.querySelector(Md(r)))||(e=h({src:e,async:!0,type:"module"},t),(t=Cd.get(r))&&jd(e,t),Ge(a=n.createElement("script")),td(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},i.set(r,a))}}};var Rd="undefined"===typeof document?null:document;function Od(e,t,n){var i=Rd;if(i&&"string"===typeof t&&t){var r=gt(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"===typeof n&&(r+='[crossorigin="'+n+'"]'),wd.has(r)||(wd.add(r),e={rel:e,crossOrigin:n,href:t},null===i.querySelector(r)&&(td(t=i.createElement("link"),"link",e),Ge(t),i.head.appendChild(t)))}}function xd(e,t,n,i){var r,a,s,c,l=(l=W.current)?Ed(l):null;if(!l)throw Error(o(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Id(n.href),(i=(n=We(l).hoistableStyles).get(t))||(i={type:"style",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Id(n.href);var u=We(l).hoistableStyles,d=u.get(e);if(d||(l=l.ownerDocument||l,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=l.querySelector(_d(e)))&&!u._p&&(d.instance=u,d.state.loading=5),Cd.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Cd.set(e,n),u||(r=l,a=e,s=n,c=d.state,r.querySelector('link[rel="preload"][as="style"]['+a+"]")?c.loading=1:(a=r.createElement("link"),c.preload=a,a.addEventListener("load",function(){return c.loading|=1}),a.addEventListener("error",function(){return c.loading|=2}),td(a,"link",s),Ge(a),r.head.appendChild(a))))),t&&null===i)throw Error(o(528,""));return d}if(t&&null!==i)throw Error(o(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Dd(n),(i=(n=We(l).hoistableScripts).get(t))||(i={type:"script",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,e))}}function Id(e){return'href="'+gt(e)+'"'}function _d(e){return'link[rel="stylesheet"]['+e+"]"}function Nd(e){return h({},e,{"data-precedence":e.precedence,precedence:null})}function Dd(e){return'[src="'+gt(e)+'"]'}function Md(e){return"script[async]"+e}function Ad(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+gt(n.href)+'"]');if(i)return t.instance=i,Ge(i),i;var r=h({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Ge(i=(e.ownerDocument||e).createElement("style")),td(i,"style",r),Ld(i,n.precedence,e),t.instance=i;case"stylesheet":r=Id(n.href);var a=e.querySelector(_d(r));if(a)return t.state.loading|=4,t.instance=a,Ge(a),a;i=Nd(n),(r=Cd.get(r))&&Ud(i,r),Ge(a=(e.ownerDocument||e).createElement("link"));var s=a;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),td(a,"link",i),t.state.loading|=4,Ld(a,n.precedence,e),t.instance=a;case"script":return a=Dd(n.src),(r=e.querySelector(Md(a)))?(t.instance=r,Ge(r),r):(i=n,(r=Cd.get(a))&&jd(i=h({},n),r),Ge(r=(e=e.ownerDocument||e).createElement("script")),td(r,"link",i),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(o(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(i=t.instance,t.state.loading|=4,Ld(i,n.precedence,e));return t.instance}function Ld(e,t,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=i.length?i[i.length-1]:null,a=r,o=0;o<i.length;o++){var s=i[o];if(s.dataset.precedence===t)a=s;else if(a!==r)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Ud(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function jd(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Fd=null;function Bd(e,t,n){if(null===Fd){var i=new Map,r=Fd=new Map;r.set(n,i)}else(i=(r=Fd).get(n))||(i=new Map,r.set(n,i));if(i.has(e))return i;for(i.set(e,null),n=n.getElementsByTagName(e),r=0;r<n.length;r++){var a=n[r];if(!(a[Be]||a[De]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var o=a.getAttribute(t)||"";o=e+o;var s=i.get(o);s?s.push(a):i.set(o,[a])}}return i}function zd(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Vd(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var qd=null;function Hd(){}function Wd(){if(this.count--,0===this.count)if(this.stylesheets)Kd(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Gd=null;function Kd(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Gd=new Map,t.forEach(Qd,e),Gd=null,Wd.call(e))}function Qd(e,t){if(!(4&t.state.loading)){var n=Gd.get(e);if(n)var i=n.get(null);else{n=new Map,Gd.set(e,n);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<r.length;a++){var o=r[a];"LINK"!==o.nodeName&&"not all"===o.getAttribute("media")||(n.set(o.dataset.precedence,o),i=o)}i&&n.set(null,i)}o=(r=t.instance).getAttribute("data-precedence"),(a=n.get(o)||i)===i&&n.set(null,r),n.set(o,r),this.count++,i=Wd.bind(this),r.addEventListener("load",i),r.addEventListener("error",i),a?a.parentNode.insertBefore(r,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(r,e.firstChild),t.state.loading|=4}}var Jd={$$typeof:T,Provider:null,Consumer:null,_currentValue:U,_currentValue2:U,_threadCount:0};function $d(e,t,n,i,r,a,o,s){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ee(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ee(0),this.hiddenUpdates=Ee(null),this.identifierPrefix=i,this.onUncaughtError=r,this.onCaughtError=a,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=s,this.incompleteTransitions=new Map}function Yd(e,t,n,i,r,a,o,s,c,l,u,d){return e=new $d(e,t,n,o,s,c,l,d),t=1,!0===a&&(t|=24),a=Ui(3,null,null,t),e.current=a,a.stateNode=e,(t=Mr()).refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:i,isDehydrated:n,cache:t},ia(a),e}function Xd(e){return e?e=Ai:Ai}function Zd(e,t,n,i,r,a){r=Xd(r),null===i.context?i.context=r:i.pendingContext=r,(i=aa(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(i.callback=a),null!==(n=oa(e,i,t))&&(Ul(n,0,t),sa(n,e,t))}function eh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function th(e,t){eh(e,t),(e=e.alternate)&&eh(e,t)}function nh(e){if(13===e.tag){var t=Ni(e,67108864);null!==t&&Ul(t,0,67108864),th(e,67108864)}}var ih=!0;function rh(e,t,n,i){var r=A.T;A.T=null;var a=L.p;try{L.p=2,oh(e,t,n,i)}finally{L.p=a,A.T=r}}function ah(e,t,n,i){var r=A.T;A.T=null;var a=L.p;try{L.p=8,oh(e,t,n,i)}finally{L.p=a,A.T=r}}function oh(e,t,n,i){if(ih){var r=sh(i);if(null===r)qu(e,t,i,ch,n),yh(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return hh=kh(hh,e,t,n,i,r),!0;case"dragenter":return ph=kh(ph,e,t,n,i,r),!0;case"mouseover":return fh=kh(fh,e,t,n,i,r),!0;case"pointerover":var a=r.pointerId;return mh.set(a,kh(mh.get(a)||null,e,t,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,gh.set(a,kh(gh.get(a)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(yh(e,i),4&t&&-1<bh.indexOf(e)){for(;null!==r;){var a=qe(r);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var o=ye(a.pendingLanes);if(0!==o){var s=a;for(s.pendingLanes|=2,s.entangledLanes|=2;o;){var c=1<<31-fe(o);s.entanglements[1]|=c,o&=~c}Cu(a),0===(6&il)&&(Cl=ne()+500,wu(0,!1))}}break;case 13:null!==(s=Ni(a,2))&&Ul(s,0,2),Vl(),th(a,2)}if(null===(a=sh(i))&&qu(e,t,i,ch,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else qu(e,t,i,null,n)}}function sh(e){return lh(e=Nt(e))}var ch=null;function lh(e){if(ch=null,null!==(e=Ve(e))){var t=c(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=l(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return ch=e,null}function uh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ie()){case re:return 2;case ae:return 8;case oe:case se:return 32;case ce:return 268435456;default:return 32}default:return 32}}var dh=!1,hh=null,ph=null,fh=null,mh=new Map,gh=new Map,vh=[],bh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yh(e,t){switch(e){case"focusin":case"focusout":hh=null;break;case"dragenter":case"dragleave":ph=null;break;case"mouseover":case"mouseout":fh=null;break;case"pointerover":case"pointerout":mh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":gh.delete(t.pointerId)}}function kh(e,t,n,i,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=qe(t))&&nh(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Sh(e){var t=Ve(e.target);if(null!==t){var n=c(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=l(n)))return e.blockedOn=t,void function(e,t){var n=L.p;try{return L.p=e,t()}finally{L.p=n}}(e.priority,function(){if(13===n.tag){var e=Al();e=xe(e);var t=Ni(n,e);null!==t&&Ul(t,0,e),th(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Th(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=sh(e.nativeEvent);if(null!==n)return null!==(t=qe(n))&&nh(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);_t=i,n.target.dispatchEvent(i),_t=null,t.shift()}return!0}function Ch(e,t,n){Th(e)&&n.delete(t)}function wh(){dh=!1,null!==hh&&Th(hh)&&(hh=null),null!==ph&&Th(ph)&&(ph=null),null!==fh&&Th(fh)&&(fh=null),mh.forEach(Ch),gh.forEach(Ch)}function Eh(e,t){e.blockedOn===t&&(e.blockedOn=null,dh||(dh=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,wh)))}var Ph=null;function Rh(e){Ph!==e&&(Ph=e,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Ph===e&&(Ph=null);for(var t=0;t<e.length;t+=3){var n=e[t],i=e[t+1],r=e[t+2];if("function"!==typeof i){if(null===lh(i||n))continue;break}var a=qe(n);null!==a&&(e.splice(t,3),t-=3,No(a,{pending:!0,data:r,method:n.method,action:i},i,r))}}))}function Oh(e){function t(t){return Eh(t,e)}null!==hh&&Eh(hh,e),null!==ph&&Eh(ph,e),null!==fh&&Eh(fh,e),mh.forEach(t),gh.forEach(t);for(var n=0;n<vh.length;n++){var i=vh[n];i.blockedOn===e&&(i.blockedOn=null)}for(;0<vh.length&&null===(n=vh[0]).blockedOn;)Sh(n),null===n.blockedOn&&vh.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(i=0;i<n.length;i+=3){var r=n[i],a=n[i+1],o=r[Me]||null;if("function"===typeof a)o||Rh(n);else if(o){var s=null;if(a&&a.hasAttribute("formAction")){if(r=a,o=a[Me]||null)s=o.formAction;else if(null!==lh(r))continue}else s=o.action;"function"===typeof s?n[i+1]=s:(n.splice(i,3),i-=3),Rh(n)}}}function xh(e){this._internalRoot=e}function Ih(e){this._internalRoot=e}Ih.prototype.render=xh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Zd(t.current,Al(),e,t,null,null)},Ih.prototype.unmount=xh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Zd(e.current,2,null,e,null,null),Vl(),t[Ae]=null}},Ih.prototype.unstable_scheduleHydration=function(e){if(e){var t=_e();e={blockedOn:null,target:e,priority:t};for(var n=0;n<vh.length&&0!==t&&t<vh[n].priority;n++);vh.splice(n,0,e),0===n&&Sh(e)}};var _h=r.version;if("19.1.0"!==_h)throw Error(o(527,_h,"19.1.0"));L.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=c(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return u(r),e;if(a===i)return u(r),t;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=a;break}if(l===i){s=!0,i=r,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,i=r;break}if(l===i){s=!0,i=a,n=r;break}l=l.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?d(e):null)?null:e.stateNode};var Nh={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:A,reconcilerVersion:"19.1.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Dh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dh.isDisabled&&Dh.supportsFiber)try{de=Dh.inject(Nh),he=Dh}catch(Mh){}}t.createRoot=function(e,t){if(!s(e))throw Error(o(299));var n=!1,i="",r=ys,a=ks,c=Ss;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onUncaughtError&&(r=t.onUncaughtError),void 0!==t.onCaughtError&&(a=t.onCaughtError),void 0!==t.onRecoverableError&&(c=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Yd(e,1,!1,null,0,n,i,r,a,c,0,null),e[Ae]=t.current,zu(e),new xh(t)},t.hydrateRoot=function(e,t,n){if(!s(e))throw Error(o(299));var i=!1,r="",a=ys,c=ks,l=Ss,u=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(r=n.identifierPrefix),void 0!==n.onUncaughtError&&(a=n.onUncaughtError),void 0!==n.onCaughtError&&(c=n.onCaughtError),void 0!==n.onRecoverableError&&(l=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(u=n.formState)),(t=Yd(e,1,!0,t,0,i,r,a,c,l,0,u)).context=Xd(null),n=t.current,(r=aa(i=xe(i=Al()))).callback=null,oa(n,r,i),n=i,t.current.lanes=n,Pe(t,n),Cu(t),e[Ae]=t.current,zu(e),new Ih(t)},t.version="19.1.0"},43:(e,t,n)=>{e.exports=n(288)},288:(e,t)=>{var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function b(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var k=y.prototype=new b;k.constructor=y,m(k,v.prototype),k.isPureReactComponent=!0;var S=Array.isArray,T={H:null,A:null,T:null,S:null,V:null},C=Object.prototype.hasOwnProperty;function w(e,t,i,r,a,o){return i=o.ref,{$$typeof:n,type:e,key:t,ref:void 0!==i?i:null,props:o}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var P=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function O(){}function x(e,t,r,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c,l,u=!1;if(null===e)u=!0;else switch(s){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case i:u=!0;break;case h:return x((u=e._init)(e._payload),t,r,a,o)}}if(u)return o=o(e),u=""===a?"."+R(e,0):a,S(o)?(r="",null!=u&&(r=u.replace(P,"$&/")+"/"),x(o,t,r,"",function(e){return e})):null!=o&&(E(o)&&(c=o,l=r+(null==o.key||e&&e.key===o.key?"":(""+o.key).replace(P,"$&/")+"/")+u,o=w(c.type,l,void 0,0,0,c.props)),t.push(o)),1;u=0;var d,f=""===a?".":a+":";if(S(e))for(var m=0;m<e.length;m++)u+=x(a=e[m],t,r,s=f+R(a,m),o);else if("function"===typeof(m=null===(d=e)||"object"!==typeof d?null:"function"===typeof(d=p&&d[p]||d["@@iterator"])?d:null))for(e=m.call(e),m=0;!(a=e.next()).done;)u+=x(a=a.value,t,r,s=f+R(a,m++),o);else if("object"===s){if("function"===typeof e.then)return x(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(O,O):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,r,a,o);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function I(e,t,n){if(null==e)return e;var i=[],r=0;return x(e,i,"","",function(e){return t.call(n,e,r++)}),i}function _(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var N="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function D(){}t.Children={map:I,forEach:function(e,t,n){I(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=o,t.PureComponent=y,t.StrictMode=a,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return T.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var i=m({},e.props),r=e.key;if(null!=t)for(a in void 0!==t.ref&&void 0,void 0!==t.key&&(r=""+t.key),t)!C.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(i[a]=t[a]);var a=arguments.length-2;if(1===a)i.children=n;else if(1<a){for(var o=Array(a),s=0;s<a;s++)o[s]=arguments[s+2];i.children=o}return w(e.type,r,void 0,0,0,i)},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,n){var i,r={},a=null;if(null!=t)for(i in void 0!==t.key&&(a=""+t.key),t)C.call(t,i)&&"key"!==i&&"__self"!==i&&"__source"!==i&&(r[i]=t[i]);var o=arguments.length-2;if(1===o)r.children=n;else if(1<o){for(var s=Array(o),c=0;c<o;c++)s[c]=arguments[c+2];r.children=s}if(e&&e.defaultProps)for(i in o=e.defaultProps)void 0===r[i]&&(r[i]=o[i]);return w(e,a,void 0,0,0,r)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:_}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=T.T,n={};T.T=n;try{var i=e(),r=T.S;null!==r&&r(n,i),"object"===typeof i&&null!==i&&"function"===typeof i.then&&i.then(D,N)}catch(a){N(a)}finally{T.T=t}},t.unstable_useCacheRefresh=function(){return T.H.useCacheRefresh()},t.use=function(e){return T.H.use(e)},t.useActionState=function(e,t,n){return T.H.useActionState(e,t,n)},t.useCallback=function(e,t){return T.H.useCallback(e,t)},t.useContext=function(e){return T.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return T.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var i=T.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return i.useEffect(e,t)},t.useId=function(){return T.H.useId()},t.useImperativeHandle=function(e,t,n){return T.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return T.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return T.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return T.H.useMemo(e,t)},t.useOptimistic=function(e,t){return T.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return T.H.useReducer(e,t,n)},t.useRef=function(e){return T.H.useRef(e)},t.useState=function(e){return T.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return T.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return T.H.useTransition()},t.version="19.1.0"},391:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4)},579:(e,t,n)=>{e.exports=n(799)},672:(e,t,n)=>{var i=n(43);function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var o={d:{f:a,r:function(){throw Error(r(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},s=Symbol.for("react.portal");var c=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(r(299));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:s,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=c.T,n=o.p;try{if(c.T=null,o.p=2,e)return e()}finally{c.T=t,o.p=n,o.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,o.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&o.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,i=l(n,t.crossOrigin),r="string"===typeof t.integrity?t.integrity:void 0,a="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?o.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:i,integrity:r,fetchPriority:a}):"script"===n&&o.d.X(e,{crossOrigin:i,integrity:r,fetchPriority:a,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=l(t.as,t.crossOrigin);o.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&o.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,i=l(n,t.crossOrigin);o.d.L(e,n,{crossOrigin:i,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=l(t.as,t.crossOrigin);o.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else o.d.m(e)},t.requestFormReset=function(e){o.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return c.H.useFormState(e,t,n)},t.useFormStatus=function(){return c.H.useHostTransitionStatus()},t.version="19.1.0"},799:(e,t)=>{var n=Symbol.for("react.transitional.element");function i(e,t,i){var r=null;if(void 0!==i&&(r=""+i),void 0!==t.key&&(r=""+t.key),"key"in t)for(var a in i={},t)"key"!==a&&(i[a]=t[a]);else i=t;return t=i.ref,{$$typeof:n,type:e,key:r,ref:void 0!==t?t:null,props:i}}Symbol.for("react.fragment"),t.jsx=i,t.jsxs=i},853:(e,t,n)=>{e.exports=n(896)},896:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<a(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,c=e[s],l=s+1,u=e[l];if(0>a(c,n))l<r&&0>a(u,c)?(e[i]=u,e[l]=n,i=l):(e[i]=c,e[s]=n,i=s);else{if(!(l<r&&0>a(u,n)))break e;e[i]=u,e[l]=n,i=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var l=[],u=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,v=!1,b="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,k="undefined"!==typeof setImmediate?setImmediate:null;function S(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(l,t)}t=i(u)}}function T(e){if(g=!1,S(e),!m)if(null!==i(l))m=!0,w||(w=!0,C());else{var t=i(u);null!==t&&N(T,t.startTime-e)}}var C,w=!1,E=-1,P=5,R=-1;function O(){return!!v||!(t.unstable_now()-R<P)}function x(){if(v=!1,w){var e=t.unstable_now();R=e;var n=!0;try{e:{m=!1,g&&(g=!1,y(E),E=-1),f=!0;var a=p;try{t:{for(S(e),h=i(l);null!==h&&!(h.expirationTime>e&&O());){var o=h.callback;if("function"===typeof o){h.callback=null,p=h.priorityLevel;var s=o(h.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof s){h.callback=s,S(e),n=!0;break t}h===i(l)&&r(l),S(e)}else r(l);h=i(l)}if(null!==h)n=!0;else{var c=i(u);null!==c&&N(T,c.startTime-e),n=!1}}break e}finally{h=null,p=a,f=!1}n=void 0}}finally{n?C():w=!1}}}if("function"===typeof k)C=function(){k(x)};else if("undefined"!==typeof MessageChannel){var I=new MessageChannel,_=I.port2;I.port1.onmessage=x,C=function(){_.postMessage(null)}}else C=function(){b(x,0)};function N(e,n){E=b(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_requestPaint=function(){v=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(u,e),null===i(l)&&e===i(u)&&(g?(y(E),E=-1):g=!0,N(T,a-o))):(e.sortIndex=s,n(l,e),m||f||(m=!0,w||(w=!0,C()))),e},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(672)}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}n.m=e,n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,i)=>(n.f[i](e,t),t),[])),n.u=e=>"static/js/"+e+".ee5807c3.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="personal-website:";n.l=(i,r,a,o)=>{if(e[i])e[i].push(r);else{var s,c;if(void 0!==a)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==i||d.getAttribute("data-webpack")==t+a){s=d;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+a),s.src=i),e[i]=[r];var h=(t,n)=>{s.onerror=s.onload=null,clearTimeout(p);var r=e[i];if(delete e[i],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach(e=>e(n)),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),c&&document.head.appendChild(s)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{var e={792:0};n.f.j=(t,i)=>{var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var a=new Promise((n,i)=>r=e[t]=[n,i]);i.push(r[2]=a);var o=n.p+n.u(t),s=new Error;n.l(o,i=>{if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var a=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",s.name="ChunkLoadError",s.type=a,s.request=o,r[1](s)}},"chunk-"+t,t)}};var t=(t,i)=>{var r,a,o=i[0],s=i[1],c=i[2],l=0;if(o.some(t=>0!==e[t])){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(c)c(n)}for(t&&t(i);l<o.length;l++)a=o[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},i=self.webpackChunkpersonal_website=self.webpackChunkpersonal_website||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var i=n(43),r=n(391);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}function s(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const d=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},h=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>Boolean(e)&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()};var p={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const f=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],m=(0,i.forwardRef)((e,t)=>{let{color:n="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:s="",children:c,iconNode:d}=e,m=u(e,f);return(0,i.createElement)("svg",l(l(l({ref:t},p),{},{width:r,height:r,stroke:n,strokeWidth:o?24*Number(a)/Number(r):a,className:h("lucide",s)},!c&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"}),m),[...d.map(e=>{let[t,n]=e;return(0,i.createElement)(t,n)}),...Array.isArray(c)?c:[c]])}),g=["className"],v=(e,t)=>{const n=(0,i.forwardRef)((n,r)=>{let{className:a}=n,o=u(n,g);return(0,i.createElement)(m,l({ref:r,iconNode:t,className:h("lucide-".concat((s=d(e),s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(e),a)},o));var s});return n.displayName=d(e),n},b=v("phone-off",[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]]),y=v("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);function k(e,t){return t.forEach(function(t){t&&"string"!==typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}var S=Object.defineProperty,T=(e,t,n)=>((e,t,n)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class C{constructor(){T(this,"_locking"),T(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){let e;this._locks+=1;const t=new Promise(t=>e=()=>{this._locks-=1,t()}),n=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),n}}function w(e,t){if(!e)throw new Error(t)}function E(e){if("number"!==typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function P(e){if("number"!==typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function R(e){if("number"!==typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}const O=Symbol("@bufbuild/protobuf/enum-type");function x(e){const t=e[O];return w(t,"missing enum type on enum object"),t}function I(e,t,n,i){e[O]=_(t,n.map(t=>({no:t.no,name:t.name,localName:e[t.no]})))}function _(e,t,n){const i=Object.create(null),r=Object.create(null),a=[];for(const o of t){const e=D(o);a.push(e),i[o.name]=e,r[o.no]=e}return{typeName:e,values:a,findName:e=>i[e],findNumber:e=>r[e]}}function N(e,t,n){const i={};for(const r of t){const e=D(r);i[e.localName]=e.no,i[e.no]=e.localName}return I(i,e,t),i}function D(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class M{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const n=this.getType().runtime.bin,i=n.makeReadOptions(t);return n.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const n=this.getType(),i=n.runtime.json,r=i.makeReadOptions(t);return i.readMessage(n,e,r,this),this}fromJsonString(e,t){let n;try{n=JSON.parse(e)}catch(S){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(S instanceof Error?S.message:String(S)))}return this.fromJson(n,t)}toBinary(e){const t=this.getType().runtime.bin,n=t.makeWriteOptions(e),i=n.writerFactory();return t.writeMessage(this,i,n),i.finish()}toJson(e){const t=this.getType().runtime.json,n=t.makeWriteOptions(e);return t.writeMessage(this,n)}toJsonString(e){var t;const n=this.toJson(e);return JSON.stringify(n,null,null!==(t=null===e||void 0===e?void 0:e.prettySpaces)&&void 0!==t?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function A(){let e=0,t=0;for(let i=0;i<28;i+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,0==(128&n))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<i,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function L(e,t,n){for(let a=0;a<28;a+=7){const i=e>>>a,r=!(i>>>7==0&&0==t),o=255&(r?128|i:i);if(n.push(o),!r)return}const i=e>>>28&15|(7&t)<<4,r=!(t>>3==0);if(n.push(255&(r?128|i:i)),r){for(let e=3;e<31;e+=7){const i=t>>>e,r=!(i>>>7==0),a=255&(r?128|i:i);if(n.push(a),!r)return}n.push(t>>>31&1)}}const U=4294967296;function j(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let i=0,r=0;function a(t,a){const o=Number(e.slice(t,a));r*=n,i=i*n+o,i>=U&&(r+=i/U|0,i%=U)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),t?z(i,r):B(i,r)}function F(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(U*t+e);const n=16777215&(e>>>24|t<<8),i=t>>16&65535;let r=(16777215&e)+6777216*n+6710656*i,a=n+8147497*i,o=2*i;const s=1e7;return r>=s&&(a+=Math.floor(r/s),r%=s),a>=s&&(o+=Math.floor(a/s),a%=s),o.toString()+V(a)+V(r)}function B(e,t){return{lo:0|e,hi:0|t}}function z(e,t){return t=~t,e?e=1+~e:t+=1,B(e,t)}const V=e=>{const t=String(e);return"0000000".slice(t.length)+t};function q(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function H(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;0!==(128&e)&&n<10;n++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}const W=function(){const e=new DataView(new ArrayBuffer(8));if("function"===typeof BigInt&&"function"===typeof e.getBigInt64&&"function"===typeof e.getBigUint64&&"function"===typeof e.setBigInt64&&"function"===typeof e.setBigUint64&&("object"!=typeof process||"1"!=={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_ULTRAVOX_AGENT_ID:"194d06e7-c393-4ff6-847a-6fbdb7d8fcfb",REACT_APP_ULTRAVOX_API_KEY:"l3XFSy7o.DRrCu5jG9FQT80s929C13OqWWVXiQwst"}.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),i=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const i="bigint"==typeof e?e:BigInt(e);if(i>n||i<t)throw new Error("int64 invalid: ".concat(e));return i},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>r||t<i)throw new Error("uint64 invalid: ".concat(e));return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}const t=e=>w(/^-?[0-9]+$/.test(e),"int64 invalid: ".concat(e)),n=e=>w(/^[0-9]+$/.test(e),"uint64 invalid: ".concat(e));return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),t(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),n(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),t(e),j(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),n(e),j(e)),dec:(e,t)=>function(e,t){let n=B(e,t);const i=2147483648&n.hi;i&&(n=z(n.lo,n.hi));const r=F(n.lo,n.hi);return i?"-"+r:r}(e,t),uDec:(e,t)=>F(e,t)}}();var G,K,Q;function J(e,t,n){if(t===n)return!0;if(e==G.BYTES){if(!(t instanceof Uint8Array)||!(n instanceof Uint8Array))return!1;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}switch(e){case G.UINT64:case G.FIXED64:case G.INT64:case G.SFIXED64:case G.SINT64:return t==n}return!1}function $(e,t){switch(e){case G.BOOL:return!1;case G.UINT64:case G.FIXED64:case G.INT64:case G.SFIXED64:case G.SINT64:return 0==t?W.zero:"0";case G.DOUBLE:case G.FLOAT:return 0;case G.BYTES:return new Uint8Array(0);case G.STRING:return"";default:return 0}}function Y(e,t){switch(e){case G.BOOL:return!1===t;case G.STRING:return""===t;case G.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(G||(G={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"}(K||(K={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(Q||(Q={}));class X{constructor(e){this.stack=[],this.textEncoder=null!==e&&void 0!==e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),n=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],n),n+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(P(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return E(e),q(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){R(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){P(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){E(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return E(e),q(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=W.enc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=W.uEnc(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=W.enc(e);return L(t.lo,t.hi,this.buf),this}sint64(e){let t=W.enc(e),n=t.hi>>31;return L(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=W.uEnc(e);return L(t.lo,t.hi,this.buf),this}}class Z{constructor(e,t){this.varint64=A,this.uint32=H,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!==t&&void 0!==t?t:new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case Q.Varint:for(;128&this.buf[this.pos++];);break;case Q.Bit64:this.pos+=4;case Q.Bit32:this.pos+=4;break;case Q.LengthDelimited:let n=this.uint32();this.pos+=n;break;case Q.StartGroup:for(;;){const[e,n]=this.tag();if(n===Q.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return W.dec(...this.varint64())}uint64(){return W.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,W.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return W.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return W.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function ee(e){const t=e.field.localName,n=Object.create(null);return n[t]=function(e){const t=e.field;if(t.repeated)return[];if(void 0!==t.default)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return $(t.T,t.L);case"message":const e=t.T,n=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(n):n;case"map":throw"map fields are not allowed to be extensions"}}(e),[n,()=>n[t]]}let te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),ne=[];for(let yc=0;yc<te.length;yc++)ne[te[yc].charCodeAt(0)]=yc;ne["-".charCodeAt(0)]=te.indexOf("+"),ne["_".charCodeAt(0)]=te.indexOf("/");const ie={dec(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),r=0,a=0,o=0;for(let s=0;s<e.length;s++){if(n=ne[e.charCodeAt(s)],void 0===n)switch(e[s]){case"=":a=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:o=n,a=1;break;case 1:i[r++]=o<<2|(48&n)>>4,o=n,a=2;break;case 2:i[r++]=(15&o)<<4|(60&n)>>2,o=n,a=3;break;case 3:i[r++]=(3&o)<<6|n,a=0}}if(1==a)throw Error("invalid base64 string.");return i.subarray(0,r)},enc(e){let t,n="",i=0,r=0;for(let a=0;a<e.length;a++)switch(t=e[a],i){case 0:n+=te[t>>2],r=(3&t)<<4,i=1;break;case 1:n+=te[r|t>>4],r=(15&t)<<2,i=2;break;case 2:n+=te[r|t>>6],n+=te[63&t],i=0}return i&&(n+=te[r],n+="=",1==i&&(n+="=")),n}};function re(e,t,n){se(t,e);const i=t.runtime.bin.makeReadOptions(n),r=function(e,t){if(!t.repeated&&("enum"==t.kind||"scalar"==t.kind)){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter(e=>e.no===t.no)}(e.getType().runtime.bin.listUnknownFields(e),t.field),[a,o]=ee(t);for(const s of r)t.runtime.bin.readField(a,i.readerFactory(s.data),t.field,s.wireType,i);return o()}function ae(e,t,n,i){se(t,e);const r=t.runtime.bin.makeReadOptions(i),a=t.runtime.bin.makeWriteOptions(i);if(oe(e,t)){const n=e.getType().runtime.bin.listUnknownFields(e).filter(e=>e.no!=t.field.no);e.getType().runtime.bin.discardUnknownFields(e);for(const t of n)e.getType().runtime.bin.onUnknownField(e,t.no,t.wireType,t.data)}const o=a.writerFactory();let s=t.field;s.opt||s.repeated||"enum"!=s.kind&&"scalar"!=s.kind||(s=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(s,n,o,a);const c=r.readerFactory(o.finish());for(;c.pos<c.len;){const[t,n]=c.tag(),i=c.skip(n,t);e.getType().runtime.bin.onUnknownField(e,t,n,i)}}function oe(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find(e=>e.no==t.field.no)}function se(e,t){w(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function ce(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?void 0!==t[n]:"enum"==e.kind?t[n]!==e.T.values[0].no:!Y(e.T,t[n]);case"message":return void 0!==t[n];case"map":return Object.keys(t[n]).length>0}}function le(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?$(e.T,e.L):void 0;break;case"message":t[n]=void 0}}function ue(e,t){if(null===e||"object"!=typeof e)return!1;if(!Object.getOwnPropertyNames(M.prototype).every(t=>t in e&&"function"==typeof e[t]))return!1;const n=e.getType();return null!==n&&"function"==typeof n&&"typeName"in n&&"string"==typeof n.typeName&&(void 0===t||n.typeName==t.typeName)}function de(e,t){return ue(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}G.DOUBLE,G.FLOAT,G.INT64,G.UINT64,G.INT32,G.UINT32,G.BOOL,G.STRING,G.BYTES;const he={ignoreUnknownFields:!1},pe={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function fe(e){return e?Object.assign(Object.assign({},he),e):he}function me(e){return e?Object.assign(Object.assign({},pe),e):pe}const ge=Symbol(),ve=Symbol();function be(e){if(null===e)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function ye(e,t,n,i,r){let a=n.localName;if(n.repeated){if(w("map"!=n.kind),null===t)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(t)));const o=e[a];for(const e of t){if(null===e)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(e)));switch(n.kind){case"message":o.push(n.T.fromJson(e,i));break;case"enum":const t=Te(n.T,e,i.ignoreUnknownFields,!0);t!==ve&&o.push(t);break;case"scalar":try{o.push(Se(n.T,e,n.L,!0))}catch(S){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(e));throw S instanceof Error&&S.message.length>0&&(i+=": ".concat(S.message)),new Error(i)}}}}else if("map"==n.kind){if(null===t)return;if("object"!=typeof t||Array.isArray(t))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(t)));const o=e[a];for(const[e,a]of Object.entries(t)){if(null===a)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let s;try{s=ke(n.K,e)}catch(S){let i="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(t));throw S instanceof Error&&S.message.length>0&&(i+=": ".concat(S.message)),new Error(i)}switch(n.V.kind){case"message":o[s]=n.V.T.fromJson(a,i);break;case"enum":const e=Te(n.V.T,a,i.ignoreUnknownFields,!0);e!==ve&&(o[s]=e);break;case"scalar":try{o[s]=Se(n.V.T,a,K.BIGINT,!0)}catch(S){let i="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(t));throw S instanceof Error&&S.message.length>0&&(i+=": ".concat(S.message)),new Error(i)}}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:a},a="value"),n.kind){case"message":const o=n.T;if(null===t&&"google.protobuf.Value"!=o.typeName)return;let s=e[a];ue(s)?s.fromJson(t,i):(e[a]=s=o.fromJson(t,i),o.fieldWrapper&&!n.oneof&&(e[a]=o.fieldWrapper.unwrapField(s)));break;case"enum":const c=Te(n.T,t,i.ignoreUnknownFields,!1);switch(c){case ge:le(n,e);break;case ve:break;default:e[a]=c}break;case"scalar":try{const i=Se(n.T,t,n.L,!1);if(i===ge)le(n,e);else e[a]=i}catch(S){let i="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(be(t));throw S instanceof Error&&S.message.length>0&&(i+=": ".concat(S.message)),new Error(i)}}}function ke(e,t){if(e===G.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1}return Se(e,t,K.BIGINT,!0).toString()}function Se(e,t,n,i){if(null===t)return i?$(e,n):ge;switch(e){case G.DOUBLE:case G.FLOAT:if("NaN"===t)return Number.NaN;if("Infinity"===t)return Number.POSITIVE_INFINITY;if("-Infinity"===t)return Number.NEGATIVE_INFINITY;if(""===t)break;if("string"==typeof t&&t.trim().length!==t.length)break;if("string"!=typeof t&&"number"!=typeof t)break;const i=Number(t);if(Number.isNaN(i))break;if(!Number.isFinite(i))break;return e==G.FLOAT&&R(i),i;case G.INT32:case G.FIXED32:case G.SFIXED32:case G.SINT32:case G.UINT32:let r;if("number"==typeof t?r=t:"string"==typeof t&&t.length>0&&t.trim().length===t.length&&(r=Number(t)),void 0===r)break;return e==G.UINT32||e==G.FIXED32?P(r):E(r),r;case G.INT64:case G.SFIXED64:case G.SINT64:if("number"!=typeof t&&"string"!=typeof t)break;const a=W.parse(t);return n?a.toString():a;case G.FIXED64:case G.UINT64:if("number"!=typeof t&&"string"!=typeof t)break;const o=W.uParse(t);return n?o.toString():o;case G.BOOL:if("boolean"!==typeof t)break;return t;case G.STRING:if("string"!==typeof t)break;try{encodeURIComponent(t)}catch(S){throw new Error("invalid UTF8")}return t;case G.BYTES:if(""===t)return new Uint8Array(0);if("string"!==typeof t)break;return ie.dec(t)}throw new Error}function Te(e,t,n,i){if(null===t)return"google.protobuf.NullValue"==e.typeName?0:i?e.values[0].no:ge;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=e.findName(t);if(void 0!==i)return i.no;if(n)return ve}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(be(t)))}function Ce(e){return!(!e.repeated&&"map"!=e.kind)||!e.oneof&&("message"!=e.kind&&(!e.opt&&!e.req))}function we(e,t,n){if("map"==e.kind){w("object"==typeof t&&null!=t);const i={},r=Object.entries(t);switch(e.V.kind){case"scalar":for(const[n,a]of r)i[n.toString()]=Pe(e.V.T,a);break;case"message":for(const[e,a]of r)i[e.toString()]=a.toJson(n);break;case"enum":const t=e.V.T;for(const[e,a]of r)i[e.toString()]=Ee(t,a,n.enumAsInteger)}return n.emitDefaultValues||r.length>0?i:void 0}if(e.repeated){w(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++)i.push(Pe(e.T,t[n]));break;case"enum":for(let r=0;r<t.length;r++)i.push(Ee(e.T,t[r],n.enumAsInteger));break;case"message":for(let e=0;e<t.length;e++)i.push(t[e].toJson(n))}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return Pe(e.T,t);case"enum":return Ee(e.T,t,n.enumAsInteger);case"message":return de(e.T,t).toJson(n)}}function Ee(e,t,n){var i;if(w("number"==typeof t),"google.protobuf.NullValue"==e.typeName)return null;if(n)return t;const r=e.findNumber(t);return null!==(i=null===r||void 0===r?void 0:r.name)&&void 0!==i?i:t}function Pe(e,t){switch(e){case G.INT32:case G.SFIXED32:case G.SINT32:case G.FIXED32:case G.UINT32:return w("number"==typeof t),t;case G.FLOAT:case G.DOUBLE:return w("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case G.STRING:return w("string"==typeof t),t;case G.BOOL:return w("boolean"==typeof t),t;case G.UINT64:case G.FIXED64:case G.INT64:case G.SFIXED64:case G.SINT64:return w("bigint"==typeof t||"string"==typeof t||"number"==typeof t),t.toString();case G.BYTES:return w(t instanceof Uint8Array),ie.enc(t)}}const Re=Symbol("@bufbuild/protobuf/unknown-fields"),Oe={readUnknownFields:!0,readerFactory:e=>new Z(e)},xe={writeUnknownFields:!0,writerFactory:()=>new X};function Ie(e){return e?Object.assign(Object.assign({},Oe),e):Oe}function _e(e){return e?Object.assign(Object.assign({},xe),e):xe}function Ne(e,t,n,i,r){let{repeated:a,localName:o}=n;switch(n.oneof&&((e=e[n.oneof.localName]).case!=o&&delete e.value,e.case=o,o="value"),n.kind){case"scalar":case"enum":const s="enum"==n.kind?G.INT32:n.T;let c=Ae;if("scalar"==n.kind&&n.L>0&&(c=Me),a){let n=e[o];if(i==Q.LengthDelimited&&s!=G.STRING&&s!=G.BYTES){let e=t.uint32()+t.pos;for(;t.pos<e;)n.push(c(t,s))}else n.push(c(t,s))}else e[o]=c(t,s);break;case"message":const l=n.T;a?e[o].push(De(t,new l,r,n)):ue(e[o])?De(t,e[o],r,n):(e[o]=De(t,new l,r,n),!l.fieldWrapper||n.oneof||n.repeated||(e[o]=l.fieldWrapper.unwrapField(e[o])));break;case"map":let[u,d]=function(e,t,n){const i=t.uint32(),r=t.pos+i;let a,o;for(;t.pos<r;){const[i]=t.tag();switch(i){case 1:a=Ae(t,e.K);break;case 2:switch(e.V.kind){case"scalar":o=Ae(t,e.V.T);break;case"enum":o=t.int32();break;case"message":o=De(t,new e.V.T,n,void 0)}}}void 0===a&&(a=$(e.K,K.BIGINT));"string"!=typeof a&&"number"!=typeof a&&(a=a.toString());if(void 0===o)switch(e.V.kind){case"scalar":o=$(e.V.T,K.BIGINT);break;case"enum":o=e.V.T.values[0].no;break;case"message":o=new e.V.T}return[a,o]}(n,t,r);e[o][u]=d}}function De(e,t,n,i){const r=t.getType().runtime.bin,a=null===i||void 0===i?void 0:i.delimited;return r.readMessage(t,e,a?i.no:e.uint32(),n,a),t}function Me(e,t){const n=Ae(e,t);return"bigint"==typeof n?n.toString():n}function Ae(e,t){switch(t){case G.STRING:return e.string();case G.BOOL:return e.bool();case G.DOUBLE:return e.double();case G.FLOAT:return e.float();case G.INT32:return e.int32();case G.INT64:return e.int64();case G.UINT64:return e.uint64();case G.FIXED64:return e.fixed64();case G.BYTES:return e.bytes();case G.FIXED32:return e.fixed32();case G.SFIXED32:return e.sfixed32();case G.SFIXED64:return e.sfixed64();case G.SINT64:return e.sint64();case G.UINT32:return e.uint32();case G.SINT32:return e.sint32()}}function Le(e,t,n,i){w(void 0!==t);const r=e.repeated;switch(e.kind){case"scalar":case"enum":let a="enum"==e.kind?G.INT32:e.T;if(r)if(w(Array.isArray(t)),e.packed)!function(e,t,n,i){if(!i.length)return;e.tag(n,Q.LengthDelimited).fork();let[,r]=Be(t);for(let a=0;a<i.length;a++)e[r](i[a]);e.join()}(n,a,e.no,t);else for(const i of t)Fe(n,a,e.no,i);else Fe(n,a,e.no,t);break;case"message":if(r){w(Array.isArray(t));for(const r of t)je(n,i,e,r)}else je(n,i,e,t);break;case"map":w("object"==typeof t&&null!=t);for(const[r,o]of Object.entries(t))Ue(n,i,e,r,o)}}function Ue(e,t,n,i,r){e.tag(n.no,Q.LengthDelimited),e.fork();let a=i;switch(n.K){case G.INT32:case G.FIXED32:case G.UINT32:case G.SFIXED32:case G.SINT32:a=Number.parseInt(i);break;case G.BOOL:w("true"==i||"false"==i),a="true"==i}switch(Fe(e,n.K,1,a),n.V.kind){case"scalar":Fe(e,n.V.T,2,r);break;case"enum":Fe(e,G.INT32,2,r);break;case"message":w(void 0!==r),e.tag(2,Q.LengthDelimited).bytes(r.toBinary(t))}e.join()}function je(e,t,n,i){const r=de(n.T,i);n.delimited?e.tag(n.no,Q.StartGroup).raw(r.toBinary(t)).tag(n.no,Q.EndGroup):e.tag(n.no,Q.LengthDelimited).bytes(r.toBinary(t))}function Fe(e,t,n,i){w(void 0!==i);let[r,a]=Be(t);e.tag(n,r)[a](i)}function Be(e){let t=Q.Varint;switch(e){case G.BYTES:case G.STRING:t=Q.LengthDelimited;break;case G.DOUBLE:case G.FIXED64:case G.SFIXED64:t=Q.Bit64;break;case G.FIXED32:case G.SFIXED32:case G.FLOAT:t=Q.Bit32}return[t,G[e].toLowerCase()]}function ze(e){if(void 0===e)return e;if(ue(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function Ve(e){return e instanceof Uint8Array?e:new Uint8Array(e)}class qe{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const e={};for(const t of this.list())e[t.jsonName]=e[t.name]=t;this.jsonNames=e}return this.jsonNames[e]}find(e){if(!this.numbers){const e={};for(const t of this.list())e[t.no]=t;this.numbers=e}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const n of this.list())n.oneof?n.oneof!==t&&(t=n.oneof,e.push(t)):e.push(n)}return this.members}}function He(e,t){const n=Ge(e);return t?n:Ye($e(n))}const We=Ge;function Ge(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let r=e.charAt(i);switch(r){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),t=!1;break;default:t&&(t=!1,r=r.toUpperCase()),n.push(r)}}return n.join("")}const Ke=new Set(["constructor","toString","toJSON","valueOf"]),Qe=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Je=e=>"".concat(e,"$"),$e=e=>Qe.has(e)?Je(e):e,Ye=e=>Ke.has(e)?Je(e):e;class Xe{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=He(e,!1)}addField(e){w(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[e]}}const Ze=(et=e=>new qe(e,e=>function(e){var t,n,i,r,a,o;const s=[];let c;for(const l of"function"==typeof e?e():e){const e=l;if(e.localName=He(l.name,void 0!==l.oneof),e.jsonName=null!==(t=l.jsonName)&&void 0!==t?t:We(l.name),e.repeated=null!==(n=l.repeated)&&void 0!==n&&n,"scalar"==l.kind&&(e.L=null!==(i=l.L)&&void 0!==i?i:K.BIGINT),e.delimited=null!==(r=l.delimited)&&void 0!==r&&r,e.req=null!==(a=l.req)&&void 0!==a&&a,e.opt=null!==(o=l.opt)&&void 0!==o&&o,void 0===l.packed&&(e.packed="enum"==l.kind||"scalar"==l.kind&&l.T!=G.BYTES&&l.T!=G.STRING),void 0!==l.oneof){const t="string"==typeof l.oneof?l.oneof:l.oneof.name;c&&c.name==t||(c=new Xe(t)),e.oneof=c,c.addField(e)}s.push(e)}return s}(e)),tt=e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated)i[n]=[];else switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=$(t.T,t.L)}}},{syntax:"proto3",json:{makeReadOptions:fe,makeWriteOptions:me,readMessage(e,t,n,i){if(null==t||Array.isArray(t)||"object"!=typeof t)throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(be(t)));i=null!==i&&void 0!==i?i:new e;const r=new Map,a=n.typeRegistry;for(const[o,s]of Object.entries(t)){const t=e.fields.findJsonName(o);if(t){if(t.oneof){if(null===s&&"scalar"==t.kind)continue;const n=r.get(t.oneof);if(void 0!==n)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(t.oneof.name,'" present: "').concat(n,'", "').concat(o,'"'));r.set(t.oneof,o)}ye(i,s,t,n,e)}else{let t=!1;if((null===a||void 0===a?void 0:a.findExtension)&&o.startsWith("[")&&o.endsWith("]")){const r=a.findExtension(o.substring(1,o.length-1));if(r&&r.extendee.typeName==e.typeName){t=!0;const[e,a]=ee(r);ye(e,s,r.field,n,r),ae(i,r,a(),n)}}if(!t&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!ce(r,e)){if(r.req)throw"required field not set";if(!t.emitDefaultValues)continue;if(!Ce(r))continue}const n=we(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t);void 0!==n&&(i[t.useProtoFieldName?r.name:r.jsonName]=n)}const a=t.typeRegistry;if(null===a||void 0===a?void 0:a.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(e)){const o=a.findExtensionFor(n.typeName,r.no);if(o&&oe(e,o)){const n=re(e,o,t),r=we(o.field,n,t);void 0!==r&&(i[o.field.jsonName]=r)}}}catch(S){const t=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),i=S instanceof Error?S.message:String(S);throw new Error(t+(i.length>0?": ".concat(i):""))}return i},readScalar:(e,t,n)=>Se(e,t,null!==n&&void 0!==n?n:K.BIGINT,!0),writeScalar(e,t,n){if(void 0!==t)return n||Y(e,t)?Pe(e,t):void 0},debug:be},bin:{makeReadOptions:Ie,makeWriteOptions:_e,listUnknownFields(e){var t;return null!==(t=e[Re])&&void 0!==t?t:[]},discardUnknownFields(e){delete e[Re]},writeUnknownFields(e,t){const n=e[Re];if(n)for(const i of n)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(e,t,n,i){const r=e;Array.isArray(r[Re])||(r[Re]=[]),r[Re].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,r){const a=e.getType(),o=r?t.len:t.pos+n;let s,c;for(;t.pos<o&&([s,c]=t.tag(),!0!==r||c!=Q.EndGroup);){const n=a.fields.find(s);if(!n){const n=t.skip(c,s);i.readUnknownFields&&this.onUnknownField(e,s,c,n);continue}Ne(e,t,n,c,i)}if(r&&(c!=Q.EndGroup||s!==n))throw new Error("invalid end group tag")},readField:Ne,writeMessage(e,t,n){const i=e.getType();for(const r of i.fields.byNumber())if(ce(r,e))Le(r,r.oneof?e[r.oneof.localName].value:e[r.localName],t,n);else if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){void 0!==t&&Le(e,t,n,i)}},util:Object.assign(Object.assign({},{setEnumType:I,initPartial(e,t){if(void 0===e)return;const n=t.getType();for(const i of n.fields.byMember()){const n=i.localName,r=t,a=e;if(null!=a[n])switch(i.kind){case"oneof":const e=a[n].case;if(void 0===e)continue;const t=i.findField(e);let o=a[n].value;t&&"message"==t.kind&&!ue(o,t.T)?o=new t.T(o):t&&"scalar"===t.kind&&t.T===G.BYTES&&(o=Ve(o)),r[n]={case:e,value:o};break;case"scalar":case"enum":let s=a[n];i.T===G.BYTES&&(s=i.repeated?s.map(Ve):Ve(s)),r[n]=s;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===G.BYTES)for(const[t,i]of Object.entries(a[n]))r[n][t]=Ve(i);else Object.assign(r[n],a[n]);break;case"message":const e=i.V.T;for(const t of Object.keys(a[n])){let i=a[n][t];e.fieldWrapper||(i=new e(i)),r[n][t]=i}}break;case"message":const c=i.T;if(i.repeated)r[n]=a[n].map(e=>ue(e,c)?e:new c(e));else{const e=a[n];c.fieldWrapper?"google.protobuf.BytesValue"===c.typeName?r[n]=Ve(e):r[n]=e:r[n]=ue(e,c)?e:new c(e)}}}},equals:(e,t,n)=>t===n||!(!t||!n)&&e.fields.byMember().every(e=>{const i=t[e.localName],r=n[e.localName];if(e.repeated){if(i.length!==r.length)return!1;switch(e.kind){case"message":return i.every((t,n)=>e.T.equals(t,r[n]));case"scalar":return i.every((t,n)=>J(e.T,t,r[n]));case"enum":return i.every((e,t)=>J(G.INT32,e,r[t]))}throw new Error("repeated cannot contain ".concat(e.kind))}switch(e.kind){case"message":let t=i,n=r;return e.T.fieldWrapper&&(void 0===t||ue(t)||(t=e.T.fieldWrapper.wrapField(t)),void 0===n||ue(n)||(n=e.T.fieldWrapper.wrapField(n))),e.T.equals(t,n);case"enum":return J(G.INT32,i,r);case"scalar":return J(e.T,i,r);case"oneof":if(i.case!==r.case)return!1;const a=e.findField(i.case);if(void 0===a)return!0;switch(a.kind){case"message":return a.T.equals(i.value,r.value);case"enum":return J(G.INT32,i.value,r.value);case"scalar":return J(a.T,i.value,r.value)}throw new Error("oneof cannot contain ".concat(a.kind));case"map":const o=Object.keys(i).concat(Object.keys(r));switch(e.V.kind){case"message":const t=e.V.T;return o.every(e=>t.equals(i[e],r[e]));case"enum":return o.every(e=>J(G.INT32,i[e],r[e]));case"scalar":const n=e.V.T;return o.every(e=>J(n,i[e],r[e]))}}}),clone(e){const t=e.getType(),n=new t,i=n;for(const r of t.fields.byMember()){const t=e[r.localName];let n;if(r.repeated)n=t.map(ze);else if("map"==r.kind){n=i[r.localName];for(const[e,i]of Object.entries(t))n[e]=ze(i)}else n="oneof"==r.kind?r.findField(t.case)?{case:t.case,value:ze(t.value)}:{case:void 0}:ze(t);i[r.localName]=n}for(const r of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}),{newFieldList:et,initFields:tt}),makeMessageType(e,t,n){return function(e,t,n,i){var r;const a=null!==(r=null===i||void 0===i?void 0:i.localName)&&void 0!==r?r:t.substring(t.lastIndexOf(".")+1),o={[a]:function(t){e.util.initFields(this),e.util.initPartial(t,this)}}[a];return Object.setPrototypeOf(o.prototype,new M),Object.assign(o,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary:(e,t)=>(new o).fromBinary(e,t),fromJson:(e,t)=>(new o).fromJson(e,t),fromJsonString:(e,t)=>(new o).fromJsonString(e,t),equals:(t,n)=>e.util.equals(o,t,n)}),o}(this,e,t,n)},makeEnum:N,makeEnumType:_,getEnumType:x,makeExtension(e,t,n){return function(e,t,n,i){let r;return{typeName:t,extendee:n,get field(){if(!r){const n="function"==typeof i?i():i;n.name=t.split(".").pop(),n.jsonName="[".concat(t,"]"),r=e.util.newFieldList([n]).list()[0]}return r},runtime:e}}(this,e,t,n)}});var et,tt;class nt extends M{constructor(e){super(),this.seconds=W.zero,this.nanos=0,Ze.util.initPartial(e,this)}fromJson(e,t){if("string"!==typeof e)throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(Ze.json.debug(e)));const n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=W.parse(i/1e3),this.nanos=0,n[7]&&(this.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),this}toJson(e){const t=1e3*Number(this.seconds);if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let n="Z";if(this.nanos>0){const e=(this.nanos+1e9).toString().substring(1);n="000000"===e.substring(3)?"."+e.substring(0,3)+"Z":"000"===e.substring(6)?"."+e.substring(0,6)+"Z":"."+e+"Z"}return new Date(t).toISOString().replace(".000Z",n)}toDate(){return new Date(1e3*Number(this.seconds)+Math.ceil(this.nanos/1e6))}static now(){return nt.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new nt({seconds:W.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return(new nt).fromBinary(e,t)}static fromJson(e,t){return(new nt).fromJson(e,t)}static fromJsonString(e,t){return(new nt).fromJsonString(e,t)}static equals(e,t){return Ze.util.equals(nt,e,t)}}nt.runtime=Ze,nt.typeName="google.protobuf.Timestamp",nt.fields=Ze.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const it=Ze.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:nt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:rt,repeated:!0},{no:5,name:"events",kind:"message",T:ot,repeated:!0}]),rt=Ze.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:at,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),at=Ze.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:nt},{no:3,name:"value",kind:"scalar",T:2}]),ot=Ze.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:nt},{no:7,name:"normalized_end_timestamp",kind:"message",T:nt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),st=Ze.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),ct=Ze.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),lt=Ze.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),ut=Ze.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),dt=Ze.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),ht=Ze.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),pt=Ze.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),ft=Ze.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),mt=Ze.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),gt=Ze.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),vt=Ze.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:bt,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:Jt}]),bt=Ze.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),yt=Ze.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:Ze.getEnumType(lt),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),kt=Ze.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Ze.getEnumType(St)},{no:4,name:"tracks",kind:"message",T:Pt,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:yt},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:Ze.getEnumType(Tt)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:Ze.getEnumType(pt)},{no:18,name:"kind_details",kind:"enum",T:Ze.getEnumType(Ct),repeated:!0}]),St=Ze.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Tt=Ze.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),Ct=Ze.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),wt=Ze.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),Et=Ze.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Rt,repeated:!0}]),Pt=Ze.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:Ze.getEnumType(ct)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:Ze.getEnumType(lt)},{no:10,name:"layers",kind:"message",T:Rt,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Et,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:Ze.getEnumType(wt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:Jt},{no:19,name:"audio_features",kind:"enum",T:Ze.getEnumType(gt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:Ze.getEnumType(st)}]),Rt=Ze.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:Ze.getEnumType(ut)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),Ot=Ze.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:Ze.getEnumType(xt)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Nt,oneof:"value"},{no:3,name:"speaker",kind:"message",T:It,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:Dt,oneof:"value"},{no:7,name:"transcription",kind:"message",T:Mt,oneof:"value"},{no:8,name:"metrics",kind:"message",T:it,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Lt,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Ut,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:jt,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Ft,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Zt,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:en,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:tn,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),xt=Ze.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),It=Ze.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:_t,repeated:!0}]),_t=Ze.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Nt=Ze.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),Dt=Ze.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),Mt=Ze.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:At,repeated:!0}]),At=Ze.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Lt=Ze.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Ut=Ze.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),jt=Ze.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Ft=Ze.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:Bt,oneof:"value"}]),Bt=Ze.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),zt=Ze.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),Vt=Ze.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:Ze.getEnumType(qt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),qt=Ze.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Ht=Ze.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:Ze.getEnumType(Wt)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),Wt=Ze.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),Gt=Ze.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:Kt},{no:2,name:"screen",kind:"message",T:Kt},{no:3,name:"resume_connection",kind:"enum",T:Ze.getEnumType(ht)},{no:4,name:"disabled_codecs",kind:"message",T:Qt},{no:5,name:"force_relay",kind:"enum",T:Ze.getEnumType(ht)}]),Kt=Ze.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:Ze.getEnumType(ht)}]),Qt=Ze.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:bt,repeated:!0},{no:2,name:"publish",kind:"message",T:bt,repeated:!0}]),Jt=Ze.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),$t=Ze.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Yt=Ze.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:Ze.getEnumType($t)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),Xt=Ze.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Zt=Ze.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:Ze.getEnumType(wt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Yt,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:Xt,oneof:"content_header"}],{localName:"DataStream_Header"}),en=Ze.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),tn=Ze.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),nn=Ze.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),rn=Ze.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),an=Ze.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),on=Ze.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:gn,oneof:"message"},{no:2,name:"answer",kind:"message",T:gn,oneof:"message"},{no:3,name:"trickle",kind:"message",T:un,oneof:"message"},{no:4,name:"add_track",kind:"message",T:ln,oneof:"message"},{no:5,name:"mute",kind:"message",T:dn,oneof:"message"},{no:6,name:"subscription",kind:"message",T:bn,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:yn,oneof:"message"},{no:8,name:"leave",kind:"message",T:Tn,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:wn,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Un,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Bn,oneof:"message"},{no:13,name:"simulate",kind:"message",T:qn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:En,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Hn,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:kn,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:Sn,oneof:"message"}]),sn=Ze.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:hn,oneof:"message"},{no:2,name:"answer",kind:"message",T:gn,oneof:"message"},{no:3,name:"offer",kind:"message",T:gn,oneof:"message"},{no:4,name:"trickle",kind:"message",T:un,oneof:"message"},{no:5,name:"update",kind:"message",T:vn,oneof:"message"},{no:6,name:"track_published",kind:"message",T:fn,oneof:"message"},{no:8,name:"leave",kind:"message",T:Tn,oneof:"message"},{no:9,name:"mute",kind:"message",T:dn,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Rn,oneof:"message"},{no:11,name:"room_update",kind:"message",T:On,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:In,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:Nn,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:An,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:jn,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:mn,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:pn,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Wn,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Qn,oneof:"message"},{no:22,name:"request_response",kind:"message",T:Jn,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:Yn,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:Fn,oneof:"message"}]),cn=Ze.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),ln=Ze.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:Ze.getEnumType(ct)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:Ze.getEnumType(lt)},{no:9,name:"layers",kind:"message",T:Rt,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:cn,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:Ze.getEnumType(wt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:Ze.getEnumType(st)},{no:17,name:"audio_features",kind:"enum",T:Ze.getEnumType(gt),repeated:!0}]),un=Ze.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:Ze.getEnumType(nn)},{no:3,name:"final",kind:"scalar",T:8}]),dn=Ze.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),hn=Ze.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:vt},{no:2,name:"participant",kind:"message",T:kt},{no:3,name:"other_participants",kind:"message",T:kt,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:Pn,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:Gt},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:Vt},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:bt,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),pn=Ze.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:Pn,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:Gt},{no:3,name:"server_info",kind:"message",T:Vt},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),fn=Ze.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Pt}]),mn=Ze.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),gn=Ze.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),vn=Ze.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:kt,repeated:!0}]),bn=Ze.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:zt,repeated:!0}]),yn=Ze.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:Ze.getEnumType(ut)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),kn=Ze.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:Ze.getEnumType(gt),repeated:!0}]),Sn=Ze.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Tn=Ze.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:Ze.getEnumType(pt)},{no:3,name:"action",kind:"enum",T:Ze.getEnumType(Cn)},{no:4,name:"regions",kind:"message",T:Gn}]),Cn=Ze.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),wn=Ze.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Rt,repeated:!0}]),En=Ze.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),Pn=Ze.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),Rn=Ze.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:_t,repeated:!0}]),On=Ze.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:vt}]),xn=Ze.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:Ze.getEnumType(dt)},{no:3,name:"score",kind:"scalar",T:2}]),In=Ze.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:xn,repeated:!0}]),_n=Ze.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:Ze.getEnumType(rn)}]),Nn=Ze.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:_n,repeated:!0}]),Dn=Ze.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:Ze.getEnumType(ut)},{no:2,name:"enabled",kind:"scalar",T:8}]),Mn=Ze.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Dn,repeated:!0}]),An=Ze.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Dn,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Mn,repeated:!0}]),Ln=Ze.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),Un=Ze.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Ln,repeated:!0}]),jn=Ze.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),Fn=Ze.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:vt},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:kt},{no:4,name:"other_participants",kind:"message",T:kt,repeated:!0}]),Bn=Ze.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:gn},{no:2,name:"subscription",kind:"message",T:bn},{no:3,name:"publish_tracks",kind:"message",T:fn,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Vn,repeated:!0},{no:5,name:"offer",kind:"message",T:gn},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:zn,repeated:!0}]),zn=Ze.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),Vn=Ze.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:Ze.getEnumType(nn)}]),qn=Ze.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:Ze.getEnumType(an),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),Hn=Ze.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Wn=Ze.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),Gn=Ze.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:Kn,repeated:!0}]),Kn=Ze.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),Qn=Ze.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:Ze.getEnumType(mt)}]),Jn=Ze.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:Ze.getEnumType($n)},{no:3,name:"message",kind:"scalar",T:9}]),$n=Ze.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),Yn=Ze.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);function Xn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Zn,ei={exports:{}},ti=ei.exports;var ni,ii,ri=function(){return Zn||(Zn=1,e=ei,function(t,n){e.exports?e.exports=n():t.log=n()}(ti,function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],r={},a=null;function o(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(S){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var n=this.getLevel(),r=0;r<i.length;r++){var a=i[r];this[a]=r<n?e:this.methodFactory(a,n,this.name)}if(this.log=this.debug,typeof console===t&&n<this.levels.SILENT)return"No console available for logging"}function l(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function u(i,r,a){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?s:void 0!==console[i]?o(console,i):void 0!==console.log?o(console,"log"):e)}(i)||l.apply(this,arguments)}function d(e,n){var o,s,l,d=this,h="loglevel";function p(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(a){}if(typeof e===t)try{var n=window.document.cookie,i=encodeURIComponent(h),r=n.indexOf(i+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r+i.length+1))[1])}catch(a){}return void 0===d.levels[e]&&(e=void 0),e}}function f(e){var t=e;if("string"===typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"===typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"===typeof e?h+=":"+e:"symbol"===typeof e&&(h=void 0),d.name=e,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||u,d.getLevel=function(){return null!=l?l:null!=s?s:o},d.setLevel=function(e,n){return l=f(e),!1!==n&&function(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(r){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(r){}}}(l),c.call(d)},d.setDefaultLevel=function(e){s=f(e),p()||d.setLevel(e,!1)},d.resetLevel=function(){l=null,function(){if(typeof window!==t&&h){try{window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(a!==d&&(o=f(a.getLevel())),c.call(d),a===d)for(var e in r)r[e].rebuild()},o=f(a?a.getLevel():"WARN");var m=p();null!=m&&(l=f(m)),c.call(d)}(a=new d).getLogger=function(e){if("symbol"!==typeof e&&"string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=r[e];return t||(t=r[e]=new d(e,a.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return a.noConflict=function(){return typeof window!==t&&window.log===a&&(window.log=h),a},a.getLoggers=function(){return r},a.default=a,a})),ei.exports;var e}();!function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"}(ni||(ni={})),function(e){e.Default="livekit",e.Room="livekit-room",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"}(ii||(ii={}));let ai=ri.getLogger("livekit");Object.values(ii).map(e=>ri.getLogger(e));function oi(e){const t=ri.getLogger(e);return t.setDefaultLevel(ai.getLevel()),t}ai.setDefaultLevel(ni.info);const si=ri.getLogger("lk-e2ee"),ci=7e3,li=[0,300,1200,2700,4800,ci,ci,ci,ci,ci];function ui(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{c(i.next(e))}catch(S){a(S)}}function s(e){try{c(i.throw(e))}catch(S){a(S)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,s)}c((i=i.apply(e,t||[])).next())})}function di(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function hi(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=di(e),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise(function(i,r){(function(e,t,n,i){Promise.resolve(i).then(function(t){e({value:t,done:n})},t)})(i,r,(t=e[n](t)).done,t.value)})}}}"function"===typeof SuppressedError&&SuppressedError;var pi,fi={exports:{}};var mi=function(){if(pi)return fi.exports;pi=1;var e,t="object"===typeof Reflect?Reflect:null,n=t&&"function"===typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};e=t&&"function"===typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!==e};function r(){r.init.call(this)}fi.exports=r,fi.exports.once=function(e,t){return new Promise(function(n,i){function r(n){e.removeListener(t,a),i(n)}function a(){"function"===typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}f(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&f(e,"error",t,n)}(e,r,{once:!0})})},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function s(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,a,c,l;if(o(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),c=a[t]),void 0===c)c=a[t]=n,++e._eventsCount;else if("function"===typeof c?c=a[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(r=s(e))>0&&c.length>r&&!c.warned){c.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=c.length,l=u,console&&console.warn&&console.warn(l)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=l.bind(i);return r.listener=n,i.wrapFn=r,r}function d(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function f(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function r(a){i.once&&e.removeEventListener(t,r),n(a)})}}return Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return s(this)},r.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,a=this._events;if(void 0!==a)r=r&&void 0===a.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var c=a[e];if(void 0===c)return!1;if("function"===typeof c)n(c,this,t);else{var l=c.length,u=p(c,l);for(i=0;i<l;++i)n(u[i],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return o(t),this.on(e,u(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,u(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,r,a,s;if(o(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(r=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){s=n[a].listener,r=a;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,a=Object.keys(n);for(i=0;i<a.length;++i)"removeListener"!==(r=a[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return d(this,e,!0)},r.prototype.rawListeners=function(e){return d(this,e,!1)},r.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},fi.exports}();let gi=!0,vi=!0;function bi(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseFloat(i[n],10)}function yi(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const a=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,a),r.apply(this,[e,a])};const a=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function ki(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(gi=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Si(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(vi=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Ti(){if("object"===typeof window){if(gi)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function Ci(e,t){vi&&console.warn(e+" is deprecated, please use "+t+" instead.")}function wi(e){return"[object Object]"===Object.prototype.toString.call(e)}function Ei(e){return wi(e)?Object.keys(e).reduce(function(t,n){const i=wi(e[n]),r=i?Ei(e[n]):e[n],a=i&&!Object.keys(r).length;return void 0===r||a?t:Object.assign(t,{[n]:r})},{}):e}function Pi(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?Pi(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(t=>{Pi(e,e.get(t),n)})}))}function Ri(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const a=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(t=>{e.forEach(n=>{n.type===i&&n.trackId===t.id&&Pi(e,n,r)})}),r}const Oi=Ti;function xi(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"===typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"===typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"===typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!==typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach(e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===typeof e.video){let a=e.video.facingMode;a=a&&("object"===typeof a?a:{ideal:a});const o=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?t=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{let o=(n=n.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!o&&n.length&&t.includes("back")&&(o=n[n.length-1]),o&&(e.video.deviceId=a.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=i(e.video),Oi("chrome: "+JSON.stringify(e)),r(e)})}e.video=i(e.video)}return Oi("chrome: "+JSON.stringify(e)),r(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,e=>{n.webkitGetUserMedia(e,t,e=>{i&&i(a(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(a(e))))}}}function Ii(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function _i(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}),t.stream.getTracks().forEach(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else yi(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Ni(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Di(e){if(!("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>Ri(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),yi(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>Ri(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach(n=>{n.track===e&&(t?i=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?i=!0:n=t),t.track===e)),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Mi(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),r.apply(this,arguments)}}function Ai(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Mi(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"===typeof arguments[0]?n.apply(this,[t=>{const n=a(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>a(this,e))}};e.RTCPeerConnection.prototype[t]=i[t]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Li(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]})}function Ui(e,t){yi(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var ji=Object.freeze({__proto__:null,fixNegotiationNeeded:Ui,shimAddTrackRemoveTrack:Ai,shimAddTrackRemoveTrackWithNative:Mi,shimGetSendersWithDtmf:Ni,shimGetUserMedia:xi,shimMediaStream:Ii,shimOnTrack:_i,shimPeerConnection:Li,shimSenderReceiverGetStats:Di});function Fi(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){Ci("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"===typeof n&&"object"===typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"===typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function Bi(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zi(e,t){if("object"!==typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,a]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!r)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(S){if("TypeError"!==S.name)throw S;e.forEach((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(r,a)}}function Vi(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function qi(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),yi(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Hi(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Ci("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function Wi(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Gi(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return i})}function Ki(e){if("object"!==typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function Qi(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Ji(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var $i=Object.freeze({__proto__:null,shimAddTransceiver:Gi,shimCreateAnswer:Ji,shimCreateOffer:Qi,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:Ki,shimGetUserMedia:Fi,shimOnTrack:Bi,shimPeerConnection:zi,shimRTCDataChannel:Wi,shimReceiverGetStats:qi,shimRemoveStream:Hi,shimSenderGetStats:Vi});function Yi(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function Xi(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function Zi(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let s=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,n){const i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=s}function er(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(tr(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function tr(e){return e&&void 0!==e.video?Object.assign({},e,{video:Ei(e.video)}):e}function nr(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];void 0===i.urls&&i.url?(Ci("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ir(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rr(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function ar(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var or,sr=Object.freeze({__proto__:null,shimAudioContext:ar,shimCallbacksAPI:Zi,shimConstraints:tr,shimCreateOfferLegacy:rr,shimGetUserMedia:er,shimLocalStreamsAPI:Yi,shimRTCIceServerUrls:nr,shimRemoteStreamsAPI:Xi,shimTrackEventTransceiver:ir}),cr={exports:{}};var lr=(or||(or=1,function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:void 0===n[t[i]]&&(n[t[i]]=t[i+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let r=0;r<i.length;r++)n=i[r].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let a=3;a<i.length;a++){const r=i[a],o=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(o){const i=t.parseRtpMap(o),a=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(i.parameters=a.length?t.parseFmtp(a[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const r=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{r.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});let r=0;return n.codecs.forEach(e=>{e.maxptime>r&&(r=e.maxptime)}),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),s=o.length>0&&o[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),i.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:a?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&s&&n.push({ssrc:s});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=u})),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const a=t.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let r;const a=void 0!==n?n:2;return r=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(cr)),cr.exports),ur=Xn(lr),dr=k({__proto__:null,default:ur},[lr]);function hr(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),i=ur.parseCandidate(e.candidate);for(const e in i)e in n||Object.defineProperty(n,e,{value:i[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,yi(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function pr(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||yi(e,"icecandidate",e=>{if(e.candidate){const t=ur.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function fr(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=ur.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=ur.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!==n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),i=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=ur.matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i}(arguments[0],e);let r;r=0===n&&0===i?Number.POSITIVE_INFINITY:0===n||0===i?Math.max(n,i):Math.min(n,i);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>r}),this._sctp=a}return n.apply(this,arguments)}}function mr(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},yi(e,"datachannel",e=>(t(e.channel,e.target),e))}function gr(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function vr(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function br(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function yr(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!==typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var kr=Object.freeze({__proto__:null,removeExtmapAllowMixed:vr,shimAddIceCandidateNullOrEmpty:br,shimConnectionState:gr,shimMaxMessageSize:fr,shimParameterlessSetLocalDescription:yr,shimRTCIceCandidate:hr,shimRTCIceCandidateRelayProtocol:pr,shimSendThrowTypeError:mr});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Ti,i=function(e){const t={browser:null,version:null};if("undefined"===typeof e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const e=n.userAgentData.brands.find(e=>"Chromium"===e.brand);if(e)return{browser:"chrome",version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(bi(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(bi(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=parseInt(bi(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=bi(n.userAgent,/Version\/(\d+(\.?\d+))/,1)}return t}(e),r={browserDetails:i,commonShim:kr,extractVersion:bi,disableLog:ki,disableWarnings:Si,sdp:dr};switch(i.browser){case"chrome":if(!ji||!Li||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=ji,br(e,i),yr(e),xi(e,i),Ii(e),Li(e,i),_i(e),Ai(e,i),Ni(e),Di(e),Ui(e,i),hr(e),pr(e),gr(e),fr(e,i),mr(e),vr(e,i);break;case"firefox":if(!$i||!zi||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=$i,br(e,i),yr(e),Fi(e,i),zi(e,i),Bi(e),Hi(e),Vi(e),qi(e),Wi(e),Gi(e),Ki(e),Qi(e),Ji(e),hr(e),gr(e),fr(e,i),mr(e);break;case"safari":if(!sr||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=sr,br(e,i),yr(e),nr(e),rr(e),Zi(e),Yi(e),Xi(e),ir(e),er(e),ar(e),hr(e),pr(e),fr(e,i),mr(e),vr(e,i);break;default:n("Unsupported browser!")}}({window:"undefined"===typeof window?void 0:window});const Sr="lk_e2ee";var Tr,Cr,wr,Er;function Pr(){return"undefined"!==typeof window.RTCRtpSender&&"undefined"!==typeof window.RTCRtpSender.prototype.createEncodedStreams||Rr()}function Rr(){return"undefined"!==typeof window.RTCRtpScriptTransform}!function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"}(Tr||(Tr={})),function(e){e.KeyRatcheted="keyRatcheted"}(Cr||(Cr={})),function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"}(wr||(wr={})),function(e){e.Error="cryptorError"}(Er||(Er={}));mi.EventEmitter;class Or extends Error{constructor(e,t){super(t||"an error has occured"),this.name="LiveKitError",this.code=e}}var xr,Ir,_r,Nr,Dr,Mr,Ar,Lr;!function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest",e[e.Timeout=5]="Timeout"}(xr||(xr={}));class Ur extends Or{constructor(e,t,n,i){super(1,e),this.name="ConnectionError",this.status=n,this.reason=t,this.context=i,this.reasonName=xr[t]}}class jr extends Or{constructor(e){super(21,null!==e&&void 0!==e?e:"device is unsupported"),this.name="DeviceUnsupportedError"}}class Fr extends Or{constructor(e){super(20,null!==e&&void 0!==e?e:"track is invalid"),this.name="TrackInvalidError"}}class Br extends Or{constructor(e){super(10,null!==e&&void 0!==e?e:"unsupported server"),this.name="UnsupportedServer"}}class zr extends Or{constructor(e){super(12,null!==e&&void 0!==e?e:"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Vr extends Or{constructor(e){super(13,null!==e&&void 0!==e?e:"unable to negotiate"),this.name="NegotiationError"}}class qr extends Or{constructor(e,t){super(15,e),this.name="PublishTrackError",this.status=t}}class Hr extends Or{constructor(e,t){super(15,e),this.reason=t,this.reasonName="string"===typeof t?t:$n[t]}}!function(e){e[e.AlreadyOpened=0]="AlreadyOpened",e[e.AbnormalEnd=1]="AbnormalEnd",e[e.DecodeFailed=2]="DecodeFailed",e[e.LengthExceeded=3]="LengthExceeded",e[e.Incomplete=4]="Incomplete",e[e.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered"}(Ir||(Ir={}));class Wr extends Or{constructor(e,t){super(16,e),this.name="DataStreamError",this.reason=t,this.reasonName=Ir[t]}}!function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"}(_r||(_r={})),function(e){e.getFailure=function(t){if(t&&"name"in t)return"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?e.NotFound:"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?e.PermissionDenied:"NotReadableError"===t.name||"TrackStartError"===t.name?e.DeviceInUse:e.Other}}(_r||(_r={})),function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(Nr||(Nr={}));!function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.Moved="moved",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.ParticipantActive="participantActive",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"}(Dr||(Dr={})),function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackCpuConstrained="localTrackCpuConstrained",e.LocalSenderCreated="localSenderCreated",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.TrackCpuConstrained="trackCpuConstrained",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage",e.Active="active"}(Mr||(Mr={})),function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse",e.SignalConnected="signalConnected",e.RoomMoved="roomMoved"}(Ar||(Ar={})),function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.CpuConstrained="cpuConstrained",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate",e.PreConnectBufferFlushed="preConnectBufferFlushed"}(Lr||(Lr={}));const Gr=/version\/(\d+(\.?_?\d+)+)/i;let Kr;function Qr(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("undefined"===typeof e&&"undefined"===typeof navigator)return;const n=(null!==e&&void 0!==e?e:navigator.userAgent).toLowerCase();if(void 0===Kr||t){const e=Jr.find(e=>{let{test:t}=e;return t.test(n)});Kr=null===e||void 0===e?void 0:e.describe(n)}return Kr}const Jr=[{test:/firefox|iceweasel|fxios/i,describe:e=>({name:"Firefox",version:$r(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Yr(e)})},{test:/chrom|crios|crmo/i,describe:e=>({name:"Chrome",version:$r(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Yr(e)})},{test:/safari|applewebkit/i,describe:e=>({name:"Safari",version:$r(Gr,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:Yr(e)})}];function $r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function Yr(e){return e.includes("mac os")?$r(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}class Xr{}Xr.setTimeout=function(){return setTimeout(...arguments)},Xr.setInterval=function(){return setInterval(...arguments)},Xr.clearTimeout=function(){return clearTimeout(...arguments)},Xr.clearInterval=function(){return clearInterval(...arguments)};const Zr=[];var ea;!function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"}(ea||(ea={}));class ta extends mi.EventEmitter{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=ta.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=ai,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),"hidden"===document.visibilityState?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),5e3):this.handleAppVisibilityChanged()},this.log=oi(null!==(i=n.loggerName)&&void 0!==i?i:ii.Track),this.loggerContextCb=n.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=ta.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),uo(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===ta.Kind.Video&&(t="video"),0===this.attachedElements.length&&this.kind===ta.Kind.Video&&this.addAppVisibilityListener(),e||("audio"===t&&(Zr.forEach(t=>{null!==t.parentElement||e||(e=t)}),e&&Zr.splice(Zr.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),na(this.mediaStreamTrack,e);const n=e.srcObject.getTracks(),i=n.some(e=>"audio"===e.kind);return e.play().then(()=>{this.emit(i?Lr.AudioPlaybackStarted:Lr.VideoPlaybackStarted)}).catch(t=>{"NotAllowedError"===t.name?this.emit(i?Lr.AudioPlaybackFailed:Lr.VideoPlaybackFailed,t):"AbortError"===t.name?ai.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):ai.warn("could not playback ".concat(i?"audio":"video"),t),i&&e&&n.some(e=>"video"===e.kind)&&"NotAllowedError"===t.name&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Lr.ElementAttached,e),e}detach(e){try{if(e){ia(this.mediaStreamTrack,e);const t=this.attachedElements.indexOf(e);return t>=0&&(this.attachedElements.splice(t,1),this.recycleElement(e),this.emit(Lr.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(e=>{ia(this.mediaStreamTrack,e),t.push(e),this.recycleElement(e),this.emit(Lr.ElementDetached,e)}),this.attachedElements=[],t}finally{0===this.attachedElements.length&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=oi(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),Zr.forEach(e=>{e.parentElement||(t=!1)}),t&&Zr.push(e)}}handleAppVisibilityChanged(){return ui(this,void 0,void 0,function*(){this.isInBackground="hidden"===document.visibilityState,this.isInBackground||this.kind!==ta.Kind.Video||setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){wa()?(this.isInBackground="hidden"===document.visibilityState,document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){wa()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function na(e,t){let n,i;n=t.srcObject instanceof MediaStream?t.srcObject:new MediaStream,i="audio"===e.kind?n.getAudioTracks():n.getVideoTracks(),i.includes(e)||(i.forEach(e=>{n.removeTrack(e)}),n.addTrack(e)),ka()&&t instanceof HTMLVideoElement||(t.autoplay=!0),t.muted=0===n.getAudioTracks().length,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(ka()||ya())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=n,t.play().catch(()=>{})},0))}function ia(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}!function(e){let t,n,i;!function(e){e.Audio="audio",e.Video="video",e.Unknown="unknown"}(t=e.Kind||(e.Kind={})),function(e){e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e.ScreenShareAudio="screen_share_audio",e.Unknown="unknown"}(n=e.Source||(e.Source={})),function(e){e.Active="active",e.Paused="paused",e.Unknown="unknown"}(i=e.StreamState||(e.StreamState={})),e.kindToProto=function(e){switch(e){case t.Audio:return ct.AUDIO;case t.Video:return ct.VIDEO;default:return ct.DATA}},e.kindFromProto=function(e){switch(e){case ct.AUDIO:return t.Audio;case ct.VIDEO:return t.Video;default:return t.Unknown}},e.sourceToProto=function(e){switch(e){case n.Camera:return lt.CAMERA;case n.Microphone:return lt.MICROPHONE;case n.ScreenShare:return lt.SCREEN_SHARE;case n.ScreenShareAudio:return lt.SCREEN_SHARE_AUDIO;default:return lt.UNKNOWN}},e.sourceFromProto=function(e){switch(e){case lt.CAMERA:return n.Camera;case lt.MICROPHONE:return n.Microphone;case lt.SCREEN_SHARE:return n.ScreenShare;case lt.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}},e.streamStateFromProto=function(e){switch(e){case rn.ACTIVE:return i.Active;case rn.PAUSED:return i.Paused;default:return i.Unknown}}}(ta||(ta={}));class ra{constructor(e,t,n,i,r){if("object"===typeof e)this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else{if(void 0===t||void 0===n)throw new TypeError("Unsupported options: provide at least width, height and maxBitrate");this.width=e,this.height=t,this.aspectRatio=e/t,this.encoding={maxBitrate:n,maxFramerate:i,priority:r}}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const aa=["vp8","h264"],oa=["vp8","h264","vp9","av1","h265"];function sa(e){return!!aa.find(t=>t===e)}var ca,la;!function(e){e[e.PREFER_REGRESSION=0]="PREFER_REGRESSION",e[e.SIMULCAST=1]="SIMULCAST",e[e.REGRESSION=2]="REGRESSION"}(ca||(ca={})),function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}}(la||(la={}));const ua={h90:new ra(160,90,9e4,20),h180:new ra(320,180,16e4,20),h216:new ra(384,216,18e4,20),h360:new ra(640,360,45e4,20),h540:new ra(960,540,8e5,25),h720:new ra(1280,720,17e5,30),h1080:new ra(1920,1080,3e6,30),h1440:new ra(2560,1440,5e6,30),h2160:new ra(3840,2160,8e6,30)},da={h120:new ra(160,120,7e4,20),h180:new ra(240,180,125e3,20),h240:new ra(320,240,14e4,20),h360:new ra(480,360,33e4,20),h480:new ra(640,480,5e5,20),h540:new ra(720,540,6e5,25),h720:new ra(960,720,13e5,30),h1080:new ra(1440,1080,23e5,30),h1440:new ra(1920,1440,38e5,30)},ha={h360fps3:new ra(640,360,2e5,3,"medium"),h360fps15:new ra(640,360,4e5,15,"medium"),h720fps5:new ra(1280,720,8e5,5,"medium"),h720fps15:new ra(1280,720,15e5,15,"medium"),h720fps30:new ra(1280,720,2e6,30,"medium"),h1080fps15:new ra(1920,1080,25e5,15,"medium"),h1080fps30:new ra(1920,1080,5e6,30,"medium"),original:new ra(0,0,7e6,30,"medium")},pa="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function fa(e){return ui(this,void 0,void 0,function*(){return new Promise(t=>Xr.setTimeout(t,e))})}function ma(){return"addTransceiver"in RTCPeerConnection.prototype}function ga(){return"addTrack"in RTCPeerConnection.prototype}function va(e){return"av1"===e||"vp9"===e}function ba(e){return!(!document||Sa())&&(e||(e=document.createElement("audio")),"setSinkId"in e)}function ya(){var e;return"Firefox"===(null===(e=Qr())||void 0===e?void 0:e.name)}function ka(){var e;return"Safari"===(null===(e=Qr())||void 0===e?void 0:e.name)}function Sa(){const e=Qr();return"Safari"===(null===e||void 0===e?void 0:e.name)||"iOS"===(null===e||void 0===e?void 0:e.os)}function Ta(){const e=Qr();return"Safari"===(null===e||void 0===e?void 0:e.name)&&e.version.startsWith("17.")||"iOS"===(null===e||void 0===e?void 0:e.os)&&!!(null===e||void 0===e?void 0:e.osVersion)&&Ia(e.osVersion,"17")>=0}function Ca(){var e,t;return!!wa()&&(null!==(t=null===(e=navigator.userAgentData)||void 0===e?void 0:e.mobile)&&void 0!==t?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent))}function wa(){return"undefined"!==typeof document}function Ea(){return"ReactNative"==navigator.product}function Pa(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function Ra(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Oa(){if(!Ea())return;let e=Ra();return e?e.platform:void 0}function xa(){if(wa())return window.devicePixelRatio;if(Ea()){let e=Ra();if(e)return e.devicePixelRatio}return 1}function Ia(e,t){const n=e.split("."),i=t.split("."),r=Math.min(n.length,i.length);for(let a=0;a<r;++a){const e=parseInt(n[a],10),t=parseInt(i[a],10);if(e>t)return 1;if(e<t)return-1;if(a===r-1&&e===t)return 0}return""===e&&""!==t?-1:""===t?1:n.length==i.length?0:n.length<i.length?-1:1}function _a(e){for(const t of e)t.target.handleResize(t)}function Na(e){for(const t of e)t.target.handleVisibilityChanged(t)}let Da=null;const Ma=()=>(Da||(Da=new ResizeObserver(_a)),Da);let Aa=null;const La=()=>(Aa||(Aa=new IntersectionObserver(Na,{root:null,rootMargin:"0px"})),Aa);let Ua;function ja(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=document.createElement("canvas");r.width=e,r.height=t;const a=r.getContext("2d");null===a||void 0===a||a.fillRect(0,0,r.width,r.height),i&&a&&(a.beginPath(),a.arc(e/2,t/2,50,0,2*Math.PI,!0),a.closePath(),a.fillStyle="grey",a.fill());const o=r.captureStream(),[s]=o.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=n,s}function Fa(){if(!Ua){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[Ua]=i.stream.getAudioTracks(),!Ua)throw Error("Could not get empty media stream audio track");Ua.enabled=!1}return Ua.clone()}class Ba{get isResolved(){return this._isResolved}constructor(e,t){this._isResolved=!1,this.onFinally=t,this.promise=new Promise((t,n)=>ui(this,void 0,void 0,function*(){this.resolve=t,this.reject=n,e&&(yield e(t,n))})).finally(()=>{var e;this._isResolved=!0,null===(e=this.onFinally)||void 0===e||e.call(this)})}}function za(e){if("string"===typeof e||"number"===typeof e)return e;if(Array.isArray(e))return e[0];if(void 0!==e.exact)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(void 0!==e.ideal)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function Va(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function qa(e){switch(e.reason){case xr.LeaveRequest:return e.context;case xr.Cancelled:return pt.CLIENT_INITIATED;case xr.NotAllowed:return pt.USER_REJECTED;case xr.ServerUnreachable:return pt.JOIN_FAILURE;default:return pt.UNKNOWN_REASON}}function Ha(e){return void 0!==e?Number(e):void 0}function Wa(e){return void 0!==e?BigInt(e):void 0}function Ga(e){return!!e&&!(e instanceof MediaStreamTrack)&&e.isLocal}function Ka(e){return!!e&&e.kind==ta.Kind.Audio}function Qa(e){return!!e&&e.kind==ta.Kind.Video}function Ja(e){return Ga(e)&&Qa(e)}function $a(e){return Ga(e)&&Ka(e)}function Ya(e){return!!e&&!e.isLocal}function Xa(e){return!!e&&!e.isLocal}function Za(e){return Ya(e)&&Qa(e)}function eo(e,t,n){var i,r,a,o;const{optionsWithoutProcessor:s,audioProcessor:c,videoProcessor:l}=ho(null!==e&&void 0!==e?e:{}),u=null===t||void 0===t?void 0:t.processor,d=null===n||void 0===n?void 0:n.processor,h=null!==s&&void 0!==s?s:{};return!0===h.audio&&(h.audio={}),!0===h.video&&(h.video={}),h.audio&&(to(h.audio,t),null!==(i=(a=h.audio).deviceId)&&void 0!==i||(a.deviceId={ideal:"default"}),(c||u)&&(h.audio.processor=null!==c&&void 0!==c?c:u)),h.video&&(to(h.video,n),null!==(r=(o=h.video).deviceId)&&void 0!==r||(o.deviceId={ideal:"default"}),(l||d)&&(h.video.processor=null!==l&&void 0!==l?l:d)),h}function to(e,t){return Object.keys(t).forEach(n=>{void 0===e[n]&&(e[n]=t[n])}),e}function no(e){var t,n,i,r;const a={};if(e.video)if("object"===typeof e.video){const n={},r=n,o=e.video;Object.keys(o).forEach(e=>{if("resolution"===e)to(r,o.resolution);else r[e]=o[e]}),a.video=n,null!==(t=(i=a.video).deviceId)&&void 0!==t||(i.deviceId={ideal:"default"})}else a.video=!!e.video&&{deviceId:{ideal:"default"}};else a.video=!1;return e.audio?"object"===typeof e.audio?(a.audio=e.audio,null!==(n=(r=a.audio).deviceId)&&void 0!==n||(r.deviceId={ideal:"default"})):a.audio={deviceId:{ideal:"default"}}:a.audio=!1,a}function io(e){return ui(this,arguments,void 0,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function*(){const n=ro();if(n){const i=n.createAnalyser();i.fftSize=2048;const r=i.frequencyBinCount,a=new Uint8Array(r);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield fa(t),i.getByteTimeDomainData(a);const o=a.some(e=>128!==e&&0!==e);return n.close(),!o}return!1}()})}function ro(){var e;const t="undefined"!==typeof window&&(window.AudioContext||window.webkitAudioContext);if(t){const n=new t({latencyHint:"interactive"});if("suspended"===n.state&&"undefined"!==typeof window&&(null===(e=window.document)||void 0===e?void 0:e.body)){const e=()=>ui(this,void 0,void 0,function*(){var t;try{"suspended"===n.state&&(yield n.resume())}catch(S){console.warn("Error trying to auto-resume audio context",S)}null===(t=window.document.body)||void 0===t||t.removeEventListener("click",e)});window.document.body.addEventListener("click",e)}return n}}function ao(e){return"audioinput"===e?ta.Source.Microphone:"videoinput"===e?ta.Source.Camera:ta.Source.Unknown}function oo(e){return e===ta.Source.Microphone?"audioinput":e===ta.Source.Camera?"videoinput":void 0}function so(e){var t,n;let i=null===(t=e.video)||void 0===t||t;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i="boolean"===typeof i?{}:i,i=ka()?Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:null!==(n=e.audio)&&void 0!==n&&n,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function co(e){return e.split("/")[1].toLowerCase()}function lo(e){const t=[];return e.forEach(e=>{void 0!==e.track&&t.push(new fn({cid:e.track.mediaStreamID,track:e.trackInfo}))}),t}function uo(e){return"mediaStreamTrack"in e?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?uo(e.track):{})}}function ho(e){const t=Object.assign({},e);let n,i;return"object"===typeof t.audio&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),"object"===typeof t.video&&t.video.processor&&(i=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:(r=t,"undefined"===typeof r?r:"function"===typeof structuredClone?"object"===typeof r&&null!==r?structuredClone(Object.assign({},r)):structuredClone(r):JSON.parse(JSON.stringify(r)))};var r}function po(e,t){return e.width*e.height<t.width*t.height}class fo extends mi.EventEmitter{constructor(e){super(),this.onWorkerMessage=e=>{var t,n;const{kind:i,data:r}=e.data;switch(i){case"error":ai.error(r.error.message),this.emit(wr.EncryptionError,r.error);break;case"initAck":r.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)});break;case"enable":if(r.enabled&&this.keyProvider.getKeys().forEach(e=>{this.postKey(e)}),this.encryptionEnabled!==r.enabled&&r.participantIdentity===(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))this.emit(wr.ParticipantEncryptionStatusChanged,r.enabled,this.room.localParticipant),this.encryptionEnabled=r.enabled;else if(r.participantIdentity){const e=null===(n=this.room)||void 0===n?void 0:n.getParticipantByIdentity(r.participantIdentity);if(!e)throw TypeError("couldn't set encryption status, participant not found".concat(r.participantIdentity));this.emit(wr.ParticipantEncryptionStatusChanged,r.enabled,e)}break;case"ratchetKey":this.keyProvider.emit(Tr.KeyRatcheted,r.ratchetResult,r.participantIdentity,r.keyIndex)}},this.onWorkerError=e=>{ai.error("e2ee worker encountered an error:",{error:e.error}),this.emit(wr.EncryptionError,e.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!Pr())throw new jr("tried to setup end-to-end encryption on an unsupported browser");if(ai.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:si.getLevel()}};this.worker&&(ai.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){ai.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){e&&0!==e.length?this.postSifTrailer(e):ai.warn("ignoring server sent trailer as it's empty")}setupEngine(e){e.on(Ar.RTPVideoMapUpdate,e=>{this.postRTPMap(e)})}setupEventListeners(e,t){e.on(Dr.TrackPublished,(e,t)=>this.setParticipantCryptorEnabled(e.trackInfo.encryption!==wt.NONE,t.identity)),e.on(Dr.ConnectionStateChanged,t=>{t===Ys.Connected&&e.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{this.setParticipantCryptorEnabled(t.trackInfo.encryption!==wt.NONE,e.identity)})})}).on(Dr.TrackUnsubscribed,(e,t,n)=>{var i;const r={kind:"removeTransform",data:{participantIdentity:n.identity,trackId:e.mediaStreamID}};null===(i=this.worker)||void 0===i||i.postMessage(r)}).on(Dr.TrackSubscribed,(e,t,n)=>{this.setupE2EEReceiver(e,n.identity,t.trackInfo)}).on(Dr.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");t.getKeys().forEach(e=>{this.postKey(e)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(Mr.LocalSenderCreated,(e,t)=>ui(this,void 0,void 0,function*(){this.setupE2EESender(t,e)})),t.on(Tr.SetKey,e=>this.postKey(e)).on(Tr.RatchetRequest,(e,t)=>this.postRatchetRequest(e,t))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const n={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(n)}postKey(e){let{key:t,participantIdentity:n,keyIndex:i}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:n,isPublisher:n===(null===(r=this.room)||void 0===r?void 0:r.localParticipant.identity),key:t,keyIndex:i}};this.worker.postMessage(a)}postEnable(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");{const n={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(n)}}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const n={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(n)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,n){if(e.receiver){if(!(null===n||void 0===n?void 0:n.mimeType)||""===n.mimeType)throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,"video"===e.kind?co(n.mimeType):void 0)}}setupE2EESender(e,t){Ga(e)&&t?this.handleSender(t,e.mediaStreamID,void 0):t||ai.warn("early return because sender is not ready")}handleReceiver(e,t,n,i){return ui(this,void 0,void 0,function*(){if(this.worker){if(Rr()){const r={kind:"decode",participantIdentity:n,trackId:t,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(Sr in e&&i){const e={kind:"updateCodec",data:{trackId:t,codec:i,participantIdentity:n}};return void this.worker.postMessage(e)}let r=e.writableStream,a=e.readableStream;if(!r||!a){const t=e.createEncodedStreams();e.writableStream=t.writable,r=t.writable,e.readableStream=t.readable,a=t.readable}const o={kind:"decode",data:{readableStream:a,writableStream:r,trackId:t,codec:i,participantIdentity:n,isReuse:Sr in e}};this.worker.postMessage(o,[a,r])}e[Sr]=!0}})}handleSender(e,t,n){var i;if(!(Sr in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i.localParticipant.identity)||""===this.room.localParticipant.identity)throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Rr()){ai.info("initialize script transform");const i={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,i)}else{ai.info("initialize encoded streams");const i=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:i.readable,writableStream:i.writable,codec:n,trackId:t,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(r,[i.readable,i.writable])}e[Sr]=!0}}}const mo="default";class go{constructor(){this._previousDevices=[]}static getInstance(){return void 0===this.instance&&(this.instance=new go),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return ui(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;if((null===(i=go.userMediaPromiseMap)||void 0===i?void 0:i.size)>0){ai.debug("awaiting getUserMedia promise");try{e?yield go.userMediaPromiseMap.get(e):yield Promise.all(go.userMediaPromiseMap.values())}catch(S){ai.warn("error waiting for media permissons")}}let r=yield navigator.mediaDevices.enumerateDevices();if(n&&(!ka()||!t.hasDeviceInUse(e))){if(0===r.filter(t=>t.kind===e).length||r.some(t=>{const n=""===t.label,i=!e||t.kind===e;return n&&i})){const t={video:"audioinput"!==e&&"audiooutput"!==e,audio:"videoinput"!==e&&{deviceId:{ideal:"default"}}},n=yield navigator.mediaDevices.getUserMedia(t);r=yield navigator.mediaDevices.enumerateDevices(),n.getTracks().forEach(e=>{e.stop()})}}return t._previousDevices=r,e&&(r=r.filter(t=>t.kind===e)),r}()})}normalizeDeviceId(e,t,n){return ui(this,void 0,void 0,function*(){if(t!==mo)return t;const i=yield this.getDevices(e),r=i.find(e=>e.deviceId===mo);if(!r)return void ai.warn("could not reliably determine default device");const a=i.find(e=>e.deviceId!==mo&&e.groupId===(null!==n&&void 0!==n?n:r.groupId));if(a)return null===a||void 0===a?void 0:a.deviceId;ai.warn("could not reliably determine default device")})}hasDeviceInUse(e){return e?go.userMediaPromiseMap.has(e):go.userMediaPromiseMap.size>0}}var vo;go.mediaDeviceKinds=["audioinput","audiooutput","videoinput"],go.userMediaPromiseMap=new Map,function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"}(vo||(vo={}));class bo{constructor(){this.pendingTasks=new Map,this.taskMutex=new C,this.nextTaskIndex=0}run(e){return ui(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:vo.WAITING};this.pendingTasks.set(t.id,t);const n=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=vo.RUNNING,yield e()}finally{t.status=vo.COMPLETED,this.pendingTasks.delete(t.id),n()}})}flush(){return ui(this,void 0,void 0,function*(){return this.run(()=>ui(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function yo(e,t){return e.pathname="".concat(function(e){return e.endsWith("/")?e:"".concat(e,"/")}(e.pathname)).concat(t),e.toString()}const ko=["syncState","trickle","offer","answer","simulate","leave"];var So;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"}(So||(So={}));class To{get currentState(){return this.state}get isDisconnected(){return this.state===So.DISCONNECTING||this.state===So.DISCONNECTED}get isEstablishingConnection(){return this.state===So.CONNECTING||this.state===So.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;this.rtt=0,this.state=So.DISCONNECTED,this.log=ai,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=oi(null!==(n=t.loggerName)&&void 0!==n?n:ii.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new bo,this.queuedRequests=[],this.closingLock=new C,this.connectionLock=new C,this.state=So.DISCONNECTED}get logContext(){var e,t;return null!==(t=null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this))&&void 0!==t?t:{}}join(e,t,n,i){return ui(this,void 0,void 0,function*(){this.state=So.CONNECTING,this.options=n;return yield this.connect(e,t,n,i)})}reconnect(e,t,n,i){return ui(this,void 0,void 0,function*(){if(!this.options)return void this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);this.state=So.RECONNECTING,this.clearPingInterval();return yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:n,reconnectReason:i}))})}connect(e,t,n,i){this.connectOptions=n;const r=function(e,t,n){var i;const r=new URLSearchParams;r.set("access_token",e),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid));r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",Ea()?"reactnative":"js"),r.set("version",t.version),r.set("protocol",t.protocol.toString()),t.deviceModel&&r.set("device_model",t.deviceModel);t.os&&r.set("os",t.os);t.osVersion&&r.set("os_version",t.osVersion);t.browser&&r.set("browser",t.browser);t.browserVersion&&r.set("browser_version",t.browserVersion);n.adaptiveStream&&r.set("adaptive_stream","1");n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString());(null===(i=navigator.connection)||void 0===i?void 0:i.type)&&r.set("network",navigator.connection.type);return r}(t,function(){var e;const t=new Ht({sdk:Wt.JS,protocol:16,version:"2.15.5"});return Ea()&&(t.os=null!==(e=Oa())&&void 0!==e?e:""),t}(),n),a=function(e,t){const n=new URL(function(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}(e));return t.forEach((e,t)=>{n.searchParams.set(t,e)}),yo(n,"rtc")}(e,r),o=yo(new URL(Va(a)),"validate");return new Promise((e,t)=>ui(this,void 0,void 0,function*(){const r=yield this.connectionLock.lock();try{const r=()=>ui(this,void 0,void 0,function*(){this.close(),clearTimeout(s),t(new Ur("room connection has been cancelled (signal)",xr.Cancelled))}),s=setTimeout(()=>{this.close(),t(new Ur("room connection has timed out (signal)",xr.ServerUnreachable))},n.websocketTimeout);(null===i||void 0===i?void 0:i.aborted)&&r(),null===i||void 0===i||i.addEventListener("abort",r);const c=new URL(a);c.searchParams.has("access_token")&&c.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(c),Object.assign({reconnect:n.reconnect,reconnectReason:n.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(s)},this.ws.onerror=e=>ui(this,void 0,void 0,function*(){if(this.state===So.CONNECTED)this.handleWSError(e);else{this.state=So.DISCONNECTED,clearTimeout(s);try{const n=yield fetch(o);if(n.status.toFixed(0).startsWith("4")){const e=yield n.text();t(new Ur(e,xr.NotAllowed,n.status))}else t(new Ur("Encountered unknown websocket error during connection: ".concat(e.toString()),xr.InternalError,n.status))}catch(S){t(new Ur(S instanceof Error?S.message:"server was not reachable",xr.ServerUnreachable))}}}),this.ws.onmessage=a=>ui(this,void 0,void 0,function*(){var o,s,c;let l;if("string"===typeof a.data){const e=JSON.parse(a.data);l=sn.fromJson(e,{ignoreUnknownFields:!0})}else{if(!(a.data instanceof ArrayBuffer))return void this.log.error("could not decode websocket message: ".concat(typeof a.data),this.logContext);l=sn.fromBinary(new Uint8Array(a.data))}if(this.state!==So.CONNECTED){let a=!1;if("join"===(null===(o=l.message)||void 0===o?void 0:o.case)?(this.state=So.CONNECTED,null===i||void 0===i||i.removeEventListener("abort",r),this.pingTimeoutDuration=l.message.value.pingTimeout,this.pingIntervalDuration=l.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),e(l.message.value)):this.state===So.RECONNECTING&&"leave"!==l.message.case?(this.state=So.CONNECTED,null===i||void 0===i||i.removeEventListener("abort",r),this.startPingInterval(),"reconnect"===(null===(s=l.message)||void 0===s?void 0:s.case)?e(l.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),e(void 0),a=!0)):this.isEstablishingConnection&&"leave"===l.message.case?t(new Ur("Received leave request while trying to (re)connect",xr.LeaveRequest,void 0,l.message.value.reason)):n.reconnect||t(new Ur("did not receive join response, got ".concat(null===(c=l.message)||void 0===c?void 0:c.case," instead"),xr.InternalError)),!a)return}this.signalLatency&&(yield fa(this.signalLatency)),this.handleSignalResponse(l)}),this.ws.onclose=e=>{this.isEstablishingConnection&&t(new Ur("Websocket got closed during a (re)connection attempt",xr.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:e.reason,code:e.code,wasClean:e.wasClean,state:this.state})),this.handleOnClose(e.reason)}}finally{r()}}))}close(){return ui(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.closingLock.lock();try{if(e.clearPingInterval(),t&&(e.state=So.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const t=new Promise(t=>{e.ws?e.ws.onclose=()=>{t()}:t()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([t,fa(250)])),e.ws=void 0}}finally{t&&(e.state=So.DISCONNECTED),n()}}()})}sendOffer(e,t){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:wo(e,t)})}sendAnswer(e,t){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:wo(e,t)})}sendIceCandidate(e,t){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new un({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new dn({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return ui(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const r=n.getNextRequestId();return yield n.sendRequest({case:"updateMetadata",value:new En({requestId:r,metadata:e,name:t,attributes:i})}),r}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new wn({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new Un({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:W.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Hn({timestamp:W.parse(Date.now()),rtt:W.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,t){return this.sendRequest({case:"updateAudioTrack",value:new kn({trackSid:e,features:t})})}sendLeave(){return this.sendRequest({case:"leave",value:new Tn({reason:pt.CLIENT_INITIATED,action:Cn.DISCONNECT})})}sendRequest(e){return ui(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){const i=!n&&!function(e){const t=ko.indexOf(e.case)>=0;return ai.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}(e);if(i&&t.state===So.RECONNECTING)return void t.queuedRequests.push(()=>ui(t,void 0,void 0,function*(){yield this.sendRequest(e,!0)}));if(n||(yield t.requestQueue.flush()),t.signalLatency&&(yield fa(t.signalLatency)),t.isDisconnected)return void t.log.debug("skipping signal request (type: ".concat(e.case,") - SignalClient disconnected"));if(!t.ws||t.ws.readyState!==t.ws.OPEN)return void t.log.error("cannot send signal request before connected, type: ".concat(null===e||void 0===e?void 0:e.case),t.logContext);const r=new on({message:e});try{t.useJSON?t.ws.send(r.toJsonString()):t.ws.send(r.toBinary())}catch(S){t.log.error("error sending signal message",Object.assign(Object.assign({},t.logContext),{error:S}))}}()})}handleSignalResponse(e){var t,n;const i=e.message;if(void 0==i)return void this.log.debug("received unsupported message",this.logContext);let r=!1;if("answer"===i.case){const e=Co(i.value);this.onAnswer&&this.onAnswer(e,i.value.id)}else if("offer"===i.case){const e=Co(i.value);this.onOffer&&this.onOffer(e,i.value.id)}else if("trickle"===i.case){const e=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(e,i.value.target)}else"update"===i.case?this.onParticipantUpdate&&this.onParticipantUpdate(null!==(t=i.value.participants)&&void 0!==t?t:[]):"trackPublished"===i.case?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):"speakersChanged"===i.case?this.onSpeakersChanged&&this.onSpeakersChanged(null!==(n=i.value.speakers)&&void 0!==n?n:[]):"leave"===i.case?this.onLeave&&this.onLeave(i.value):"mute"===i.case?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):"roomUpdate"===i.case?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):"connectionQuality"===i.case?this.onConnectionQuality&&this.onConnectionQuality(i.value):"streamStateUpdate"===i.case?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):"subscribedQualityUpdate"===i.case?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):"subscriptionPermissionUpdate"===i.case?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):"refreshToken"===i.case?this.onTokenRefresh&&this.onTokenRefresh(i.value):"trackUnpublished"===i.case?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):"subscriptionResponse"===i.case?this.onSubscriptionError&&this.onSubscriptionError(i.value):"pong"===i.case||("pongResp"===i.case?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):"requestResponse"===i.case?this.onRequestResponse&&this.onRequestResponse(i.value):"trackSubscribed"===i.case?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):"roomMoved"===i.case?(this.onTokenRefresh&&this.onTokenRefresh(i.value.token),this.onRoomMoved&&this.onRoomMoved(i.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return ui(this,void 0,void 0,function*(){if(this.state===So.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){this.clearPingTimeout(),this.pingTimeoutDuration?this.pingTimeout=Xr.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-1e3*this.pingTimeoutDuration).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},1e3*this.pingTimeoutDuration):this.log.warn("ping timeout duration not set",this.logContext)}clearPingTimeout(){this.pingTimeout&&Xr.clearTimeout(this.pingTimeout)}startPingInterval(){this.clearPingInterval(),this.resetPingTimeout(),this.pingIntervalDuration?(this.log.debug("start ping interval",this.logContext),this.pingInterval=Xr.setInterval(()=>{this.sendPing()},1e3*this.pingIntervalDuration)):this.log.warn("ping interval duration not set",this.logContext)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Xr.clearInterval(this.pingInterval)}}function Co(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type}return t}function wo(e,t){return new gn({sdp:e.sdp,type:e.type,id:t})}class Eo{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0;){if(!(this.buffer[0].sequence<=e))break;this.pop()}}alignBufferedAmount(e){for(;this.buffer.length>0;){const t=this.buffer[0];if(this._totalSize-t.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class Po{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,t){const n=Date.now();n-this._lastCleanup>this.ttl/2&&this.cleanup();const i=n+this.ttl;return this._map.set(e,{value:t,expiresAt:i}),this}get(e){const t=this._map.get(e);if(t){if(!(t.expiresAt<Date.now()))return t.value;this._map.delete(e)}}has(e){const t=this._map.get(e);return!!t&&(!(t.expiresAt<Date.now())||(this._map.delete(e),!1))}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[t,n]of this._map.entries())n.expiresAt<e&&this._map.delete(t);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e(n.value,t,this.asValueMap())}map(e){this.cleanup();const t=[],n=this.asValueMap();for(const[i,r]of n.entries())t.push(e(r,i,n));return t}asValueMap(){const e=new Map;for(const[t,n]of this._map.entries())n.expiresAt>=Date.now()&&e.set(t,n.value);return e}}var Ro,Oo,xo,Io,_o,No={},Do={},Mo={exports:{}};function Ao(){if(Ro)return Mo.exports;Ro=1;var e=Mo.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){e[t].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),Mo.exports}function Lo(){return Oo||(Oo=1,function(e){var t=function(e){return String(Number(e))===e?Number(e):e},n=function(e,n,i){var r=e.name&&e.names;e.push&&!n[e.push]?n[e.push]=[]:r&&!n[e.name]&&(n[e.name]={});var a=e.push?{}:r?n[e.name]:n;!function(e,n,i,r){if(r&&!i)n[r]=t(e[1]);else for(var a=0;a<i.length;a+=1)null!=e[a+1]&&(n[i[a]]=t(e[a+1]))}(i.match(e.reg),a,e.names,e.name),e.push&&n[e.push].push(a)},i=Ao(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},a=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),o=a[a.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(r))return n(c,o,r)}}),t.media=a,t};var a=function(e,n){var i=n.split(/=(.+)/,2);return 2===i.length?e[i[0]]=t(i[1]):1===i.length&&n.length>1&&(e[i[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var n=[],i=e.split(" ").map(t),r=0;r<i.length;r+=3)n.push({component:i[r],ip:i[r+1],port:i[r+2]});return n},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var n,i=!1;return"~"!==e[0]?n=t(e):(n=t(e.substring(1,e.length)),i=!0),{scid:n,paused:i}})})}}(Do)),Do}function Uo(){if(Io)return xo;Io=1;var e=Ao(),t=/%[sdv%]/g,n=function(e){var n=1,i=arguments,r=i.length;return e.replace(t,function(e){if(n>=r)return e;var t=i[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},i=function(e,t,i){var r=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var a=0;a<t.names.length;a+=1){var o=t.names[a];t.name?r.push(i[t.name][o]):r.push(i[t.names[a]])}else r.push(i[t.name]);return n.apply(null,r)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];return xo=function(t,n){n=n||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var o=n.outerOrder||r,s=n.innerOrder||a,c=[];return o.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){c.push(i(n,e,t))})})}),t.media.forEach(function(t){c.push(i("m",e.m[0],t)),s.forEach(function(n){e[n].forEach(function(e){e.name in t&&null!=t[e.name]?c.push(i(n,e,t)):e.push in t&&null!=t[e.push]&&t[e.push].forEach(function(t){c.push(i(n,e,t))})})})}),c.join("\r\n")+"\r\n"},xo}var jo=function(){if(_o)return No;_o=1;var e=Lo(),t=Uo(),n=Ao();return No.grammar=n,No.write=t,No.parse=e.parse,No.parseParams=e.parseParams,No.parseFmtpConfig=e.parseFmtpConfig,No.parsePayloads=e.parsePayloads,No.parseRemoteCandidates=e.parseRemoteCandidates,No.parseImageAttributes=e.parseImageAttributes,No.parseSimulcastStreamList=e.parseSimulcastStreamList,No}();function Fo(e,t,n){var i,r,a;void 0===t&&(t=50),void 0===n&&(n={});var o=null!=(i=n.isImmediate)&&i,s=null!=(r=n.callback)&&r,c=n.maxWait,l=Date.now(),u=[];function d(){if(void 0!==c){var e=Date.now()-l;if(e+t>=c)return c-e}return t}var h=function(){var t=[].slice.call(arguments),n=this;return new Promise(function(i,r){var c=o&&void 0===a;if(void 0!==a&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,l=Date.now(),!o){var i=e.apply(n,t);s&&s(i),u.forEach(function(e){return(0,e.resolve)(i)}),u=[]}},d()),c){var h=e.apply(n,t);return s&&s(h),i(h)}u.push({resolve:i,reject:r})})};return h.cancel=function(e){void 0!==a&&clearTimeout(a),u.forEach(function(t){return(0,t.reject)(e)}),u=[]},h}const Bo="negotiationStarted",zo="negotiationComplete",Vo="rtpVideoPayloadTypes";class qo extends mi.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;super(),this.log=ai,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Fo(e=>ui(this,void 0,void 0,function*(){this.emit(Bo);try{yield this.createAndSendOffer()}catch(S){if(!e)throw S;e(S)}}),20),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=oi(null!==(n=t.loggerName)&&void 0!==n?n:ii.PCTransport),this.loggerOptions=t,this.config=e,this._pc=this.createPC(),this.offerLock=new C}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=e=>{var t;e.candidate&&(null===(t=this.onIceCandidate)||void 0===t||t.call(this,e.candidate))},e.onicecandidateerror=e=>{var t;null===(t=this.onIceCandidateError)||void 0===t||t.call(this,e)},e.oniceconnectionstatechange=()=>{var t;null===(t=this.onIceConnectionStateChange)||void 0===t||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;null===(t=this.onSignalingStatechange)||void 0===t||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,e.connectionState)},e.ondatachannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},e.ontrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},e}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}get isICEConnected(){return null!==this._pc&&("connected"===this.pc.iceConnectionState||"completed"===this.pc.iceConnectionState)}addIceCandidate(e){return ui(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,t){return ui(this,void 0,void 0,function*(){var n;if("answer"===e.type&&this.latestOfferId>0&&t>0&&t!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:t,latestOfferId:this.latestOfferId})),!1;let i;if("offer"===e.type){let{stereoMids:t,nackMids:n}=function(e){var t;const n=[],i=[],r=jo.parse(null!==(t=e.sdp)&&void 0!==t?t:"");let a=0;return r.media.forEach(e=>{var t;"audio"===e.type&&(e.rtp.some(e=>"opus"===e.codec&&(a=e.payload,!0)),(null===(t=e.rtcpFb)||void 0===t?void 0:t.some(e=>e.payload===a&&"nack"===e.type))&&i.push(e.mid),e.fmtp.some(t=>t.payload===a&&(t.config.includes("sprop-stereo=1")&&n.push(e.mid),!0)))}),{stereoMids:n,nackMids:i}}(e);this.remoteStereoMids=t,this.remoteNackMids=n}else if("answer"===e.type){const t=jo.parse(null!==(n=e.sdp)&&void 0!==n?n:"");t.media.forEach(e=>{"audio"===e.type&&this.trackBitrates.some(t=>{if(!t.transceiver||e.mid!=t.transceiver.mid)return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n)return!0;let i=!1;for(const r of e.fmtp)if(r.payload===n){r.config=r.config.split(";").filter(e=>!e.includes("maxaveragebitrate")).join(";"),t.maxbr>0&&(r.config+=";maxaveragebitrate=".concat(1e3*t.maxbr)),i=!0;break}return i||t.maxbr>0&&e.fmtp.push({payload:n,config:"maxaveragebitrate=".concat(1e3*t.maxbr)}),!0})}),i=jo.write(t)}if(yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(e=>{this.pc.addIceCandidate(e)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate)this.renegotiate=!1,yield this.createAndSendOffer();else if("answer"===e.type&&(this.emit(zo),e.sdp)){jo.parse(e.sdp).media.forEach(e=>{"video"===e.type&&this.emit(Vo,e.rtp)})}return!0})}createAndSendOffer(e){return ui(this,void 0,void 0,function*(){var t;const n=yield this.offerLock.lock();try{if(void 0===this.onOffer)return;if((null===e||void 0===e?void 0:e.iceRestart)&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&"have-local-offer"===this._pc.signalingState){const t=this._pc.remoteDescription;if(!(null===e||void 0===e?void 0:e.iceRestart)||!t)return void(this.renegotiate=!0);yield this._pc.setRemoteDescription(t)}else if(!this._pc||"closed"===this._pc.signalingState)return void this.log.warn("could not createOffer with closed peer connection",this.logContext);this.log.debug("starting to negotiate",this.logContext);const n=this.latestOfferId+1;this.latestOfferId=n;const i=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:i.sdp},this.logContext));const r=jo.parse(null!==(t=i.sdp)&&void 0!==t?t:"");if(r.media.forEach(e=>{Wo(e),"audio"===e.type?Ho(e,[],[]):"video"===e.type&&this.trackBitrates.some(t=>{if(!e.msid||!t.cid||!e.msid.includes(t.cid))return!1;let n=0;if(e.rtp.some(e=>e.codec.toUpperCase()===t.codec.toUpperCase()&&(n=e.payload,!0)),0===n)return!0;if(va(t.codec)&&!ka()&&this.ensureVideoDDExtensionForSVC(e,r),"av1"!==t.codec)return!0;const i=Math.round(.7*t.maxbr);for(const r of e.fmtp)if(r.payload===n){r.config.includes("x-google-start-bitrate")||(r.config+=";x-google-start-bitrate=".concat(i));break}return!0})}),this.latestOfferId>n)return void this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:n}));yield this.setMungedSDP(i,jo.write(r)),this.onOffer(i,this.latestOfferId)}finally{n()}})}createAndSetAnswer(){return ui(this,void 0,void 0,function*(){var e;const t=yield this.pc.createAnswer(),n=jo.parse(null!==(e=t.sdp)&&void 0!==e?e:"");return n.media.forEach(e=>{Wo(e),"audio"===e.type&&Ho(e,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,jo.write(n)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new zr("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new zr("PC closed, cannot configure");return null===(t=this._pc)||void 0===t?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(null===(e=this._pc)||void 0===e?void 0:e.removeTrack)}removeTrack(e){var t;return null===(t=this._pc)||void 0===t?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&void 0!==t?t:"closed"}getICEConnectionState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:"closed"}getSignallingState(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.signalingState)&&void 0!==t?t:"closed"}getTransceivers(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getTransceivers())&&void 0!==t?t:[]}getSenders(){var e,t;return null!==(t=null===(e=this._pc)||void 0===e?void 0:e.getSenders())&&void 0!==t?t:[]}getLocalDescription(){var e;return null===(e=this._pc)||void 0===e?void 0:e.localDescription}getRemoteDescription(){var e;return null===(e=this.pc)||void 0===e?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return ui(this,void 0,void 0,function*(){var e;if(!this._pc)return;let t="";const n=new Map,i=new Map;if((yield this._pc.getStats()).forEach(e=>{switch(e.type){case"transport":t=e.selectedCandidatePairId;break;case"candidate-pair":""===t&&e.selected&&(t=e.id),n.set(e.id,e);break;case"remote-candidate":i.set(e.id,"".concat(e.address,":").concat(e.port))}}),""===t)return;const r=null===(e=n.get(t))||void 0===e?void 0:e.remoteCandidateId;return void 0!==r?i.get(r):void 0})}setMungedSDP(e,t,n){return ui(this,void 0,void 0,function*(){if(t){const i=e.sdp;e.sdp=t;try{return this.log.debug("setting munged ".concat(n?"remote":"local"," description"),this.logContext),void(n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e))}catch(S){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:S,sdp:t})),e.sdp=i}}try{n?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(S){let i="unknown error";S instanceof Error?i=S.message:"string"===typeof S&&(i=S);const r={error:i,sdp:e.sdp};throw!n&&this.pc.remoteDescription&&(r.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:r})),new Vr(i)}})}ensureVideoDDExtensionForSVC(e,t){var n,i;if(!(null===(n=e.ext)||void 0===n?void 0:n.some(e=>e.uri===pa))){if(0===this.ddExtID){let e=0;t.media.forEach(t=>{var n;"video"===t.type&&(null===(n=t.ext)||void 0===n||n.forEach(t=>{t.value>e&&(e=t.value)}))}),this.ddExtID=e+1}null===(i=e.ext)||void 0===i||i.push({value:this.ddExtID,uri:pa})}}}function Ho(e,t,n){let i=0;e.rtp.some(e=>"opus"===e.codec&&(i=e.payload,!0)),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some(e=>e.payload===i&&"nack"===e.type)&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some(e=>e.payload===i&&(e.config.includes("stereo=1")||(e.config+=";stereo=1"),!0)))}function Wo(e){if(e.connection){const t=e.connection.ip.indexOf(":")>=0;(4===e.connection.version&&t||6===e.connection.version&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}const Go="vp8",Ko={audioPreset:la.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ha.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Go,backupCodec:!0,preConnectBuffer:!1},Qo={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Jo={deviceId:{ideal:"default"},resolution:ua.h720.resolution},$o={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new class{constructor(e){this._retryDelays=void 0!==e?[...e]:li}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+1e3*Math.random()}},disconnectOnPageLeave:!0,webAudioMix:!1},Yo={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Xo;!function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"}(Xo||(Xo={}));class Zo{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,n){var i;this.peerConnectionTimeout=Yo.peerConnectionTimeout,this.log=ai,this.updateState=()=>{var e;const t=this.state,n=this.requiredTransports.map(e=>e.getConnectionState());n.every(e=>"connected"===e)?this.state=Xo.CONNECTED:n.some(e=>"failed"===e)?this.state=Xo.FAILED:n.some(e=>"connecting"===e)?this.state=Xo.CONNECTING:n.every(e=>"closed"===e)?this.state=Xo.CLOSED:n.some(e=>"closed"===e)?this.state=Xo.CLOSING:n.every(e=>"new"===e)&&(this.state=Xo.NEW),t!==this.state&&(this.log.debug("pc state change: from ".concat(Xo[t]," to ").concat(Xo[this.state]),this.logContext),null===(e=this.onStateChange)||void 0===e||e.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=oi(null!==(i=n.loggerName)&&void 0!==i?i:ii.PCManager),this.loggerOptions=n,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t,this.publisher=new qo(e,n),this.subscriber=new qo(e,n),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,nn.PUBLISHER)},this.subscriber.onIceCandidate=e=>{var t;null===(t=this.onIceCandidate)||void 0===t||t.call(this,e,nn.SUBSCRIBER)},this.subscriber.onDataChannel=e=>{var t;null===(t=this.onDataChannel)||void 0===t||t.call(this,e)},this.subscriber.onTrack=e=>{var t;null===(t=this.onTrack)||void 0===t||t.call(this,e)},this.publisher.onOffer=(e,t)=>{var n;null===(n=this.onPublisherOffer)||void 0===n||n.call(this,e,t)},this.state=Xo.NEW,this.connectionLock=new C,this.remoteOfferLock=new C}get logContext(){var e,t;return Object.assign({},null===(t=(e=this.loggerOptions).loggerContextCb)||void 0===t?void 0:t.call(e))}requirePublisher(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,t){return this.publisher.setRemoteDescription(e,t)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return ui(this,void 0,void 0,function*(){if(this.publisher&&"closed"!==this.publisher.getSignallingState()){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(S){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:S}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return ui(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return ui(this,void 0,void 0,function*(){t===nn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,t){return ui(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{if(!(yield this.subscriber.setRemoteDescription(e,t)))return;return yield this.subscriber.createAndSetAnswer()}finally{n()}})}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){return ui(this,void 0,void 0,function*(){var n;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&"connected"!==this.publisher.getConnectionState()&&"connecting"!==this.publisher.getConnectionState()&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all(null===(n=this.requiredTransports)||void 0===n?void 0:n.map(n=>this.ensureTransportConnected(n,e,t)))}finally{i()}})}negotiate(e){return ui(this,void 0,void 0,function*(){return new Promise((t,n)=>ui(this,void 0,void 0,function*(){const i=setTimeout(()=>{n("negotiation timed out")},this.peerConnectionTimeout);e.signal.addEventListener("abort",()=>{clearTimeout(i),n("negotiation aborted")}),this.publisher.once(Bo,()=>{e.signal.aborted||this.publisher.once(zo,()=>{clearTimeout(i),t()})}),yield this.publisher.negotiate(e=>{clearTimeout(i),n(e)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===nn.PUBLISHER||e===nn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){return ui(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.peerConnectionTimeout;return function*(){if("connected"!==e.getConnectionState())return new Promise((e,r)=>ui(n,void 0,void 0,function*(){const n=()=>{this.log.warn("abort transport connection",this.logContext),Xr.clearTimeout(a),r(new Ur("room connection has been cancelled",xr.Cancelled))};(null===t||void 0===t?void 0:t.signal.aborted)&&n(),null===t||void 0===t||t.signal.addEventListener("abort",n);const a=Xr.setTimeout(()=>{null===t||void 0===t||t.signal.removeEventListener("abort",n),r(new Ur("could not establish pc connection",xr.InternalError))},i);for(;this.state!==Xo.CONNECTED;)if(yield fa(50),null===t||void 0===t?void 0:t.signal.aborted)return void r(new Ur("room connection has been cancelled",xr.Cancelled));Xr.clearTimeout(a),null===t||void 0===t||t.signal.removeEventListener("abort",n),e()}))}()})}}class es extends Error{constructor(e,t,n){super(t),this.code=e,this.message=ns(t,es.MAX_MESSAGE_BYTES),this.data=n?ns(n,es.MAX_DATA_BYTES):void 0}static fromProto(e){return new es(e.code,e.message,e.data)}toProto(){return new Bt({code:this.code,message:this.message,data:this.data})}static builtIn(e,t){return new es(es.ErrorCode[e],es.ErrorMessage[e],t)}}es.MAX_MESSAGE_BYTES=256,es.MAX_DATA_BYTES=15360,es.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404},es.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};function ts(e){return(new TextEncoder).encode(e).length}function ns(e,t){if(ts(e)<=t)return e;let n=0,i=e.length;const r=new TextEncoder;for(;n<i;){const a=Math.floor((n+i+1)/2);r.encode(e.slice(0,a)).length<=t?n=a:i=a-1}return e.slice(0,n)}const is=2e3;function rs(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),void 0===n||void 0===i||void 0===e.timestamp||void 0===t.timestamp?0:8*(n-i)*1e3/(e.timestamp-t.timestamp)}const as="undefined"!==typeof MediaRecorder;const os=as?MediaRecorder:class{constructor(){throw new Error("MediaRecorder is not available in this environment")}};class ss extends os{constructor(e,t){if(!as)throw new Error("MediaRecorder is not available in this environment");let n,i;super(new MediaStream([e.mediaStreamTrack]),t);const r=()=>{this.removeEventListener("dataavailable",n),this.removeEventListener("stop",r),this.removeEventListener("error",a),null===i||void 0===i||i.close(),i=void 0},a=e=>{null===i||void 0===i||i.error(e),this.removeEventListener("dataavailable",n),this.removeEventListener("stop",r),this.removeEventListener("error",a),i=void 0};this.byteStream=new ReadableStream({start:e=>{i=e,n=t=>ui(this,void 0,void 0,function*(){let n;if(t.data.arrayBuffer){const e=yield t.data.arrayBuffer();n=new Uint8Array(e)}else{if(!t.data.byteArray)throw new Error("no data available!");n=t.data.byteArray}void 0!==i&&e.enqueue(n)}),this.addEventListener("dataavailable",n)},cancel:()=>{r()}}),this.addEventListener("stop",r),this.addEventListener("error",a)}}class cs extends ta{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(e,t,arguments.length>4?arguments[4]:void 0),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Fo(()=>ui(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>ui(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Lr.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new C,this.pauseUpstreamLock=new C,this.trackChangeLock=new C,this.trackChangeLock.lock().then(t=>ui(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{t()}})),this._constraints=e.getConstraints(),n&&(this._constraints=n)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==ta.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();return e&&t?{width:e,height:t}:void 0}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return null!==(t=null===(e=this.processor)||void 0===e?void 0:e.processedTrack)&&void 0!==t?t:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,t){return ui(this,void 0,void 0,function*(){var n;if(e===this._mediaStreamTrack&&!t)return;let i;if(this._mediaStreamTrack&&(this.attachedElements.forEach(e=>{ia(this._mediaStreamTrack,e)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints()),this.processor&&e){if(this.log.debug("restarting processor",this.logContext),"unknown"===this.kind)throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(na(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}this.sender&&"closed"!==(null===(n=this.sender.transport)||void 0===n?void 0:n.state)&&(yield this.sender.replaceTrack(null!==i&&void 0!==i?i:e)),this.providedByUser||this._mediaStreamTrack===e||this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(t=>{na(null!==i&&void 0!==i?i:e,t)}))})}waitForDimensions(){return ui(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return function*(){var n;if(e.kind===ta.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");"iOS"===(null===(n=Qr())||void 0===n?void 0:n.os)&&(yield fa(10));const i=Date.now();for(;Date.now()-i<t;){const t=e.dimensions;if(t)return t;yield fa(50)}throw new Fr("unable to get track dimensions after timeout")}()})}setDeviceId(e){return ui(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===za(e)||(this._constraints.deviceId=e,!!this.isMuted||(yield this.restartTrack(),za(e)===this._mediaStreamTrack.getSettings().deviceId))})}getDeviceId(){return ui(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){if(e.source===ta.Source.ScreenShare)return;const{deviceId:n,groupId:i}=e._mediaStreamTrack.getSettings(),r=e.kind===ta.Kind.Audio?"audioinput":"videoinput";return t?go.getInstance().normalizeDeviceId(r,n,i):n}()})}mute(){return ui(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return ui(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,t){return ui(this,void 0,void 0,function*(){const n=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Fr("unable to replace an unpublished track");let n,i;return"boolean"===typeof t?n=t:void 0!==t&&(n=t.userProvidedTrack,i=t.stopProcessor),this.providedByUser=null===n||void 0===n||n,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.internalStopProcessor()),this}finally{n()}})}restart(e){return ui(this,void 0,void 0,function*(){this.manuallyStopped=!1;const t=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:t,facingMode:n}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const r={audio:!1,video:!1};this.kind===ta.Kind.Video?r.video=!t&&!n||{deviceId:t,facingMode:n}:r.audio=!t||{deviceId:t},this.attachedElements.forEach(e=>{ia(this.mediaStreamTrack,e)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const a=(yield navigator.mediaDevices.getUserMedia(r)).getTracks()[0];return yield a.applyConstraints(i),a.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(a),this._constraints=e,this.emit(Lr.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{t()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),this.isMuted===e&&this._mediaStreamTrack.enabled!==e||(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Lr.Muted:Lr.Unmuted,this))}get needsReAcquisition(){return"live"!==this._mediaStreamTrack.readyState||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return ui(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Ca()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),this.isInBackground||!this.needsReAcquisition||this.isUserProvided||this.isMuted||(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),null===(e=this.processor)||void 0===e||e.destroy(),this.processor=void 0}pauseUpstream(){return ui(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!0===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to pause upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!0,this.emit(Lr.UpstreamPaused,this);const t=Qr();if("Safari"===(null===t||void 0===t?void 0:t.name)&&Ia(t.version,"12.0")<0)throw new jr("pauseUpstream is not supported on Safari < 12.");"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(null))}finally{t()}})}resumeUpstream(){return ui(this,void 0,void 0,function*(){var e;const t=yield this.pauseUpstreamLock.lock();try{if(!1===this._isUpstreamPaused)return;if(!this.sender)return void this.log.warn("unable to resume upstream for an unpublished track",this.logContext);this._isUpstreamPaused=!1,this.emit(Lr.UpstreamResumed,this),"closed"!==(null===(e=this.sender.transport)||void 0===e?void 0:e.state)&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{t()}})}getRTCStatsReport(){return ui(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;return yield this.sender.getStats()})}setProcessor(e){return ui(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var i;const r=yield t.trackChangeLock.lock();try{t.log.debug("setting up processor",t.logContext);const r=document.createElement(t.kind),a={kind:t.kind,track:t._mediaStreamTrack,element:r,audioContext:t.audioContext};if(yield e.init(a),t.log.debug("processor initialized",t.logContext),t.processor&&(yield t.internalStopProcessor()),"unknown"===t.kind)throw TypeError("cannot set processor on track of unknown kind");if(na(t._mediaStreamTrack,r),r.muted=!0,r.play().catch(e=>{e instanceof DOMException&&"AbortError"===e.name?(t.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},t.logContext),{error:e})),setTimeout(()=>{r.play().catch(e=>{t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{err:e}))})},100)):t.log.error("failed to play processor element",Object.assign(Object.assign({},t.logContext),{error:e}))}),t.processor=e,t.processorElement=r,t.processor.processedTrack){for(const e of t.attachedElements)e!==t.processorElement&&n&&(ia(t._mediaStreamTrack,e),na(t.processor.processedTrack,e));yield null===(i=t.sender)||void 0===i?void 0:i.replaceTrack(t.processor.processedTrack)}t.emit(Lr.TrackProcessorUpdate,t.processor)}finally{r()}}()})}getProcessor(){return this.processor}stopProcessor(){return ui(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){const n=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(t)}finally{n()}}()})}internalStopProcessor(){return ui(this,arguments,void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i;e.processor&&(e.log.debug("stopping processor",e.logContext),null===(n=e.processor.processedTrack)||void 0===n||n.stop(),yield e.processor.destroy(),e.processor=void 0,t||(null===(i=e.processorElement)||void 0===i||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Lr.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(as)if(this.localTrackRecorder)this.log.warn("preconnect buffer already started");else{{let e="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(e)||(e="video/mp4"),this.localTrackRecorder=new ss(this,{mimeType:e})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},1e4)}else this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return null===(e=this.localTrackRecorder)||void 0===e?void 0:e.mimeType}}class ls extends cs{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(e,ta.Kind.Audio,t,n,r),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>ui(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(S){return void this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:S}))}e&&this.prevStats&&(this._currentBitrate=rs(e,this.prevStats)),this.prevStats=e}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Lr.AudioTrackFeatureUpdate,this,gt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Lr.AudioTrackFeatureUpdate,this,gt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return ui(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ta.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return ui(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const t=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==za(this._constraints.deviceId);return this.source!==ta.Source.Microphone||!this.stopOnMute&&"ended"!==this._mediaStreamTrack.readyState&&!t||this.isUserProvided||(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return ui(this,void 0,void 0,function*(){let t;if(e){const n=no({audio:e});"boolean"!==typeof n.audio&&(t=n.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return ui(this,void 0,void 0,function*(){const n=yield t.restart.call(this,e);return this.checkForSilence(),n})}startMonitor(){wa()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},is)))}setProcessor(e){return ui(this,void 0,void 0,function*(){var t;const n=yield this.trackChangeLock.lock();try{if(!Ea()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield null===(t=this.sender)||void 0===t?void 0:t.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Lr.TrackProcessorUpdate,this.processor)}finally{n()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return ui(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return;let t;return(yield this.sender.getStats()).forEach(e=>{"outbound-rtp"===e.type&&(t={type:"audio",streamId:e.id,packetsSent:e.packetsSent,packetsLost:e.packetsLost,bytesSent:e.bytesSent,timestamp:e.timestamp,roundTripTime:e.roundTripTime,jitter:e.jitter})}),t})}checkForSilence(){return ui(this,void 0,void 0,function*(){const e=yield io(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Lr.AudioSilenceDetected)),e})}}const us=Object.values(ua),ds=Object.values(da),hs=Object.values(ha),ps=[ua.h180,ua.h360],fs=[da.h180,da.h360],ms=["q","h","f"];function gs(e,t,n,i){var r,a;let o=null===i||void 0===i?void 0:i.videoEncoding;e&&(o=null===i||void 0===i?void 0:i.screenShareEncoding);const s=null===i||void 0===i?void 0:i.simulcast,c=null===i||void 0===i?void 0:i.scalabilityMode,l=null===i||void 0===i?void 0:i.videoCodec;if(!o&&!s&&!c||!t||!n)return[{}];o||(o=function(e,t,n,i){const r=function(e,t,n){if(e)return hs;const i=t>n?t/n:n/t;if(Math.abs(i-16/9)<Math.abs(i-4/3))return us;return ds}(e,t,n);let{encoding:a}=r[0];const o=Math.max(t,n);for(let s=0;s<r.length;s+=1){const e=r[s];if(a=e.encoding,e.width>=o)break}if(i)switch(i){case"av1":case"h265":a=Object.assign({},a),a.maxBitrate=.7*a.maxBitrate;break;case"vp9":a=Object.assign({},a),a.maxBitrate=.85*a.maxBitrate}return a}(e,t,n,l),ai.debug("using video encoding",o));const u=o.maxFramerate,d=new ra(t,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&va(l)){const e=new ks(c),t=[];if(e.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const n=Qr();if(Sa()||Ea()||"Chrome"===(null===n||void 0===n?void 0:n.name)&&Ia(null===n||void 0===n?void 0:n.version,"113")<0){const i="h"==e.suffix?2:3,r=function(e){return e||(e=Qr()),"Safari"===(null===e||void 0===e?void 0:e.name)&&Ia(e.version,"18.3")>0||"iOS"===(null===e||void 0===e?void 0:e.os)&&!!(null===e||void 0===e?void 0:e.osVersion)&&Ia(e.osVersion,"18.3")>0}(n);for(let n=0;n<e.spatial;n+=1)t.push({rid:ms[2-n],maxBitrate:o.maxBitrate/Math.pow(i,n),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:r?Math.pow(2,n):void 0});t[0].scalabilityMode=c}else t.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:c});return d.encoding.priority&&(t[0].priority=d.encoding.priority,t[0].networkPriority=d.encoding.priority),ai.debug("using svc encoding",{encodings:t}),t}if(!s)return[o];let h,p=[];if(p=e?null!==(r=ys(null===i||void 0===i?void 0:i.screenShareSimulcastLayers))&&void 0!==r?r:vs(e,d):null!==(a=ys(null===i||void 0===i?void 0:i.videoSimulcastLayers))&&void 0!==a?a:vs(e,d),p.length>0){const e=p[0];p.length>1&&([,h]=p);const i=Math.max(t,n);if(i>=960&&h)return bs(t,n,[e,h,d],u);if(i>=480)return bs(t,n,[e,d],u)}return bs(t,n,[d])}function vs(e,t){if(e)return[{scaleResolutionDownBy:2,fps:(n=t).encoding.maxFramerate}].map(e=>{var t,i;return new ra(Math.floor(n.width/e.scaleResolutionDownBy),Math.floor(n.height/e.scaleResolutionDownBy),Math.max(15e4,Math.floor(n.encoding.maxBitrate/(Math.pow(e.scaleResolutionDownBy,2)*((null!==(t=n.encoding.maxFramerate)&&void 0!==t?t:30)/(null!==(i=e.fps)&&void 0!==i?i:30))))),e.fps,n.encoding.priority)});var n;const{width:i,height:r}=t,a=i>r?i/r:r/i;return Math.abs(a-16/9)<Math.abs(a-4/3)?ps:fs}function bs(e,t,n,i){const r=[];if(n.forEach((n,a)=>{if(a>=ms.length)return;const o=Math.min(e,t),s={rid:ms[a],scaleResolutionDownBy:Math.max(1,o/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate},c=i&&n.encoding.maxFramerate?Math.min(i,n.encoding.maxFramerate):n.encoding.maxFramerate;c&&(s.maxFramerate=c);const l=ya()||0===a;n.encoding.priority&&l&&(s.priority=n.encoding.priority,s.networkPriority=n.encoding.priority),r.push(s)}),Ea()&&"ios"===Oa()){let e;r.forEach(t=>{e?t.maxFramerate&&t.maxFramerate>e&&(e=t.maxFramerate):e=t.maxFramerate});let t=!0;r.forEach(n=>{var i;n.maxFramerate!=e&&(t&&(t=!1,ai.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),ai.info('Setting framerate of encoding "'.concat(null!==(i=n.rid)&&void 0!==i?i:"",'" to ').concat(e)),n.maxFramerate=e)})}return r}function ys(e){if(e)return e.sort((e,t)=>{const{encoding:n}=e,{encoding:i}=t;return n.maxBitrate>i.maxBitrate?1:n.maxBitrate<i.maxBitrate?-1:n.maxBitrate===i.maxBitrate&&n.maxFramerate&&i.maxFramerate?n.maxFramerate>i.maxFramerate?1:-1:0})}class ks{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat(null!==(e=this.suffix)&&void 0!==e?e:"")}}class Ss extends cs{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;super(e,ta.Kind.Video,t,n,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>ui(this,void 0,void 0,function*(){if(!this.sender)return void(this._currentBitrate=0);let e;try{e=yield this.getSenderStats()}catch(S){return void this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:S}))}const t=new Map(e.map(e=>[e.rid,e])),n=e.some(e=>"cpu"===e.qualityLimitationReason);if(n!==this.isCpuConstrained&&(this.isCpuConstrained=n,this.isCpuConstrained&&this.emit(Lr.CpuConstrained)),this.prevStats){let e=0;t.forEach((t,n)=>{var i;const r=null===(i=this.prevStats)||void 0===i?void 0:i.get(n);e+=rs(t,r)}),this._currentBitrate=e}this.prevStats=t}),this.senderLock=new C}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!wa())return;const n=null===(t=this.sender)||void 0===t?void 0:t.getParameters();n&&(this.encodings=n.encodings),this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},is))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return ui(this,void 0,void 0,function*(){var t,n,i,r,a;yield e.pauseUpstream.call(this);try{for(var o,s=!0,c=hi(this.simulcastCodecs.values());!(t=(o=yield c.next()).done);s=!0){r=o.value,s=!1;const e=r;yield null===(a=e.sender)||void 0===a?void 0:a.replaceTrack(null)}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return ui(this,void 0,void 0,function*(){var t,n,i,r,a;yield e.resumeUpstream.call(this);try{for(var o,s=!0,c=hi(this.simulcastCodecs.values());!(t=(o=yield c.next()).done);s=!0){r=o.value,s=!1;const e=r;yield null===(a=e.sender)||void 0===a?void 0:a.replaceTrack(e.mediaStreamTrack)}}catch(l){n={error:l}}finally{try{s||t||!(i=c.return)||(yield i.call(c))}finally{if(n)throw n.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return ui(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source!==ta.Source.Camera||this.isUserProvided||(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return ui(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.isMuted?(this.source!==ta.Source.Camera||this.isUserProvided||(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){return ui(this,void 0,void 0,function*(){var e;if(!(null===(e=this.sender)||void 0===e?void 0:e.getStats))return[];const t=[],n=yield this.sender.getStats();return n.forEach(e=>{var i;if("outbound-rtp"===e.type){const r={type:"video",streamId:e.id,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,framesSent:e.framesSent,firCount:e.firCount,pliCount:e.pliCount,nackCount:e.nackCount,packetsSent:e.packetsSent,bytesSent:e.bytesSent,qualityLimitationReason:e.qualityLimitationReason,qualityLimitationDurations:e.qualityLimitationDurations,qualityLimitationResolutionChanges:e.qualityLimitationResolutionChanges,rid:null!==(i=e.rid)&&void 0!==i?i:e.id,retransmittedPacketsSent:e.retransmittedPacketsSent,targetBitrate:e.targetBitrate,timestamp:e.timestamp},a=n.get(e.remoteId);a&&(r.jitter=a.jitter,r.packetsLost=a.packetsLost,r.roundTripTime=a.roundTripTime),t.push(r)}}),t.sort((e,t)=>{var n,i;return(null!==(n=t.frameWidth)&&void 0!==n?n:0)-(null!==(i=e.frameWidth)&&void 0!==i?i:0)}),t})}setPublishingQuality(e){const t=[];for(let n=ea.LOW;n<=ea.HIGH;n+=1)t.push(new Dn({quality:n,enabled:n<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(va(this.codec),t)}restartTrack(e){return ui(this,void 0,void 0,function*(){var t,n,i,r,a;let o;if(e){const t=no({video:e});"boolean"!==typeof t.video&&(o=t.video)}yield this.restart(o),this.isCpuConstrained=!1;try{for(var s,c=!0,l=hi(this.simulcastCodecs.values());!(t=(s=yield l.next()).done);c=!0){r=s.value,c=!1;const e=r;e.sender&&"closed"!==(null===(a=e.sender.transport)||void 0===a?void 0:a.state)&&(e.mediaStreamTrack=this.mediaStreamTrack.clone(),yield e.sender.replaceTrack(e.mediaStreamTrack))}}catch(u){n={error:u}}finally{try{c||t||!(i=l.return)||(yield i.call(l))}finally{if(n)throw n.error}}})}setProcessor(e){const t=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return ui(this,arguments,void 0,function(e){var n=this;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){var r,a,o,s,c,l;if(yield t.setProcessor.call(n,e,i),null===(c=n.processor)||void 0===c?void 0:c.processedTrack)try{for(var u,d=!0,h=hi(n.simulcastCodecs.values());!(r=(u=yield h.next()).done);d=!0){s=u.value,d=!1;const e=s;yield null===(l=e.sender)||void 0===l?void 0:l.replaceTrack(n.processor.processedTrack)}}catch(p){a={error:p}}finally{try{d||r||!(o=h.return)||(yield o.call(h))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return ui(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const t=this.sender.getParameters();t.degradationPreference=e,this.sender.setParameters(t)}catch(S){this.log.warn("failed to set degradationPreference",Object.assign({error:S},this.logContext))}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))return void this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);const n={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,n),n}setSimulcastTrackSender(e,t){const n=this.simulcastCodecs.get(e);n&&(n.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},5e3))}setPublishingCodecs(e){return ui(this,void 0,void 0,function*(){var t,n,i,r,a,o,s;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(va(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(t=!0,n=hi(e);!(r=(i=yield n.next()).done);t=!0){s=i.value,t=!1;const e=s;if(this.codec&&this.codec!==e.codec){const t=this.simulcastCodecs.get(e.codec);if(this.log.debug("try setPublishingCodec for ".concat(e.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:t})),t&&t.sender)t.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(e.codec),this.logContext),yield Ts(t.sender,t.encodings,e.qualities,this.senderLock,va(e.codec),this.log,this.logContext));else for(const n of e.qualities)if(n.enabled){c.push(e.codec);break}}else yield this.setPublishingLayers(va(e.codec),e.qualities)}}catch(l){a={error:l}}finally{try{t||r||!(o=n.return)||(yield o.call(n))}finally{if(a)throw a.error}}return c})}setPublishingLayers(e,t){return ui(this,void 0,void 0,function*(){this.optimizeForPerformance?this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:t})):(this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:t})),this.sender&&this.encodings&&(yield Ts(this.sender,this.encodings,t,this.senderLock,e,this.log,this.logContext)))})}prioritizePerformance(){return ui(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const e=this.sender.getParameters();e.encodings=e.encodings.map((e,t)=>{var n;return Object.assign(Object.assign({},e),{active:0===t,scaleResolutionDownBy:Math.max(1,Math.ceil((null!==(n=this.mediaStreamTrack.getSettings().height)&&void 0!==n?n:360)/360)),scalabilityMode:0===t&&va(this.codec)?"L1T3":void 0,maxFramerate:0===t?15:0,maxBitrate:0===t?e.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:e.encodings})),this.encodings=e.encodings,yield this.sender.setParameters(e)}catch(S){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:S})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return ui(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Ca()&&this.isInBackground&&this.source===ta.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Ts(e,t,n,i,r,a,o){return ui(this,void 0,void 0,function*(){const s=yield i.lock();a.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:e,qualities:n,senderEncodings:t}));try{const i=e.getParameters(),{encodings:s}=i;if(!s)return;if(s.length!==t.length)return void a.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:s,senderEncodings:t}));let c=!1;if(!1&&s[0].scalabilityMode);else{if(r){n.some(e=>e.enabled)&&n.forEach(e=>e.enabled=!0)}s.forEach((e,i)=>{var r;let s=null!==(r=e.rid)&&void 0!==r?r:"";""===s&&(s="q");const l=Cs(s),u=n.find(e=>e.quality===l);u&&e.active!==u.enabled&&(c=!0,e.active=u.enabled,a.debug("setting layer ".concat(u.quality," to ").concat(e.active?"enabled":"disabled"),o),ya()&&(u.enabled?(e.scaleResolutionDownBy=t[i].scaleResolutionDownBy,e.maxBitrate=t[i].maxBitrate,e.maxFrameRate=t[i].maxFrameRate):(e.scaleResolutionDownBy=4,e.maxBitrate=10,e.maxFrameRate=2)))})}c&&(i.encodings=s,a.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:i.encodings})),yield e.setParameters(i))}finally{s()}})}function Cs(e){switch(e){case"f":default:return ea.HIGH;case"h":return ea.MEDIUM;case"q":return ea.LOW}}function ws(e,t,n,i){if(!n)return[new Rt({quality:ea.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(i){const i=n[0].scalabilityMode,r=new ks(i),a=[],o="h"==r.suffix?1.5:2,s="h"==r.suffix?2:3;for(let c=0;c<r.spatial;c+=1)a.push(new Rt({quality:Math.min(ea.HIGH,r.spatial-1)-c,width:Math.ceil(e/Math.pow(o,c)),height:Math.ceil(t/Math.pow(o,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(s,c)):0,ssrc:0}));return a}return n.map(n=>{var i,r,a;const o=null!==(i=n.scaleResolutionDownBy)&&void 0!==i?i:1;let s=Cs(null!==(r=n.rid)&&void 0!==r?r:"");return new Rt({quality:s,width:Math.ceil(e/o),height:Math.ceil(t/o),bitrate:null!==(a=n.maxBitrate)&&void 0!==a?a:0,ssrc:0})})}const Es="_lossy",Ps="_reliable",Rs="leave-reconnect";var Os;!function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"}(Os||(Os={}));class xs extends mi.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Yo.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Os.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=ai,this.reliableDataSequence=1,this.reliableMessageBuffer=new Eo,this.reliableReceivedState=new Po(3e4),this.handleDataChannel=e=>ui(this,[e],void 0,function(e){var t=this;let{channel:n}=e;return function*(){if(n){if(n.label===Ps)t.reliableDCSub=n;else{if(n.label!==Es)return;t.lossyDCSub=n}t.log.debug("on data channel ".concat(n.id,", ").concat(n.label),t.logContext),n.onmessage=t.handleDataMessage}}()}),this.handleDataMessage=e=>ui(this,void 0,void 0,function*(){var t,n;const i=yield this.dataProcessLock.lock();try{let i;if(e.data instanceof ArrayBuffer)i=e.data;else{if(!(e.data instanceof Blob))return void this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:e.data}));i=yield e.data.arrayBuffer()}const r=Ot.fromBinary(new Uint8Array(i));if(r.sequence>0&&""!==r.participantSid){const e=this.reliableReceivedState.get(r.participantSid);if(e&&r.sequence<=e)return;this.reliableReceivedState.set(r.participantSid,r.sequence)}"speaker"===(null===(t=r.value)||void 0===t?void 0:t.case)?this.emit(Ar.ActiveSpeakersUpdate,r.value.value.speakers):("user"===(null===(n=r.value)||void 0===n?void 0:n.case)&&function(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=0!==e.destinationIdentities.length?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}(r,r.value.value),this.emit(Ar.DataPacketReceived,r))}finally{i()}}),this.handleDataError=e=>{const t=0===e.currentTarget.maxRetransmits?"lossy":"reliable";if(e instanceof ErrorEvent&&e.error){const{error:n}=e.error;this.log.error("DataChannel error on ".concat(t,": ").concat(e.message),Object.assign(Object.assign({},this.logContext),{error:n}))}else this.log.error("Unknown DataChannel error on ".concat(t),Object.assign(Object.assign({},this.logContext),{event:e}))},this.handleBufferedAmountLow=e=>{const t=0===e.currentTarget.maxRetransmits?xt.LOSSY:xt.RELIABLE;this.updateAndEmitDCBufferStatus(t)},this.handleDisconnect=(e,t)=>{if(this._isClosed)return;this.log.warn("".concat(e," disconnected"),this.logContext),0===this.reconnectAttempts&&(this.reconnectStart=Date.now());const n=e=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(e,"ms. giving up"),this.logContext),this.emit(Ar.Disconnected),this.close()},i=Date.now()-this.reconnectStart;let r=this.getNextRetryDelay({elapsedMs:i,retryCount:this.reconnectAttempts});null!==r?(e===Rs&&(r=0),this.log.debug("reconnecting in ".concat(r,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Xr.setTimeout(()=>this.attemptReconnect(t).finally(()=>this.reconnectTimeout=void 0),r)):n(i)},this.waitForRestarted=()=>new Promise((e,t)=>{this.pcState===Os.Connected&&e();const n=()=>{this.off(Ar.Disconnected,i),e()},i=()=>{this.off(Ar.Restarted,n),t()};this.once(Ar.Restarted,n),this.once(Ar.Disconnected,i)}),this.updateAndEmitDCBufferStatus=e=>{const t=this.isBufferStatusLow(e);"undefined"!==typeof t&&t!==this.dcBufferStatus.get(e)&&(this.dcBufferStatus.set(e,t),this.emit(Ar.DCBufferStatusChanged,t,e))},this.isBufferStatusLow=e=>{const t=this.dataChannelForKind(e);if(t)return e===xt.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(t.bufferedAmount),t.bufferedAmount<=t.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===So.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(ft.RR_SIGNAL_DISCONNECTED))},this.log=oi(null!==(t=e.loggerName)&&void 0!==t?t:ii.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new To(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new C,this.dataProcessLock=new C,this.dcBufferStatus=new Map([[xt.LOSSY,!0],[xt.RELIABLE,!0]]),this.client.onParticipantUpdate=e=>this.emit(Ar.ParticipantUpdate,e),this.client.onConnectionQuality=e=>this.emit(Ar.ConnectionQualityUpdate,e),this.client.onRoomUpdate=e=>this.emit(Ar.RoomUpdate,e),this.client.onSubscriptionError=e=>this.emit(Ar.SubscriptionError,e),this.client.onSubscriptionPermissionUpdate=e=>this.emit(Ar.SubscriptionPermissionUpdate,e),this.client.onSpeakersChanged=e=>this.emit(Ar.SpeakersChanged,e),this.client.onStreamStateUpdate=e=>this.emit(Ar.StreamStateChanged,e),this.client.onRequestResponse=e=>this.emit(Ar.SignalRequestResponse,e)}get logContext(){var e,t,n,i,r,a;return{room:null===(t=null===(e=this.latestJoinResponse)||void 0===e?void 0:e.room)||void 0===t?void 0:t.name,roomID:null===(i=null===(n=this.latestJoinResponse)||void 0===n?void 0:n.room)||void 0===i?void 0:i.sid,participant:null===(a=null===(r=this.latestJoinResponse)||void 0===r?void 0:r.participant)||void 0===a?void 0:a.identity,pID:this.participantSid}}join(e,t,n,i){return ui(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=n,this.maxJoinAttempts=n.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const r=yield this.client.join(e,t,n,i);return this._isClosed=!1,this.latestJoinResponse=r,this.subscriberPrimary=r.subscriberPrimary,this.pcManager||(yield this.configure(r)),this.subscriberPrimary&&!r.fastPublish||this.negotiate(),this.clientConfiguration=r.clientConfiguration,this.emit(Ar.SignalConnected,r),r}catch(S){if(S instanceof Ur&&S.reason===xr.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,n,i);throw S}})}close(){return ui(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed)e();else try{this._isClosed=!0,this.joinAttempts=0,this.emit(Ar.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return ui(this,void 0,void 0,function*(){var e;yield null===(e=this.pcManager)||void 0===e?void 0:e.close(),this.pcManager=void 0;const t=e=>{e&&(e.close(),e.onbufferedamountlow=null,e.onclose=null,e.onclosing=null,e.onerror=null,e.onmessage=null,e.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Eo,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return ui(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Fr("a track with the same ID has already been published");return new Promise((t,n)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],n(new Ur("publication of local track timed out, no response from server",xr.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:e=>{clearTimeout(i),t(e)},reject:()=>{clearTimeout(i),n(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(S){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:S}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return null===(e=this.reliableDCSub)||void 0===e?void 0:e.readyState}getConnectedServerAddress(){return ui(this,void 0,void 0,function*(){var e;return null===(e=this.pcManager)||void 0===e?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return ui(this,void 0,void 0,function*(){var t,n;if(this.pcManager&&this.pcManager.currentState!==Xo.NEW)return;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid;const i=this.makeRTCConfiguration(e);var r;this.pcManager=new Zo(i,e.subscriberPrimary,this.loggerOptions),this.emit(Ar.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(e,t)=>{this.client.sendIceCandidate(e,t)},this.pcManager.onPublisherOffer=(e,t)=>{this.client.sendOffer(e,t)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(t,n,i)=>ui(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(t),this.logContext),["closed","disconnected","failed"].includes(n)&&(this.publisherConnectionPromise=void 0),t===Xo.CONNECTED){const t=this.pcState===Os.New;this.pcState=Os.Connected,t&&this.emit(Ar.Connected,e)}else t===Xo.FAILED&&this.pcState===Os.Connected&&(this.pcState=Os.Disconnected,this.handleDisconnect("peerconnection failed","failed"===i?ft.RR_SUBSCRIBER_FAILED:ft.RR_PUBLISHER_FAILED));const r=this.client.isDisconnected||this.client.currentState===So.RECONNECTING,a=[Xo.FAILED,Xo.CLOSING,Xo.CLOSED].includes(t);r&&a&&!this._isClosed&&this.emit(Ar.Offline)}),this.pcManager.onTrack=e=>{this.emit(Ar.MediaTrackAdded,e.track,e.streams[0],e.receiver)},void 0!==(r=null===(n=e.serverInfo)||void 0===n?void 0:n.protocol)&&r>13||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,t)=>ui(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,t))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=(e,t)=>ui(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=t,!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e,t);n&&this.client.sendAnswer(n,t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:null===(t=e.track)||void 0===t?void 0:t.sid})),!this.pendingTrackResolvers[e.cid])return void this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));const{resolve:n}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],n(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(Ar.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(Ar.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(Ar.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(Ar.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var t;this.participantSid=null===(t=e.participant)||void 0===t?void 0:t.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(Ar.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",ft.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:null===e||void 0===e?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Cn.DISCONNECT:this.emit(Ar.Disconnected,null===e||void 0===e?void 0:e.reason),this.close();break;case Cn.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Rs);break;case Cn.RESUME:this.handleDisconnect(Rs)}}}makeRTCConfiguration(e){var t;const n=Object.assign({},this.rtcConfig);if((null===(t=this.signalOpts)||void 0===t?void 0:t.e2eeEnabled)&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),n.encodedInsertableStreams=!0),e.iceServers&&!n.iceServers){const t=[];e.iceServers.forEach(e=>{const n={urls:e.urls};e.username&&(n.username=e.username),e.credential&&(n.credential=e.credential),t.push(n)}),n.iceServers=t}return e.clientConfiguration&&e.clientConfiguration.forceRelay===ht.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Es,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Ps,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,t,n){return ui(this,void 0,void 0,function*(){if(ma()){return yield this.createTransceiverRTCRtpSender(e,t,n)}if(ga()){this.log.warn("using add-track fallback",this.logContext);return yield this.createRTCRtpSender(e.mediaStreamTrack)}throw new zr("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,n,i){return ui(this,void 0,void 0,function*(){if(ma())return this.createSimulcastTransceiverSender(e,t,n,i);if(ga())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new zr("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,n){return ui(this,void 0,void 0,function*(){if(!this.pcManager)throw new zr("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),Qa(e)&&(e.codec=t.videoCodec);const r={direction:"sendonly",streams:i};n&&(r.sendEncodings=n);return(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r)).sender})}createSimulcastTransceiverSender(e,t,n,i){return ui(this,void 0,void 0,function*(){if(!this.pcManager)throw new zr("publisher is closed");const r={direction:"sendonly"};i&&(r.sendEncodings=i);const a=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r);if(n.videoCodec)return e.setSimulcastTrackSender(n.videoCodec,a.sender),a.sender})}createRTCRtpSender(e){return ui(this,void 0,void 0,function*(){if(!this.pcManager)throw new zr("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return ui(this,void 0,void 0,function*(){var t,n,i;if(!this._isClosed)if(this.attemptingReconnect)ai.warn("already attempting reconnect, returning early",this.logContext);else{(null===(t=this.clientConfiguration)||void 0===t?void 0:t.resumeConnection)!==ht.DISABLED&&(null!==(i=null===(n=this.pcManager)||void 0===n?void 0:n.currentState)&&void 0!==i?i:Xo.NEW)!==Xo.NEW||(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(S){this.reconnectAttempts+=1;let t=!0;S instanceof zr?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:S})),t=!1):S instanceof Is||(this.fullReconnectOnNext=!0),t?this.handleDisconnect("reconnect",ft.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(Ar.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(S){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:S}))}return null}restartConnection(e){return ui(this,void 0,void 0,function*(){var t,n,i;try{if(!this.url||!this.token)throw new zr("could not reconnect, url or token not saved");let n;this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(Ar.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Is;n=yield this.join(null!==e&&void 0!==e?e:this.url,this.token,this.signalOpts)}catch(S){if(S instanceof Ur&&S.reason===xr.NotAllowed)throw new zr("could not reconnect, token might be expired");throw new Is}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(Ar.SignalRestarted,n),yield this.waitForPCReconnected(),this.client.currentState!==So.CONNECTED)throw new Is("Signal connection got severed during reconnect");null===(t=this.regionUrlProvider)||void 0===t||t.resetAttempts(),this.emit(Ar.Restarted)}catch(r){const e=yield null===(n=this.regionUrlProvider)||void 0===n?void 0:n.getNextBestRegionUrl();if(e)return void(yield this.restartConnection(e));throw null===(i=this.regionUrlProvider)||void 0===i||i.resetAttempts(),r}})}resumeConnection(e){return ui(this,void 0,void 0,function*(){var t;if(!this.url||!this.token)throw new zr("could not reconnect, url or token not saved");if(!this.pcManager)throw new zr("publisher and subscriber connections unset");let n;this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(Ar.Resuming);try{this.setupSignalClientCallbacks(),n=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let e="";if(i instanceof Error&&(e=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof Ur&&i.reason===xr.NotAllowed)throw new zr("could not reconnect, token might be expired");if(i instanceof Ur&&i.reason===xr.LeaveRequest)throw i;throw new Is(e)}if(this.emit(Ar.SignalResumed),n){const e=this.makeRTCConfiguration(n);this.pcManager.updateConfiguration(e),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=n.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==So.CONNECTED)throw new Is("Signal connection got severed during reconnect");this.client.setReconnected(),"open"===(null===(t=this.reliableDC)||void 0===t?void 0:t.readyState)&&null===this.reliableDC.id&&this.createDataChannels(),(null===n||void 0===n?void 0:n.lastMessageSeq)&&this.resendReliableMessagesForResume(n.lastMessageSeq),this.emit(Ar.Resumed)})}waitForPCInitialConnection(e,t){return ui(this,void 0,void 0,function*(){if(!this.pcManager)throw new zr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return ui(this,void 0,void 0,function*(){this.pcState=Os.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield fa(2e3),!this.pcManager)throw new zr("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Os.Connected}catch(S){throw this.pcState=Os.Disconnected,new Ur("could not establish PC connection, ".concat(S.message),xr.InternalError)}})}publishRpcResponse(e,t,n,i){return ui(this,void 0,void 0,function*(){const r=new Ot({destinationIdentities:[e],kind:xt.RELIABLE,value:{case:"rpcResponse",value:new Ft({requestId:t,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:null!==n&&void 0!==n?n:""}})}});yield this.sendDataPacket(r,xt.RELIABLE)})}publishRpcAck(e,t){return ui(this,void 0,void 0,function*(){const n=new Ot({destinationIdentities:[e],kind:xt.RELIABLE,value:{case:"rpcAck",value:new jt({requestId:t})}});yield this.sendDataPacket(n,xt.RELIABLE)})}sendDataPacket(e,t){return ui(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(t),t===xt.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const n=e.toBinary(),i=this.dataChannelForKind(t);if(i){if(t===xt.RELIABLE&&this.reliableMessageBuffer.push({data:n,sequence:e.sequence}),this.attemptingReconnect)return;i.send(n)}this.updateAndEmitDCBufferStatus(t)})}resendReliableMessagesForResume(e){return ui(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(xt.RELIABLE);const t=this.dataChannelForKind(xt.RELIABLE);t&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(e=>{t.send(e.data)})),this.updateAndEmitDCBufferStatus(xt.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((t,n)=>ui(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))t();else{const i=()=>n("Engine closed");for(this.once(Ar.Closing,i);!this.dcBufferStatus.get(e);)yield fa(10);this.off(Ar.Closing,i),t()}}))}ensureDataTransportConnected(e){return ui(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscriberPrimary;return function*(){var i;if(!t.pcManager)throw new zr("PC manager is closed");const r=n?t.pcManager.subscriber:t.pcManager.publisher,a=n?"Subscriber":"Publisher";if(!r)throw new Ur("".concat(a," connection not set"),xr.InternalError);let o=!1;n||t.dataChannelForKind(e,n)||(t.createDataChannels(),o=!0),o||n||t.pcManager.publisher.isICEConnected||"checking"===t.pcManager.publisher.getICEConnectionState()||(o=!0),o&&t.negotiate();const s=t.dataChannelForKind(e,n);if("open"===(null===s||void 0===s?void 0:s.readyState))return;const c=(new Date).getTime()+t.peerConnectionTimeout;for(;(new Date).getTime()<c;){if(r.isICEConnected&&"open"===(null===(i=t.dataChannelForKind(e,n))||void 0===i?void 0:i.readyState))return;yield fa(50)}throw new Ur("could not establish ".concat(a," connection, state: ").concat(r.getICEConnectionState()),xr.InternalError)}()})}ensurePublisherConnected(e){return ui(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!!this.pcManager&&(this.pcManager.currentState===Xo.CONNECTED&&!(!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED))}negotiate(){return ui(this,void 0,void 0,function*(){return new Promise((e,t)=>ui(this,void 0,void 0,function*(){if(!this.pcManager)return void t(new Vr("PC manager is closed"));this.pcManager.requirePublisher(),0!=this.pcManager.publisher.getTransceivers().length||this.lossyDC||this.reliableDC||this.createDataChannels();const n=new AbortController,i=()=>{n.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(Ar.Closing,i),this.pcManager.publisher.once(Vo,e=>{const t=new Map;e.forEach(e=>{const n=e.codec.toLowerCase();var i;i=n,oa.includes(i)&&t.set(e.payload,n)}),this.emit(Ar.RTPVideoMapUpdate,t)});try{yield this.pcManager.negotiate(n),e()}catch(S){S instanceof Vr&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ft.RR_UNKNOWN),t(S)}finally{this.off(Ar.Closing,i)}}))})}dataChannelForKind(e,t){if(t){if(e===xt.LOSSY)return this.lossyDCSub;if(e===xt.RELIABLE)return this.reliableDCSub}else{if(e===xt.LOSSY)return this.lossyDC;if(e===xt.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var n,i;if(!this.pcManager)return void this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);const r=this.pcManager.subscriber.getLocalDescription(),a=this.pcManager.subscriber.getRemoteDescription(),o=null===(i=null===(n=this.signalOpts)||void 0===n?void 0:n.autoSubscribe)||void 0===i||i,s=new Array,c=new Array;e.forEach(e=>{e.isDesired!==o&&s.push(e.trackSid),e.isEnabled||c.push(e.trackSid)}),this.client.sendSyncState(new Bn({answer:r?wo({sdp:r.sdp,type:r.type}):void 0,offer:a?wo({sdp:a.sdp,type:a.type}):void 0,subscription:new bn({trackSids:s,subscribe:!o,participantTracks:[]}),publishTracks:lo(t),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c,datachannelReceiveStates:this.reliableReceivedState.map((e,t)=>new zn({publisherSid:t,lastSeq:e}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(t,n)=>{void 0!==(null===t||void 0===t?void 0:t.id)&&null!==t.id&&e.push(new Vn({label:t.label,id:t.id,target:n}))};return t(this.dataChannelForKind(xt.LOSSY),nn.PUBLISHER),t(this.dataChannelForKind(xt.RELIABLE),nn.PUBLISHER),t(this.dataChannelForKind(xt.LOSSY,!0),nn.SUBSCRIBER),t(this.dataChannelForKind(xt.RELIABLE,!0),nn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Xr.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){wa()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){wa()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Is extends Error{}class _s{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Pa(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return ui(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(e=>!this.attemptedRegions.find(t=>t.url===e.url));if(t.length>0){const e=t[0];return this.attemptedRegions.push(e),ai.debug("next region: ".concat(e.region)),e.url}return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return ui(this,void 0,void 0,function*(){const t=yield fetch("".concat((n=this.serverUrl,"".concat(n.protocol.replace("ws","http"),"//").concat(n.host,"/settings")),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});var n;if(t.ok){const e=yield t.json();return this.lastUpdateAt=Date.now(),e}throw new Ur("Could not fetch region settings: ".concat(t.statusText),401===t.status?xr.NotAllowed:xr.InternalError,t.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}class Ns{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if("number"===typeof this.totalByteSize&&0!==this.totalByteSize){if(e&&this.bytesReceived<this.totalByteSize)throw new Wr("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Ir.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Wr("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Ir.LengthExceeded)}}constructor(e,t,n,i){this.reader=t,this.totalByteSize=n,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=i}}class Ds extends Ns{handleChunkReceived(e){var t;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const n=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,n)}[Symbol.asyncIterator](){const e=this.reader.getReader();let t=new Ba,n=null,i=null;if(this.signal){const e=this.signal;i=()=>{var n;null===(n=t.reject)||void 0===n||n.call(t,e.reason)},e.addEventListener("abort",i),n=e}const r=()=>{e.releaseLock(),n&&i&&n.removeEventListener("abort",i),this.signal=void 0};return{next:()=>ui(this,void 0,void 0,function*(){var n,i;try{const{done:r,value:a}=yield Promise.race([e.read(),t.promise,null!==(i=null===(n=this.outOfBandFailureRejectingFuture)||void 0===n?void 0:n.promise)&&void 0!==i?i:new Promise(()=>{})]);return r?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(a),{done:!1,value:a.content})}catch(a){throw r(),a}}),return(){return ui(this,void 0,void 0,function*(){return r(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return ui(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){var n,i,r,a;let o=new Set;const s=t.signal?e.withAbortSignal(t.signal):e;try{for(var c,l=!0,u=hi(s);!(n=(c=yield u.next()).done);l=!0){a=c.value,l=!1;const e=a;o.add(e)}}catch(d){i={error:d}}finally{try{l||n||!(r=u.return)||(yield r.call(u))}finally{if(i)throw i.error}}return Array.from(o)}()})}}class Ms extends Ns{constructor(e,t,n,i){super(e,t,n,i),this.receivedChunks=new Map}handleChunkReceived(e){var t;const n=Ha(e.chunkIndex),i=this.receivedChunks.get(n);if(i&&i.version>e.version)return;this.receivedChunks.set(n,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;null===(t=this.onProgress)||void 0===t||t.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader(),t=new TextDecoder("utf-8",{fatal:!0});let n=new Ba,i=null,r=null;if(this.signal){const e=this.signal;r=()=>{var t;null===(t=n.reject)||void 0===t||t.call(n,e.reason)},e.addEventListener("abort",r),i=e}const a=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>ui(this,void 0,void 0,function*(){var i,r;try{const{done:a,value:s}=yield Promise.race([e.read(),n.promise,null!==(r=null===(i=this.outOfBandFailureRejectingFuture)||void 0===i?void 0:i.promise)&&void 0!==r?r:new Promise(()=>{})]);if(a)return this.validateBytesReceived(!0),{done:!0,value:void 0};{let e;this.handleChunkReceived(s);try{e=t.decode(s.content)}catch(o){throw new Wr("Cannot decode datastream chunk ".concat(s.chunkIndex," as text: ").concat(o),Ir.DecodeFailed)}return{done:!1,value:e}}}catch(o){throw a(),o}}),return(){return ui(this,void 0,void 0,function*(){return a(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return ui(this,arguments,void 0,function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){var n,i,r,a;let o="";const s=t.signal?e.withAbortSignal(t.signal):e;try{for(var c,l=!0,u=hi(s);!(n=(c=yield u.next()).done);l=!0){a=c.value,l=!1;o+=a}}catch(d){i={error:d}}finally{try{l||n||!(r=u.return)||(yield r.call(u))}finally{if(i)throw i.error}}return o}()})}}class As{constructor(){this.log=ai,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,t){if(this.textStreamHandlers.has(e))throw new Wr('A text stream handler for topic "'.concat(e,'" has already been set.'),Ir.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,t)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,t){if(this.byteStreamHandlers.has(e))throw new Wr('A byte stream handler for topic "'.concat(e,'" has already been set.'),Ir.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,t)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearHandlersAndControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear(),this.byteStreamHandlers.clear(),this.textStreamHandlers.clear()}validateParticipantHasNoActiveDataStreams(e){var t,n,i,r;const a=Array.from(this.textStreamControllers.entries()).filter(t=>t[1].sendingParticipantIdentity===e),o=Array.from(this.byteStreamControllers.entries()).filter(t=>t[1].sendingParticipantIdentity===e);if(a.length>0||o.length>0){const s=new Wr("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Ir.AbnormalEnd);for(const[e,i]of o)null===(n=(t=i.outOfBandFailureRejectingFuture).reject)||void 0===n||n.call(t,s),this.byteStreamControllers.delete(e);for(const[e,t]of a)null===(r=(i=t.outOfBandFailureRejectingFuture).reject)||void 0===r||r.call(i,s),this.textStreamControllers.delete(e)}}handleDataStreamPacket(e){return ui(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity);case"streamChunk":return this.handleStreamChunk(e.value.value);case"streamTrailer":return this.handleStreamTrailer(e.value.value);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,t){return ui(this,void 0,void 0,function*(){var n;if("byteHeader"===e.contentHeader.case){const i=this.byteStreamHandlers.get(e.topic);if(!i)return void this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);let r;const a=new Ba,o={id:e.streamId,name:null!==(n=e.contentHeader.value.name)&&void 0!==n?n:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Ha(e.timestamp),attributes:e.attributes},s=new ReadableStream({start:n=>{if(r=n,this.textStreamControllers.has(e.streamId))throw new Wr("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Ir.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:o,controller:r,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:a})}});i(new Ds(o,s,Ha(e.totalLength),a),{identity:t})}else if("textHeader"===e.contentHeader.case){const n=this.textStreamHandlers.get(e.topic);if(!n)return void this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);let i;const r=new Ba,a={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes},o=new ReadableStream({start:n=>{if(i=n,this.textStreamControllers.has(e.streamId))throw new Wr("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Ir.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:a,controller:i,startTime:Date.now(),sendingParticipantIdentity:t,outOfBandFailureRejectingFuture:r})}});n(new Ms(a,o,Ha(e.totalLength),r),{identity:t})}})}handleStreamChunk(e){const t=this.byteStreamControllers.get(e.streamId);t&&e.content.length>0&&t.controller.enqueue(e);const n=this.textStreamControllers.get(e.streamId);n&&e.content.length>0&&n.controller.enqueue(e)}handleStreamTrailer(e){const t=this.textStreamControllers.get(e.streamId);t&&(t.info.attributes=Object.assign(Object.assign({},t.info.attributes),e.attributes),t.controller.close(),this.textStreamControllers.delete(e.streamId));const n=this.byteStreamControllers.get(e.streamId);n&&(n.info.attributes=Object.assign(Object.assign({},n.info.attributes),e.attributes),n.controller.close(),this.byteStreamControllers.delete(e.streamId))}}class Ls{constructor(e,t,n){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=n,this.info=t}write(e){return this.defaultWriter.write(e)}close(){return ui(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),null===(e=this.onClose)||void 0===e||e.call(this)})}}class Us extends Ls{}class js extends Ls{}class Fs{constructor(e,t){this.engine=e,this.log=t}setupEngine(e){this.engine=e}sendText(e,t){return ui(this,void 0,void 0,function*(){var n;const i=crypto.randomUUID(),r=(new TextEncoder).encode(e).byteLength,a=null===(n=null===t||void 0===t?void 0:t.attachments)||void 0===n?void 0:n.map(()=>crypto.randomUUID()),o=new Array(a?a.length+1:1).fill(0),s=(e,n)=>{var i;o[n]=e;const r=o.reduce((e,t)=>e+t,0);null===(i=null===t||void 0===t?void 0:t.onProgress)||void 0===i||i.call(t,r)},c=yield this.streamText({streamId:i,totalSize:r,destinationIdentities:null===t||void 0===t?void 0:t.destinationIdentities,topic:null===t||void 0===t?void 0:t.topic,attachedStreamIds:a,attributes:null===t||void 0===t?void 0:t.attributes});return yield c.write(e),s(1,0),yield c.close(),(null===t||void 0===t?void 0:t.attachments)&&a&&(yield Promise.all(t.attachments.map((e,n)=>ui(this,void 0,void 0,function*(){return this._sendFile(a[n],e,{topic:t.topic,mimeType:e.type,onProgress:e=>{s(e,n+1)}})})))),c.info})}streamText(e){return ui(this,void 0,void 0,function*(){var t,n;const i=null!==(t=null===e||void 0===e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),r={id:i,mimeType:"text/plain",timestamp:Date.now(),topic:null!==(n=null===e||void 0===e?void 0:e.topic)&&void 0!==n?n:"",size:null===e||void 0===e?void 0:e.totalSize,attributes:null===e||void 0===e?void 0:e.attributes},a=new Zt({streamId:i,mimeType:r.mimeType,topic:r.topic,timestamp:Wa(r.timestamp),totalLength:Wa(null===e||void 0===e?void 0:e.totalSize),attributes:r.attributes,contentHeader:{case:"textHeader",value:new Yt({version:null===e||void 0===e?void 0:e.version,attachedStreamIds:null===e||void 0===e?void 0:e.attachedStreamIds,replyToStreamId:null===e||void 0===e?void 0:e.replyToStreamId,operationType:"update"===(null===e||void 0===e?void 0:e.type)?$t.UPDATE:$t.CREATE})}}),o=null===e||void 0===e?void 0:e.destinationIdentities,s=new Ot({destinationIdentities:o,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(s,xt.RELIABLE);let c=0;const l=this.engine,u=new WritableStream({write(e){return ui(this,void 0,void 0,function*(){for(const t of function(e,t){const n=[];let i=(new TextEncoder).encode(e);for(;i.length>t;){let e=t;for(;e>0;){const t=i[e];if(void 0!==t&&128!==(192&t))break;e--}n.push(i.slice(0,e)),i=i.slice(e)}return i.length>0&&n.push(i),n}(e,15e3)){yield l.waitForBufferStatusLow(xt.RELIABLE);const e=new en({content:t,streamId:i,chunkIndex:Wa(c)}),n=new Ot({destinationIdentities:o,value:{case:"streamChunk",value:e}});yield l.sendDataPacket(n,xt.RELIABLE),c+=1}})},close(){return ui(this,void 0,void 0,function*(){const e=new tn({streamId:i}),t=new Ot({destinationIdentities:o,value:{case:"streamTrailer",value:e}});yield l.sendDataPacket(t,xt.RELIABLE)})},abort(e){console.log("Sink error:",e)}});let d=()=>ui(this,void 0,void 0,function*(){yield h.close()});l.once(Ar.Closing,d);const h=new Us(u,r,()=>this.engine.off(Ar.Closing,d));return h})}sendFile(e,t){return ui(this,void 0,void 0,function*(){const n=crypto.randomUUID();return yield this._sendFile(n,e,t),{id:n}})}_sendFile(e,t,n){return ui(this,void 0,void 0,function*(){var i;const r=yield this.streamBytes({streamId:e,totalSize:t.size,name:t.name,mimeType:null!==(i=null===n||void 0===n?void 0:n.mimeType)&&void 0!==i?i:t.type,topic:null===n||void 0===n?void 0:n.topic,destinationIdentities:null===n||void 0===n?void 0:n.destinationIdentities}),a=t.stream().getReader();for(;;){const{done:e,value:t}=yield a.read();if(e)break;yield r.write(t)}return yield r.close(),r.info})}streamBytes(e){return ui(this,void 0,void 0,function*(){var t,n,i,r,a;const o=null!==(t=null===e||void 0===e?void 0:e.streamId)&&void 0!==t?t:crypto.randomUUID(),s=null===e||void 0===e?void 0:e.destinationIdentities,c={id:o,mimeType:null!==(n=null===e||void 0===e?void 0:e.mimeType)&&void 0!==n?n:"application/octet-stream",topic:null!==(i=null===e||void 0===e?void 0:e.topic)&&void 0!==i?i:"",timestamp:Date.now(),attributes:null===e||void 0===e?void 0:e.attributes,size:null===e||void 0===e?void 0:e.totalSize,name:null!==(r=null===e||void 0===e?void 0:e.name)&&void 0!==r?r:"unknown"},l=new Zt({totalLength:Wa(null!==(a=c.size)&&void 0!==a?a:0),mimeType:c.mimeType,streamId:o,topic:c.topic,timestamp:Wa(Date.now()),attributes:c.attributes,contentHeader:{case:"byteHeader",value:new Xt({name:c.name})}}),u=new Ot({destinationIdentities:s,value:{case:"streamHeader",value:l}});yield this.engine.sendDataPacket(u,xt.RELIABLE);let d=0;const h=new C,p=this.engine,f=this.log,m=new WritableStream({write(e){return ui(this,void 0,void 0,function*(){const t=yield h.lock();let n=0;try{for(;n<e.byteLength;){const t=e.slice(n,n+15e3);yield p.waitForBufferStatusLow(xt.RELIABLE);const i=new Ot({destinationIdentities:s,value:{case:"streamChunk",value:new en({content:t,streamId:o,chunkIndex:Wa(d)})}});yield p.sendDataPacket(i,xt.RELIABLE),d+=1,n+=t.byteLength}}finally{t()}})},close(){return ui(this,void 0,void 0,function*(){const e=new tn({streamId:o}),t=new Ot({destinationIdentities:s,value:{case:"streamTrailer",value:e}});yield p.sendDataPacket(t,xt.RELIABLE)})},abort(e){f.error("Sink error:",e)}});return new js(m,c)})}}class Bs extends ta{constructor(e,t,n,i,r){super(e,n,r),this.sid=t,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Lr.Muted:Lr.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=n=>{n.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Lr.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return ui(this,void 0,void 0,function*(){var e;if(!(null===(e=this.receiver)||void 0===e?void 0:e.getStats))return;return yield this.receiver.getStats()})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),is)),"undefined"!==typeof RTCRtpReceiver&&"getSynchronizationSources"in RTCRtpReceiver&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var t;this.timeSyncHandle=requestAnimationFrame(()=>e());const n=null===(t=this.receiver)||void 0===t?void 0:t.getSynchronizationSources()[0];if(n){const{timestamp:e,rtpTimestamp:t}=n;t&&this.rtpTimestamp!==t&&(this.emit(Lr.TimeSyncUpdate,{timestamp:e,rtpTimestamp:t}),this.rtpTimestamp=t)}};e()}}class zs extends Bs{constructor(e,t,n,i,r,a){super(e,t,ta.Kind.Audio,n,a),this.monitorReceiver=()=>ui(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=rs(e,this.prevStats)),this.prevStats=e}),this.audioContext=i,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var t;for(const n of this.attachedElements)this.audioContext?null===(t=this.gainNode)||void 0===t||t.gain.setTargetAtTime(e,0,.1):n.volume=e;Ea()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Ea())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return ui(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(ba(t))return t.setSinkId(e)}))})}attach(e){const t=0===this.attachedElements.length;return e?super.attach(e):e=super.attach(),this.sinkId&&ba(e)&&e.setSinkId(this.sinkId).catch(e=>{this.log.error("Failed to set sink id on remote audio track",e,this.logContext)}),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let n=this.sourceNode;this.webAudioPluginNodes.forEach(e=>{n.connect(e),n=e}),this.gainNode=e.createGain(),n.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),"running"!==e.state&&e.resume().then(()=>{"running"!==e.state&&this.emit(Lr.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(e=>{this.emit(Lr.AudioPlaybackFailed,e)})}disconnectWebAudio(){var e,t;null===(e=this.gainNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return ui(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;let e;return(yield this.receiver.getStats()).forEach(t=>{"inbound-rtp"===t.type&&(e={type:"audio",streamId:t.id,timestamp:t.timestamp,jitter:t.jitter,bytesReceived:t.bytesReceived,concealedSamples:t.concealedSamples,concealmentEvents:t.concealmentEvents,silentConcealedSamples:t.silentConcealedSamples,silentConcealmentEvents:t.silentConcealmentEvents,totalAudioEnergy:t.totalAudioEnergy,totalSamplesDuration:t.totalSamplesDuration})}),e})}}class Vs extends Bs{constructor(e,t,n,i,r){super(e,t,ta.Kind.Video,n,r),this.elementInfos=[],this.monitorReceiver=()=>ui(this,void 0,void 0,function*(){if(!this.receiver)return void(this._currentBitrate=0);const e=yield this.getReceiverStats();e&&this.prevStats&&this.receiver&&(this._currentBitrate=rs(e,this.prevStats)),this.prevStats=e}),this.debouncedHandleResize=Fo(()=>{this.updateDimensions()},100),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return void 0!==this.adaptiveStreamSettings}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?ia(this._mediaStreamTrack,t):na(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t.element===e)){const t=new qs(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&void 0===this.elementInfos.find(t=>t===e)?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream)return void this.log.warn("stopObservingElementInfo ignored",this.logContext);const t=this.elementInfos.filter(t=>t===e);for(const n of t)n.stopObserving();this.elementInfos=this.elementInfos.filter(t=>t!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const n of t)this.stopObservingElement(n);return t}getDecoderImplementation(){var e;return null===(e=this.prevStats)||void 0===e?void 0:e.decoderImplementation}getReceiverStats(){return ui(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,n="",i=new Map;return e.forEach(e=>{"inbound-rtp"===e.type?(n=e.codecId,t={type:"video",streamId:e.id,framesDecoded:e.framesDecoded,framesDropped:e.framesDropped,framesReceived:e.framesReceived,packetsReceived:e.packetsReceived,packetsLost:e.packetsLost,frameWidth:e.frameWidth,frameHeight:e.frameHeight,pliCount:e.pliCount,firCount:e.firCount,nackCount:e.nackCount,jitter:e.jitter,timestamp:e.timestamp,bytesReceived:e.bytesReceived,decoderImplementation:e.decoderImplementation}):"codec"===e.type&&i.set(e.id,e)}),t&&""!==n&&i.get(n)&&(t.mimeType=i.get(n).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(t=>t.element===e);for(const n of t)this.stopObservingElementInfo(n)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return ui(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,t;const n=this.elementInfos.reduce((e,t)=>Math.max(e,t.visibilityChangedAt||0),0),i=!(null!==(t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pauseVideoInBackground)&&void 0!==t&&!t)&&this.isInBackground,r=this.elementInfos.some(e=>e.pictureInPicture),a=this.elementInfos.some(e=>e.visible)&&!i||r;this.lastVisible!==a&&(!a&&Date.now()-n<100?Xr.setTimeout(()=>{this.updateVisibility()},100):(this.lastVisible=a,this.emit(Lr.VisibilityChanged,a,this)))}updateDimensions(){var e,t;let n=0,i=0;const r=this.getPixelDensity();for(const a of this.elementInfos){const e=a.width()*r,t=a.height()*r;e+t>n+i&&(n=e,i=t)}(null===(e=this.lastDimensions)||void 0===e?void 0:e.width)===n&&(null===(t=this.lastDimensions)||void 0===t?void 0:t.height)===i||(this.lastDimensions={width:n,height:i},this.emit(Lr.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=null===(e=this.adaptiveStreamSettings)||void 0===e?void 0:e.pixelDensity;if("screen"===t)return xa();if(!t){return xa()>2?2:1}return t}}class qs{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=e=>{var t;const{target:n,isIntersecting:i}=e;n===this.element&&(this.isIntersecting=i,this.isPiP=Hs(this.element),this.visibilityChangedAt=Date.now(),null===(t=this.handleVisibilityChanged)||void 0===t||t.call(this))},this.onEnterPiP=()=>{var e,t,n;null===(t=null===(e=window.documentPictureInPicture)||void 0===e?void 0:e.window)||void 0===t||t.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Hs(this.element),null===(n=this.handleVisibilityChanged)||void 0===n||n.call(this)},this.onLeavePiP=()=>{var e;this.isPiP=Hs(this.element),null===(e=this.handleVisibilityChanged)||void 0===e||e.call(this)},this.element=e,this.isIntersecting=null!==t&&void 0!==t?t:Ws(e),this.isPiP=wa()&&Hs(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,t,n;this.isIntersecting=Ws(this.element),this.isPiP=Hs(this.element),this.element.handleResize=()=>{var e;null===(e=this.handleResize)||void 0===e||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,La().observe(this.element),Ma().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),null===(e=window.documentPictureInPicture)||void 0===e||e.addEventListener("enter",this.onEnterPiP),null===(n=null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)||void 0===n||n.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,t,n,i,r;null===(e=La())||void 0===e||e.unobserve(this.element),null===(t=Ma())||void 0===t||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),null===(n=window.documentPictureInPicture)||void 0===n||n.removeEventListener("enter",this.onEnterPiP),null===(r=null===(i=window.documentPictureInPicture)||void 0===i?void 0:i.window)||void 0===r||r.removeEventListener("pagehide",this.onLeavePiP)}}function Hs(e){var t,n;return document.pictureInPictureElement===e||!!(null===(t=window.documentPictureInPicture)||void 0===t?void 0:t.window)&&Ws(e,null===(n=window.documentPictureInPicture)||void 0===n?void 0:n.window)}function Ws(e,t){const n=t||window;let i=e.offsetTop,r=e.offsetLeft;const a=e.offsetWidth,o=e.offsetHeight,{hidden:s}=e,{display:c}=getComputedStyle(e);for(;e.offsetParent;)i+=(e=e.offsetParent).offsetTop,r+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+a>n.pageXOffset&&!s&&"none"!==c}class Gs extends mi.EventEmitter{constructor(e,t,n,i){var r;super(),this.metadataMuted=!1,this.encryption=wt.NONE,this.log=ai,this.handleMuted=()=>{this.emit(Lr.Muted)},this.handleUnmuted=()=>{this.emit(Lr.Unmuted)},this.log=oi(null!==(r=null===i||void 0===i?void 0:i.loggerName)&&void 0!==r?r:ii.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=n,this.source=ta.Source.Unknown}setTrack(e){this.track&&(this.track.off(Lr.Muted,this.handleMuted),this.track.off(Lr.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Lr.Muted,this.handleMuted),e.on(Lr.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},null===(e=this.loggerContextCb)||void 0===e?void 0:e.call(this)),uo(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return void 0!==this.track}get isEncrypted(){return this.encryption!==wt.NONE}get audioTrack(){if(Ka(this.track))return this.track}get videoTrack(){if(Qa(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=ta.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===ta.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}!function(e){var t,n;(t=e.SubscriptionStatus||(e.SubscriptionStatus={})).Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",(n=e.PermissionStatus||(e.PermissionStatus={})).Allowed="allowed",n.NotAllowed="not_allowed"}(Gs||(Gs={}));class Ks extends Gs{get isUpstreamPaused(){var e;return null===(e=this.track)||void 0===e?void 0:e.isUpstreamPaused}constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Lr.Ended)},this.handleCpuConstrained=()=>{this.track&&Qa(this.track)&&this.emit(Lr.CpuConstrained,this.track)},this.updateInfo(t),this.setTrack(n)}setTrack(e){this.track&&(this.track.off(Lr.Ended,this.handleTrackEnded),this.track.off(Lr.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(Lr.Ended,this.handleTrackEnded),e.on(Lr.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return ui(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.mute()})}unmute(){return ui(this,void 0,void 0,function*(){var e;return null===(e=this.track)||void 0===e?void 0:e.unmute()})}pauseUpstream(){return ui(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.pauseUpstream()})}resumeUpstream(){return ui(this,void 0,void 0,function*(){var e;yield null===(e=this.track)||void 0===e?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Ka(this.track)){const t=this.track.getSourceTrackSettings(),n=new Set;return t.autoGainControl&&n.add(gt.TF_AUTO_GAIN_CONTROL),t.echoCancellation&&n.add(gt.TF_ECHO_CANCELLATION),t.noiseSuppression&&n.add(gt.TF_NOISE_SUPPRESSION),t.channelCount&&t.channelCount>1&&n.add(gt.TF_STEREO),(null===(e=this.options)||void 0===e?void 0:e.dtx)||n.add(gt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&n.add(gt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(n.values())}return[]}}function Qs(e,t){return ui(this,void 0,void 0,function*(){null!==e&&void 0!==e||(e={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:a}=ho(e);let o=a.audio,s=a.video;if(i&&"object"===typeof a.audio&&(a.audio.processor=i),r&&"object"===typeof a.video&&(a.video.processor=r),e.audio&&"object"===typeof a.audio&&"string"===typeof a.audio.deviceId){const e=a.audio.deviceId;a.audio.deviceId={exact:e},n=!0,o=Object.assign(Object.assign({},a.audio),{deviceId:{ideal:e}})}if(a.video&&"object"===typeof a.video&&"string"===typeof a.video.deviceId){const e=a.video.deviceId;a.video.deviceId={exact:e},n=!0,s=Object.assign(Object.assign({},a.video),{deviceId:{ideal:e}})}(!0===a.audio||"object"===typeof a.audio&&!a.audio.deviceId)&&(a.audio={deviceId:"default"}),!0===a.video?a.video={deviceId:"default"}:"object"!==typeof a.video||a.video.deviceId||(a.video.deviceId="default");const c=eo(a,Qo,Jo),l=no(c),u=navigator.mediaDevices.getUserMedia(l);a.audio&&(go.userMediaPromiseMap.set("audioinput",u),u.catch(()=>go.userMediaPromiseMap.delete("audioinput"))),a.video&&(go.userMediaPromiseMap.set("videoinput",u),u.catch(()=>go.userMediaPromiseMap.delete("videoinput")));try{const e=yield u;return yield Promise.all(e.getTracks().map(n=>ui(this,void 0,void 0,function*(){const a="audio"===n.kind;let o,s=a?c.audio:c.video;"boolean"!==typeof s&&s||(s={});const u=a?l.audio:l.video;"boolean"!==typeof u&&(o=u);const d=n.getSettings().deviceId;(null===o||void 0===o?void 0:o.deviceId)&&za(o.deviceId)!==d?o.deviceId=d:o||(o={deviceId:d});const h=function(e,t,n){switch(e.kind){case"audio":return new ls(e,t,!1,void 0,n);case"video":return new Ss(e,t,!1,n);default:throw new Fr("unsupported track type: ".concat(e.kind))}}(n,o,t);return h.kind===ta.Kind.Video?h.source=ta.Source.Camera:h.kind===ta.Kind.Audio&&(h.source=ta.Source.Microphone),h.mediaStream=e,Ka(h)&&i?yield h.setProcessor(i):Qa(h)&&r&&(yield h.setProcessor(r)),h})))}catch(S){if(!n)throw S;return Qs(Object.assign(Object.assign({},e),{audio:o,video:s}),t)}})}function Js(e){return ui(this,void 0,void 0,function*(){return(yield Qs({audio:null===e||void 0===e||e,video:!1}))[0]})}var $s,Ys;!function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"}($s||($s={}));class Xs extends mi.EventEmitter{get logContext(){var e,t;return Object.assign({},null===(t=null===(e=this.loggerOptions)||void 0===e?void 0:e.loggerContextCb)||void 0===t?void 0:t.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return(null===(e=this.permissions)||void 0===e?void 0:e.agent)||this.kind===Tt.AGENT}get isActive(){var e;return(null===(e=this.participantInfo)||void 0===e?void 0:e.state)===St.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,t,n,i,r,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Tt.STANDARD;var s;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=$s.Unknown,this.log=ai,this.log=oi(null!==(s=null===a||void 0===a?void 0:a.loggerName)&&void 0!==s?s:ii.Participant),this.loggerOptions=a,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=n,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=o,this._attributes=null!==r&&void 0!==r?r:{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,t]of this.trackPublications)if(t.source===e)return t}getTrackPublicationByName(e){for(const[,t]of this.trackPublications)if(t.trackName===e)return t}waitUntilActive(){return this.isActive?Promise.resolve():(this.activeFuture||(this.activeFuture=new Ba,this.once(Mr.Active,()=>{var e,t;null===(t=null===(e=this.activeFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.activeFuture=void 0})),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrackPublication(ta.Source.Camera);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isMicrophoneEnabled(){var e;const t=this.getTrackPublication(ta.Source.Microphone);return!(null===(e=null===t||void 0===t?void 0:t.isMuted)||void 0===e||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(ta.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(1e3*Number.parseInt(this.participantInfo.joinedAt.toString())):new Date}updateInfo(e){var t;return!(this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version)&&(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===St.ACTIVE&&(null===(t=this.participantInfo)||void 0===t?void 0:t.state)!==St.ACTIVE&&this.emit(Mr.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const t=this.metadata!==e,n=this.metadata;this.metadata=e,t&&this.emit(Mr.ParticipantMetadataChanged,n)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(Mr.ParticipantNameChanged,e)}_setAttributes(e){const t=function(e,t){var n;void 0===e&&(e={}),void 0===t&&(t={});const i=[...Object.keys(t),...Object.keys(e)],r={};for(const a of i)e[a]!==t[a]&&(r[a]=null!==(n=t[a])&&void 0!==n?n:"");return r}(this.attributes,e);this._attributes=e,Object.keys(t).length>0&&this.emit(Mr.AttributesChanged,t)}setPermissions(e){var t,n,i,r,a,o;const s=this.permissions,c=e.canPublish!==(null===(t=this.permissions)||void 0===t?void 0:t.canPublish)||e.canSubscribe!==(null===(n=this.permissions)||void 0===n?void 0:n.canSubscribe)||e.canPublishData!==(null===(i=this.permissions)||void 0===i?void 0:i.canPublishData)||e.hidden!==(null===(r=this.permissions)||void 0===r?void 0:r.hidden)||e.recorder!==(null===(a=this.permissions)||void 0===a?void 0:a.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((e,t)=>{var n;return e!==(null===(n=this.permissions)||void 0===n?void 0:n.canPublishSources[t])})||e.canSubscribeMetrics!==(null===(o=this.permissions)||void 0===o?void 0:o.canSubscribeMetrics);return this.permissions=e,c&&this.emit(Mr.ParticipantPermissionsChanged,s),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(Mr.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=function(e){switch(e){case dt.EXCELLENT:return $s.Excellent;case dt.GOOD:return $s.Good;case dt.POOR:return $s.Poor;case dt.LOST:return $s.Lost;default:return $s.Unknown}}(e),t!==this._connectionQuality&&this.emit(Mr.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,t;this.activeFuture&&(null===(t=(e=this.activeFuture).reject)||void 0===t||t.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(t=>Ka(t.track)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(Lr.Muted,()=>{this.emit(Mr.TrackMuted,e)}),e.on(Lr.Unmuted,()=>{this.emit(Mr.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case ta.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case ta.Kind.Video:this.videoTrackPublications.set(e.trackSid,e)}}}class Zs extends Xs{constructor(e,t,n,i,r,a){super(e,t,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=wt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Ba)},this.handleReconnected=()=>{var e,t;null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.resolve)||void 0===t||t.call(e),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var e,t,n,i,r,a;this.reconnectFuture&&(this.reconnectFuture.promise.catch(e=>this.log.warn(e.message,this.logContext)),null===(t=null===(e=this.reconnectFuture)||void 0===e?void 0:e.reject)||void 0===t||t.call(e,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&(null===(i=(n=this.signalConnectedFuture).reject)||void 0===i||i.call(n,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),null===(a=null===(r=this.activeAgentFuture)||void 0===r?void 0:r.reject)||void 0===a||a.call(r,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=e=>{var t,n;e.participant&&this.updateInfo(e.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Ba),null===(n=(t=this.signalConnectedFuture).resolve)||void 0===n||n.call(t)},this.handleSignalRequestResponse=e=>{const{requestId:t,reason:n,message:i}=e,r=this.pendingSignalRequests.get(t);r&&(n!==$n.OK&&r.reject(new Hr(i,n)),this.pendingSignalRequests.delete(t))},this.handleDataPacket=e=>{switch(e.value.case){case"rpcResponse":let t=e.value.value,n=null,i=null;"payload"===t.value.case?n=t.value.value:"error"===t.value.case&&(i=es.fromProto(t.value.value)),this.handleIncomingRpcResponse(t.requestId,n,i);break;case"rpcAck":let r=e.value.value;this.handleIncomingRpcAck(r.requestId)}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(e=>function(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Ln({participantIdentity:null!==(t=e.participantIdentity)&&void 0!==t?t:"",participantSid:null!==(n=e.participantSid)&&void 0!==n?n:"",allTracks:null!==(i=e.allowAll)&&void 0!==i&&i,trackSids:e.allowedTrackSids||[]})}(e)))},this.onTrackUnmuted=e=>{this.onTrackMuted(e,e.isUpstreamPaused)},this.onTrackMuted=(e,t)=>{void 0===t&&(t=!0),e.sid?this.engine.updateMuteStatus(e.sid,t):this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),uo(e)))},this.onTrackUpstreamPaused=e=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),uo(e))),this.onTrackMuted(e,!0)},this.onTrackUpstreamResumed=e=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),uo(e))),this.onTrackMuted(e,e.isMuted)},this.onTrackFeatureUpdate=e=>{const t=this.audioTrackPublications.get(e.sid);t?this.engine.client.sendUpdateLocalAudioTrack(t.trackSid,t.getTrackFeatures()):this.log.warn("Could not update local audio track settings, missing publication for track ".concat(e.sid),this.logContext)},this.onTrackCpuConstrained=(e,t)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),uo(t))),this.emit(Mr.LocalTrackCpuConstrained,e,t)},this.handleSubscribedQualityUpdate=e=>ui(this,void 0,void 0,function*(){var t,n,i,r,a;if(!(null===(a=this.roomOptions)||void 0===a?void 0:a.dynacast))return;const o=this.videoTrackPublications.get(e.trackSid);if(!o)return void this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}));if(!o.videoTrack)return;const s=yield o.videoTrack.setPublishingCodecs(e.subscribedCodecs);try{for(var c,l=!0,u=hi(s);!(t=(c=yield u.next()).done);l=!0){r=c.value,l=!1;const e=r;sa(e)&&(this.log.debug("publish ".concat(e," for ").concat(o.videoTrack.sid),Object.assign(Object.assign({},this.logContext),uo(o))),yield this.publishAdditionalCodecForTrack(o.videoTrack,e,o.options))}}catch(d){n={error:d}}finally{try{l||t||!(i=u.return)||(yield i.call(u))}finally{if(n)throw n.error}}}),this.handleLocalTrackUnpublished=e=>{const t=this.trackPublications.get(e.trackSid);t?this.unpublishTrack(t.track):this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:e.trackSid}))},this.handleTrackEnded=e=>ui(this,void 0,void 0,function*(){if(e.source===ta.Source.ScreenShare||e.source===ta.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),uo(e))),this.unpublishTrack(e);else if(e.isUserProvided)yield e.mute();else if($a(e)||Ja(e))try{if(wa())try{const t=yield null===navigator||void 0===navigator?void 0:navigator.permissions.query({name:e.source===ta.Source.Camera?"camera":"microphone"});if(t&&"denied"===t.state)throw this.log.warn("user has revoked access to ".concat(e.source),Object.assign(Object.assign({},this.logContext),uo(e))),t.onchange=()=>{"denied"!==t.state&&(e.isMuted||e.restartTrack(),t.onchange=null)},new Error("GetUserMedia Permission denied")}catch(S){}e.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),uo(e))),$a(e)?yield e.restartTrack({deviceId:"default"}):yield e.restartTrack())}catch(S){this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),uo(e))),yield e.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=n,this.roomOptions=i,this.setupEngine(n),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=r,this.roomOutgoingDataStreamManager=a}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==wt.NONE}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setupEngine(e){var t;this.engine=e,this.engine.on(Ar.RemoteMute,(e,t)=>{const n=this.trackPublications.get(e);n&&n.track&&(t?n.mute():n.unmute())}),(null===(t=this.signalConnectedFuture)||void 0===t?void 0:t.isResolved)&&(this.signalConnectedFuture=void 0),this.engine.on(Ar.Connected,this.handleReconnected).on(Ar.SignalConnected,this.handleSignalConnected).on(Ar.SignalRestarted,this.handleReconnected).on(Ar.SignalResumed,this.handleReconnected).on(Ar.Restarting,this.handleReconnecting).on(Ar.Resuming,this.handleReconnecting).on(Ar.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(Ar.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(Ar.Closing,this.handleClosing).on(Ar.SignalRequestResponse,this.handleSignalRequestResponse).on(Ar.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return ui(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return ui(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return ui(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return ui(this,arguments,void 0,function(e){var t=this;let{metadata:n,name:i,attributes:r}=e;return function*(){return new Promise((e,a)=>ui(t,void 0,void 0,function*(){var t,o;try{let s=!1;const c=yield this.engine.client.sendUpdateLocalMetadata(null!==(t=null!==n&&void 0!==n?n:this.metadata)&&void 0!==t?t:"",null!==(o=null!==i&&void 0!==i?i:this.name)&&void 0!==o?o:"",r),l=performance.now();for(this.pendingSignalRequests.set(c,{resolve:e,reject:e=>{a(e),s=!0},values:{name:i,metadata:n,attributes:r}});performance.now()-l<5e3&&!s;){if((!i||this.name===i)&&(!n||this.metadata===n)&&(!r||Object.entries(r).every(e=>{let[t,n]=e;return this.attributes[t]===n||""===n&&!this.attributes[t]})))return this.pendingSignalRequests.delete(c),void e();yield fa(50)}a(new Hr("Request to update local metadata timed out","TimeoutError"))}catch(S){S instanceof Error&&a(S)}}))}()})}setCameraEnabled(e,t,n){return this.setTrackEnabled(ta.Source.Camera,e,t,n)}setMicrophoneEnabled(e,t,n){return this.setTrackEnabled(ta.Source.Microphone,e,t,n)}setScreenShareEnabled(e,t,n){return this.setTrackEnabled(ta.Source.ScreenShare,e,t,n)}setPermissions(e){const t=this.permissions,n=super.setPermissions(e);return n&&t&&this.emit(Mr.ParticipantPermissionsChanged,t),n}setE2EEEnabled(e){return ui(this,void 0,void 0,function*(){this.encryptionType=e?wt.GCM:wt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,n,i){return ui(this,void 0,void 0,function*(){var r,a;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t})),this.republishPromise&&(yield this.republishPromise);let o=this.getTrackPublication(e);if(t)if(o)yield o.unmute();else{let t;if(this.pendingPublishing.has(e)){const t=yield this.waitForPendingPublicationOfSource(e);return t||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield null===t||void 0===t?void 0:t.unmute(),t}this.pendingPublishing.add(e);try{switch(e){case ta.Source.Camera:t=yield this.createTracks({video:null===(r=n)||void 0===r||r});break;case ta.Source.Microphone:t=yield this.createTracks({audio:null===(a=n)||void 0===a||a});break;case ta.Source.ScreenShare:t=yield this.createScreenTracks(Object.assign({},n));break;default:throw new Fr(e)}}catch(S){throw null===t||void 0===t||t.forEach(e=>{e.stop()}),S instanceof Error&&this.emit(Mr.MediaDevicesError,S,oo(e)),this.pendingPublishing.delete(e),S}for(const i of t){const t=Object.assign(Object.assign({},this.roomOptions.publishDefaults),n);e===ta.Source.Microphone&&Ka(i)&&t.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),i.startPreConnectBuffer())}try{const e=[];for(const r of t)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),uo(r))),e.push(this.publishTrack(r,i));const n=yield Promise.all(e);[o]=n}catch(S){throw null===t||void 0===t||t.forEach(e=>{e.stop()}),S}finally{this.pendingPublishing.delete(e)}}else if(!(null===o||void 0===o?void 0:o.track)&&this.pendingPublishing.has(e)&&(o=yield this.waitForPendingPublicationOfSource(e),o||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),o&&o.track)if(e===ta.Source.ScreenShare){o=yield this.unpublishTrack(o.track);const e=this.getTrackPublication(ta.Source.ScreenShareAudio);e&&e.track&&this.unpublishTrack(e.track)}else yield o.mute();return o})}enableCameraAndMicrophone(){return ui(this,void 0,void 0,function*(){if(!this.pendingPublishing.has(ta.Source.Camera)&&!this.pendingPublishing.has(ta.Source.Microphone)){this.pendingPublishing.add(ta.Source.Camera),this.pendingPublishing.add(ta.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(e=>this.publishTrack(e)))}finally{this.pendingPublishing.delete(ta.Source.Camera),this.pendingPublishing.delete(ta.Source.Microphone)}}})}createTracks(e){return ui(this,void 0,void 0,function*(){var t,n;null!==e&&void 0!==e||(e={});const i=eo(e,null===(t=this.roomOptions)||void 0===t?void 0:t.audioCaptureDefaults,null===(n=this.roomOptions)||void 0===n?void 0:n.videoCaptureDefaults);try{const e=yield Qs(i,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return e.map(e=>(Ka(e)&&(this.microphoneError=void 0,e.setAudioContext(this.audioContext),e.source=ta.Source.Microphone,this.emit(Mr.AudioStreamAcquired)),Qa(e)&&(this.cameraError=void 0,e.source=ta.Source.Camera),e))}catch(r){throw r instanceof Error&&(e.audio&&(this.microphoneError=r),e.video&&(this.cameraError=r)),r}})}createScreenTracks(e){return ui(this,void 0,void 0,function*(){if(void 0===e&&(e={}),void 0===navigator.mediaDevices.getDisplayMedia)throw new jr("getDisplayMedia not supported");void 0!==e.resolution||Ta()||(e.resolution=ha.h1080fps30.resolution);const t=so(e),n=yield navigator.mediaDevices.getDisplayMedia(t),i=n.getVideoTracks();if(0===i.length)throw new Fr("no video track found");const r=new Ss(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=ta.Source.ScreenShare,e.contentHint&&(r.mediaStreamTrack.contentHint=e.contentHint);const a=[r];if(n.getAudioTracks().length>0){this.emit(Mr.AudioStreamAcquired);const e=new ls(n.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e.source=ta.Source.ScreenShareAudio,a.push(e)}return a})}publishTrack(e,t){return ui(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,t)})}publishOrRepublishTrack(e,t){return ui(this,arguments,void 0,function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function*(){var r,a,o,s;let c,l;if($a(e)&&e.setAudioContext(n.audioContext),yield null===(r=n.reconnectFuture)||void 0===r?void 0:r.promise,n.republishPromise&&!i&&(yield n.republishPromise),Ga(e)&&n.pendingPublishPromises.has(e)&&(yield n.pendingPublishPromises.get(e)),e instanceof MediaStreamTrack)c=e.getConstraints();else{let t;switch(c=e.constraints,e.source){case ta.Source.Microphone:t="audioinput";break;case ta.Source.Camera:t="videoinput"}t&&n.activeDeviceMap.has(t)&&(c=Object.assign(Object.assign({},c),{deviceId:n.activeDeviceMap.get(t)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new ls(e,c,!0,n.audioContext,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;case"video":e=new Ss(e,c,!0,{loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});break;default:throw new Fr("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:n.roomOptions.loggerName,loggerContextCb:()=>n.logContext});if(n.trackPublications.forEach(t=>{t.track&&t.track===e&&(l=t)}),l)return n.log.warn("track has already been published, skipping",Object.assign(Object.assign({},n.logContext),uo(l))),l;const u="channelCount"in e.mediaStreamTrack.getSettings()&&2===e.mediaStreamTrack.getSettings().channelCount||2===e.mediaStreamTrack.getConstraints().channelCount,d=null!==(a=null===t||void 0===t?void 0:t.forceStereo)&&void 0!==a?a:u;d&&(t||(t={}),void 0===t.dtx&&n.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},n.logContext),uo(e))),void 0===t.red&&n.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),null!==(o=t.dtx)&&void 0!==o||(t.dtx=!1),null!==(s=t.red)&&void 0!==s||(t.red=!1));const h=Object.assign(Object.assign({},n.roomOptions.publishDefaults),t);!function(){const e=Qr(),t="17.2";if(e)return"Safari"!==e.name&&"iOS"!==e.os||!!("iOS"===e.os&&e.osVersion&&Ia(t,e.osVersion)>=0)||"Safari"===e.name&&Ia(t,e.version)>=0}()&&n.roomOptions.e2ee&&(n.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},n.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const p=new Promise((t,i)=>ui(n,void 0,void 0,function*(){try{if(this.engine.client.currentState!==So.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:uo(e)}));const n=setTimeout(()=>{i(new qr("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(n);const r=yield this.publish(e,h,d);t(r)}else try{const n=yield this.publish(e,h,d);t(n)}catch(S){i(S)}}catch(S){i(S)}}));n.pendingPublishPromises.set(e,p);try{return yield p}catch(S){throw S}finally{n.pendingPublishPromises.delete(e)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Ba),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),uo(e))),!1;const{canPublish:t,canPublishSources:n}=this.permissions;return!(!t||0!==n.length&&!n.map(e=>function(e){switch(e){case lt.CAMERA:return ta.Source.Camera;case lt.MICROPHONE:return ta.Source.Microphone;case lt.SCREEN_SHARE:return ta.Source.ScreenShare;case lt.SCREEN_SHARE_AUDIO:return ta.Source.ScreenShareAudio;default:return ta.Source.Unknown}}(e)).includes(e.source))||(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),uo(e))),!1)}publish(e,t,n){return ui(this,void 0,void 0,function*(){var i,r,a,o,s,c,l,u,d,h;if(!this.hasPermissionsToPublish(e))throw new qr("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(t=>Ga(e)&&t.source===e.source)&&e.source!==ta.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),uo(e))),t.stopMicTrackOnMute&&Ka(e)&&(e.stopOnMute=!0),e.source===ta.Source.ScreenShare&&ya()&&(t.simulcast=!1),"av1"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(ka())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/AV1"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),"vp9"!==t.videoCodec||function(){if(!("getCapabilities"in RTCRtpSender))return!1;if(ya())return!1;if(ka()){const e=Qr();if((null===e||void 0===e?void 0:e.version)&&Ia(e.version,"16")<0)return!1;if("iOS"===(null===e||void 0===e?void 0:e.os)&&(null===e||void 0===e?void 0:e.osVersion)&&Ia(e.osVersion,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e)for(const n of e.codecs)if("video/VP9"===n.mimeType){t=!0;break}return t}()||(t.videoCodec=void 0),void 0===t.videoCodec&&(t.videoCodec=Go),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(e=>t.videoCodec===co(e.mime))||(t.videoCodec=co(this.enabledPublishVideoCodecs[0].mime)));const p=t.videoCodec;e.on(Lr.Muted,this.onTrackMuted),e.on(Lr.Unmuted,this.onTrackUnmuted),e.on(Lr.Ended,this.handleTrackEnded),e.on(Lr.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Lr.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Lr.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const f=[],m=!(null===(i=t.dtx)||void 0===i||i),g=e.getSourceTrackSettings();g.autoGainControl&&f.push(gt.TF_AUTO_GAIN_CONTROL),g.echoCancellation&&f.push(gt.TF_ECHO_CANCELLATION),g.noiseSuppression&&f.push(gt.TF_NOISE_SUPPRESSION),g.channelCount&&g.channelCount>1&&f.push(gt.TF_STEREO),m&&f.push(gt.TF_NO_DTX),$a(e)&&e.hasPreConnectBuffer&&f.push(gt.TF_PRECONNECT_BUFFER);const v=new ln({cid:e.mediaStreamTrack.id,name:t.name,type:ta.kindToProto(e.kind),muted:e.isMuted,source:ta.sourceToProto(e.source),disableDtx:m,encryption:this.encryptionType,stereo:n,disableRed:this.isE2EEEnabled||!(null===(r=t.red)||void 0===r||r),stream:null===t||void 0===t?void 0:t.stream,backupCodecPolicy:null===t||void 0===t?void 0:t.backupCodecPolicy,audioFeatures:f});let b;if(e.kind===ta.Kind.Video){let n={width:0,height:0};try{n=yield e.waitForDimensions()}catch(S){const i=null!==(o=null===(a=this.roomOptions.videoCaptureDefaults)||void 0===a?void 0:a.resolution)&&void 0!==o?o:ua.h720.resolution;n={width:i.width,height:i.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),uo(e)),{dims:n}))}v.width=n.width,v.height=n.height,Ja(e)&&(va(p)&&(e.source===ta.Source.ScreenShare&&(t.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),uo(e))))),t.scalabilityMode=null!==(s=t.scalabilityMode)&&void 0!==s?s:"L3T3_KEY"),v.simulcastCodecs=[new cn({codec:p,cid:e.mediaStreamTrack.id})],!0===t.backupCodec&&(t.backupCodec={codec:Go}),t.backupCodec&&p!==t.backupCodec.codec&&v.encryption===wt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),v.simulcastCodecs.push(new cn({codec:t.backupCodec.codec,cid:""})))),b=gs(e.source===ta.Source.ScreenShare,v.width,v.height,t),v.layers=ws(v.width,v.height,b,va(t.videoCodec))}else e.kind===ta.Kind.Audio&&(b=[{maxBitrate:null===(c=t.audioPreset)||void 0===c?void 0:c.maxBitrate,priority:null!==(u=null===(l=t.audioPreset)||void 0===l?void 0:l.priority)&&void 0!==u?u:"high",networkPriority:null!==(h=null===(d=t.audioPreset)||void 0===d?void 0:d.priority)&&void 0!==h?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new zr("cannot publish track when not connected");const y=()=>ui(this,void 0,void 0,function*(){var n,i,r;if(!this.engine.pcManager)throw new zr("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,t,b),this.emit(Mr.LocalSenderCreated,e.sender,e),Ja(e)&&(null!==(n=t.degradationPreference)&&void 0!==n||(t.degradationPreference=function(e){return e.source===ta.Source.ScreenShare||e.constraints.height&&za(e.constraints.height)>=1080?"maintain-resolution":"balanced"}(e)),e.setDegradationPreference(t.degradationPreference)),b)if(ya()&&e.kind===ta.Kind.Audio){let t;for(const n of this.engine.pcManager.publisher.getTransceivers())if(n.sender===e.sender){t=n;break}t&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:t,codec:"opus",maxbr:(null===(i=b[0])||void 0===i?void 0:i.maxBitrate)?b[0].maxBitrate/1e3:0})}else e.codec&&va(e.codec)&&(null===(r=b[0])||void 0===r?void 0:r.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:v.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});yield this.engine.negotiate()});let k;const T=new Promise((t,n)=>ui(this,void 0,void 0,function*(){var i;try{k=yield this.engine.addTrack(v),t(k)}catch(r){e.sender&&(null===(i=this.engine.pcManager)||void 0===i?void 0:i.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(t=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),uo(e)),{error:t}))})),n(r)}}));if(this.enabledPublishVideoCodecs.length>0){const e=yield Promise.all([T,y()]);k=e[0]}else{let n;if(k=yield T,k.codecs.forEach(e=>{void 0===n&&(n=e.mimeType)}),n&&e.kind===ta.Kind.Video){const i=co(n);i!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),uo(e)),{codec:i})),t.videoCodec=i,b=gs(e.source===ta.Source.ScreenShare,v.width,v.height,t))}yield y()}const C=new Ks(e.kind,k,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(C.on(Lr.CpuConstrained,e=>this.onTrackCpuConstrained(e,C)),C.options=t,e.sid=k.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:k})),Ja(e)?e.startMonitor(this.engine.client):$a(e)&&e.startMonitor(),this.addTrackPublication(C),this.emit(Mr.LocalTrackPublished,C),$a(e)&&k.audioFeatures.includes(gt.TF_PRECONNECT_BUFFER)){const t=e.getPreConnectBuffer(),n=e.getPreConnectBufferMimeType();if(this.on(Mr.LocalTrackSubscribed,t=>{if(t.trackSid===k.sid){if(!e.hasPreConnectBuffer)return void this.log.warn("subscribe event came to late, buffer already closed",this.logContext);this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),uo(e))),e.stopPreConnectBuffer()}}),t){const i=new Promise((i,r)=>ui(this,void 0,void 0,function*(){var a,o,s,c,l,u;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),uo(e)));const m=setTimeout(()=>{r(new Error("agent not active within 10 seconds"))},1e4),v=yield this.waitUntilActiveAgentPresent();clearTimeout(m),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),uo(e)));const b=yield this.streamBytes({name:"preconnect-buffer",mimeType:n,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[v.identity],attributes:{trackId:C.trackSid,sampleRate:String(null!==(l=g.sampleRate)&&void 0!==l?l:"48000"),channels:String(null!==(u=g.channelCount)&&void 0!==u?u:"1")}});try{for(var d,h=!0,p=hi(t);!(a=(d=yield p.next()).done);h=!0){c=d.value,h=!1;const e=c;yield b.write(e)}}catch(f){o={error:f}}finally{try{h||a||!(s=p.return)||(yield s.call(p))}finally{if(o)throw o.error}}yield b.close(),i()}catch(S){r(S)}}));i.then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),uo(e)))}).catch(t=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),uo(e)),{error:t}))})}}return C})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,n){return ui(this,void 0,void 0,function*(){var i;if(this.encryptionType!==wt.NONE)return;let r;if(this.trackPublications.forEach(t=>{t.track&&t.track===e&&(r=t)}),!r)throw new Fr("track is not published");if(!Ja(e))throw new Fr("track is not a video track");const a=Object.assign(Object.assign({},null===(i=this.roomOptions)||void 0===i?void 0:i.publishDefaults),n),o=function(e,t,n){var i,r,a,o;if(!n.backupCodec||!0===n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&ai.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const s=e.mediaStreamTrack.getSettings(),c=null!==(i=s.width)&&void 0!==i?i:null===(r=e.dimensions)||void 0===r?void 0:r.width,l=null!==(a=s.height)&&void 0!==a?a:null===(o=e.dimensions)||void 0===o?void 0:o.height;return e.source===ta.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),gs(e.source===ta.Source.ScreenShare,c,l,n)}(e,t,a);if(!o)return void this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),uo(e)));const s=e.addSimulcastTrack(t,o);if(!s)return;const c=new ln({cid:s.mediaStreamTrack.id,type:ta.kindToProto(e.kind),muted:e.isMuted,source:ta.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:a.videoCodec,cid:s.mediaStreamTrack.id}]});if(c.layers=ws(c.width,c.height,o),!this.engine||this.engine.isClosed)throw new zr("cannot publish track when not connected");const l=(yield Promise.all([this.engine.addTrack(c),(()=>ui(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,s,a,o),yield this.engine.negotiate()}))()]))[0];this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:o,trackInfo:l}))})}unpublishTrack(e,t){return ui(this,void 0,void 0,function*(){var n,i;if(Ga(e)){const t=this.pendingPublishPromises.get(e);t&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),uo(e))),yield t)}const r=this.getPublicationForTrack(e),a=r?uo(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!r||!r.track)return void this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));(e=r.track).off(Lr.Muted,this.onTrackMuted),e.off(Lr.Unmuted,this.onTrackUnmuted),e.off(Lr.Ended,this.handleTrackEnded),e.off(Lr.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Lr.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Lr.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),void 0===t&&(t=null===(i=null===(n=this.roomOptions)||void 0===n?void 0:n.stopLocalTrackOnUnpublish)||void 0===i||i),t?e.stop():e.stopMonitor();let o=!1;const s=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Xo.FAILED&&s)try{for(const e of this.engine.pcManager.publisher.getTransceivers())e.sender===s&&(e.direction="inactive",o=!0);if(this.engine.removeTrack(s)&&(o=!0),Ja(e)){for(const[,t]of e.simulcastCodecs)t.sender&&(this.engine.removeTrack(t.sender)&&(o=!0),t.sender=void 0);e.simulcastCodecs.clear()}}catch(S){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:S}))}switch(this.trackPublications.delete(r.trackSid),r.kind){case ta.Kind.Audio:this.audioTrackPublications.delete(r.trackSid);break;case ta.Kind.Video:this.videoTrackPublications.delete(r.trackSid)}return this.emit(Mr.LocalTrackUnpublished,r),r.setTrack(void 0),o&&(yield this.engine.negotiate()),r})}unpublishTracks(e){return ui(this,void 0,void 0,function*(){return(yield Promise.all(e.map(e=>this.unpublishTrack(e)))).filter(e=>!!e)})}republishAllTracks(e){return ui(this,arguments,void 0,function(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){t.republishPromise&&(yield t.republishPromise),t.republishPromise=new Promise((i,r)=>ui(t,void 0,void 0,function*(){try{const t=[];this.trackPublications.forEach(n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),t.push(n))}),yield Promise.all(t.map(e=>ui(this,void 0,void 0,function*(){const t=e.track;yield this.unpublishTrack(t,!1),!n||t.isMuted||t.source===ta.Source.ScreenShare||t.source===ta.Source.ScreenShareAudio||!$a(t)&&!Ja(t)||t.isUserProvided||(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:e.trackSid})),yield t.restartTrack()),yield this.publishOrRepublishTrack(t,e.options,!0)}))),i()}catch(t){r(t)}finally{this.republishPromise=void 0}})),yield t.republishPromise}()})}publishData(e){return ui(this,arguments,void 0,function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){const i=n.reliable?xt.RELIABLE:xt.LOSSY,r=n.destinationIdentities,a=n.topic,o=new Ot({kind:i,value:{case:"user",value:new Nt({participantIdentity:t.identity,payload:e,destinationIdentities:r,topic:a})}});yield t.engine.sendDataPacket(o,i)}()})}publishDtmf(e,t){return ui(this,void 0,void 0,function*(){const n=new Ot({kind:xt.RELIABLE,value:{case:"sipDtmf",value:new Dt({code:e,digit:t})}});yield this.engine.sendDataPacket(n,xt.RELIABLE)})}sendChatMessage(e,t){return ui(this,void 0,void 0,function*(){const n={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:null===t||void 0===t?void 0:t.attachments},i=new Ot({value:{case:"chatMessage",value:new Lt(Object.assign(Object.assign({},n),{timestamp:W.parse(n.timestamp)}))}});return yield this.engine.sendDataPacket(i,xt.RELIABLE),this.emit(Mr.ChatMessage,n),n})}editChatMessage(e,t){return ui(this,void 0,void 0,function*(){const n=Object.assign(Object.assign({},t),{message:e,editTimestamp:Date.now()}),i=new Ot({value:{case:"chatMessage",value:new Lt(Object.assign(Object.assign({},n),{timestamp:W.parse(n.timestamp),editTimestamp:W.parse(n.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,xt.RELIABLE),this.emit(Mr.ChatMessage,n),n})}sendText(e,t){return ui(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,t)})}streamText(e){return ui(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,t){return ui(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,t)})}streamBytes(e){return ui(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return ui(this,arguments,void 0,function(e){var t=this;let{destinationIdentity:n,method:i,payload:r,responseTimeout:a=1e4}=e;return function*(){return new Promise((e,o)=>ui(t,void 0,void 0,function*(){var t,s,c,l;if(ts(r)>15360)return void o(es.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));if((null===(s=null===(t=this.engine.latestJoinResponse)||void 0===t?void 0:t.serverInfo)||void 0===s?void 0:s.version)&&Ia(null===(l=null===(c=this.engine.latestJoinResponse)||void 0===c?void 0:c.serverInfo)||void 0===l?void 0:l.version,"1.8.0")<0)return void o(es.builtIn("UNSUPPORTED_SERVER"));const u=crypto.randomUUID();yield this.publishRpcRequest(n,u,i,r,a-2e3);const d=setTimeout(()=>{this.pendingAcks.delete(u),o(es.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(u),clearTimeout(h)},2e3);this.pendingAcks.set(u,{resolve:()=>{clearTimeout(d)},participantIdentity:n});const h=setTimeout(()=>{this.pendingResponses.delete(u),o(es.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(u,{resolve:(t,n)=>{clearTimeout(h),this.pendingAcks.has(u)&&(console.warn("RPC response received before ack",u),this.pendingAcks.delete(u),clearTimeout(d)),n?o(n):e(null!==t&&void 0!==t?t:"")},participantIdentity:n})}))}()})}registerRpcMethod(e,t){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const t=this.pendingAcks.get(e);t?(t.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,t,n){const i=this.pendingResponses.get(e);i?(i.resolve(t,n),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,t,n,i,r){return ui(this,void 0,void 0,function*(){const a=new Ot({destinationIdentities:[e],kind:xt.RELIABLE,value:{case:"rpcRequest",value:new Ut({id:t,method:n,payload:i,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(a,xt.RELIABLE)})}handleParticipantDisconnected(e){for(const[t,{participantIdentity:n}]of this.pendingAcks)n===e&&this.pendingAcks.delete(t);for(const[t,{participantIdentity:n,resolve:i}]of this.pendingResponses)n===e&&(i(null,es.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(t))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(e=>"video"===e.mime.split("/")[0].toLowerCase())}updateInfo(e){return!!super.updateInfo(e)&&(e.tracks.forEach(e=>{var t,n;const i=this.trackPublications.get(e.sid);if(i){const r=i.isMuted||null!==(n=null===(t=i.track)||void 0===t?void 0:t.isUpstreamPaused)&&void 0!==n&&n;r!==e.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),uo(i)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(e.sid,r))}}),!0)}setActiveAgent(e){var t,n,i,r;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?null===(n=null===(t=this.activeAgentFuture)||void 0===t?void 0:t.resolve)||void 0===n||n.call(t,e):null===(r=null===(i=this.activeAgentFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Ba),this.activeAgentFuture.promise)}getPublicationForTrack(e){let t;return this.trackPublications.forEach(n=>{const i=n.track;i&&(e instanceof MediaStreamTrack?($a(i)||Ja(i))&&i.mediaStreamTrack===e&&(t=n):e===i&&(t=n))}),t}waitForPendingPublicationOfSource(e){return ui(this,void 0,void 0,function*(){const t=Date.now();for(;Date.now()<t+1e4;){const t=Array.from(this.pendingPublishPromises.entries()).find(t=>{let[n]=t;return n.source===e});if(t)return t[1];yield fa(20)}})}}class ec extends Gs{constructor(e,t,n,i){super(e,t.sid,t.name,i),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=e=>{this.setTrack(void 0),this.emit(Lr.Ended,e)},this.handleVisibilityChange=e=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(e),this.logContext),this.visible=e,this.emitTrackUpdate()},this.handleVideoDimensionsChange=e=>{this.log.debug("adaptivestream video dimensions ".concat(e.width,"x").concat(e.height),this.logContext),this.videoDimensionsAdaptiveStream=e,this.emitTrackUpdate()},this.subscribed=n,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new bn({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new zt({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Lr.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(n)}get subscriptionStatus(){return!1===this.subscribed?Gs.SubscriptionStatus.Unsubscribed:super.isSubscribed?Gs.SubscriptionStatus.Subscribed:Gs.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Gs.PermissionStatus.Allowed:Gs.PermissionStatus.NotAllowed}get isSubscribed(){return!1!==this.subscribed&&super.isSubscribed}get isDesired(){return!1!==this.subscribed}get isEnabled(){return void 0!==this.requestedDisabled?!this.requestedDisabled:!this.isAdaptiveStream||this.visible}get isLocal(){return!1}setEnabled(e){this.isManualOperationAllowed()&&this.requestedDisabled!==!e&&(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){this.isManualOperationAllowed()&&this.requestedMaxQuality!==e&&(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,n;this.isManualOperationAllowed()&&((null===(t=this.requestedVideoDimensions)||void 0===t?void 0:t.width)===e.width&&(null===(n=this.requestedVideoDimensions)||void 0===n?void 0:n.height)===e.height||(Za(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Za(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return null!==(e=this.requestedMaxQuality)&&void 0!==e?e:ea.HIGH}setTrack(e){const t=this.subscriptionStatus,n=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(Lr.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(Lr.VisibilityChanged,this.handleVisibilityChange),i.off(Lr.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(Lr.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Lr.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Lr.VisibilityChanged,this.handleVisibilityChange),e.on(Lr.Ended,this.handleEnded),this.emit(Lr.Subscribed,e)),this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,n=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(n),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(Lr.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?Lr.Muted:Lr.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(Lr.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Lr.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return!!this.isDesired||(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Za(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new yn({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===ta.Kind.Video){let t=this.requestedVideoDimensions;if(void 0!==this.videoDimensionsAdaptiveStream)if(t){po(this.videoDimensionsAdaptiveStream,t)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else if(void 0!==this.requestedMaxQuality&&this.trackInfo){const e=function(e,t){var n;return null===(n=e.layers)||void 0===n?void 0:n.find(e=>e.quality===t)}(this.trackInfo,this.requestedMaxQuality);e&&po(this.videoDimensionsAdaptiveStream,e)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),t=this.videoDimensionsAdaptiveStream;t?(e.width=Math.ceil(t.width),e.height=Math.ceil(t.height)):void 0!==this.requestedMaxQuality?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:ea.HIGH})),e.quality=ea.HIGH)}this.emit(Lr.UpdateSettings,e)}}class tc extends Xs{static fromParticipantInfo(e,t,n){return new tc(e,t.sid,t.identity,t.name,t.metadata,t.attributes,n,t.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,t,n,i,r,a,o){super(t,n||"",i,r,a,o,arguments.length>7&&void 0!==arguments[7]?arguments[7]:Tt.STANDARD),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Lr.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),uo(e)),{settings:t})),this.signalClient.sendUpdateTrackSettings(t)}),e.on(Lr.UpdateSubscription,e=>{e.participantTracks.forEach(e=>{e.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(e)}),e.on(Lr.SubscriptionPermissionChanged,t=>{this.emit(Mr.TrackSubscriptionPermissionChanged,e,t)}),e.on(Lr.SubscriptionStatusChanged,t=>{this.emit(Mr.TrackSubscriptionStatusChanged,e,t)}),e.on(Lr.Subscribed,t=>{this.emit(Mr.TrackSubscribed,t,e)}),e.on(Lr.Unsubscribed,t=>{this.emit(Mr.TrackUnsubscribed,t,e)}),e.on(Lr.SubscriptionFailed,t=>{this.emit(Mr.TrackSubscriptionFailed,e.trackSid,t)})}getTrackPublication(e){const t=super.getTrackPublication(e);if(t)return t}getTrackPublicationByName(e){const t=super.getTrackPublicationByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ta.Source.Microphone;this.volumeMap.set(t,e);const n=this.getTrackPublication(t);n&&n.track&&n.track.setVolume(e)}getVolume(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ta.Source.Microphone;const t=this.getTrackPublication(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,n,i,r,a){let o=this.getTrackPublicationBySid(t);if(o||t.startsWith("TR")||this.trackPublications.forEach(t=>{o||e.kind!==t.kind.toString()||(o=t)}),!o)return 0===a?(this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),void this.emit(Mr.TrackSubscriptionFailed,t)):(void 0===a&&(a=20),void setTimeout(()=>{this.addSubscribedMediaTrack(e,t,n,i,r,a-1)},150));if("ended"===e.readyState)return this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),uo(o))),void this.emit(Mr.TrackSubscriptionFailed,t);let s;return s="video"===e.kind?new Vs(e,t,i,r):new zs(e,t,i,this.audioContext,this.audioOutput),s.source=o.source,s.isMuted=o.isMuted,s.setMediaStream(n),s.start(),o.setTrack(s),this.volumeMap.has(o.source)&&Ya(s)&&Ka(s)&&s.setVolume(this.volumeMap.get(o.source)),o}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,n=new Map;return e.tracks.forEach(e=>{var i,r;let a=this.getTrackPublicationBySid(e.sid);if(a)a.updateInfo(e);else{const t=ta.kindFromProto(e.type);if(!t)return;a=new ec(t,e,null===(i=this.signalClient.connectOptions)||void 0===i?void 0:i.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:null===(r=this.loggerOptions)||void 0===r?void 0:r.loggerName}),a.updateInfo(e),n.set(e.sid,a);const o=Array.from(this.trackPublications.values()).find(e=>e.source===(null===a||void 0===a?void 0:a.source));o&&a.source!==ta.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:uo(o),newTrack:uo(a)})),this.addTrackPublication(a)}t.set(e.sid,a)}),this.trackPublications.forEach(e=>{t.has(e.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),uo(e))),this.unpublishTrack(e.trackSid,!0))}),n.forEach(e=>{this.emit(Mr.TrackPublished,e)}),!0}unpublishTrack(e,t){const n=this.trackPublications.get(e);if(!n)return;const{track:i}=n;switch(i&&(i.stop(),n.setTrack(void 0)),this.trackPublications.delete(e),n.kind){case ta.Kind.Audio:this.audioTrackPublications.delete(e);break;case ta.Kind.Video:this.videoTrackPublications.delete(e)}t&&this.emit(Mr.TrackUnpublished,n)}setAudioOutput(e){return ui(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTrackPublications.forEach(n=>{var i;Ka(n.track)&&Ya(n.track)&&t.push(n.track.setSinkId(null!==(i=e.deviceId)&&void 0!==i?i:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:n})),super.emit(e,...n)}}!function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"}(Ys||(Ys={}));class nc extends mi.EventEmitter{constructor(e){var t,n,i,r;if(super(),t=this,this.state=Ys.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=ai,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(e,t,n)=>ui(this,void 0,void 0,function*(){var i;if("undefined"===typeof RTCPeerConnection||!ma()&&!ga())throw Ea()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const r=yield this.disconnectLock.lock();if(this.state===Ys.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),r(),Promise.resolve();if(this.connectFuture)return r(),this.connectFuture.promise;this.setAndEmitConnectionState(Ys.Connecting),(null===(i=this.regionUrlProvider)||void 0===i?void 0:i.getServerUrl().toString())!==e&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Pa(new URL(e))&&(void 0===this.regionUrlProvider?this.regionUrlProvider=new _s(e,t):this.regionUrlProvider.updateToken(t),this.regionUrlProvider.fetchRegionSettings().then(e=>{var t;null===(t=this.regionUrlProvider)||void 0===t||t.setServerReportedRegions(e)}).catch(e=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:e}))}));const a=(i,o,s)=>ui(this,void 0,void 0,function*(){var c,l;this.abortController&&this.abortController.abort();const u=new AbortController;this.abortController=u,null===r||void 0===r||r();try{yield this.attemptConnection(null!==s&&void 0!==s?s:e,t,n,u),this.abortController=void 0,i()}catch(S){if(this.regionUrlProvider&&S instanceof Ur&&S.reason!==xr.Cancelled&&S.reason!==xr.NotAllowed){let t=null;try{t=yield this.regionUrlProvider.getNextBestRegionUrl(null===(c=this.abortController)||void 0===c?void 0:c.signal)}catch(d){if(d instanceof Ur&&(401===d.status||d.reason===xr.Cancelled))return this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),void o(d)}t&&!(null===(l=this.abortController)||void 0===l?void 0:l.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(S.message,". Retrying with another region: ").concat(t),this.logContext),this.recreateEngine(),yield a(i,o,t)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,qa(S)),o(S))}else{let t=pt.UNKNOWN_REASON;S instanceof Ur&&(t=qa(S)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t),o(S)}}}),o=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Ba((e,t)=>{a(e,t,o)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(e,t,n,i,r,a)=>ui(this,void 0,void 0,function*(){var o,s,c;const l=yield n.join(e,t,{autoSubscribe:i.autoSubscribe,adaptiveStream:"object"===typeof r.adaptiveStream||r.adaptiveStream,maxRetries:i.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:i.websocketTimeout},a.signal);let u=l.serverInfo;if(u||(u={version:l.serverVersion,region:l.serverRegion}),this.serverInfo=u,this.log.debug("connected to Livekit Server ".concat(Object.entries(u).map(e=>{let[t,n]=e;return"".concat(t,": ").concat(n)}).join(", ")),{room:null===(o=l.room)||void 0===o?void 0:o.name,roomSid:null===(s=l.room)||void 0===s?void 0:s.sid,identity:null===(c=l.participant)||void 0===c?void 0:c.identity}),!u.version)throw new Br("unknown server version");return"0.15.1"===u.version&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),r.dynacast=!1),l}),this.applyJoinResponse=e=>{const t=e.participant;if(this.localParticipant.sid=t.sid,this.localParticipant.identity=t.identity,this.localParticipant.setEnabledPublishCodecs(e.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(e.sifTrailer)}catch(S){this.log.error(S instanceof Error?S.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:S}))}this.handleParticipantUpdates([t,...e.otherParticipants]),e.room&&this.handleRoomUpdate(e.room)},this.attemptConnection=(e,t,n,i)=>ui(this,void 0,void 0,function*(){var r,a;this.state===Ys.Reconnecting||this.isResuming||(null===(r=this.engine)||void 0===r?void 0:r.pendingReconnect)?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),(null===(a=this.regionUrlProvider)||void 0===a?void 0:a.isCloud())&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Yo),n),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const n=yield this.connectSignal(e,t,this.engine,this.connOptions,this.options,i);this.applyJoinResponse(n),this.setupLocalParticipantEvents(),this.emit(Dr.SignalConnected)}catch(o){yield this.engine.close(),this.recreateEngine();const e=new Ur("could not establish signal connection",xr.ServerUnreachable);throw o instanceof Error&&(e.message="".concat(e.message,": ").concat(o.message)),o instanceof Ur&&(e.reason=o.reason,e.status=o.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:o})),e}if(i.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Ur("Connection attempt aborted",xr.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,i)}catch(S){throw yield this.engine.close(),this.recreateEngine(),S}wa()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),wa()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Ys.Connected),this.emit(Dr.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return ui(t,[...n],void 0,function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){var n,i,r,a;const o=yield e.disconnectLock.lock();try{if(e.state===Ys.Disconnected)return void e.log.debug("already disconnected",e.logContext);e.log.info("disconnect from room",Object.assign({},e.logContext)),(e.state===Ys.Connecting||e.state===Ys.Reconnecting||e.isResuming)&&(e.log.warn("abort connection attempt",e.logContext),null===(n=e.abortController)||void 0===n||n.abort(),null===(r=null===(i=e.connectFuture)||void 0===i?void 0:i.reject)||void 0===r||r.call(i,new Ur("Client initiated disconnect",xr.Cancelled)),e.connectFuture=void 0),(null===(a=e.engine)||void 0===a?void 0:a.client.isDisconnected)||(yield e.engine.client.sendLeave()),e.engine&&(yield e.engine.close()),e.handleDisconnect(t,pt.CLIENT_INITIATED),e.engine=void 0}finally{o()}}()})},this.onPageLeave=()=>ui(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>ui(this,void 0,void 0,function*(){const e=[],t=Qr();if(t&&"iOS"===t.os){const t="livekit-dummy-audio-el";let n=document.getElementById(t);if(!n){n=document.createElement("audio"),n.id=t,n.autoplay=!0,n.hidden=!0;const e=Fa();e.enabled=!0;const i=new MediaStream([e]);n.srcObject=i,document.addEventListener("visibilitychange",()=>{n&&(n.srcObject=document.hidden?null:i,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(n),this.once(Dr.Disconnected,()=>{null===n||void 0===n||n.remove(),n=null})}e.push(n)}this.remoteParticipants.forEach(t=>{t.audioTrackPublications.forEach(t=>{t.track&&t.track.attachedElements.forEach(t=>{e.push(t)})})});try{yield Promise.all([this.acquireAudioContext(),...e.map(e=>(e.muted=!1,e.play()))]),this.handleAudioPlaybackStarted()}catch(n){throw this.handleAudioPlaybackFailed(n),n}}),this.startVideo=()=>ui(this,void 0,void 0,function*(){const e=[];for(const t of this.remoteParticipants.values())t.videoTrackPublications.forEach(t=>{var n;null===(n=t.track)||void 0===n||n.attachedElements.forEach(t=>{e.includes(t)||e.push(t)})});yield Promise.all(e.map(e=>e.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(e=>{"NotAllowedError"===e.name?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const e of this.remoteParticipants.values())this.handleParticipantDisconnected(e.identity,e);this.setAndEmitConnectionState(Ys.Reconnecting)&&this.emit(Dr.Reconnecting)},this.handleSignalRestarted=e=>ui(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(e.serverRegion),Object.assign(Object.assign({},this.logContext),{region:e.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(e);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(t){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:t}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:e.serverRegion}))}catch(n){return}this.setAndEmitConnectionState(Ys.Connected),this.emit(Dr.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=e=>{e.forEach(e=>{var t;if(e.identity===this.localParticipant.identity)return void this.localParticipant.updateInfo(e);""===e.identity&&(e.identity=null!==(t=this.sidToIdentity.get(e.sid))&&void 0!==t?t:"");let n=this.remoteParticipants.get(e.identity);e.state===St.DISCONNECTED?this.handleParticipantDisconnected(e.identity,n):n=this.getOrCreateParticipant(e.identity,e)})},this.handleActiveSpeakersUpdate=e=>{const t=[],n={};e.forEach(e=>{if(n[e.sid]=!0,e.sid===this.localParticipant.sid)this.localParticipant.audioLevel=e.level,this.localParticipant.setIsSpeaking(!0),t.push(this.localParticipant);else{const n=this.getRemoteParticipantBySid(e.sid);n&&(n.audioLevel=e.level,n.setIsSpeaking(!0),t.push(n))}}),n[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(e=>{n[e.sid]||(e.audioLevel=0,e.setIsSpeaking(!1))}),this.activeSpeakers=t,this.emitWhenConnected(Dr.ActiveSpeakersChanged,t)},this.handleSpeakersChanged=e=>{const t=new Map;this.activeSpeakers.forEach(e=>{const n=this.remoteParticipants.get(e.identity);n&&n.sid!==e.sid||t.set(e.sid,e)}),e.forEach(e=>{let n=this.getRemoteParticipantBySid(e.sid);e.sid===this.localParticipant.sid&&(n=this.localParticipant),n&&(n.audioLevel=e.level,n.setIsSpeaking(e.active),e.active?t.set(e.sid,n):t.delete(e.sid))});const n=Array.from(t.values());n.sort((e,t)=>t.audioLevel-e.audioLevel),this.activeSpeakers=n,this.emitWhenConnected(Dr.ActiveSpeakersChanged,n)},this.handleStreamStateUpdate=e=>{e.streamStates.forEach(e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);if(!n||!n.track)return;const i=ta.streamStateFromProto(e.state);i!==n.track.streamState&&(n.track.streamState=i,t.emit(Mr.TrackStreamStateChanged,n,n.track.streamState),this.emitWhenConnected(Dr.TrackStreamStateChanged,n,n.track.streamState,t))})},this.handleSubscriptionPermissionUpdate=e=>{const t=this.getRemoteParticipantBySid(e.participantSid);if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setAllowed(e.allowed)},this.handleSubscriptionError=e=>{const t=Array.from(this.remoteParticipants.values()).find(t=>t.trackPublications.has(e.trackSid));if(!t)return;const n=t.getTrackPublicationBySid(e.trackSid);n&&n.setSubscriptionError(e.err)},this.handleDataPacket=e=>{const t=this.remoteParticipants.get(e.participantIdentity);if("user"===e.value.case)this.handleUserPacket(t,e.value.value,e.kind);else if("transcription"===e.value.case)this.handleTranscription(t,e.value.value);else if("sipDtmf"===e.value.case)this.handleSipDtmf(t,e.value.value);else if("chatMessage"===e.value.case)this.handleChatMessage(t,e.value.value);else if("metrics"===e.value.case)this.handleMetrics(e.value.value,t);else if("streamHeader"===e.value.case||"streamChunk"===e.value.case||"streamTrailer"===e.value.case)this.handleDataStream(e);else if("rpcRequest"===e.value.case){const t=e.value.value;this.handleIncomingRpcRequest(e.participantIdentity,t.id,t.method,t.payload,t.responseTimeoutMs,t.version)}},this.handleUserPacket=(e,t,n)=>{this.emit(Dr.DataReceived,t.payload,e,n,t.topic),null===e||void 0===e||e.emit(Mr.DataReceived,t.payload,n)},this.handleSipDtmf=(e,t)=>{this.emit(Dr.SipDTMFReceived,t,e),null===e||void 0===e||e.emit(Mr.SipDTMFReceived,t)},this.handleTranscription=(e,t)=>{const n=t.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(t.transcribedParticipantIdentity),i=null===n||void 0===n?void 0:n.trackPublications.get(t.trackId),r=function(e,t){return e.segments.map(e=>{let{id:n,text:i,language:r,startTime:a,endTime:o,final:s}=e;var c;const l=null!==(c=t.get(n))&&void 0!==c?c:Date.now(),u=Date.now();return s?t.delete(n):t.set(n,l),{id:n,text:i,startTime:Number.parseInt(a.toString()),endTime:Number.parseInt(o.toString()),final:s,language:r,firstReceivedTime:l,lastReceivedTime:u}})}(t,this.transcriptionReceivedTimes);null===i||void 0===i||i.emit(Lr.TranscriptionReceived,r),null===n||void 0===n||n.emit(Mr.TranscriptionReceived,r,i),this.emit(Dr.TranscriptionReceived,r,n,i)},this.handleChatMessage=(e,t)=>{const n=function(e){const{id:t,timestamp:n,message:i,editTimestamp:r}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}(t);this.emit(Dr.ChatMessage,n,e)},this.handleMetrics=(e,t)=>{this.emit(Dr.MetricsReceived,e,t)},this.handleDataStream=e=>{this.incomingDataStreamManager.handleDataStreamPacket(e)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(Dr.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=e=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:e})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(Dr.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(Dr.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(Dr.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>ui(this,void 0,void 0,function*(){var e;"iOS"!==(null===(e=Qr())||void 0===e?void 0:e.os)&&(yield this.selectDefaultDevices()),this.emit(Dr.MediaDevicesChanged)}),this.handleRoomUpdate=e=>{const t=this.roomInfo;this.roomInfo=e,t&&t.metadata!==e.metadata&&this.emitWhenConnected(Dr.RoomMetadataChanged,e.metadata),(null===t||void 0===t?void 0:t.activeRecording)!==e.activeRecording&&this.emitWhenConnected(Dr.RecordingStatusChanged,e.activeRecording)},this.handleConnectionQualityUpdate=e=>{e.updates.forEach(e=>{if(e.participantSid===this.localParticipant.sid)return void this.localParticipant.setConnectionQuality(e.quality);const t=this.getRemoteParticipantBySid(e.participantSid);t&&t.setConnectionQuality(e.quality)})},this.onLocalParticipantMetadataChanged=e=>{this.emit(Dr.ParticipantMetadataChanged,e,this.localParticipant)},this.onLocalParticipantNameChanged=e=>{this.emit(Dr.ParticipantNameChanged,e,this.localParticipant)},this.onLocalAttributesChanged=e=>{this.emit(Dr.ParticipantAttributesChanged,e,this.localParticipant)},this.onLocalTrackMuted=e=>{this.emit(Dr.TrackMuted,e,this.localParticipant)},this.onLocalTrackUnmuted=e=>{this.emit(Dr.TrackUnmuted,e,this.localParticipant)},this.onTrackProcessorUpdate=e=>{var t;null===(t=null===e||void 0===e?void 0:e.onPublish)||void 0===t||t.call(e,this)},this.onLocalTrackPublished=e=>ui(this,void 0,void 0,function*(){var t,n,i,r,a,o;if(null===(t=e.track)||void 0===t||t.on(Lr.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.on(Lr.Restarted,this.onLocalTrackRestarted),null===(a=null===(r=null===(i=e.track)||void 0===i?void 0:i.getProcessor())||void 0===r?void 0:r.onPublish)||void 0===a||a.call(r,this),this.emit(Dr.LocalTrackPublished,e,this.localParticipant),$a(e.track)){(yield e.track.checkForSilence())&&this.emit(Dr.LocalAudioSilenceDetected,e)}const s=yield null===(o=e.track)||void 0===o?void 0:o.getDeviceId(!1),c=oo(e.source);c&&s&&s!==this.localParticipant.activeDeviceMap.get(c)&&(this.localParticipant.activeDeviceMap.set(c,s),this.emit(Dr.ActiveDeviceChanged,c,s))}),this.onLocalTrackUnpublished=e=>{var t,n;null===(t=e.track)||void 0===t||t.off(Lr.TrackProcessorUpdate,this.onTrackProcessorUpdate),null===(n=e.track)||void 0===n||n.off(Lr.Restarted,this.onLocalTrackRestarted),this.emit(Dr.LocalTrackUnpublished,e,this.localParticipant)},this.onLocalTrackRestarted=e=>ui(this,void 0,void 0,function*(){const t=yield e.getDeviceId(!1),n=oo(e.source);n&&t&&t!==this.localParticipant.activeDeviceMap.get(n)&&(this.log.debug("local track restarted, setting ".concat(n," ").concat(t," active"),this.logContext),this.localParticipant.activeDeviceMap.set(n,t),this.emit(Dr.ActiveDeviceChanged,n,t))}),this.onLocalConnectionQualityChanged=e=>{this.emit(Dr.ConnectionQualityChanged,e,this.localParticipant)},this.onMediaDevicesError=(e,t)=>{this.emit(Dr.MediaDevicesError,e,t)},this.onLocalParticipantPermissionsChanged=e=>{this.emit(Dr.ParticipantPermissionsChanged,e,this.localParticipant)},this.onLocalChatMessageSent=e=>{this.emit(Dr.ChatMessage,e,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},$o),e),this.log=oi(null!==(n=this.options.loggerName)&&void 0!==n?n:ii.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Qo),null===e||void 0===e?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Jo),null===e||void 0===e?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},Ko),null===e||void 0===e?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new As,this.outgoingDataStreamManager=new Fs(this.engine,this.log),this.disconnectLock=new C,this.localParticipant=new Zs("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",za(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",za(this.options.audioCaptureDefaults.deviceId)),(null===(i=this.options.audioOutput)||void 0===i?void 0:i.deviceId)&&this.switchActiveDevice("audiooutput",za(this.options.audioOutput.deviceId)).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),this.options.e2ee&&this.setupE2EE(),wa()){const e=new AbortController;null===(r=navigator.mediaDevices)||void 0===r||r.addEventListener("devicechange",this.handleDeviceChange,{signal:e.signal}),nc.cleanupRegistry&&nc.cleanupRegistry.register(this,()=>{e.abort()})}}registerTextStreamHandler(e,t){return this.incomingDataStreamManager.registerTextStreamHandler(e,t)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,t){return this.incomingDataStreamManager.registerByteStreamHandler(e,t)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,t){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,t)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return ui(this,void 0,void 0,function*(){if(!this.e2eeManager)throw Error("e2ee not configured, please set e2ee settings within the room options");yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),""!==this.localParticipant.identity&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity)})}setupE2EE(){var e;this.options.e2ee&&("e2eeManager"in this.options.e2ee?this.e2eeManager=this.options.e2ee.e2eeManager:this.e2eeManager=new fo(this.options.e2ee),this.e2eeManager.on(wr.ParticipantEncryptionStatusChanged,(e,t)=>{t.isLocal&&(this.isE2EEEnabled=e),this.emit(Dr.ParticipantEncryptionStatusChanged,e,t)}),this.e2eeManager.on(wr.EncryptionError,e=>this.emit(Dr.EncryptionError,e)),null===(e=this.e2eeManager)||void 0===e||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:null===(e=this.roomInfo)||void 0===e?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.activeRecording)&&void 0!==t&&t}getSid(){return ui(this,void 0,void 0,function*(){return this.state===Ys.Disconnected?"":this.roomInfo&&""!==this.roomInfo.sid?this.roomInfo.sid:new Promise((e,t)=>{const n=t=>{""!==t.sid&&(this.engine.off(Ar.RoomUpdate,n),e(t.sid))};this.engine.on(Ar.RoomUpdate,n),this.once(Dr.Disconnected,()=>{this.engine.off(Ar.RoomUpdate,n),t("Room disconnected before room server id was available")})})})}get name(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.name)&&void 0!==t?t:""}get metadata(){var e;return null===(e=this.roomInfo)||void 0===e?void 0:e.metadata}get numParticipants(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numParticipants)&&void 0!==t?t:0}get numPublishers(){var e,t;return null!==(t=null===(e=this.roomInfo)||void 0===e?void 0:e.numPublishers)&&void 0!==t?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new xs(this.options),this.engine.on(Ar.ParticipantUpdate,this.handleParticipantUpdates).on(Ar.RoomUpdate,this.handleRoomUpdate).on(Ar.SpeakersChanged,this.handleSpeakersChanged).on(Ar.StreamStateChanged,this.handleStreamStateUpdate).on(Ar.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Ar.SubscriptionError,this.handleSubscriptionError).on(Ar.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Ar.MediaTrackAdded,(e,t,n)=>{this.onTrackAdded(e,t,n)}).on(Ar.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(Ar.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Ar.DataPacketReceived,this.handleDataPacket).on(Ar.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Ys.SignalReconnecting)&&this.emit(Dr.SignalReconnecting)}).on(Ar.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Ys.Connected)&&this.emit(Dr.Reconnected)}).on(Ar.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Ys.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(Ar.Restarting,this.handleRestarting).on(Ar.SignalRestarted,this.handleSignalRestarted).on(Ar.Offline,()=>{this.setAndEmitConnectionState(Ys.Reconnecting)&&this.emit(Dr.Reconnecting)}).on(Ar.DCBufferStatusChanged,(e,t)=>{this.emit(Dr.DCBufferStatusChanged,e,t)}).on(Ar.LocalTrackSubscribed,e=>{const t=this.localParticipant.getTrackPublications().find(t=>{let{trackSid:n}=t;return n===e});t?(this.localParticipant.emit(Mr.LocalTrackSubscribed,t),this.emitWhenConnected(Dr.LocalTrackSubscribed,t,this.localParticipant)):this.log.warn("could not find local track subscription for subscribed event",this.logContext)}).on(Ar.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((e,t)=>{this.handleParticipantDisconnected(t,e)}),this.emit(Dr.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return go.getInstance().getDevices(e,t)}prepareConnection(e,t){return ui(this,void 0,void 0,function*(){if(this.state===Ys.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Pa(new URL(e))&&t){this.regionUrlProvider=new _s(e,t);const n=yield this.regionUrlProvider.getNextBestRegionUrl();n&&this.state===Ys.Disconnected&&(this.regionUrl=n,yield fetch(Va(n),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(n),this.logContext))}else yield fetch(Va(e),{method:"HEAD"})}catch(S){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:S}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return ui(this,void 0,void 0,function*(){let n,i=()=>{};switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new qn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new qn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new qn({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new qn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>ui(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new qn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>ui(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new qn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new qn({scenario:{case:"switchCandidateProtocol",value:"force-tls"===e?2:1}}),i=()=>ui(this,void 0,void 0,function*(){const e=this.engine.client.onLeave;e&&e(new Tn({reason:pt.CLIENT_INITIATED,action:Cn.RECONNECT}))});break;case"subscriber-bandwidth":if(void 0===t||"number"!==typeof t)throw new Error("subscriber-bandwidth requires a number as argument");n=new qn({scenario:{case:"subscriberBandwidth",value:Wa(t)}});break;case"leave-full-reconnect":n=new qn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}n&&(yield this.engine.client.sendSimulateScenario(n),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){return ui(this,arguments,void 0,function(e,t){var n=this;let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function*(){var r,a,o,s,c,l,u;let d=!0,h=!1;const p=i?{exact:t}:t;if("audioinput"===e){h=0===n.localParticipant.audioTrackPublications.size;const t=null!==(r=n.getActiveDevice(e))&&void 0!==r?r:n.options.audioCaptureDefaults.deviceId;n.options.audioCaptureDefaults.deviceId=p;const i=Array.from(n.localParticipant.audioTrackPublications.values()).filter(e=>e.source===ta.Source.Microphone);try{d=(yield Promise.all(i.map(e=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.setDeviceId(p)}))).every(e=>!0===e)}catch(S){throw n.options.audioCaptureDefaults.deviceId=t,S}const a=i.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});d&&a&&(h=!0)}else if("videoinput"===e){h=0===n.localParticipant.videoTrackPublications.size;const t=null!==(a=n.getActiveDevice(e))&&void 0!==a?a:n.options.videoCaptureDefaults.deviceId;n.options.videoCaptureDefaults.deviceId=p;const i=Array.from(n.localParticipant.videoTrackPublications.values()).filter(e=>e.source===ta.Source.Camera);try{d=(yield Promise.all(i.map(e=>{var t;return null===(t=e.videoTrack)||void 0===t?void 0:t.setDeviceId(p)}))).every(e=>!0===e)}catch(S){throw n.options.videoCaptureDefaults.deviceId=t,S}const r=i.some(e=>{var t,n;return null!==(n=null===(t=e.track)||void 0===t?void 0:t.isMuted)&&void 0!==n&&n});d&&r&&(h=!0)}else if("audiooutput"===e){if(h=!0,!ba()&&!n.options.webAudioMix||n.options.webAudioMix&&n.audioContext&&!("setSinkId"in n.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");n.options.webAudioMix&&(t=null!==(o=yield go.getInstance().normalizeDeviceId("audiooutput",t))&&void 0!==o?o:""),null!==(s=(u=n.options).audioOutput)&&void 0!==s||(u.audioOutput={});const i=null!==(c=n.getActiveDevice(e))&&void 0!==c?c:n.options.audioOutput.deviceId;n.options.audioOutput.deviceId=t;try{n.options.webAudioMix&&(null===(l=n.audioContext)||void 0===l||l.setSinkId(t)),yield Promise.all(Array.from(n.remoteParticipants.values()).map(e=>e.setAudioOutput({deviceId:t})))}catch(S){throw n.options.audioOutput.deviceId=i,S}}return h&&(n.localParticipant.activeDeviceMap.set(e,t),n.emit(Dr.ActiveDeviceChanged,e,t)),d}()})}setupLocalParticipantEvents(){this.localParticipant.on(Mr.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Mr.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Mr.AttributesChanged,this.onLocalAttributesChanged).on(Mr.TrackMuted,this.onLocalTrackMuted).on(Mr.TrackUnmuted,this.onLocalTrackUnmuted).on(Mr.LocalTrackPublished,this.onLocalTrackPublished).on(Mr.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Mr.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Mr.MediaDevicesError,this.onMediaDevicesError).on(Mr.AudioStreamAcquired,this.startAudio).on(Mr.ChatMessage,this.onLocalChatMessageSent).on(Mr.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;null===(e=this.engine)||void 0===e||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,n){if(this.state===Ys.Connecting||this.state===Ys.Reconnecting){const i=()=>{this.onTrackAdded(e,t,n),r()},r=()=>{this.off(Dr.Reconnected,i),this.off(Dr.Connected,i),this.off(Dr.Disconnected,r)};return this.once(Dr.Reconnected,i),this.once(Dr.Connected,i),void this.once(Dr.Disconnected,r)}if(this.state===Ys.Disconnected)return void this.log.warn("skipping incoming track after Room disconnected",this.logContext);if("ended"===e.readyState)return void this.log.info("skipping incoming track as it already ended",this.logContext);const i=function(e){const t=e.split("|");return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}(t.id),r=i[0];let a=i[1],o=e.id;if(a&&a.startsWith("TR")&&(o=a),r===this.localParticipant.sid)return void this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);const s=Array.from(this.remoteParticipants.values()).find(e=>e.sid===r);if(!s)return void this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);let c;this.options.adaptiveStream&&(c="object"===typeof this.options.adaptiveStream?this.options.adaptiveStream:{}),s.addSubscribedMediaTrack(e,o,t,n,c)}handleDisconnect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;var n;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearHandlersAndControllers(),this.state!==Ys.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(e=>{e.trackPublications.forEach(t=>{e.unpublishTrack(t.trackSid)})}),this.localParticipant.trackPublications.forEach(t=>{var n,i,r;t.track&&this.localParticipant.unpublishTrack(t.track,e),e?(null===(n=t.track)||void 0===n||n.detach(),null===(i=t.track)||void 0===i||i.stop()):null===(r=t.track)||void 0===r||r.stopMonitor()}),this.localParticipant.off(Mr.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Mr.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Mr.AttributesChanged,this.onLocalAttributesChanged).off(Mr.TrackMuted,this.onLocalTrackMuted).off(Mr.TrackUnmuted,this.onLocalTrackUnmuted).off(Mr.LocalTrackPublished,this.onLocalTrackPublished).off(Mr.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Mr.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Mr.MediaDevicesError,this.onMediaDevicesError).off(Mr.AudioStreamAcquired,this.startAudio).off(Mr.ChatMessage,this.onLocalChatMessageSent).off(Mr.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&"boolean"===typeof this.options.webAudioMix&&(this.audioContext.close(),this.audioContext=void 0),wa()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),null===(n=navigator.mediaDevices)||void 0===n||n.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Ys.Disconnected),this.emit(Dr.Disconnected,t)}}}handleParticipantDisconnected(e,t){var n;this.remoteParticipants.delete(e),t&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),t.trackPublications.forEach(e=>{t.unpublishTrack(e.trackSid,!0)}),this.emit(Dr.ParticipantDisconnected,t),t.setDisconnected(),null===(n=this.localParticipant)||void 0===n||n.handleParticipantDisconnected(t.identity))}handleIncomingRpcRequest(e,t,n,i,r,a){return ui(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,t),1!==a)return void(yield this.engine.publishRpcResponse(e,t,null,es.builtIn("UNSUPPORTED_VERSION")));const o=this.rpcHandlers.get(n);if(!o)return void(yield this.engine.publishRpcResponse(e,t,null,es.builtIn("UNSUPPORTED_METHOD")));let s=null,c=null;try{const a=yield o({requestId:t,callerIdentity:e,payload:i,responseTimeout:r});ts(a)>15360?(s=es.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(n))):c=a}catch(l){l instanceof es?s=l:(console.warn("Uncaught error returned by RPC handler for ".concat(n,". Returning APPLICATION_ERROR instead."),l),s=es.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,t,c,s)})}selectDefaultDevices(){return ui(this,void 0,void 0,function*(){var e,t,n;const i=go.getInstance().previousDevices,r=yield go.getInstance().getDevices(void 0,!1),a=Qr();if("Chrome"===(null===a||void 0===a?void 0:a.name)&&"iOS"!==a.os)for(let s of r){const e=i.find(e=>e.deviceId===s.deviceId);e&&""!==e.label&&e.kind===s.kind&&e.label!==s.label&&"default"===this.getActiveDevice(s.kind)&&this.emit(Dr.ActiveDeviceChanged,s.kind,s.deviceId)}const o=["audiooutput","audioinput","videoinput"];for(let s of o){const a=ao(s),o=this.localParticipant.getTrackPublication(a);if(o&&(null===(e=o.track)||void 0===e?void 0:e.isUserProvided))continue;const c=r.filter(e=>e.kind===s),l=this.getActiveDevice(s);l===(null===(t=i.filter(e=>e.kind===s)[0])||void 0===t?void 0:t.deviceId)&&c.length>0&&(null===(n=c[0])||void 0===n?void 0:n.deviceId)!==l?yield this.switchActiveDevice(s,c[0].deviceId):"audioinput"===s&&!Sa()||"videoinput"===s||!(c.length>0)||c.find(e=>e.deviceId===this.getActiveDevice(s))||"audiooutput"===s&&Sa()||(yield this.switchActiveDevice(s,c[0].deviceId))}})}acquireAudioContext(){return ui(this,void 0,void 0,function*(){var e,t;if("boolean"!==typeof this.options.webAudioMix&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:this.audioContext&&"closed"!==this.audioContext.state||(this.audioContext=null!==(e=ro())&&void 0!==e?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(e=>e.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&"suspended"===this.audioContext.state)try{yield Promise.race([this.audioContext.resume(),fa(200)])}catch(S){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:S}))}const n="running"===(null===(t=this.audioContext)||void 0===t?void 0:t.state);n!==this.canPlaybackAudio&&(this.audioEnabled=n,this.emit(Dr.AudioPlaybackStatusChanged,n))})}createParticipant(e,t){var n;let i;return i=t?tc.fromParticipantInfo(this.engine.client,t,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):new tc(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),(null===(n=this.options.audioOutput)||void 0===n?void 0:n.deviceId)&&i.setAudioOutput(this.options.audioOutput).catch(e=>this.log.warn("Could not set audio output: ".concat(e.message),this.logContext)),i}getOrCreateParticipant(e,t){if(this.remoteParticipants.has(e)){const n=this.remoteParticipants.get(e);if(t){n.updateInfo(t)&&this.sidToIdentity.set(t.sid,t.identity)}return n}const n=this.createParticipant(e,t);return this.remoteParticipants.set(e,n),this.sidToIdentity.set(t.sid,t.identity),this.emitWhenConnected(Dr.ParticipantConnected,n),n.on(Mr.TrackPublished,e=>{this.emitWhenConnected(Dr.TrackPublished,e,n)}).on(Mr.TrackSubscribed,(e,t)=>{e.kind===ta.Kind.Audio?(e.on(Lr.AudioPlaybackStarted,this.handleAudioPlaybackStarted),e.on(Lr.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):e.kind===ta.Kind.Video&&(e.on(Lr.VideoPlaybackFailed,this.handleVideoPlaybackFailed),e.on(Lr.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(Dr.TrackSubscribed,e,t,n)}).on(Mr.TrackUnpublished,e=>{this.emit(Dr.TrackUnpublished,e,n)}).on(Mr.TrackUnsubscribed,(e,t)=>{this.emit(Dr.TrackUnsubscribed,e,t,n)}).on(Mr.TrackMuted,e=>{this.emitWhenConnected(Dr.TrackMuted,e,n)}).on(Mr.TrackUnmuted,e=>{this.emitWhenConnected(Dr.TrackUnmuted,e,n)}).on(Mr.ParticipantMetadataChanged,e=>{this.emitWhenConnected(Dr.ParticipantMetadataChanged,e,n)}).on(Mr.ParticipantNameChanged,e=>{this.emitWhenConnected(Dr.ParticipantNameChanged,e,n)}).on(Mr.AttributesChanged,e=>{this.emitWhenConnected(Dr.ParticipantAttributesChanged,e,n)}).on(Mr.ConnectionQualityChanged,e=>{this.emitWhenConnected(Dr.ConnectionQualityChanged,e,n)}).on(Mr.ParticipantPermissionsChanged,e=>{this.emitWhenConnected(Dr.ParticipantPermissionsChanged,e,n)}).on(Mr.TrackSubscriptionStatusChanged,(e,t)=>{this.emitWhenConnected(Dr.TrackSubscriptionStatusChanged,e,t,n)}).on(Mr.TrackSubscriptionFailed,(e,t)=>{this.emit(Dr.TrackSubscriptionFailed,e,n,t)}).on(Mr.TrackSubscriptionPermissionChanged,(e,t)=>{this.emitWhenConnected(Dr.TrackSubscriptionPermissionChanged,e,t,n)}).on(Mr.Active,()=>{this.emitWhenConnected(Dr.ParticipantActive,n),n.kind===Tt.AGENT&&this.localParticipant.setActiveAgent(n)}),t&&n.updateInfo(t),n}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((e,t)=>(e.push(...t.getTrackPublications()),e),[]),t=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const t of e.videoTrackPublications.values())t.isSubscribed&&Xa(t)&&t.emitTrackUpdate()}getRemoteParticipantBySid(e){const t=this.sidToIdentity.get(e);if(t)return this.remoteParticipants.get(t)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Xr.setInterval(()=>{this.engine&&!this.engine.isClosed&&this.engine.verifyTransport()?e=0:(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,pt.STATE_MISMATCH)))},4e3)}clearConnectionReconcile(){this.connectionReconcileInterval&&Xr.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e!==this.state&&(this.state=e,this.emit(Dr.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,n]=e;this.emit(t,...n)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(this.state===Ys.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,n]);else if(this.state===Ys.Connected)return this.emit(e,...n);return!1}simulateParticipants(e){return ui(this,void 0,void 0,function*(){var t,n;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),r=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new vt({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:W.parse((new Date).getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new kt({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(Dr.SignalConnected),this.emit(Dr.Connected),this.setAndEmitConnectionState(Ys.Connected),i.video){const e=new Ks(ta.Kind.Video,new Pt({source:lt.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:ct.AUDIO,name:"video-dummy"}),new Ss(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:ja(160*(null!==(t=r.aspectRatios[0])&&void 0!==t?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(Mr.LocalTrackPublished,e)}if(i.audio){const e=new Ks(ta.Kind.Audio,new Pt({source:lt.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:ct.AUDIO}),new ls(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Fa(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(e),this.localParticipant.emit(Mr.LocalTrackPublished,e)}for(let e=0;e<r.count-1;e+=1){let t=new kt({sid:Math.floor(1e4*Math.random()).toString(),identity:"simulated-".concat(e),state:St.ACTIVE,tracks:[],joinedAt:W.parse(Date.now())});const i=this.getOrCreateParticipant(t.identity,t);if(r.video){const a=ja(160*(null!==(n=r.aspectRatios[e%r.aspectRatios.length])&&void 0!==n?n:1),160,!1,!0),o=new Pt({source:lt.CAMERA,sid:Math.floor(1e4*Math.random()).toString(),type:ct.AUDIO});i.addSubscribedMediaTrack(a,o.sid,new MediaStream([a]),new RTCRtpReceiver),t.tracks=[...t.tracks,o]}if(r.audio){const e=Fa(),n=new Pt({source:lt.MICROPHONE,sid:Math.floor(1e4*Math.random()).toString(),type:ct.AUDIO});i.addSubscribedMediaTrack(e,n.sid,new MediaStream([e]),new RTCRtpReceiver),t.tracks=[...t.tracks,n]}i.updateInfo(t)}})}emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e!==Dr.ActiveSpeakersChanged&&e!==Dr.TranscriptionReceived){const t=ic(n).filter(e=>void 0!==e);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:t}))}return super.emit(e,...n)}}function ic(e){return e.map(e=>{if(e)return Array.isArray(e)?ic(e):"object"===typeof e?"logContext"in e?e.logContext:void 0:e})}nc.cleanupRegistry="undefined"!==typeof FinalizationRegistry&&new FinalizationRegistry(e=>{e()});var rc;!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"}(rc||(rc={}));mi.EventEmitter;mi.EventEmitter;new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);var ac,oc,sc,cc;!function(e){e.DISCONNECTED="disconnected",e.DISCONNECTING="disconnecting",e.CONNECTING="connecting",e.IDLE="idle",e.LISTENING="listening",e.THINKING="thinking",e.SPEAKING="speaking"}(ac||(ac={})),function(e){e.USER="user",e.AGENT="agent"}(oc||(oc={})),function(e){e.VOICE="voice",e.TEXT="text"}(sc||(sc={})),function(e){e.SPEAKS="speaks",e.LISTENS="listens",e.SPEAKS_ONCE="speaks-once"}(cc||(cc={}));class lc{constructor(e,t,n,i){s(this,"text",void 0),s(this,"isFinal",void 0),s(this,"speaker",void 0),s(this,"medium",void 0),this.text=e,this.isFinal=t,this.speaker=n,this.medium=i}}class uc extends Event{constructor(){super("status")}}class dc extends Event{constructor(){super("transcripts")}}class hc extends Event{constructor(e){super("experimental_message"),s(this,"message",void 0),this.message=e}}class pc extends Event{constructor(e){super("data_message"),s(this,"message",void 0),this.message=e}}class fc extends Event{constructor(e){super("video_track_subscribed"),s(this,"videoElement",void 0),this.videoElement=e}}class mc extends EventTarget{constructor(){let{audioContext:e,experimentalMessages:t,videoElement:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),s(this,"_transcripts",[]),s(this,"_status",ac.DISCONNECTED),s(this,"registeredTools",new Map),s(this,"socket",void 0),s(this,"room",void 0),s(this,"videoElement",void 0),s(this,"audioElement",new Audio),s(this,"localAudioTrack",void 0),s(this,"micSourceNode",void 0),s(this,"agentSourceNode",void 0),s(this,"delayedSpeakingState",!1),s(this,"textDecoder",new TextDecoder),s(this,"textEncoder",new TextEncoder),s(this,"audioContext",void 0),s(this,"experimentalMessages",void 0),s(this,"_isMicMuted",!1),s(this,"_isSpeakerMuted",!1),this.audioContext=e||new AudioContext,this.experimentalMessages=t||new Set,this.videoElement=n}get transcripts(){return[...this._transcripts.filter(e=>null!=e)]}get status(){return this._status}get isMicMuted(){return this._isMicMuted}get isSpeakerMuted(){return this._isSpeakerMuted}registerToolImplementation(e,t){this.registeredTools.set(e,t)}registerToolImplementations(e){for(const[t,n]of Object.entries(e))this.registerToolImplementation(t,n)}joinCall(e,t){if(this._status!==ac.DISCONNECTED)throw new Error("Cannot join a new call while already in a call");const n=new URL(e);let i="web_".concat("0.4.1");t&&(i+=":".concat(t)),n.searchParams.set("clientVersion",i),n.searchParams.set("apiVersion","1"),this.experimentalMessages&&n.searchParams.set("experimentalMessages",Array.from(this.experimentalMessages.values()).join(",")),e=n.toString(),this.setStatus(ac.CONNECTING),this.socket=new WebSocket(e),this.socket.onmessage=e=>this.handleSocketMessage(e),this.socket.onclose=e=>this.handleSocketClose(e)}async leaveCall(){await this.disconnect()}setOutputMedium(e){if(!mc.CONNECTED_STATUSES.has(this._status))throw new Error("Cannot set output medium while not connected. Current status is ".concat(this._status,"."));this.sendData({type:"set_output_medium",medium:e})}sendText(e,t){if(!mc.CONNECTED_STATUSES.has(this._status))throw new Error("Cannot send text while not connected. Current status is ".concat(this._status,"."));this.sendData({type:"input_text_message",text:e,deferResponse:t})}sendData(e){if(void 0==e.type)throw new Error("Data must have a type field");const t=JSON.stringify(e),n=this.textEncoder.encode(t);var i,r;n.length>1024?null===(i=this.socket)||void 0===i||i.send(t):null===(r=this.room)||void 0===r||r.localParticipant.publishData(n,{reliable:!0})}muteMic(){var e;this._isMicMuted=!0,null===(e=this.localAudioTrack)||void 0===e||e.mute()}unmuteMic(){var e;this._isMicMuted=!1,null===(e=this.localAudioTrack)||void 0===e||e.unmute()}toggleMicMute(){this.isMicMuted?this.unmuteMic():this.muteMic()}muteSpeaker(){var e;this._isSpeakerMuted=!0,null===(e=this.room)||void 0===e||e.remoteParticipants.forEach(e=>{e.audioTrackPublications.forEach(e=>{e.setEnabled(!this._isSpeakerMuted)})})}unmuteSpeaker(){var e;this._isSpeakerMuted=!1,null===(e=this.room)||void 0===e||e.remoteParticipants.forEach(e=>{e.audioTrackPublications.forEach(e=>{e.setEnabled(!this._isSpeakerMuted)})})}toggleSpeakerMute(){this.isSpeakerMuted?this.unmuteSpeaker():this.muteSpeaker()}async handleSocketMessage(e){const t=JSON.parse(e.data);this.room=new nc({webAudioMix:!1}),this.room.on(Dr.TrackSubscribed,(e,t)=>{t.kind==ta.Kind.Audio&&t.setEnabled(!this.isSpeakerMuted)}),this.room.on(Dr.TrackSubscribed,e=>this.handleTrackSubscribed(e)),this.room.on(Dr.DataReceived,(e,t)=>this.handleDataReceived(e,t));const[n,i]=await Promise.all([Js(),this.room.connect(t.roomUrl,t.token)]);if(this.localAudioTrack=n,this.localAudioTrack.setAudioContext(this.audioContext),this.isMicMuted&&this.localAudioTrack.mute(),[ac.DISCONNECTED,ac.DISCONNECTING].includes(this.status))return void await this.disconnect();this.audioContext.resume(),this.audioElement.play(),this.localAudioTrack.mediaStream&&(this.micSourceNode=this.audioContext.createMediaStreamSource(this.localAudioTrack.mediaStream));const r={name:"audio",simulcast:!1,source:ta.Source.Microphone};this.room.localParticipant.publishTrack(this.localAudioTrack,r),this.setStatus(ac.IDLE)}async handleSocketClose(e){await this.disconnect()}async disconnect(){var e,t,n,i,r,a;this.setStatus(ac.DISCONNECTING),null===(e=this.localAudioTrack)||void 0===e||e.stop(),this.localAudioTrack=void 0,await(null===(t=this.room)||void 0===t?void 0:t.disconnect()),this.room=void 0,null===(n=this.socket)||void 0===n||n.close(),this.socket=void 0,null===(i=this.micSourceNode)||void 0===i||i.disconnect(),this.micSourceNode=void 0,null===(r=this.agentSourceNode)||void 0===r||r.disconnect(),this.agentSourceNode=void 0,null===(a=this.videoElement)||void 0===a||a.pause(),this.audioElement.pause(),this.audioElement.srcObject=null,this.setStatus(ac.DISCONNECTED)}handleTrackSubscribed(e){if("video"===e.kind)this.videoElement||(this.videoElement=document.createElement("video")),e.attach(this.videoElement),this.dispatchEvent(new fc(this.videoElement));else if("audio"===e.kind){e.attach(this.audioElement),e.mediaStream&&(this.agentSourceNode=this.audioContext.createMediaStreamSource(e.mediaStream)),this.delayedSpeakingState&&(this.delayedSpeakingState=!1,this.setStatus(ac.SPEAKING))}}setStatus(e){this._status!==e&&(this._status=e,this.dispatchEvent(new uc))}handleDataReceived(e,t){const n=JSON.parse(this.textDecoder.decode(e));if(this.dispatchEvent(new pc(n)),"state"===n.type){const e=n.state;e===ac.SPEAKING&&void 0===this.agentSourceNode?this.delayedSpeakingState=!0:this.setStatus(e)}else if("transcript"===n.type){const e="voice"==n.medium?sc.VOICE:sc.TEXT,t="agent"==n.role?oc.AGENT:oc.USER,i=n.ordinal,r=n.final;n.text?this.addOrUpdateTranscript(i,e,t,r,n.text):n.delta&&this.addOrUpdateTranscript(i,e,t,r,void 0,n.delta)}else"client_tool_invocation"==n.type?this.invokeClientTool(n.toolName,n.invocationId,n.parameters):this.experimentalMessages&&this.dispatchEvent(new hc(n))}addOrUpdateTranscript(e,t,n,i,r,a){for(;this._transcripts.length<e;)this._transcripts.push(null);if(this._transcripts.length==e)this._transcripts.push(new lc(r||a||"",i,n,t));else{var o;const s=(null===(o=this._transcripts[e])||void 0===o?void 0:o.text)||"";this._transcripts[e]=new lc(r||s+(a||""),i,n,t)}this.dispatchEvent(new dc)}invokeClientTool(e,t,n){const i=this.registeredTools.get(e);if(i)try{const e=i(n);e instanceof Promise?e.then(e=>this.handleClientToolResult(t,e)).catch(e=>this.handleClientToolFailure(t,e)):this.handleClientToolResult(t,e)}catch(S){this.handleClientToolFailure(t,S)}else this.sendData({type:"client_tool_result",invocationId:t,errorType:"undefined",errorMessage:"Client tool ".concat(e," is not registered (TypeScript client)")})}handleClientToolResult(e,t){"string"===typeof t?this.sendData({type:"client_tool_result",invocationId:e,result:t}):"string"!==typeof t.result||"string"!==typeof t.responseType?this.sendData({type:"client_tool_result",invocationId:e,errorType:"implementation-error",errorMessage:'Client tool result must be a string or an object with string "result" and "responseType" properties.'}):this.sendData(l({type:"client_tool_result",invocationId:e},t))}handleClientToolFailure(e,t){this.sendData({type:"client_tool_result",invocationId:e,errorType:"implementation-error",errorMessage:t instanceof Error?t.message:void 0})}}s(mc,"CONNECTED_STATUSES",new Set([ac.LISTENING,ac.THINKING,ac.SPEAKING]));var gc=n(579);const vc=function(){const[e,t]=(0,i.useState)(!1),[n,r]=(0,i.useState)(null);return(0,gc.jsx)("div",{className:"App",children:(0,gc.jsxs)("div",{className:"container",children:[(0,gc.jsxs)("header",{className:"header",children:[(0,gc.jsx)("div",{className:"greeting",children:(0,gc.jsx)("p",{children:"Hello \ud83d\udc4b my name is"})}),(0,gc.jsxs)("div",{className:"name-container",children:[(0,gc.jsx)("h1",{className:"name",children:"Miracle Lee"}),(0,gc.jsxs)("button",{className:"learn-more-btn",onClick:()=>{e?(n&&(n.leaveCall(),r(null)),t(!1)):(async()=>{try{const e=new mc;r(e),e.addEventListener("status",e=>{}),e.addEventListener("transcripts",e=>{});const n="https://api.ultravox.ai/api/agents/".concat("194d06e7-c393-4ff6-847a-6fbdb7d8fcfb","/calls"),i={"Content-Type":"application/json","X-Unsafe-API-Key":"l3XFSy7o.DRrCu5jG9FQT80s929C13OqWWVXiQwst"},a=await fetch(n,{method:"POST",headers:i,body:JSON.stringify({medium:{webRtc:{}},recordingEnabled:!0,firstSpeakerSettings:{agent:{}},initialOutputMedium:"MESSAGE_MEDIUM_VOICE"}),mode:"cors"});if(!a.ok){const e=await a.text();throw new Error("API request failed with status ".concat(a.status,": ").concat(e))}const o=await a.json(),{joinUrl:s}=o;if(!s)throw new Error("No joinUrl received from API");e.joinCall(s),t(!0)}catch(e){alert("Failed to start call: ".concat(e.message))}})()},children:[e?(0,gc.jsx)(b,{size:16}):(0,gc.jsx)(y,{size:16}),(0,gc.jsx)("span",{children:e?"End Call":"Let's talk"})]})]})]}),(0,gc.jsxs)("main",{className:"main",children:[(0,gc.jsxs)("div",{className:"headshot-container",children:[(0,gc.jsx)("img",{src:"/headshot.jpeg",alt:"Miracle Lee",className:"headshot"}),(0,gc.jsx)("img",{src:"/dubhacks.jpeg",alt:"DubHacks Hackathon",className:"dubhacks-image"}),(0,gc.jsx)("iframe",{className:"video-element",src:"https://www.youtube.com/embed/NZzUOnmgbkM",title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0})]}),(0,gc.jsxs)("div",{className:"bio-section",children:[(0,gc.jsx)("p",{className:"bio",children:"I'm a software engineer with a passion for AI, startups, and creating impactful tech experiences."}),(0,gc.jsxs)("p",{className:"current",children:["Currently, I'm a Software Engineer Intern at ",(0,gc.jsx)("a",{href:"https://www.ultravox.ai/",target:"_blank",rel:"noopener noreferrer",children:(0,gc.jsx)("em",{children:"Ultravox.Ai "})}),"where I am performing full-stack production engineering and creating investor-facing demos."]}),(0,gc.jsxs)("p",{className:"clubs",children:["At the University of Washington, I'm the Director of Logistics at ",(0,gc.jsx)("a",{href:"https://dubhacks.co/",target:"_blank",rel:"noopener noreferrer",children:(0,gc.jsx)("em",{children:"DubHacks"})}),", the largest collegiate hackathon in the Pacific Northwest. I'm also the Public Relations Director at ",(0,gc.jsx)("a",{href:"https://gen1.cs.washington.edu/",target:"_blank",rel:"noopener noreferrer",children:(0,gc.jsx)("em",{children:"GEN1"})}),", an RSO for first-generation students in the Paul G. Allen School of Computer Science."]})]})]}),(0,gc.jsxs)("footer",{className:"footer",id:"connect",children:[(0,gc.jsx)("div",{className:"links",children:(0,gc.jsxs)("div",{className:"social-links",children:[(0,gc.jsx)("a",{href:"https://www.linkedin.com/in/miracle-lee1",target:"_blank",rel:"noopener noreferrer",className:"link linkedin",children:"LinkedIn"}),(0,gc.jsx)("a",{href:"/Miracle_Lee_Resume.pdf",target:"_blank",rel:"noopener noreferrer",className:"link resume",children:"Resume"}),(0,gc.jsx)("a",{href:"mailto:ml284@uw.edu",className:"link email",children:"Email"})]})}),(0,gc.jsxs)("p",{className:"footer-text",children:[" Made with \u2764\ufe0f by Miracle Lee using JavaScript, Tailwind CSS, and HTML | This site is open source on ",(0,gc.jsx)("a",{href:"https://github.com/MiraLee251",target:"_blank",rel:"noopener noreferrer",children:"my GitHub"})]})]})]})})},bc=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,453)).then(t=>{let{getCLS:n,getFID:i,getFCP:r,getLCP:a,getTTFB:o}=t;n(e),i(e),r(e),a(e),o(e)})};r.createRoot(document.getElementById("root")).render((0,gc.jsx)(i.StrictMode,{children:(0,gc.jsx)(vc,{})})),bc()})();
//# sourceMappingURL=main.26dacf08.js.map